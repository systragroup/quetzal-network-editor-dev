"use strict";(self.webpackChunkquetzal_network_editor=self.webpackChunkquetzal_network_editor||[]).push([[265],{9265:(e,t,s)=>{s.r(t),s.d(t,{default:()=>l});var i=function(){var e=this,t=e._self._c;return t("section",[t("MglGeojsonLayer",e._g({attrs:{"source-id":"links",source:{type:"geojson",data:e.visibleLinks,buffer:0,promoteId:"index"},"layer-id":"links",layer:{interactive:!0,type:"line",minzoom:1,maxzoom:18,paint:{"line-color":["case",["has","route_color"],["concat","#",["get","route_color"]],"#B5E0D6"],"line-opacity":["case",["boolean",e.isEditorMode,!1],.1,1],"line-width":["case",["has","route_width"],["case",["to-boolean",["to-number",["get","route_width"]]],["to-number",["get","route_width"]],3],3]},layout:{"line-sort-key":["to-number",["get","route_width"]],"line-cap":"round"}}}},e.isEditorMode?{}:{mouseenter:e.enterLink,mouseleave:e.leaveLink,contextmenu:e.editLineProperties})),e._v(" "),t("MglGeojsonLayer",{attrs:{"source-id":"nodes",source:{type:"geojson",data:e.visibleNodes,buffer:0,promoteId:"index"},"layer-id":"nodes",layer:{interactive:!0,type:"circle",minzoom:12,maxzoom:18,paint:{"circle-color":["case",["boolean",e.isEditorMode,!1],"#9E9E9E","#2C3E4E"],"circle-stroke-color":"#ffffff","circle-stroke-width":1,"circle-radius":["case",["has","route_width"],["case",["to-boolean",["to-number",["get","route_width"]]],["to-number",["get","route_width"]],3],3]}}}})],1)};i._withStripped=!0;var r=s(1963),o=s(6158),n=s.n(o);const a={name:"StaticLinks",components:{MglGeojsonLayer:r.tf},props:["map","showedTrips","isEditorMode"],events:["rightClick"],data:()=>({visibleNodes:{},visibleLinks:{},selectedFeatures:[]}),computed:{selectedPopupContent(){return this.$store.getters.linksPopupContent},links(){return this.$store.getters.links},nodes(){return this.$store.getters.nodes}},watch:{showedTrips(e,t){let s="";e.length<t.length?(s=new Set(t.filter((t=>!e.includes(t)))),this.setHiddenFeatures("remove",s)):e.length>t.length?(s=new Set(e.filter((e=>!t.includes(e)))),this.setHiddenFeatures("add",s)):this.setHiddenFeatures()},isEditorMode(e){e?this.map.off("dblclick",this.selectLine):this.map.on("dblclick",this.selectLine)}},created(){this.setHiddenFeatures(),this.map.on("dblclick",this.selectLine)},methods:{enterLink(e){e.map.getCanvas().style.cursor="pointer",this.selectedFeatures=e.mapboxEvent.features,this.popup?.isOpen()&&this.popup.remove(),this.selectedPopupContent.length>0&&(this.popup=new(n().Popup)({closeButton:!1}).setLngLat([e.mapboxEvent.lngLat.lng,e.mapboxEvent.lngLat.lat]).setHTML(this.selectedFeatures[0].properties[this.selectedPopupContent]).addTo(e.map))},leaveLink(e){this.selectedFeatures=[],this.popup?.isOpen()&&this.popup.remove(),e.map.getCanvas().style.cursor=""},setHiddenFeatures(e="all",t=[]){if("all"===e){this.visibleLinks=structuredClone(this.$store.getters.linksHeader),this.visibleNodes=structuredClone(this.$store.getters.nodesHeader);const e=new Set(this.showedTrips);this.visibleLinks.features=this.links.features.filter((t=>e.has(t.properties.trip_id)));const t=[...new Set(this.visibleLinks.features.map((e=>Number(e.properties.route_width))))],s={};t.forEach((e=>s[e]=new Set)),this.visibleLinks.features.map((e=>[e.properties.a,e.properties.b].forEach((t=>s[Number(e.properties.route_width)].add(t)))));let i=new Set;for(let e=0;e<t.length-1;e++){const r=s[t[e+1]],o=s[t[e]];i=new Set([...i,...o]),s[t[e+1]]=new Set([...r].filter((e=>!i.has(e))))}t.forEach((e=>{const t=this.nodes.features.filter((t=>s[e].has(t.properties.index)));t.map((t=>t.properties.route_width=e)),this.visibleNodes.features.push(...t)}))}else if("remove"===e){this.visibleLinks.features=this.visibleLinks.features.filter((e=>!t.has(e.properties.trip_id)));const e=this.visibleLinks.features.map((e=>e.properties.a)),s=this.visibleLinks.features.map((e=>e.properties.b)),i=new Set([...e,...s]);this.visibleNodes.features=this.visibleNodes.features.filter((e=>i.has(e.properties.index)))}else if("add"===e){const e=this.links.features.filter((e=>t.has(e.properties.trip_id)));this.visibleLinks.features.push(...e);const s=[...new Set(e.map((e=>Number(e.properties.route_width))))];s.sort((function(e,t){return t-e}));const i={};s.forEach((e=>i[e]=new Set)),e.map((e=>[e.properties.a,e.properties.b].forEach((t=>i[Number(e.properties.route_width)].add(t)))));let r=new Set;for(let e=0;e<s.length-1;e++){const t=i[s[e+1]],o=i[s[e]];r=new Set([...r,...o]),i[s[e+1]]=new Set([...t].filter((e=>!r.has(e))))}s.forEach((e=>{const t=this.nodes.features.filter((t=>i[e].has(t.properties.index)));t.map((t=>t.properties.route_width=e)),this.visibleNodes.features.push(...t)}))}},selectLine(e){if(e.preventDefault(),0===this.selectedFeatures.length){const t=[[e.point.x-5,e.point.y-5],[e.point.x+5,e.point.y+5]];this.selectedFeatures=this.map.queryRenderedFeatures(t,{layers:["links"]})}this.selectedFeatures.length>0&&(this.$store.commit("setEditorTrip",{tripId:this.selectedFeatures[0].properties.trip_id,changeBounds:!1}),this.$store.commit("changeNotification",{text:"",autoClose:!0}))},editLineProperties(e){this.$store.commit("setEditorTrip",{tripId:e.mapboxEvent.features[0].properties.trip_id,changeBounds:!1}),this.$emit("rightClick",{action:"Edit Line Info",lingering:!1})}}},l=(0,s(1900).Z)(a,i,[],!1,null,"74160ab4",null).exports}}]);
//# sourceMappingURL=265.build.js.map