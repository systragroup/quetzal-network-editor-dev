"use strict";(self.webpackChunkquetzal_network_editor=self.webpackChunkquetzal_network_editor||[]).push([[533],{50769:(e,t,r)=>{r.d(t,{Z:()=>i});var o=r(87537),s=r.n(o),a=r(23645),n=r.n(a)()(s());n.push([e.id,".container[data-v-096c1da2]{width:100%;overflow:hidden;margin-left:0 auto;margin-right:0 auto;padding:0 0 0 0}.layout[data-v-096c1da2]{position:absolute;width:100%;height:calc(100% - 50px);display:flex;flex-flow:row;justify-content:center;align-items:center}.layout-overlay[data-v-096c1da2]{height:100%;width:100%;background-color:rgba(0,0,0,.5);position:absolute}.card[data-v-096c1da2]{height:100%;overflow-y:auto;padding:2.5rem}.card2[data-v-096c1da2]{height:100%;overflow-y:auto;padding:2.5rem;margin-right:3rem}.v-card__text[data-v-096c1da2]{max-height:80%;overflow-y:auto}.row[data-v-096c1da2]{height:calc(100% - 38px)}.col[data-v-096c1da2]{max-height:100%}.title[data-v-096c1da2]{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:3.5em;color:#b5e0d6 !important;font-weight:bold}.subtitle[data-v-096c1da2]{font-size:2em;color:var(--v-secondary-dark);font-weight:bold;margin:10px;margin-left:0px}.card button[data-v-096c1da2]{margin-top:0px}.background[data-v-096c1da2]{background-color:var(--v-background-base)}div.gallery[data-v-096c1da2]{margin:5px;background-color:var(--v-white-base);border:1px solid var(--v-lightgrey-base);float:left;width:50rem}div.gallery[data-v-096c1da2]:hover{border:1px solid var(--v-darkgrey-base)}div.gallery img[data-v-096c1da2]{width:100%;height:auto}","",{version:3,sources:["webpack://./src/components/microservices/MatrixRoadCaster.vue"],names:[],mappings:"AAEA,4BACE,UAAA,CACA,eAAA,CACA,kBAAA,CACA,mBAAA,CACA,eAAA,CAEF,yBACE,iBAAA,CACA,UAAA,CACA,wBAAA,CACA,YAAA,CACA,aAAA,CACA,sBAAA,CACA,kBAAA,CAEF,iCACE,WAAA,CACA,UAAA,CACA,+BAAA,CACA,iBAAA,CAEF,uBACE,WAAA,CACA,eAAA,CACA,cAAA,CAEF,wBACE,WAAA,CACA,eAAA,CACA,cAAA,CACA,iBAAA,CAGF,+BACE,cAAA,CACA,eAAA,CAEF,sBACE,wBAAA,CAEF,sBACE,eAAA,CAEF,wBACE,YAAA,CACA,qBAAA,CACA,kBAAA,CACA,sBAAA,CACA,eAAA,CACA,wBAAA,CACA,gBAAA,CAEF,2BACE,aAAA,CACA,6BAAA,CACA,gBAAA,CACA,WAAA,CACA,eAAA,CAEF,8BACE,cAAA,CAEF,6BACE,yCAAA,CAGF,6BACE,UAAA,CACA,oCAAA,CACA,wCAAA,CACA,UAAA,CACA,WAAA,CAGF,mCACE,uCAAA,CAGF,iCACE,UAAA,CACA,WAAA",sourcesContent:['@import "@scss/variables.scss";\n\n.container {\n  width: 100%;\n  overflow: hidden;\n  margin-left: 0 auto;\n  margin-right: 0 auto;\n  padding: 0 0 0 0;\n}\n.layout {\n  position: absolute;\n  width: calc(100%);\n  height: calc(100% - 50px);\n  display: flex;\n  flex-flow: row;\n  justify-content: center;\n  align-items: center;\n}\n.layout-overlay {\n  height: 100%;\n  width: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  position: absolute;\n}\n.card {\n  height: 100%;\n  overflow-y: auto;\n  padding: 2.5rem;\n}\n.card2 {\n  height: 100%;\n  overflow-y: auto;\n  padding: 2.5rem;\n  margin-right: 3rem;\n}\n\n.v-card__text {\n  max-height: 80%;\n  overflow-y: auto;\n}\n.row {\n  height: calc(100% - 38px)\n}\n.col {\n  max-height: 100%;\n}\n.title {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  font-size: 3.5em;\n  color: $primary !important;\n  font-weight: bold;\n}\n.subtitle {\n  font-size: 2em;\n  color:var(--v-secondary-dark);\n  font-weight: bold;\n  margin: 10px;\n  margin-left: 0px;\n}\n.card button {\n  margin-top: 0px;\n}\n.background {\n  background-color:var(--v-background-base);\n}\n\ndiv.gallery {\n  margin: 5px;\n  background-color: var(--v-white-base);\n  border: 1px solid var(--v-lightgrey-base);\n  float: left;\n  width: 50rem;\n}\n\ndiv.gallery:hover {\n  border: 1px solid var(--v-darkgrey-base);\n}\n\ndiv.gallery img {\n  width: 100%;\n  height: auto;\n}\n\n'],sourceRoot:""}]);const i=n},90941:(e,t,r)=>{r.d(t,{Z:()=>i});var o=r(87537),s=r.n(o),a=r(23645),n=r.n(a)()(s());n.push([e.id,".card[data-v-3988604c]{height:100%;overflow-y:auto;padding:2.5rem}.map[data-v-3988604c]{max-width:100rem;width:50rem;height:35rem}.v-card__text[data-v-3988604c]{padding:0px 24px 0px}.freeform-button[data-v-3988604c]{position:absolute;top:5px;right:5px}","",{version:3,sources:["webpack://./src/components/microservices/OSMImporter.vue"],names:[],mappings:"AAGA,uBACE,WAAA,CACA,eAAA,CACA,cAAA,CAEF,sBACE,gBAAA,CACA,WAAA,CACA,YAAA,CAEF,+BACI,oBAAA,CAEJ,kCACE,iBAAA,CACA,OAAA,CACA,SAAA",sourcesContent:['@import "@scss/variables.scss";\n\n\n.card {\n  height: 100%;\n  overflow-y: auto;\n  padding: 2.5rem;\n}\n.map {\n  max-width: 100rem;\n  width:50rem;\n  height: 35rem;\n}\n.v-card__text {\n    padding: 0px 24px 0px;\n}\n.freeform-button {\n  position: absolute;\n  top: 5px;\n  right: 5px;\n}\n'],sourceRoot:""}]);const i=n},53045:(e,t,r)=>{r.d(t,{Z:()=>i});var o=r(87537),s=r.n(o),a=r(23645),n=r.n(a)()(s());n.push([e.id,".layout[data-v-bd9695f2]{position:absolute;width:100%;height:calc(100% - 50px);display:flex;flex-flow:row;justify-content:center;align-items:center}.layout-overlay[data-v-bd9695f2]{height:100%;width:100%;background-color:var(--v-background-base);position:absolute}","",{version:3,sources:["webpack://./src/pages/Microservices.vue"],names:[],mappings:"AAEA,yBACE,iBAAA,CACA,UAAA,CACA,wBAAA,CACA,YAAA,CACA,aAAA,CACA,sBAAA,CACA,kBAAA,CAEF,iCACE,WAAA,CACA,UAAA,CACA,yCAAA,CAEA,iBAAA",sourcesContent:['@import "@scss/variables.scss";\n\n.layout {\n  position: absolute;\n  width: calc(100%);\n  height: calc(100% - 50px);\n  display: flex;\n  flex-flow: row;\n  justify-content: center;\n  align-items: center;\n}\n.layout-overlay {\n  height: 100%;\n  width: 100%;\n  background-color:var(--v-background-base);\n\n  position: absolute;\n}\n'],sourceRoot:""}]);const i=n},14533:(e,t,r)=>{r.r(t),r.d(t,{default:()=>G});var o=function(){var e=this,t=e._self._c;return t("section",[t("v-tabs",{attrs:{centered:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[t("v-tab",[e._v("OSM importer")]),e._v(" "),t("v-tab",[e._v("Matrix Road Caster")])],1),e._v(" "),t("div",{staticClass:"layout"},[t("div",{staticClass:"layout-overlay"}),e._v(" "),0===e.tab?t("OSMImporter"):1===e.tab?t("MatrixRoadCaster"):e._e()],1)],1)};o._withStripped=!0;var s=function(){var e=this,t=e._self._c;return t("v-row",{staticClass:"ma-0 pa-2 background"},[t("v-col",[t("v-card",{staticClass:"card"},[t("v-card-title",{staticClass:"subtitle"},[e._v("\n        "+e._s(e.$gettext("ML Matrix Road Caster"))+"\n      ")]),e._v(" "),t("p",[e._v(" "+e._s(e.$gettext("1) Find n zones centroids using a Kmean clustering on the nodes")))]),e._v(" "),t("p",[e._v(" "+e._s(e.$gettext("2) Call the Here Matrix API on random OD ( around 1% is sufficient )")))]),e._v(" "),t("p",[e._v(" "+e._s(e.$gettext("3) Interpolate every other OD time with an hybrid Machine learning model")))]),e._v(" "),t("p",[e._v(" "+e._s(e.$gettext("4) ajust the speed on the road network to match the routing time with the OD time using an iterative algorithm")))]),e._v(" "),t("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.validForm,callback:function(t){e.validForm=t},expression:"validForm"}},e._l(e.parameters,(function(r,o){return t("div",{key:o},[void 0===r.items?t("v-text-field",{attrs:{type:r.type,label:e.$gettext(r.text),suffix:r.units,hint:e.showHint?e.$gettext(r.hint):"","persistent-hint":e.showHint,rules:r.rules.map((t=>e.rules[t])),required:""},on:{wheel:()=>{}},model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"item.value"}}):t("v-select",{attrs:{type:r.type,items:r.items,label:e.$gettext(r.text),suffix:r.units,hint:e.showHint?e.$gettext(r.hint):"","persistent-hint":e.showHint,rules:r.rules.map((t=>e.rules[t])),required:""},on:{wheel:()=>{}},model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"item.value"}})],1)})),0),e._v(" "),t("v-card-actions",[t("v-btn",{attrs:{color:"success",loading:e.running||"RUNNING"===e.importStatus,disabled:e.running||"RUNNING"===e.importStatus||!e.validForm},on:{click:function(t){return e.run()}}},[t("v-icon",{staticStyle:{"margin-right":"10px"},attrs:{small:""}},[e._v("\n            fa-solid fa-play\n          ")]),e._v("\n          "+e._s(e.$gettext("Run"))+"\n        ")],1),e._v(" "),t("v-btn",{directives:[{name:"show",rawName:"v-show",value:"RUNNING"==e.importStatus,expression:"importStatus == 'RUNNING'"}],attrs:{color:"grey",text:""},on:{click:function(t){return e.stopRun()}}},[e._v("\n          "+e._s(e.$gettext("Abort"))+"\n        ")]),e._v(" "),t("v-card-text",{directives:[{name:"show",rawName:"v-show",value:"RUNNING"==e.importStatus,expression:"importStatus == 'RUNNING'"}]},[e._v("\n          ~ "+e._s(e.timer>0?Math.ceil(e.timer/60):e.$gettext("less than 1"))+e._s(e.$gettext(" minutes remaining"))+"\n        ")]),e._v(" "),t("v-spacer"),e._v(" "),t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){e.showHint=!e.showHint}}},[t("v-icon",[e._v("far fa-question-circle small")])],1)],1)],1)],1),e._v(" "),t("v-col",[t("v-card",{staticClass:"card2"},[t("v-card-title",{staticClass:"subtitle"},[e._v("\n        "+e._s(e.$gettext("Calibration Results"))+"\n      ")]),e._v(" "),t("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.imgs.length>0,expression:"imgs.length>0"}],attrs:{loading:e.applying,disabled:e.applying},on:{click:e.ApplyResults}},[t("v-icon",{staticStyle:{"margin-right":"10px"},attrs:{small:""}},[e._v("\n          fa-solid fa-upload\n        ")]),e._v("\n        "+e._s(e.$gettext("Apply Road links to project"))+"\n      ")],1),e._v(" "),t("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.imgs.length>0,expression:"imgs.length>0"}],attrs:{loading:e.exporting,disabled:e.exporting},on:{click:e.download}},[t("v-icon",{staticStyle:{"margin-right":"10px"},attrs:{small:""}},[e._v("\n          fa-solid fa-download\n        ")]),e._v("\n        "+e._s(e.$gettext("Download"))+"\n      ")],1),e._v(" "),e.error?t("v-alert",{attrs:{dense:"",outlined:"",text:"",type:"error"}},[e._v("\n        "+e._s(e.$gettext("Service ended with an execution error or have been aborted.           Please retry. If the problem persist, contact us."))+"\n        "),e._l(Object.keys(e.errorMessage),(function(r){return t("p",{key:r},[t("b",[e._v(e._s(r)+": ")]),e._v(e._s(e.errorMessage[r])+"\n        ")])}))],2):e._e(),e._v(" "),e._l(e.imgs,(function(e,r){return t("div",{key:r,staticClass:"gallery"},[t("v-img",{attrs:{src:e,alt:"image",contain:""}})],1)}))],2)],1)],1)};s._withStripped=!0;var a=r(60887);const n={name:"MatrixRoadCaster",components:{},data(){return{imgs:[],exporting:!1,applying:!1,validForm:!0,parameters:[{name:"num_zones",text:"number of zones",value:null,type:"Number",units:"",hint:"number of zones. road nodes will be aggregate to form centroids",rules:["required","largerThanZero"]},{name:"train_size",text:"number of OD (api call)",value:null,type:"Number",units:"",hint:"number of OD to get from the API, the rest will be interpolated with ML",rules:["required","largerThanZero"]},{name:"date_time",text:"date Time",value:null,type:"String",units:"",hint:"DateTime in the past. (YYYY-MM-DDTHH:MM:SS(UTC-timezone) (-04:00 for montreal))",rules:["required","dateTimeRule"]},{name:"ff_time_col",text:"freeflow time on roads",value:null,items:this.$store.getters.rlineAttributes,type:"String",units:"",hint:"road links time (link length / speed) to use as a first approximation. this is the freeflow speed, or speed limit",rules:["required"]},{name:"max_speed",text:"max speed on road",value:null,type:"Number",units:"",hint:"Maximum allowed speed on a road. applying an OD matrix on the road network could result il unrealistic speed if not used.",rules:["required","largerThanZero"]},{name:"num_random_od",text:"number of OD to plot",value:null,type:"Number",units:"",hint:"number of OD calibration plot to produce. those are random OD.",rules:["required","largerThanZero"]},{name:"hereApiKey",text:"HERE api key",value:null,type:"String",units:"",hint:"HERE api key to download a set of OD",rules:["required"]}],showHint:!1,re:/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,rules:{required:e=>!!e||"Required",largerThanZero:e=>e>0||"should be larger than 0",nonNegative:e=>e>=0||"should be larger or equal to 0",dateTimeRule:e=>this.re.test(e)||"invalid date time"}}},computed:{bucket(){return this.$store.getters["runMRC/bucket"]},callID(){return this.$store.getters["runMRC/callID"]},timer(){return this.$store.getters["runMRC/timer"]},importStatus(){return this.$store.getters["runMRC/status"]},running(){return this.$store.getters["runMRC/running"]},error(){return this.$store.getters["runMRC/error"]},errorMessage(){return this.$store.getters["runMRC/errorMessage"]}},watch:{importStatus(e){"SUCCEEDED"===e&&this.getImagesURL()}},created(){const e=this.$store.getters["runMRC/parameters"];this.parameters.forEach((t=>t.value=e[t.name])),this.callID&&this.getImagesURL()},methods:{run(){if(!this.$refs.form.validate())return;this.$store.commit("runMRC/setCallID");const e={callID:this.callID};this.parameters.forEach((t=>{e[t.name]=t.value})),this.$store.dispatch("runMRC/startExecution",{rlinks:this.$store.getters.rlinks,rnodes:this.$store.getters.rnodes,parameters:e})},stopRun(){this.$store.dispatch("runMRC/stopExecution")},async ApplyResults(){this.applying=!0;const e=await a.Z.readJson(this.bucket,this.callID.concat("/road_links.geojson"));this.$store.commit("loadrLinks",e);const t=await a.Z.readJson(this.bucket,this.callID.concat("/road_nodes.geojson"));this.$store.commit("loadrNodes",t),this.applying=!1,this.$store.commit("changeNotification",{text:"Road links applied!",autoClose:!0,color:"success"})},async getImagesURL(){const e=(await a.Z.listFiles(this.bucket,this.callID+"/")).filter((e=>e.endsWith(".png")));for(const t of e){const e=await a.Z.getImagesURL(this.bucket,t);this.imgs.push(e)}},async download(){this.exporting=!0,await a.Z.downloadFolder(this.bucket,this.callID.concat("/")),this.exporting=!1}}};var i=r(93379),l=r.n(i),d=r(7795),c=r.n(d),h=r(90569),u=r.n(h),m=r(3565),p=r.n(m),v=r(19216),g=r.n(v),A=r(44589),y=r.n(A),C=r(50769),f={};f.styleTagTransform=y(),f.setAttributes=p(),f.insert=u().bind(null,"head"),f.domAPI=c(),f.insertStyleElement=g(),l()(C.Z,f),C.Z&&C.Z.locals&&C.Z.locals;var b=r(51900);const x=(0,b.Z)(n,s,[],!1,null,"096c1da2",null).exports;var w=function(){var e=this,t=e._self._c;return t("section",[t("v-card",{staticClass:"card"},[t("v-card-title",[e._v("\n      "+e._s(e.$gettext("Import OSM network in bounding box"))+"\n    ")]),e._v(" "),t("v-spacer"),e._v(" "),t("v-card-subtitle",[e.error?t("v-alert",{attrs:{dense:"",width:"50rem",outlined:"",text:"",type:"error"}},[e._v("\n        "+e._s(e.$gettext("There as been an error while importing OSM network.           Please try again. If the problem persist, contact us."))+"\n        "),e._l(Object.keys(e.errorMessage),(function(r){return t("p",{key:r},[t("b",[e._v(e._s(r)+": ")]),e._v(e._s(e.errorMessage[r])+"\n        ")])}))],2):e._e()],1),e._v(" "),t("v-card-actions",[t("MglMap",{key:e.mapStyle,staticClass:"map",attrs:{"access-token":e.mapboxPublicKey,"map-style":e.mapStyle},on:{load:e.onMapLoaded,click:e.addNode}},[t("MglScaleControl",{attrs:{position:"bottom-right"}}),e._v(" "),t("MglNavigationControl",{attrs:{position:"bottom-right"}}),e._v(" "),[t("v-btn",{staticClass:"freeform-button",attrs:{fab:"",small:""},on:{click:e.toggleFreeForm}},[t("v-icon",{attrs:{color:"regular"}},[e._v("\n              "+e._s(e.freeForm?"far fa-square":"fas fa-vector-square")+"\n            ")])],1)],e._v(" "),t("MglGeojsonLayer",{attrs:{"source-id":"polygon",source:{type:"geojson",data:e.poly,promoteId:"index"},"layer-id":"poly",layer:{interactive:!0,type:"fill",paint:{"fill-color":e.$vuetify.theme.currentTheme.linksprimary,"fill-opacity":.3}}},on:{mouseover:e.onHover,mouseleave:e.offHover}}),e._v(" "),t("MglGeojsonLayer",{attrs:{"source-id":"polygon",type:"line",source:"polygon","layer-id":"stroke",layer:{type:"line",paint:{"line-color":e.$vuetify.theme.currentTheme.linksprimary,"line-width":3}}}}),e._v(" "),e.mapIsLoaded?t("NodesLayer",{attrs:{map:e.map,nodes:e.freeForm?e.nodes:e.nodesHeader,active:e.freeForm},on:{move:e.moveNode,rightClick:e.removeNode}}):e._e()],2)],1),e._v(" "),t("v-divider"),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),t("v-select",{attrs:{items:e.highwayList,attach:"",chips:"","menu-props":{top:!0,offsetY:!0},label:"Highways to import",multiple:""},scopedSlots:e._u([{key:"selection",fn:function({item:r,index:o}){return[o<=0?t("v-chip",[t("span",[e._v(e._s(r))])]):e._e(),e._v(" "),1===o?t("span",{staticClass:"grey--text text-caption"},[e._v("\n            (+"+e._s(e.selectedHighway.length-1+" "+e.$gettext("more"))+" )\n          ")]):e._e()]}}]),model:{value:e.selectedHighway,callback:function(t){e.selectedHighway=t},expression:"selectedHighway"}}),e._v(" "),t("v-spacer"),e._v(" "),t("v-btn",{attrs:{text:"",outlined:"",color:"success",loading:e.running,disabled:e.running},on:{click:e.importOSM}},[e._v("\n        "+e._s(e.$gettext("Download"))+"\n      ")])],1)],1),e._v(" "),t("v-dialog",{attrs:{persistent:"","max-width":"500"},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.applyOverwriteDialog.apply(null,arguments)},function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"]))return null;e.showOverwriteDialog=!1}]},model:{value:e.showOverwriteDialog,callback:function(t){e.showOverwriteDialog=t},expression:"showOverwriteDialog"}},[t("v-card",[t("v-card-title",{staticClass:"text-h5"},[e._v("\n        "+e._s(e.$gettext("Overwrite current road network ?"))+"\n      ")]),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),t("v-btn",{attrs:{color:"regular"},on:{click:function(t){e.showOverwriteDialog=!e.showOverwriteDialog}}},[e._v("\n          "+e._s(e.$gettext("No"))+"\n        ")]),e._v(" "),t("v-btn",{attrs:{color:"primary"},on:{click:e.applyOverwriteDialog}},[e._v("\n          "+e._s(e.$gettext("Yes"))+"\n        ")])],1)],1)],1)],1)};w._withStripped=!0;var _=r(1963),k=function(){var e=this;return(0,e._self._c)("MglGeojsonLayer",{attrs:{"source-id":"nodes",source:{type:"geojson",data:e.nodes,buffer:0,promoteId:"index"},"layer-id":"nodes",layer:{interactive:!0,type:"circle",paint:{"circle-color":"#ffffff","circle-opacity":.5,"circle-radius":["case",["boolean",["feature-state","hover"],!1],10,5],"circle-blur":["case",["boolean",["feature-state","hover"],!1],.3,0],"circle-stroke-color":e.$vuetify.theme.currentTheme.darkgrey,"circle-stroke-width":2}}},on:{mouseover:e.onCursor,mouseleave:e.offCursor,mousedown:e.moveNode,contextmenu:e.rightClick}})};k._withStripped=!0;const I={name:"NodesLayer",components:{MglGeojsonLayer:_.tf},props:["map","nodes","active"],event:["move","rightClick"],data:()=>({hoveredStateId:null,keepHovering:!1,dragNode:!1}),computed:{},watch:{},created(){},methods:{onCursor(e){if(this.active&&null===this.hoveredStateId){this.map.getCanvas().style.cursor="pointer";const t=[...new Set(e.mapboxEvent.features.map((e=>e.id)))];this.hoveredStateId={layerId:e.layerId,id:t},this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id[0]},{hover:!0})}},offCursor(e){this.active&&null!==this.hoveredStateId&&(this.keepHovering?this.dragNode=!0:(this.map.getCanvas().style.cursor="",this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id[0]},{hover:!1}),this.hoveredStateId=null))},rightClick(e){if(!this.dragNode&&"nodes"===this.hoveredStateId?.layerId){const e=this.map.querySourceFeatures(this.hoveredStateId.layerId).filter((e=>e.id===this.hoveredStateId.id[0]))[0],t={selectedFeature:e};e&&this.$emit("rightClick",t)}},moveNode(e){if(this.active&&"nodes"===this.hoveredStateId?.layerId&&0===e.mapboxEvent.originalEvent.button){e.mapboxEvent.preventDefault(),this.map.getCanvas().style.cursor="grab",this.keepHovering=!0;const t=this.map.querySourceFeatures(this.hoveredStateId.layerId);this.selectedFeature=t.filter((e=>e.id===this.hoveredStateId.id[0]))[0],this.selectedFeature?.properties&&(this.map.on("mousemove",this.onMove),this.map.on("mouseup",this.stopMovingNode))}},onMove(e){if(this.dragNode&&this.selectedFeature){const t={selectedFeature:this.selectedFeature,lngLat:Object.values(e.lngLat)};this.$emit("move",t)}},stopMovingNode(e){this.active&&0===e.originalEvent.button&&(this.map.getCanvas().style.cursor="pointer",this.map.off("mousemove",this.onMove),this.keepHovering=!1,this.dragNode=!1,this.map.getCanvas().style.cursor="",this.hoveredStateId&&this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id[0]},{hover:!1}),this.hoveredStateId=null,this.map.off("mouseup",this.stopMovingNode))}}},M=(0,b.Z)(I,k,[],!1,null,"512658b6",null).exports;var S=r(95637),$=r(95),E=r(23384),N=r.n(E),B=r(59903),F=r.n(B),O=r(50253),R=r(36463),D=r(75997),Z=r(34221);const H=r(7597),L={name:"OSMImporter",components:{MglMap:_.Q3,MglNavigationControl:_.RV,MglScaleControl:_.RQ,MglGeojsonLayer:_.tf,NodesLayer:M},data:()=>({mapIsLoaded:!1,mapboxPublicKey:"pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",showOverwriteDialog:!1,bbox:null,poly:null,nodes:{},freeForm:!1,selectedHighway:null,highwayList:R.$z}),computed:{mapStyle(){return this.$store.getters.mapStyle},rlinksIsEmpty(){return this.$store.getters.rlinksIsEmpty},nodesHeader(){return this.$store.getters.nodesHeader},highway(){return this.$store.getters["runOSM/highway"]},bucket(){return this.$store.getters["runOSM/bucket"]},callID(){return this.$store.getters["runOSM/callID"]},importStatus(){return this.$store.getters["runOSM/status"]},running(){return this.$store.getters["runOSM/running"]},error(){return this.$store.getters["runOSM/error"]},errorMessage(){return this.$store.getters["runOSM/errorMessage"]}},watch:{mapStyle(){try{this.map.removeLayer("stroke")}catch(e){}},selectedHighway(e){this.$store.commit("runOSM/changeHighway",e)}},beforeDestroy(){try{this.map.removeLayer("stroke")}catch(e){}},created(){this.selectedHighway=this.highway},methods:{onMapLoaded(e){e.map.dragRotate.disable(),this.map=e.map,this.map.on("dragend",this.getBounds),this.map.on("zoomend",this.getBounds),this.freeForm=!1,this.getBounds(),this.mapIsLoaded=!0},getBounds(){this.bbox=this.map.getBounds();const e=(0,$.Z)([this.bbox._sw.lng,this.bbox._sw.lat,this.bbox._ne.lng,this.bbox._ne.lat]);this.poly=(0,S.Z)(e,-.1*(this.bbox._ne.lat-this.bbox._sw.lat),{units:"degrees"}),this.poly.geometry.coordinates[0]=this.poly.geometry.coordinates[0].reverse()},toggleFreeForm(e){this.freeForm=!this.freeForm,this.freeForm?(this.map.off("dragend",this.getBounds),this.map.off("zoomend",this.getBounds),this.getNodes(),this.$store.commit("changeNotification",{text:"Click to add points. Right click de remove",autoClose:!1})):(this.map.on("dragend",this.getBounds),this.map.on("zoomend",this.getBounds),this.getBounds(),this.$store.commit("changeNotification",{text:"",autoClose:!0}))},onHover(){this.freeForm&&(this.map.getCanvas().style.cursor="pointer")},offHover(){this.freeForm&&(this.map.getCanvas().style.cursor="")},getNodes(){const e=structuredClone(this.nodesHeader),t=this.poly.geometry.coordinates[0];t.slice(0,t.length-1).forEach(((t,r)=>e.features.push(N()(t,{index:H.generate(),coordinatesIndex:r})))),this.nodes=e},moveNode(e){const t=e.selectedFeature.properties.coordinatesIndex,r=this.poly.geometry.coordinates[0];r[t]=e.lngLat,0===t&&(r[r.length-1]=e.lngLat),this.getNodes()},removeNode(e){const t=e.selectedFeature.properties.coordinatesIndex,r=this.poly.geometry.coordinates[0];r.length<=4?this.$store.commit("changeNotification",{text:"Cannot delete anymore",autoClose:!0}):0===t?this.$store.commit("changeNotification",{text:"cannot delete first point of polygon",autoClose:!0}):(this.poly.geometry.coordinates[0]=[...r.slice(0,t),...r.slice(t+1)],this.getNodes())},addNode(e){if(this.freeForm){const t=this.poly.geometry.coordinates[0],r=e.mapboxEvent.lngLat,o=F()(t),s=N()(Object.values(r)),a=(0,O.Z)(o,s,{units:"kilometers"}).properties.index+1;t.splice(a,0,Object.values(r)),this.getNodes()}},importOSM(){if(this.rlinksIsEmpty)if(this.$store.commit("runOSM/setCallID"),this.freeForm){const e=this.poly.geometry.coordinates[0];this.$store.dispatch("runOSM/startExecution",{coords:e,method:"poly"})}else{const e=[this.bbox._sw.lat,this.bbox._sw.lng,this.bbox._ne.lat,this.bbox._ne.lng];this.$store.dispatch("runOSM/startExecution",{coords:e,method:"bbox"})}else this.showOverwriteDialog=!0},applyOverwriteDialog(){this.$store.commit("loadrLinks",D.Z),this.$store.commit("loadrNodes",Z.Z),this.showOverwriteDialog=!1,this.importOSM()}}};var j=r(90941),T={};T.styleTagTransform=y(),T.setAttributes=p(),T.insert=u().bind(null,"head"),T.domAPI=c(),T.insertStyleElement=g(),l()(j.Z,T),j.Z&&j.Z.locals&&j.Z.locals;const q={name:"Microservices",components:{MatrixRoadCaster:x,OSMImporter:(0,b.Z)(L,w,[],!1,null,"3988604c",null).exports},props:{value:{type:Array,default:()=>[]}},data:()=>({tab:0}),computed:{rlinksIsEmpty(){return this.$store.getters.rlinksIsEmpty}},watch:{tab(e){}},methods:{}};var U=r(53045),z={};z.styleTagTransform=y(),z.setAttributes=p(),z.insert=u().bind(null,"head"),z.domAPI=c(),z.insertStyleElement=g(),l()(U.Z,z),U.Z&&U.Z.locals&&U.Z.locals;const G=(0,b.Z)(q,o,[],!1,null,"bd9695f2",null).exports}}]);
//# sourceMappingURL=533.build.js.map