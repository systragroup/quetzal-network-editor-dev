import{_ as A,j as m,J as b,v as l,q as s,I as N,x as X,c7 as Y,G as Q,i as ee,ba as te,h as ae,u as se,r as k,e as g,ag as ne,k as S,m as n,a6 as O,F as p,y as a,z as o,b7 as w,aa as P,V as I,aM as le,L as F,M as G,K as re,c8 as oe,X as ie,T as E,B as ue,a5 as q,ar as de,c9 as ce,c5 as pe,c6 as me}from"./index-C1gN1_uD.js";const fe={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(i){this.$emit("update:date",this.parseOutput(i))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(i){if(i)return new Date(i.substring(0,4)+"-"+i.substring(4,6)+"-"+i.substring(6,8))},parseOutput(i){return i.toISOString().substring(0,10).replaceAll("-","")}}};function _e(i,t,c,C,u,f){return m(),b(Q,{modelValue:u.menu,"onUpdate:modelValue":t[1]||(t[1]=_=>u.menu=_),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:l(({props:_})=>[s(N,X({"model-value":f.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},_),null,16,["model-value"])]),default:l(()=>[s(Y,{modelValue:u.isoDate,"onUpdate:modelValue":t[0]||(t[0]=_=>u.isoDate=_),max:u.dateMax,min:u.dateMin},null,8,["modelValue","max","min"])]),_:1},8,["modelValue"])}const ve=A(fe,[["render",_e],["__scopeId","data-v-1eb87a33"]]),he=i=>(pe("data-v-43210d13"),i=i(),me(),i),ge={class:"params-row"},Se={class:"list"},ye={class:"list-row bold"},xe=he(()=>n("span",{class:"list-item-small"},null,-1)),Ve={class:"list-item-large"},De={class:"list-item-medium"},ke={class:"list-item-medium"},Ie={class:"list-item-medium"},be={class:"list-item-small"},Te={class:"list-item-small"},we={class:"list-item-large"},Fe={class:"list-item-medium"},Ge={class:"list-item-medium"},Ce={class:"list-item-medium"},Ue={class:"list-item-small"},Me={class:"bottom-button"},ze={__name:"GTFSZipImporter",setup(i){const{$gettext:t}=ee(),c=te(),C=ae(),u=se(),f=k(!1),_=k(!1),K=g(()=>C.linksIsEmpty),Z=g(()=>c.callID),y=g(()=>c.UploadedGTFS),D=g(()=>c.running),j=g(()=>c.error),U=g(()=>c.errorMessage),M=g(()=>y.value.filter(v=>v.progress<100).length>0);ne(()=>{c.saveParams(T.value)});const W={required:v=>!!v||t("Required")},T=k([{name:"start_time",text:"start time",value:c.parameters.start_time,type:"time",units:"",hint:"Start Time to restrict the GTFS in a period",rules:["required"]},{name:"end_time",text:"end time",value:c.parameters.end_time,type:"time",units:"",hint:"End Time to restrict the GTFS in a period",rules:["required"]}]),z=k();function $(){z.value.click(),document.getElementById("zip-input").value=""}async function H(v){try{u.changeLoading(!0);const d=v.target.files;if(!d.length){u.changeLoading(!1);return}for(const e of d){const r=await ce(e),h=r.reduce((x,V)=>V.start_date<x?V.start_date:x,r[0].start_date),J=r.reduce((x,V)=>V.end_date>x?V.end_date:x,r[0].end_date),R={content:e,info:{name:e.name,minDate:h,maxDate:J,date:h,progress:0}};await c.addGTFS(R)}u.changeLoading(!1)}catch(d){u.changeLoading(!1),u.changeAlert(d)}}function B(){if(K.value){const v=y.value.map(r=>r.name),d=y.value.map(r=>r.date),e={files:v,dates:d,callID:Z.value};T.value.forEach(r=>{e[r.name]=r.value}),c.startExecution(e)}else f.value=!0}function L(){u.initLinks(),f.value=!1,B()}return(v,d)=>(m(),S("div",null,[n("input",{id:"zip-input",ref_key:"zipInput",ref:z,type:"file",style:{display:"none"},accept:".zip",multiple:"multiple",onChange:H},null,544),s(E,{class:"card"},{default:l(()=>[s(O,{class:"subtitle"},{default:l(()=>[p(a(o(t)("GTFS importer")),1)]),_:1}),s(w,null,{default:l(()=>[p(a(o(t)("import GTFS from local computer")),1)]),_:1}),s(w,null,{default:l(()=>[p(a(o(t)("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),s(P,null,{default:l(()=>[s(I,{variant:"elevated",disabled:D.value,"prepend-icon":"fa-solid fa-file-archive",onClick:$},{default:l(()=>[p(a(o(t)("upload GTFS")),1)]),_:1},8,["disabled"])]),_:1}),s(w,null,{default:l(()=>[j.value?(m(),b(le,{key:0,density:"compact",variant:"outlined",text:"",type:"error"},{default:l(()=>[p(a(o(t)("There as been an error while converting your GTFS.             Please try again. If the problem persist, contact us."))+" ",1),(m(!0),S(F,null,G(Object.keys(U.value),e=>(m(),S("p",{key:e},[n("b",null,a(e)+": ",1),p(a(U.value[e]),1)]))),128))]),_:1})):re("",!0)]),_:1}),n("div",ge,[(m(!0),S(F,null,G(T.value,(e,r)=>(m(),S("div",{key:r,class:"params"},[s(N,{modelValue:e.value,"onUpdate:modelValue":h=>e.value=h,type:e.type,step:"1",variant:"underlined",label:o(t)(e.text),suffix:e.units,hint:_.value?o(t)(e.hint):"","persistent-hint":_.value,rules:e.rules.map(h=>W[h]),required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])]))),128))]),n("div",Se,[n("li",ye,[xe,n("span",Ve,a(o(t)("name")),1),n("span",De,a(o(t)("from")),1),n("span",ke,a(o(t)("to")),1),n("span",Ie,a(o(t)("selected date")),1),n("span",be,a(o(t)("Uploaded")),1)]),(m(!0),S(F,null,G(y.value,(e,r)=>(m(),S("ul",{key:r,class:"list-row"},[n("span",Te,a(r),1),n("span",we,a(e.name),1),n("span",Fe,a(e.minDate),1),n("span",Ge,a(e.maxDate),1),n("span",Ce,[s(ve,{date:e.date,from:e.minDate,to:e.maxDate,"onUpdate:date":h=>e.date=h},null,8,["date","from","to","onUpdate:date"])]),n("span",Ue,[e.progress<100?(m(),b(oe,{key:0,indeterminate:e.progress===0,absolute:"",color:"primary","model-value":e.progress},null,8,["indeterminate","model-value"])):(m(),b(ie,{key:1},{default:l(()=>[p("fas fa-check")]),_:1}))])]))),128))]),n("div",Me,[s(I,{loading:D.value,disabled:D.value||y.value.length==0||M.value,color:D.value||y.value.length==0||M.value?"regular":"success","prepend-icon":"fa-solid fa-play",onClick:B},{default:l(()=>[p(a(o(t)("convert")),1)]),_:1},8,["loading","disabled","color"])])]),_:1}),s(de,{modelValue:f.value,"onUpdate:modelValue":d[1]||(d[1]=e=>f.value=e),persistent:"","max-width":"500",onKeydown:[q(L,["enter"]),d[2]||(d[2]=q(e=>f.value=!1,["esc"]))]},{default:l(()=>[s(E,null,{default:l(()=>[s(O,{class:"text-h5"},{default:l(()=>[p(a(o(t)("Overwrite current PT network ?")),1)]),_:1}),s(P,null,{default:l(()=>[s(ue),s(I,{color:"regular",onClick:d[0]||(d[0]=e=>f.value=!f.value)},{default:l(()=>[p(a(o(t)("No")),1)]),_:1}),s(I,{color:"primary",onClick:L},{default:l(()=>[p(a(o(t)("Yes")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Le=A(ze,[["__scopeId","data-v-43210d13"]]);export{Le as default};
