import{_ as A,ac as M,ad as R,e as c,r as F,o as B,h as o,i as f,j as l,k as u,v as p,x as m,a9 as j,ab as O,m as V,s as q,ae as Y,q as S,E as k,af as G,ag as K,ah as W,F as w,a0 as X,Y as Z,L as I,S as J,G as _,a2 as Q,V as N,a1 as $,K as D,u as ee,w as te,g as ne,X as ae,W as L,ai as le,aj as re,ak as oe,al as H,y as se,z as ie,U as ue,am as z}from"./index-NbJYop57.js";const T=a=>a,de={name:"Settings",setup(){const a=M(),n=R(),g=c(()=>a.selectedStepFunction),e=c(()=>a.parameters),h=c(()=>e.value.filter(r=>Object.keys(r).includes("category")&&r.model===g.value)),y=c(()=>{var r;return(r=e.value.filter(v=>((v==null?void 0:v.info)&&(v==null?void 0:v.model))===g.value)[0])==null?void 0:r.info}),d=F([]);B(()=>{d.value=[...Array(h.value.length).keys()].map((r,v)=>v)});const s=c(()=>n.scenariosList),t=c(()=>n.scenario);function x(){a.getParameters({model:n.model,path:n.scenario+"/inputs/params.json"})}function i(){d.value.length<h.value.length?d.value=[...Array(h.value.length).keys()].map((r,v)=>v):d.value=[]}const C=F(null),P=F(!1),b={required:r=>r!=null||T("Required"),largerThanZero:r=>r>0||T("should be larger than 0"),nonNegative:r=>r>=0||T("should be larger or equal to 0")};function U(r){const v=s.value.map(E=>E.scenario);r.value=r.value.filter(E=>v.includes(E))}return{selectedStepFunction:g,paramsBrute:e,errorMessage:C,showHint:P,panel:d,parameters:h,info:y,rules:b,scenariosList:s,activeScenario:t,reset:x,expandAll:i,removeDeletedScenarios:U}}},ce={class:"expansion"};function fe(a,n,g,e,h,y){return o(),f(D,{class:"card"},{default:l(()=>[u(j,{class:"subtitle"},{default:l(()=>[p(m(a.$gettext("Scenario Settings")),1)]),_:1}),e.info?(o(),f(O,{key:0,class:"info-div"},{default:l(()=>[p(m(e.info),1)]),_:1})):V("",!0),q("div",ce,[u(J,{ref:"form","lazy-validation":""},{default:l(()=>[u(Y,{modelValue:e.panel,"onUpdate:modelValue":n[0]||(n[0]=d=>e.panel=d),multiple:""},{default:l(()=>[(o(!0),S(w,null,k(e.parameters,(d,s)=>(o(),f(G,{key:s},{default:l(()=>[u(K,{class:"categorie"},{default:l(()=>[p(m(d.category),1)]),_:2},1024),u(W,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:l(()=>[(o(!0),S(w,null,k(d.params,(t,x)=>(o(),S("li",{key:x},[typeof t.items>"u"&&typeof t.value=="boolean"?(o(),f(X,{key:0,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,label:a.$gettext(t.text),hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint"])):typeof t.items>"u"?(o(),f(Z,{key:1,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,variant:"underlined",type:t.type,label:a.$gettext(t.text),suffix:t.units,hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint,rules:t.rules.map(i=>e.rules[i])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):t.items==="$scenarios"?(o(),f(I,{key:2,modelValue:t.value,"onUpdate:modelValue":[i=>t.value=i,i=>e.removeDeletedScenarios(t)],variant:"underlined",type:t.type,items:e.scenariosList.map(i=>i.scenario).filter(i=>i!==e.activeScenario),multiple:"",label:a.$gettext(t.text),suffix:t.units,hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint,rules:t.rules.map(i=>e.rules[i])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"])):(o(),f(I,{key:3,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,variant:"underlined",type:t.type,items:t.items,label:a.$gettext(t.text),suffix:t.units,hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint,rules:t.rules.map(i=>e.rules[i])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),u($,null,{default:l(()=>[u(_,{color:"grey",variant:"text",onClick:e.reset},{default:l(()=>[p(m(a.$gettext("back to default")),1)]),_:1},8,["onClick"]),u(Q),u(_,{variant:"text",onClick:e.expandAll},{default:l(()=>[p(m(e.panel.length!=e.parameters.length?a.$gettext("Expand all"):a.$gettext("Collapse all")),1)]),_:1},8,["onClick"]),u(_,{icon:"",size:"small",onClick:n[1]||(n[1]=d=>e.showHint=!e.showHint)},{default:l(()=>[u(N,null,{default:l(()=>[p("far fa-question-circle small")]),_:1})]),_:1})]),_:1})]),_:1})}const pe=A(de,[["render",fe],["__scopeId","data-v-8781a814"]]),ve={name:"Run",components:{ParamForm:pe},setup(){const a=ee(),n=M(),g=R(),e=F(""),h=c(()=>n.steps),y=c(()=>{const r=n.availableModels;return n.avalaibleStepFunctions.filter(v=>r.has(v))}),d=c(()=>n.selectedStepFunction),s=c(()=>n.running),t=c(()=>n.currentStep),x=c(()=>n.error),i=c(()=>n.errorMessage),C=c(()=>n.synchronized),P=c(()=>g.protected),b=c(()=>g.model!==null);B(async()=>{b.value&&(await n.getSteps(),e.value=d.value)}),te(e,async r=>{b.value&&(y.value.includes(r)?(n.setSelectedStepFunction(r),n.getSteps()):(e.value=y.value[0],n.setSelectedStepFunction(y.value[0]),n.getSteps()))});async function U(){try{n.initExecution(),await a.exportToS3("inputs"),await a.deleteOutputsOnS3(),n.startExecution({scenario:g.scenario})}catch(r){n.terminateExecution(),console.log(r),a.changeAlert(r)}}return{stepFunction:e,store:a,runStore:n,userStore:g,steps:h,avalaibleStepFunctions:y,selectedStepFunction:d,running:s,currentStep:t,error:x,errorMessage:i,synchronized:C,isProtected:P,modelIsLoaded:b,run:U}}},me={key:4};function ge(a,n,g,e,h,y){const d=ne("ParamForm");return o(),f(ae,{class:"background"},{default:l(()=>[u(L,{order:"1"},{default:l(()=>[u(d)]),_:1}),u(L,{order:"2"},{default:l(()=>[u(D,{class:"card"},{default:l(()=>[u(j,{class:"subtitle"},{default:l(()=>[p(m(a.$gettext("Scenario Simulation")),1)]),_:1}),u(le,{modelValue:e.currentStep,"onUpdate:modelValue":n[3]||(n[3]=s=>e.currentStep=s),class:"stepper"},{default:l(()=>[e.avalaibleStepFunctions.length>1?(o(),f(re,{key:0,modelValue:e.stepFunction,"onUpdate:modelValue":n[0]||(n[0]=s=>e.stepFunction=s),"show-arrows":"","fixed-tabs":""},{default:l(()=>[(o(!0),S(w,null,k(e.avalaibleStepFunctions,s=>(o(),f(oe,{key:s,value:s,disabled:e.running||!e.modelIsLoaded},{default:l(()=>[p(m(s),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):V("",!0),e.synchronized?V("",!0):(o(),f(H,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:l(()=>[p(m(a.$gettext("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),e.error?(o(),f(H,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:l(()=>[p(m(a.$gettext("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(o(!0),S(w,null,k(Object.keys(e.errorMessage),s=>(o(),S("p",{key:s},[q("b",null,m(s)+": ",1),p(m(e.errorMessage[s]),1)]))),128))]),_:1})):V("",!0),e.isProtected?(o(),f(H,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:l(()=>[p(m(a.$gettext("This scenario is protected. You can not run simulation.")),1)]),_:1})):V("",!0),u(_,{loading:e.running,disabled:e.running||e.isProtected||!e.modelIsLoaded,color:"success",onClick:n[1]||(n[1]=s=>e.run())},{default:l(()=>[u(N,{size:"small",style:{"margin-right":"10px"}},{default:l(()=>[p(" fa-solid fa-play ")]),_:1}),p(" "+m(a.$gettext("Run Simulation")),1)]),_:1},8,["loading","disabled"]),se(u(_,{color:"grey",variant:"text",onClick:n[2]||(n[2]=s=>e.runStore.stopExecution())},{default:l(()=>[p(m(a.$gettext("Abort Simulation")),1)]),_:1},512),[[ie,e.running&&e.currentStep!==1]]),e.modelIsLoaded?(o(),S("div",me,[(o(!0),S(w,null,k(e.steps,(s,t)=>(o(),f(ue,{key:t+1},{default:l(()=>[e.error?(o(),f(z,{key:1,complete:e.currentStep>t+1,title:s.name,value:t+1,step:t+1},null,8,["complete","title","value","step"])):(o(),f(z,{key:0,complete:e.currentStep>t+1,color:e.currentStep>=t+1?"primary":"regular",title:s.name,value:t+1,step:t+1},null,8,["complete","color","title","value","step"]))]),_:2},1024))),128))])):V("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const ye=A(ve,[["render",ge],["__scopeId","data-v-b4d4f117"]]);export{ye as default};
