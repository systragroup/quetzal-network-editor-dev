import{_ as N,h as T,g as m,i as n,j as s,bN as Y,a2 as q,O as J,F as ee,u as te,a$ as ae,aa as se,a as le,r as b,c as g,o as ne,f as y,A as l,ae as B,B as p,C as a,m as i,aW as F,a8 as z,L as k,l as re,aX as oe,H as G,I as C,bO as ie,V as ue,Q as E,a9 as de,Z as L,ah as ce,bP as pe}from"./index-CH46N1Xy.js";const me={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(c){this.$emit("update:date",this.parseOutput(c))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(c){if(c)return new Date(c.substring(0,4)+"-"+c.substring(4,6)+"-"+c.substring(6,8))},parseOutput(c){return c.toISOString().substring(0,10).replaceAll("-","")}}};function fe(c,t,u,I,d,f){return m(),T(ee,{modelValue:d.menu,"onUpdate:modelValue":t[1]||(t[1]=v=>d.menu=v),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:n(({props:v})=>[s(q,J({"model-value":f.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},v),null,16,["model-value"])]),default:n(()=>[s(Y,{modelValue:d.isoDate,"onUpdate:modelValue":t[0]||(t[0]=v=>d.isoDate=v),max:d.dateMax,min:d.dateMin},null,8,["modelValue","max","min"])]),_:1},8,["modelValue"])}const ve=N(me,[["render",fe],["__scopeId","data-v-1eb87a33"]]),_e={class:"params-row"},he={class:"list"},ge={class:"list-row bold"},ye={class:"list-item-large"},Se={class:"list-item-medium"},Ve={class:"list-item-medium"},xe={class:"list-item-medium"},De={class:"list-item-small"},be={class:"list-item-small"},ke={class:"list-item-large"},Te={class:"list-item-medium"},Ie={class:"list-item-medium"},we={class:"list-item-medium"},Fe={class:"list-item-small"},Ge={class:"bottom-button"},Ce={__name:"GTFSZipImporter",setup(c){const{$gettext:t}=te(),u=ae(),I=se(),d=le(),f=b(!1),v=b(!1),Z=g(()=>u.stateMachineArn),$=g(()=>I.linksIsEmpty),W=g(()=>u.callID),S=g(()=>u.UploadedGTFS),D=g(()=>u.running),j=g(()=>u.error),U=g(()=>u.errorMessage),M=g(()=>S.value.filter(_=>_.progress<100).length>0);ne(()=>{u.saveParams(w.value)});const H={required:_=>!!_||t("Required")},w=b([{name:"start_time",text:"start time",value:u.parameters.start_time,type:"time",units:"",hint:"Start Time to restrict the GTFS in a period",rules:["required"]},{name:"end_time",text:"end time",value:u.parameters.end_time,type:"time",units:"",hint:"End Time to restrict the GTFS in a period",rules:["required"]}]),O=b();function K(){O.value.click(),document.getElementById("zip-input").value=""}async function Q(_){try{d.changeLoading(!0);const r=_.target.files;if(!r.length){d.changeLoading(!1);return}for(const e of r){const o=await pe(e),h=o.reduce((V,x)=>x.start_date<V?x.start_date:V,o[0].start_date),R=o.reduce((V,x)=>x.end_date>V?x.end_date:V,o[0].end_date),X={content:e,info:{name:e.name,minDate:h,maxDate:R,date:h,progress:0}};await u.addGTFS(X)}d.changeLoading(!1)}catch(r){d.changeLoading(!1),d.changeAlert(r)}}function P(){if($.value){const _=S.value.map(o=>o.name),r=S.value.map(o=>o.date),e={files:_,dates:r,callID:W.value};w.value.forEach(o=>{e[o.name]=o.value}),u.startExecution(Z.value,e)}else f.value=!0}function A(){I.$reset(),f.value=!1,P()}return(_,r)=>(m(),y("div",null,[l("input",{id:"zip-input",ref_key:"zipInput",ref:O,type:"file",style:{display:"none"},accept:".zip",multiple:"multiple",onChange:Q},null,544),s(E,{class:"card"},{default:n(()=>[s(B,{class:"subtitle"},{default:n(()=>[p(a(i(t)("GTFS importer")),1)]),_:1}),s(F,null,{default:n(()=>[p(a(i(t)("import GTFS from local computer")),1)]),_:1}),s(F,null,{default:n(()=>[p(a(i(t)("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),s(z,null,{default:n(()=>[s(k,{variant:"elevated",disabled:D.value,"prepend-icon":"fa-solid fa-file-archive",onClick:K},{default:n(()=>[p(a(i(t)("upload GTFS")),1)]),_:1},8,["disabled"])]),_:1}),s(F,null,{default:n(()=>[j.value?(m(),T(oe,{key:0,density:"compact",variant:"outlined",text:"",type:"error"},{default:n(()=>[p(a(i(t)("There as been an error while converting your GTFS.             Please try again. If the problem persist, contact us."))+" ",1),(m(!0),y(G,null,C(Object.keys(U.value),e=>(m(),y("p",{key:e},[l("b",null,a(e)+": ",1),p(a(U.value[e]),1)]))),128))]),_:1})):re("",!0)]),_:1}),l("div",_e,[(m(!0),y(G,null,C(w.value,(e,o)=>(m(),y("div",{key:o,class:"params"},[s(q,{modelValue:e.value,"onUpdate:modelValue":h=>e.value=h,type:e.type,step:"1",variant:"underlined",label:i(t)(e.text),suffix:e.units,hint:v.value?i(t)(e.hint):"","persistent-hint":v.value,rules:e.rules.map(h=>H[h]),required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])]))),128))]),l("div",he,[l("li",ge,[r[3]||(r[3]=l("span",{class:"list-item-small"},null,-1)),l("span",ye,a(i(t)("name")),1),l("span",Se,a(i(t)("from")),1),l("span",Ve,a(i(t)("to")),1),l("span",xe,a(i(t)("selected date")),1),l("span",De,a(i(t)("Uploaded")),1)]),(m(!0),y(G,null,C(S.value,(e,o)=>(m(),y("ul",{key:o,class:"list-row"},[l("span",be,a(o),1),l("span",ke,a(e.name),1),l("span",Te,a(e.minDate),1),l("span",Ie,a(e.maxDate),1),l("span",we,[s(ve,{date:e.date,from:e.minDate,to:e.maxDate,"onUpdate:date":h=>e.date=h},null,8,["date","from","to","onUpdate:date"])]),l("span",Fe,[e.progress<100?(m(),T(ie,{key:0,indeterminate:e.progress===0,absolute:"",color:"primary","model-value":e.progress},null,8,["indeterminate","model-value"])):(m(),T(ue,{key:1},{default:n(()=>r[4]||(r[4]=[p("fas fa-check")])),_:1}))])]))),128))]),l("div",Ge,[s(k,{loading:D.value,disabled:D.value||S.value.length==0||M.value,color:D.value||S.value.length==0||M.value?"regular":"success","prepend-icon":"fa-solid fa-play",onClick:P},{default:n(()=>[p(a(i(t)("convert")),1)]),_:1},8,["loading","disabled","color"])])]),_:1}),s(ce,{modelValue:f.value,"onUpdate:modelValue":r[1]||(r[1]=e=>f.value=e),persistent:"","max-width":"500",onKeydown:[L(A,["enter"]),r[2]||(r[2]=L(e=>f.value=!1,["esc"]))]},{default:n(()=>[s(E,null,{default:n(()=>[s(B,{class:"text-h5"},{default:n(()=>[p(a(i(t)("Overwrite current PT network ?")),1)]),_:1}),s(z,null,{default:n(()=>[s(de),s(k,{color:"regular",onClick:r[0]||(r[0]=e=>f.value=!f.value)},{default:n(()=>[p(a(i(t)("No")),1)]),_:1}),s(k,{color:"primary",onClick:A},{default:n(()=>[p(a(i(t)("Yes")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Me=N(Ce,[["__scopeId","data-v-8e02e701"]]);export{Me as default};
