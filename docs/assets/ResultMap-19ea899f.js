import{_ as G,M as Be,a as We,b as Ke,c as Ze,d as Ee,u as J,m as Ce,e as Ae,r as S,o as u,f as y,w as n,g as i,h as Ge,i as C,j as N,k as v,l as f,n as g,t as h,V as ie,p as ue,v as de,q as Se,s as F,x as ne,y as oe,F as V,z as L,A as b,B as Pe,C as we,D as K,E as q,G as Z,H as Je,I as Qe,J as Xe,T as Ye,K as $e,L as re,N as xe,O as _e,P as De,Q as O,R as Ve,S as B,U as et,W as tt,X as T,Y as E,Z as A,$ as P,a0 as lt,a1 as at,a2 as st,a3 as it,a4 as nt,a5 as ot,a6 as rt,a7 as x,a8 as ut,a9 as ae,aa as D,ab as se,ac as Le,ad as Me}from"./index-d2df715b.js";const dt="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",ct=e=>e,mt={name:"ResultMap",components:{MglMap:Be,MglNavigationControl:We,MglScaleControl:Ke,MglGeojsonLayer:Ze,MglImageLayer:Ee},props:["selectedFeature","layerType","extrusion","links","nanLinks","opacity","offset"],events:["selectClick"],setup(){return{store:J()}},data(){return{mapIsLoaded:!1,mapboxPublicKey:null,selectedLinks:[],minZoom:{nodes:14,links:2}}},computed:{mapStyle(){return this.store.mapStyle},offsetValue(){return this.offset?-1:1}},watch:{mapStyle(e){this.map&&(this.map.getLayer("arrow")&&this.map.removeLayer("arrow"),this.map.getLayer("links")&&this.map.removeLayer("links"),this.map.getLayer("zones")&&this.map.removeLayer("zones"),this.map.getLayer("nodes")&&this.map.removeLayer("nodes"),this.mapIsLoaded=!1,this.saveMapPosition())}},created(){this.mapboxPublicKey=dt},beforeDestroy(){this.map.getLayer("arrow")&&this.map.removeLayer("arrow"),this.saveMapPosition()},methods:{saveMapPosition(){const e=this.map.getCenter();this.store.saveMapPosition({mapCenter:[e.lng,e.lat],mapZoom:this.map.getZoom()})},onMapLoaded(e){this.map&&(this.mapIsLoaded=!1);const l=new Ce.LngLatBounds;["Polygon"].includes(this.layerType)?this.links.features.forEach(o=>{try{o.geometry.type==="Polygon"?l.extend([o.geometry.coordinates[0][0],o.geometry.coordinates[0][o.geometry.coordinates.length-1]]):l.extend([o.geometry.coordinates[0][0][0],o.geometry.coordinates[0][0][o.geometry.coordinates.length-1]])}catch{}}):this.links.features.forEach(o=>{l.extend([o.geometry.coordinates[0],o.geometry.coordinates[o.geometry.coordinates.length-1]])}),Object.keys(l).length!==0&&e.map.fitBounds(l,{padding:100}),e.map.loadImage(Ae,function(o,a){if(o){console.error("err image",o);return}e.map.addImage("arrow",a,{sdf:!0})}),this.map=e.map,this.extrusion?this.store.changeNotification({text:ct("Right click and drag to tilt the map"),autoClose:!0,color:"success"}):e.map.dragRotate.disable(),this.mapIsLoaded=!0},enterLink(e){var l;if(e.map.getCanvas().style.cursor="pointer",this.selectedLinks=e.mapboxEvent.features,(l=this.popup)!=null&&l.isOpen()&&this.popup.remove(),this.selectedFeature&&this.layerType!=="Polygon"){const o=this.selectedLinks[0].properties[this.selectedFeature];o&&(this.popup=new Ce.Popup({closeButton:!1}).setLngLat([e.mapboxEvent.lngLat.lng,e.mapboxEvent.lngLat.lat]).setHTML(`${this.selectedFeature}: <br> ${o}`).addTo(e.map))}},leaveLink(e){var l;this.selectedLinks=[],(l=this.popup)!=null&&l.isOpen()&&this.popup.remove(),e.map.getCanvas().style.cursor=""},selectClick(e){var l;this.selectedLinks=e.mapboxEvent.features,((l=this.selectedLinks)==null?void 0:l.length)>0&&this.$emit("selectClick",{feature:this.selectedLinks[0].properties,action:"featureClick"})},zoneClick(e){var l;this.selectedLinks=e.mapboxEvent.features,((l=this.selectedLinks)==null?void 0:l.length)>0&&this.$emit("selectClick",{feature:this.selectedLinks[0].properties,action:"zoneClick"})},zoneHover(e){e.map.getCanvas().style.cursor="pointer"},zoneLeave(e){e.map.getCanvas().style.cursor=""}}};function pt(e,l,o,a,t,r){const s=S("MglScaleControl"),m=S("MglNavigationControl"),k=S("MglGeojsonLayer"),M=S("MglImageLayer"),H=S("MglMap");return u(),y(H,{key:r.mapStyle,style:{width:"100%"},"access-token":t.mapboxPublicKey,"map-style":r.mapStyle,center:a.store.mapCenter,zoom:a.store.mapZoom,onLoad:r.onMapLoaded},{default:n(()=>[i(s,{position:"bottom-right"}),i(m,{position:"bottom-right"}),t.mapIsLoaded?Ge(e.$slots,"default",{key:0,map:e.map,mapIsLoaded:t.mapIsLoaded}):C("",!0),o.layerType=="LineString"?(u(),y(k,{key:1,"source-id":"links",source:{type:"geojson",data:o.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:t.minZoom.links,paint:{"line-color":["get","display_color"],"line-offset":["*",r.offsetValue*.5,["to-number",["get","display_width"]]],"line-opacity":o.opacity/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:r.enterLink,onMouseleave:r.leaveLink,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0),o.layerType=="Point"?(u(),y(k,{key:2,"source-id":"nodes",source:{type:"geojson",data:o.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:t.minZoom.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":o.opacity/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:r.enterLink,onMouseleave:r.leaveLink,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0),o.layerType=="LineString"?(u(),y(M,{key:3,"source-id":"links",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:t.minZoom.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[r.offsetValue*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":o.opacity/100}}},null,8,["layer"])):C("",!0),o.layerType==="Polygon"&&o.extrusion?(u(),y(k,{key:4,"source-id":"polygon",source:{type:"geojson",data:o.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":o.opacity/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:r.zoneHover,onMouseleave:r.zoneLeave,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0),o.layerType==="Polygon"&&!o.extrusion?(u(),y(k,{key:5,"source-id":"polygon",source:{type:"geojson",data:o.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":o.opacity/100}},onMouseenter:r.zoneHover,onMouseleave:r.zoneLeave,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0),o.layerType==="Polygon"&&!o.extrusion?(u(),y(k,{key:6,"source-id":"NaNPolygon",source:{type:"geojson",data:o.nanLinks,promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:r.zoneHover,onMouseleave:r.zoneLeave,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0)]),_:3},8,["access-token","map-style","center","zoom","onLoad"])}const ht=G(mt,[["render",pt]]);const yt={name:"SidePanel",components:{},props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],events:["update-selectedCategory","select-layer","update-selected-filter","select-preset","delete-preset"],setup(){const e=J(),l=N(()=>e.showLeftPanel),o=N(()=>e.windowHeight);return{store:e,showLeftPanel:l,windowHeight:o}},data(){return{showLeftPanelContent:!0,openMenu:!1,presetsMenu:!1,selectedCat:[],vmodelSelectedFilter:""}},watch:{showLeftPanel(e){e?setTimeout(()=>{this.showLeftPanelContent=!0},500):this.showLeftPanelContent=!1},selectedCategory(e,l){e!==l&&(this.selectedCat=e)},selectedFilter(e){e!==this.vmodelSelectedFilter&&(this.vmodelSelectedFilter=e)},selectedCat(e){e!==this.selectedCategory&&this.$emit("update-selectedCategory",e)},vmodelSelectedFilter(e,l){e!==this.selectedFilter&&(this.$emit("update-selectedFilter",e),this.selectedCat=this.selectedCategory)}},created(){this.vmodelSelectedFilter=this.selectedFilter,this.selectedCat=this.selectedCategory,this.$emit("update-selectedFilter",this.selectedFilter),this.$emit("update-selectedCategory",this.selectedCategory)},methods:{init(e){this.selectedCat=e.selectedCategory},showAll(){this.selectedCat.length===this.filteredCat.length?this.selectedCat=[]:this.selectedCat=this.filteredCat}}},gt={class:"left-panel-content"},ft={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},vt={class:"preset"},bt={class:"layer"},kt={class:"item"};function Ct(e,l,o,a,t,r){return u(),v("section",{class:$e(a.showLeftPanel?"left-panel elevation-4":"left-panel-close"),style:re({width:a.showLeftPanel?"350px":"0px"})},[f("div",{class:"left-panel-toggle-btn elevation-4",onClick:l[0]||(l[0]=s=>a.store.changeLeftPanel())},[i(ie,{size:"small",color:"secondarydark"},{default:n(()=>[g(h(a.showLeftPanel?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),i(Ye,{name:"fade"},{default:n(()=>[ue(f("div",gt,[f("div",null,[f("div",ft,[f("div",vt,[i(Se,{location:"bottom","open-delay":"500"},{activator:n(({props:s})=>[i(ie,F({style:{color:"white","padding-right":"2rem"}},s),{default:n(()=>[g(" fas fa-sliders-h ")]),_:2},1040)]),default:n(()=>[f("span",null,h(e.$gettext("Presets")),1)]),_:1}),i(ne,{modelValue:t.presetsMenu,"onUpdate:modelValue":l[1]||(l[1]=s=>t.presetsMenu=s),"close-delay":"100",transition:"slide-y-transition"},{activator:n(({props:s})=>[f("span",F({class:"custom-title crop"},s),h(o.selectedPreset||e.$gettext("Presets")),17)]),default:n(()=>[i(oe,null,{default:n(()=>[(u(!0),v(V,null,L(o.presetChoices,(s,m)=>(u(),y(K,{key:m,link:"",onClick:()=>e.$emit("select-preset",s)},{append:n(()=>[i(b,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:Pe(()=>e.$emit("delete-preset",s),["stop"])},null,8,["onClick"])]),default:n(()=>[i(we,null,{default:n(()=>[g(h(s.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),i(b,{variant:"text",style:{color:"white"},icon:t.presetsMenu?"fas fa-chevron-left":"fas fa-chevron-down",onClick:l[2]||(l[2]=s=>t.presetsMenu=!t.presetsMenu)},null,8,["icon"])]),f("div",bt,[i(Se,{location:"bottom","open-delay":"500"},{activator:n(({props:s})=>[i(b,F({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:t.selectedCat.length>0?"fa-eye fa":"fa-eye-slash fa",variant:"text"},s,{onClick:l[3]||(l[3]=m=>r.showAll())}),null,16,["icon"])]),default:n(()=>[f("span",null,h(t.selectedCat.length>0?e.$gettext("Hide All"):e.$gettext("Show All")),1)]),_:1}),i(ne,{modelValue:t.openMenu,"onUpdate:modelValue":l[4]||(l[4]=s=>t.openMenu=s),"close-delay":"100",transition:"slide-y-transition"},{activator:n(({props:s})=>[f("span",F({class:"custom-title crop"},s),h(o.selectedLayer),17)]),default:n(()=>[i(oe,null,{default:n(()=>[(u(!0),v(V,null,L(o.layerChoices,(s,m)=>(u(),y(K,{key:m,link:"",onClick:()=>e.$emit("select-layer",s)},{default:n(()=>[i(we,null,{default:n(()=>[g(h(s),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),i(b,{style:{color:"white"},variant:"text",icon:t.openMenu?"fas fa-chevron-left":"fas fa-chevron-down",onClick:l[5]||(l[5]=s=>t.openMenu=!t.openMenu)},null,8,["icon"])]),i(q,{"max-width":"100%","min-width":"100%",height:a.windowHeight-180,class:"mx-auto"},{default:n(()=>[i(K,null,{default:n(()=>[i(Z,{modelValue:t.vmodelSelectedFilter,"onUpdate:modelValue":l[6]||(l[6]=s=>t.vmodelSelectedFilter=s),items:o.filterChoices,"prepend-icon":"fas fa-filter",label:e.$gettext("filter"),"item-props.color":"secondarydark",color:"secondarydark"},null,8,["modelValue","items","label"])]),_:1}),i(Je,{items:o.filteredCat,"item-height":45,height:a.windowHeight-80},{default:n(({item:s})=>[(u(),v("div",{key:t.vmodelSelectedFilter.concat(s),class:"container"},[i(Qe,null,{default:n(()=>[i(Xe,{modelValue:t.selectedCat,"onUpdate:modelValue":l[7]||(l[7]=m=>t.selectedCat=m),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:s},null,8,["modelValue","value"])]),_:2},1024),f("div",kt,h(s),1)]))]),_:1},8,["items","height"])]),_:1},8,["height"])])])],512),[[de,t.showLeftPanelContent]])]),_:1})],6)}const St=G(yt,[["render",Ct],["__scopeId","data-v-39eebd91"]]);const c=e=>e,wt={name:"ResultsSettings",props:["displaySettings","featureChoices","type"],events:["submit","save-preset"],setup(){const e=J();return{windowHeight:N(()=>e.windowHeight-100)}},data(){return{showDialog:!1,parameters:[{name:c("selectedFeature"),type:"String",value:this.displaySettings.selectedFeature,units:"",hint:c("selectedFeature")},{name:c("minWidth"),type:"Number",value:this.displaySettings.minWidth,units:"a.u.",hint:c("minWidth")},{name:c("maxWidth"),type:"Number",value:this.displaySettings.maxWidth,units:"a.u.",hint:c("maxWidth")},{name:c("numStep"),type:"Number",value:this.displaySettings.numStep,units:"int",hint:c("numStep")},{name:c("opacity"),type:"Number",value:this.displaySettings.opacity,units:"number",hint:c("opacity")},{name:c("scale"),type:"String",value:this.displaySettings.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:c("scale")},{name:c("color map"),type:"String",choices:Object.keys(xe.brewer).slice(0,36),value:this.displaySettings.cmap,units:"",hint:c("cmap to use")},{name:c("show NaN"),value:this.displaySettings.showNaN,hint:c("Hide NaN on map and color map")},{name:c("reverse color"),value:this.displaySettings.reverseColor,hint:c("reverse color scale")},{name:c("scale min"),type:"Number",value:this.displaySettings.minVal,units:"a.u.",hint:c("mininum value on the color Map")},{name:c("scale max"),type:"Number",value:this.displaySettings.maxVal,units:"a.u.",hint:c("maximum value on the color Map")},{name:c("custom scale"),value:this.displaySettings.fixScale,hint:c("customize to inputs values")},{name:c("Left side driving"),value:this.displaySettings.offset,hint:c("Select which side of the road the links are display")},{name:c("3D"),value:this.displaySettings.extrusion,hint:c("display zones as 3D extrusion")},{name:c("padding"),type:"Number",value:this.displaySettings.padding,units:"number",hint:c("range of colors")}],showHint:!1,showFixScale:!1,shake:!1,rules:{required:e=>!!e||c("Required"),largerThanZero:e=>e>0||c("should be larger than 0"),nonNegative:e=>e>=0||c("should be larger or equal to 0")}}},watch:{showDialog(e){this.refresh(),this.showFixScale=this.parameters[11].value},featureChoices(){this.refresh()}},methods:{toggleFixScale(){this.parameters[11].value?(this.showFixScale=!0,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal):this.showFixScale=!1},getColor(e){const l=[],o=this.parameters[8].value;let a=this.parameters[14].value;a=[a[0]/100,1-a[1]/100],a=o?a.reverse():a;const t=xe.scale(e).padding(a).domain([0,100]).classes(25);for(let r=0;r<100;r++)l.push(t(r).hex());return o?l.reverse():l},refresh(){this.parameters[0].value=this.displaySettings.selectedFeature,this.parameters[1].value=this.displaySettings.minWidth,this.parameters[2].value=this.displaySettings.maxWidth,this.parameters[3].value=this.displaySettings.numStep,this.parameters[4].value=this.displaySettings.opacity,this.parameters[5].value=this.displaySettings.scale,this.parameters[6].value=this.displaySettings.cmap,this.parameters[7].value=this.displaySettings.showNaN,this.parameters[8].value=this.displaySettings.reverseColor,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal,this.parameters[11].value=this.displaySettings.fixScale,this.parameters[12].value=this.displaySettings.offset,this.parameters[13].value=this.displaySettings.extrusion,this.parameters[14].value=this.displaySettings.padding},submit(e){if(this.$refs.form.validate()){const l={selectedFeature:this.parameters[0].value,minWidth:Number(this.parameters[1].value),maxWidth:Number(this.parameters[2].value),numStep:Number(this.parameters[3].value),opacity:Number(this.parameters[4].value),scale:this.parameters[5].value,cmap:this.parameters[6].value,showNaN:this.parameters[7].value,reverseColor:this.parameters[8].value,minVal:Number(this.parameters[9].value),maxVal:Number(this.parameters[10].value),fixScale:this.parameters[11].value,offset:this.parameters[12].value,extrusion:this.parameters[13].value,padding:this.parameters[14].value};e==="apply"?this.$emit("submit",l):e==="save"&&this.$emit("save-preset",l)}else this.shake=!0,setTimeout(()=>{this.shake=!1},500)},cancel(){this.showDialog=!1}}},xt={class:"setting"},Vt={class:"gradient"},Lt={class:"domain-title-small"},Mt={class:"domain-title"};function Pt(e,l,o,a,t,r){return u(),y(ne,{modelValue:t.showDialog,"onUpdate:modelValue":l[16]||(l[16]=s=>t.showDialog=s),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:n(({props:s})=>[f("div",xt,[i(b,F({color:o.displaySettings.selectedFeature===null?"error":"regular"},s,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:n(()=>[i(q,{width:"20rem",class:"setting-card","max-height":a.windowHeight,onKeydown:[l[15]||(l[15]=P(s=>r.submit("apply"),["enter"])),P(r.cancel,["esc"])]},{default:n(()=>[i(K,{class:"subtitle"},{append:n(()=>[i(b,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:l[0]||(l[0]=s=>t.showHint=!t.showHint)})]),default:n(()=>[g(h(e.$gettext("Settings"))+" ",1)]),_:1}),i(_e,{ref:"form","lazy-validation":""},{default:n(()=>[i(De,null,{default:n(()=>[i(O,null,{default:n(()=>[i(Z,{modelValue:t.parameters[0].value,"onUpdate:modelValue":l[1]||(l[1]=s=>t.parameters[0].value=s),variant:"underlined",items:o.featureChoices,label:e.$gettext(t.parameters[0].name),hint:t.showHint?e.$gettext(t.parameters[0].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),i(Ve,null,{default:n(()=>[(u(!0),v(V,null,L(t.parameters.slice(1,3),s=>(u(),y(O,{key:s.name},{default:n(()=>[i(B,{modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,variant:"underlined",density:"compact",type:s.type,label:e.$gettext(s.name),suffix:s.units,hint:t.showHint?e.$gettext(s.hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),i(Ve,null,{default:n(()=>[i(O,null,{default:n(()=>[i(B,{modelValue:t.parameters[3].value,"onUpdate:modelValue":l[2]||(l[2]=s=>t.parameters[3].value=s),variant:"underlined",density:"compact",type:t.parameters[3].type,label:e.$gettext(t.parameters[3].name),suffix:t.parameters[3].units,hint:t.showHint?e.$gettext(t.parameters[3].hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),i(O,null,{default:n(()=>[i(Z,{modelValue:t.parameters[5].value,"onUpdate:modelValue":l[3]||(l[3]=s=>t.parameters[5].value=s),density:"compact",variant:"underlined",items:t.parameters[5].choices,label:e.$gettext(t.parameters[5].name),hint:t.showHint?e.$gettext(t.parameters[5].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),i(Z,{modelValue:t.parameters[6].value,"onUpdate:modelValue":l[4]||(l[4]=s=>t.parameters[6].value=s),density:"compact",items:t.parameters[6].choices,label:e.$gettext(t.parameters[6].name),hint:t.showHint?e.$gettext(t.parameters[6].hint):"","persistent-hint":t.showHint,required:"",variant:"solo"},{selection:n(({item:s})=>[f("div",Vt,[(u(!0),v(V,null,L(r.getColor(s.value),(m,k)=>(u(),v("span",{key:k,class:"grad-step-small",style:re({backgroundColor:m})},null,4))),128)),f("span",Lt,h(s.value),1)])]),item:n(({props:s,item:m})=>[f("div",F({class:"gradient"},s),[(u(!0),v(V,null,L(r.getColor(m.value),(k,M)=>(u(),v("span",{key:M,class:"grad-step",style:re({backgroundColor:k})},null,4))),128)),f("span",Mt,h(m.value),1)],16)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),i(et,{modelValue:t.parameters[14].value,"onUpdate:modelValue":l[5]||(l[5]=s=>t.parameters[14].value=s),step:"5",density:"compact",color:"primary",label:e.$gettext(t.parameters[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),i(tt,{modelValue:t.parameters[4].value,"onUpdate:modelValue":l[6]||(l[6]=s=>t.parameters[4].value=s),class:"align-center",color:"primary",label:e.$gettext(t.parameters[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":n(({modelValue:s})=>[g(h(Math.floor(s)+"%"),1)]),_:1},8,["modelValue","label"]),(u(),y(T,{key:t.parameters[12].name,modelValue:t.parameters[12].value,"onUpdate:modelValue":l[7]||(l[7]=s=>t.parameters[12].value=s),density:"compact",color:"primary",label:e.$gettext(t.parameters[12].name),hint:t.showHint?e.$gettext(t.parameters[12].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(u(),y(T,{key:t.parameters[7].name,modelValue:t.parameters[7].value,"onUpdate:modelValue":l[8]||(l[8]=s=>t.parameters[7].value=s),density:"compact",color:"primary",label:e.$gettext(t.parameters[7].name),hint:t.showHint?e.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(u(),y(T,{key:t.parameters[8].name,modelValue:t.parameters[8].value,"onUpdate:modelValue":l[9]||(l[9]=s=>t.parameters[8].value=s),density:"compact",color:"primary",label:e.$gettext(t.parameters[8].name),hint:t.showHint?e.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(o.type)?(u(),y(T,{key:t.parameters[13].name,modelValue:t.parameters[13].value,"onUpdate:modelValue":l[10]||(l[10]=s=>t.parameters[13].value=s),density:"compact",color:"primary",label:e.$gettext(t.parameters[13].name),disabled:!["Polygon","extrusion"].includes(o.type),hint:t.showHint?e.$gettext(t.parameters[13].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","disabled","hint","persistent-hint"])):C("",!0),(u(),y(T,{key:t.parameters[11].name,modelValue:t.parameters[11].value,"onUpdate:modelValue":[l[11]||(l[11]=s=>t.parameters[11].value=s),l[12]||(l[12]=s=>r.toggleFixScale(t.parameters[11].name))],density:"compact",variant:"underlined",color:"primary",label:e.$gettext(t.parameters[11].name),hint:t.showHint?e.$gettext(t.parameters[11].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(u(!0),v(V,null,L(t.parameters.slice(9,11),s=>ue((u(),y(B,{key:s.name,modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,variant:"underlined",type:s.type,label:e.$gettext(s.name),suffix:s.units,hint:t.showHint?e.$gettext(s.hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])),[[de,t.showFixScale]])),128))]),_:1})]),_:1})]),_:1},512),i(E,null,{default:n(()=>[i(b,{color:"grey",variant:"text",onClick:r.cancel},{default:n(()=>[g(h(e.$gettext("Cancel")),1)]),_:1},8,["onClick"]),i(b,{color:"green-darken-1",variant:"text",onClick:l[13]||(l[13]=s=>r.submit("apply"))},{default:n(()=>[g(h(e.$gettext("Apply")),1)]),_:1}),i(A),i(b,{color:"grey",variant:"text",onClick:l[14]||(l[14]=s=>r.submit("save"))},{default:n(()=>[i(ie,{size:"small",start:""},{default:n(()=>[g(" fas fa-sliders-h ")]),_:1}),g(" "+h(e.$gettext("save")),1)]),_:1})]),_:1})]),_:1},8,["max-height","onKeydown"])]),_:1},8,["modelValue"])}const _t=G(wt,[["render",Pt],["__scopeId","data-v-05de23bf"]]);const j=e=>e,Dt={name:"ResultMap",components:{MapResults:ht,ResultsSidePanel:St,ResultsSettings:_t,MapLegend:lt,LayerSelector:at,StaticLayer:st},setup(){const e=it(),l=nt(),o=ot(),a=J(),{visibleLayer:t,NaNLayer:r,type:s,loadLayer:m,displaySettings:k,hasOD:M,ODfeatures:H,matSelectedIndex:Q,changeOD:p,isIndexAvailable:w,selectedCategory:X,selectedFilter:ce,attributes:me,applySettings:pe,changeSelectedFilter:he,filteredCategory:Y,updateSelectedFeature:ye,changeSelectedCategory:ge,colorScale:Fe}=rt();function Ne(d){he(d),ye()}function He(d){ge(d),ye()}const I=x("links");async function $(d){switch(I.value=d,d){case"links":m(e.links,null,null,"headway");break;case"rlinks":m(l.rlinks,null,null,"speed");break;case"nodes":m(e.nodes,null,null,"boardings");break;case"rnodes":m(l.rnodes,null,null,"boardings");break;case"od":m(o.layer,null,null,"name");break;default:const ke=await a.getOtherFile(d,"geojson"),R=await a.getOtherFile(d,"json");m(ke,R,null,"");break}}const _=x(null),W=N(()=>a.availableLayers);ut(async()=>{W.value.lenght>0&&(I.value=W.value[0]),await $(I.value)});const fe=N(()=>a.visibleRasters),Ie=N(()=>a.styles),z=x(""),ee=x(!1),te=x(!1),U=x(""),le=x({});async function ze(d){_.value=d.name,W.value.includes(d.layer)?(await $(d.layer),me.value.includes(d==null?void 0:d.selectedFilter)?(he(d.selectedFilter),Object.keys(d).includes("selectedCategory")&&ge(d.selectedCategory)):Object.keys(d).includes("selectedFilter")&&a.changeNotification({text:d.selectedFilter+" "+j("filter does not exist. use default one"),autoClose:!0,color:"error"})):a.changeNotification({text:j("Preset Layer does not exist"),autoClose:!0,color:"error"}),pe(d.displaySettings),Object.keys(d).includes("selectedIndex")&&w(d.selectedIndex)&&(p(d.selectedIndex),a.changeNotification({}))}function Ue(d){z.value=d.name,ee.value=!0}function Re(d){le.value=d,U.value=_.value,te.value=!0}async function Te(d){if((await d).valid){te.value=!1;const R={name:D.cloneDeep(U.value),layer:D.cloneDeep(I.value),displaySettings:D.cloneDeep(le.value),selectedFilter:D.cloneDeep(ce.value)};X.value.filter(qe=>Y.value.includes(qe)).length<Y.value.length&&(R.selectedCategory=D.cloneDeep(X)),H.value.includes(le.value.selectedFeature)&&M.value&&(R.selectedIndex=Q.value),a.addStyle(R),fe.value.includes(U.value)?a.changeNotification({text:j("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):a.changeNotification({text:j("Preset Saved"),autoClose:!0,color:"success"}),_.value=D.cloneDeep(U.value)}}function je(){a.deleteStyle(z.value),ee.value=!1,z.value===_.value&&(_.value=null),a.changeNotification({text:j("Preset deleted"),autoClose:!0,color:"success"}),z.value=""}const ve=x(!1),be=x([]);function Oe(d){d.action==="featureClick"?(be.value=d.feature,ve.value=!0):p(d.feature.index)}return{store:a,selectedLayer:I,selectedPreset:_,availableLayers:W,visibleLayer:t,NaNLayer:r,type:s,displaySettings:k,selectedCategory:X,selectedFilter:ce,attributes:me,filteredCategory:Y,applySettings:pe,colorScale:Fe,updateSelectedFilter:Ne,updateSelectedCategory:He,changeLayer:$,changePreset:ze,showDeleteDialog:ee,presetToDelete:z,clickDeletePreset:Ue,deletePreset:je,showPresetDialog:te,inputName:U,clickSavePreset:Re,createPreset:Te,featureClicked:Oe,availableStyles:Ie,visibleRasters:fe,showDialog:ve,formData:be}}},Ft={class:"map-view"},Nt={class:"left-panel"};function Ht(e,l,o,a,t,r){const s=S("ResultsSidePanel"),m=S("ResultsSettings"),k=S("LayerSelector"),M=S("MapLegend"),H=S("StaticLayer"),Q=S("MapResults");return u(),v("section",Ft,[i(s,{ref:"sidePanel","selected-category":a.selectedCategory,"selected-filter":a.selectedFilter,"layer-choices":a.availableLayers,"selected-layer":a.selectedLayer,"filter-choices":a.attributes,"filtered-cat":a.filteredCategory,"preset-choices":a.availableStyles,"selected-preset":a.selectedPreset,onUpdateSelectedCategory:a.updateSelectedCategory,onUpdateSelectedFilter:a.updateSelectedFilter,onSelectLayer:a.changeLayer,onSelectPreset:a.changePreset,onDeletePreset:a.clickDeletePreset},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset","onUpdateSelectedCategory","onUpdateSelectedFilter","onSelectLayer","onSelectPreset","onDeletePreset"]),i(m,{"display-settings":a.displaySettings,"feature-choices":a.attributes,type:a.type,onSubmit:a.applySettings,onSavePreset:a.clickSavePreset},null,8,["display-settings","feature-choices","type","onSubmit","onSavePreset"]),a.availableStyles.length>0?(u(),y(k,{key:0,choices:a.availableStyles,"available-layers":a.availableLayers},null,8,["choices","available-layers"])):C("",!0),f("div",Nt,[ue(i(M,{key:"result",order:0,"color-scale":a.colorScale,"display-settings":a.displaySettings},null,8,["color-scale","display-settings"]),[[de,a.visibleLayer.features.length>0]])]),a.visibleLayer.features?(u(),y(Q,{key:a.type+String(a.displaySettings.extrusion),"layer-type":a.type,extrusion:a.displaySettings.extrusion,links:a.visibleLayer,"nan-links":a.NaNLayer,"selected-feature":a.displaySettings.selectedFeature,opacity:a.displaySettings.opacity,offset:a.displaySettings.offset,onSelectClick:a.featureClicked},{default:n(({map:p})=>[(u(!0),v(V,null,L(a.availableStyles,w=>(u(),v("div",{key:w.name},[a.visibleRasters.includes(w.name)&&a.availableLayers.includes(w.layer)?(u(),y(H,{key:0,preset:w,map:p,order:a.visibleRasters.indexOf(w.name)+1},null,8,["preset","map","order"])):C("",!0)]))),128))]),_:1},8,["layer-type","extrusion","links","nan-links","selected-feature","opacity","offset","onSelectClick"])):C("",!0),i(ae,{modelValue:a.showDialog,"onUpdate:modelValue":l[1]||(l[1]=p=>a.showDialog=p),scrollable:"",persistent:"","max-width":"300",onKeydown:[l[2]||(l[2]=P(p=>a.showDialog=!1,["enter"])),l[3]||(l[3]=P(p=>a.showDialog=!1,["esc"]))]},{default:n(()=>[i(q,{"max-height":"60rem"},{default:n(()=>[i(se,{class:"text-h5"},{default:n(()=>[g(h(e.$gettext("link Properties")),1)]),_:1}),i(Le),i(Me,null,{default:n(()=>[i(oe,null,{default:n(()=>[(u(!0),v(V,null,L(a.formData,(p,w)=>(u(),y(B,{key:w,"model-value":p,label:w,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),i(Le),i(E,null,{default:n(()=>[i(A),i(b,{color:"success",variant:"text",onClick:l[0]||(l[0]=p=>a.showDialog=!1)},{default:n(()=>[g(h(e.$gettext("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(ae,{modelValue:a.showPresetDialog,"onUpdate:modelValue":l[6]||(l[6]=p=>a.showPresetDialog=p),persistent:"","max-width":"400",onKeydown:l[7]||(l[7]=P(p=>a.showPresetDialog=!1,["esc"]))},{default:n(()=>[i(q,null,{default:n(()=>[i(se,{class:"text-h5"},{default:n(()=>[g(h(e.$gettext("Create or modify preset")),1)]),_:1}),i(_e,{"validate-on":"submit lazy",onSubmit:Pe(a.createPreset,["prevent"])},{default:n(()=>[i(Me,null,{default:n(()=>[i(De,null,{default:n(()=>[i(O,{cols:"12"},{default:n(()=>[i(B,{modelValue:a.inputName,"onUpdate:modelValue":l[4]||(l[4]=p=>a.inputName=p),autofocus:"",rules:[p=>!!p||"Required."],label:e.$gettext("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),i(E,null,{default:n(()=>[i(A),i(b,{color:"grey",variant:"text",onClick:l[5]||(l[5]=p=>a.showPresetDialog=!1)},{default:n(()=>[g(h(e.$gettext("Cancel")),1)]),_:1}),i(b,{color:"green-darken-1",variant:"text",type:"submit"},{default:n(()=>[g(h(e.$gettext("ok")),1)]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),i(ae,{modelValue:a.showDeleteDialog,"onUpdate:modelValue":l[9]||(l[9]=p=>a.showDeleteDialog=p),persistent:"","max-width":"400",onKeydown:[l[10]||(l[10]=P(p=>a.showDeleteDialog=!1,["esc"])),P(a.deletePreset,["enter"])]},{default:n(()=>[i(q,null,{default:n(()=>[i(se,{class:"text-h5"},{default:n(()=>[g(h(e.$gettext("Delete")+" "+a.presetToDelete+" ?"),1)]),_:1}),i(E,null,{default:n(()=>[i(A),i(b,{color:"grey",variant:"text",onClick:l[8]||(l[8]=p=>a.showDeleteDialog=!1)},{default:n(()=>[g(h(e.$gettext("Cancel")),1)]),_:1}),i(b,{color:"error",variant:"text",onClick:a.deletePreset},{default:n(()=>[g(h(e.$gettext("delete")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const Ut=G(Dt,[["render",Ht],["__scopeId","data-v-710b83de"]]);export{Ut as default};
