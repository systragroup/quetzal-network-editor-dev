import{u as Ne,t as ge,a as Pe,r as C,s as Ge,c as ee,w as H,o as Je,b as m,d as S,e as n,f as a,g as l,M as Qe,h as Ye,i as Xe,j as ie,k as q,l as el,m as ll,n as al,p as tl,q as ze,_ as Me,v as sl,x as F,y as x,z as L,A as b,V as se,B as Fe,C as De,D as Se,E as ne,F as Le,G,H as J,I as U,J as Te,K as Re,L as ce,N as je,O as ve,P as de,Q as nl,R as ol,S as ul,T as il,U as rl,W as _e,X,Y as qe,Z as oe,$ as ke,a0 as me,a1 as dl,a2 as cl,a3 as vl,a4 as ml,a5 as re,a6 as ye,a7 as he,a8 as fl,a9 as pl,aa as yl,ab as Ve,ac as Ce,ad as hl,ae as we,af as Oe,ag as $e,ah as gl,ai as te}from"./index-D77FCi-V.js";import{c as Be,u as bl,M as xl,S as kl}from"./StaticLayer-C3WmuVLf.js";import Vl from"./LayerSelector-BWLSZds1.js";const Cl={__name:"MapResults",props:["selectedFeature","layerType","extrusion","labels","links","nanLinks","opacity","offset","selectedLayer"],emits:["selectClick"],setup(_,{expose:r,emit:t}){const{$gettext:p}=Ne(),j="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",u=_,{selectedFeature:d,layerType:h,extrusion:D,labels:k,links:e,nanLinks:c,opacity:N,offset:O,selectedLayer:w}=ge(u),A=t,I=Pe(),$=C(!1),M=j,s=Ge(null),o=C({nodes:14,links:2}),V=ee(()=>I.mapStyle);H(V,()=>{s.value&&(s.value.getLayer("arrow")&&s.value.removeLayer("arrow"),s.value.getLayer("links")&&s.value.removeLayer("links"),s.value.getLayer("zones")&&s.value.removeLayer("zones"),s.value.getLayer("nodes")&&s.value.removeLayer("nodes"),$.value=!1,B())}),Je(()=>{var i;s.value&&B(),(i=s.value)!=null&&i.getLayer("arrow")&&s.value.removeLayer("arrow")});function B(){const i=s.value.getCenter();I.saveMapPosition({mapCenter:[i.lng,i.lat],mapZoom:s.value.getZoom()})}function W(i){s.value&&($.value=!1),s.value=i.map,fe(),s.value.loadImage(tl,function(f,R){if(f){console.error("err image",f);return}s.value.addImage("arrow",R,{sdf:!0})}),D.value&&I.changeNotification({text:p("Right click and drag to tilt the map"),autoClose:!0,color:"success"}),$.value=!0}function fe(){const i=new ze.LngLatBounds;["Polygon"].includes(h.value)?e.value.features.forEach(f=>{try{f.geometry.type==="Polygon"?i.extend([f.geometry.coordinates[0][0],f.geometry.coordinates[0][f.geometry.coordinates.length-1]]):i.extend([f.geometry.coordinates[0][0][0],f.geometry.coordinates[0][0][f.geometry.coordinates.length-1]])}catch{}}):e.value.features.forEach(f=>{i.extend([f.geometry.coordinates[0],f.geometry.coordinates[f.geometry.coordinates.length-1]])}),Object.keys(i).length!==0&&s.value.fitBounds(i,{padding:100})}const P=C([]),Q=C(null);r({update:be});function be(){var i;$.value&&(s.value.getSource("results").setData(e.value),(i=s.value.getSource("NaNresults"))==null||i.setData(c.value),k.value||s.value.getLayer("labels")&&s.value.removeLayer("labels"))}H(w,()=>fe());const pe=ee(()=>O.value?-1:1);function Y(i){var f;if(i.map.getCanvas().style.cursor="pointer",P.value=i.mapboxEvent.features,(f=Q.value)!=null&&f.isOpen()&&Q.value.remove(),d.value&&h.value!=="Polygon"){const R=P.value[0].properties[d.value];R&&(Q.value=new ze.Popup({closeButton:!1}).setLngLat([i.mapboxEvent.lngLat.lng,i.mapboxEvent.lngLat.lat]).setHTML(`${d.value}: <br> ${R}`).addTo(i.map))}}function ue(i){var f;P.value=[],(f=Q.value)!=null&&f.isOpen()&&Q.value.remove(),i.map.getCanvas().style.cursor=""}function z(i){var f;P.value=i.mapboxEvent.features,((f=P.value)==null?void 0:f.length)>0&&A("selectClick",{feature:P.value[0].properties,action:"featureClick"})}function E(i){var f;P.value=i.mapboxEvent.features,((f=P.value)==null?void 0:f.length)>0&&A("selectClick",{feature:P.value[0].properties,action:"zoneClick"})}function Z(i){i.map.getCanvas().style.cursor="pointer"}function K(i){i.map.getCanvas().style.cursor=""}return(i,f)=>(m(),S(l(al),{key:V.value,style:{width:"100%"},"access-token":l(M),"map-style":V.value,center:l(I).mapCenter,zoom:l(I).mapZoom,onLoad:W},{default:n(()=>[a(l(Qe),{position:"bottom-right"}),a(l(Ye),{position:"bottom-right","visualize-pitch":!0}),Xe(i.$slots,"default",{map:s.value,mapIsLoaded:$.value}),l(h)=="LineString"?(m(),S(l(ie),{key:0,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(e),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:o.value.links,paint:{"line-color":["get","display_color"],"line-offset":["*",pe.value*.5,["to-number",["get","display_width"]]],"line-opacity":l(N)/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:Y,onMouseleave:ue,onClick:E,onContextmenu:z},null,8,["source","layer"])):q("",!0),l(h)=="Point"?(m(),S(l(ie),{key:1,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(e),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:o.value.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":l(N)/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:Y,onMouseleave:ue,onClick:E,onContextmenu:z},null,8,["source","layer"])):q("",!0),l(h)=="LineString"?(m(),S(l(el),{key:2,"source-id":"results",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:o.value.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[pe.value*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":l(N)/100}}},null,8,["layer"])):q("",!0),l(h)==="Polygon"&&l(D)?(m(),S(l(ie),{key:3,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(e),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":l(N)/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:Z,onMouseleave:K,onClick:E,onContextmenu:z},null,8,["source","layer"])):q("",!0),l(h)==="Polygon"&&!l(D)?(m(),S(l(ie),{key:4,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(e),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":l(N)/100}},onMouseenter:Z,onMouseleave:K,onClick:E,onContextmenu:z},null,8,["source","layer"])):q("",!0),l(h)==="Polygon"&&!l(D)?(m(),S(l(ie),{key:5,reactive:!1,"source-id":"NaNresults",source:{type:"geojson",data:l(c),promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:Z,onMouseleave:K,onClick:E,onContextmenu:z},null,8,["source"])):q("",!0),l(k)!==null?(m(),S(l(ll),{key:6,type:"symbol","source-id":"results",source:"links","layer-id":"labels",layer:{type:"symbol",layout:{"text-field":["get",l(k)],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":i.$vuetify.theme.current.colors.black}}},null,8,["layer"])):q("",!0)]),_:3},8,["access-token","map-style","center","zoom"]))}},wl={name:"SidePanel",components:{},props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],emits:["update-selectedCategory","select-layer","select-preset","delete-preset","update-selectedFilter"],setup(_,r){const t=Pe(),p=ee(()=>t.showLeftPanel),j=C(!0);H(p,w=>{w?setTimeout(()=>{j.value=!0},500):j.value=!1});const u=C(!1),d=C(!1),{selectedCategory:h,filteredCat:D}=ge(_),k=C([]);H(h,(w,A)=>{w!==A&&(k.value=w)}),H(k,w=>{w!==h.value&&r.emit("update-selectedCategory",w)});function e(w){k.value=w.selectedCategory}function c(){k.value.length===D.value.length?k.value=[]:k.value=D.value}const{selectedFilter:N}=ge(_),O=C("");return H(N,w=>{w!==O.value&&(O.value=w)}),H(O,w=>{w!==N.value&&(r.emit("update-selectedFilter",w),k.value=h.value)}),sl(()=>{O.value=N.value,k.value=h.value,r.emit("update-selectedFilter",N.value),r.emit("update-selectedCategory",h.value)}),{store:t,showLeftPanel:p,showLeftPanelContent:j,openMenu:u,presetsMenu:d,selectedCat:k,vmodelSelectedFilter:O,init:e,showAll:c}}},Sl={class:"left-panel-content"},Ll={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},_l={class:"preset"},Nl={class:"title-div"},Pl={class:"custom-title"},Ml={class:"crop"},Fl={class:"layer"},Dl={class:"title-div"},Il={class:"custom-title"},Ul={class:"crop"},zl={style:{"padding-top":"0.5rem"}},Rl={class:"item"};function jl(_,r,t,p,j,u){return m(),F("section",{class:rl(p.showLeftPanel?"left-panel elevation-4":"left-panel-close"),style:_e({width:p.showLeftPanel?"350px":"0px"})},[x("div",{class:"left-panel-toggle-btn elevation-4",onClick:r[0]||(r[0]=d=>p.store.changeLeftPanel())},[a(se,{size:"small",color:"secondarydark"},{default:n(()=>[L(b(p.showLeftPanel?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),a(il,{name:"fade"},{default:n(()=>[Fe(x("div",Sl,[x("div",null,[x("div",Ll,[x("div",_l,[a(se,{style:{color:"white","padding-right":"2rem","padding-left":"1rem"}},{default:n(()=>r[7]||(r[7]=[L(" fas fa-sliders-h ")])),_:1}),a(Se,{modelValue:p.presetsMenu,"onUpdate:modelValue":r[1]||(r[1]=d=>p.presetsMenu=d),"close-delay":"100",location:"bottom center",transition:"slide-y-transition"},{activator:n(({props:d})=>[x("div",ne({class:"menu-container"},d),[x("div",Nl,[x("span",Pl,b(_.$gettext("Presets")),1),x("span",Ml,b(t.selectedPreset),1)]),a(se,{variant:"text",style:{color:"white"}},{default:n(()=>[L(b(p.presetsMenu?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)]),default:n(()=>[a(Le,null,{default:n(()=>[(m(!0),F(G,null,J(t.presetChoices,(d,h)=>(m(),S(ce,{key:h,link:"",onClick:()=>_.$emit("select-preset",d)},{append:n(()=>[a(U,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:Te(()=>_.$emit("delete-preset",d),["stop"])},null,8,["onClick"])]),default:n(()=>[a(Re,null,{default:n(()=>[L(b(d.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),a(je,{location:"bottom","open-delay":"300"},{activator:n(({props:d})=>[a(U,ne({variant:"text"},d,{disabled:t.presetChoices.length===0,style:{color:"white"},icon:"fas fa-download",onClick:r[2]||(r[2]=h=>p.store.exportFile("styles.json"))}),null,16,["disabled"])]),default:n(()=>[x("span",null,b(_.$gettext("Dowload presets")),1)]),_:1})]),x("div",Fl,[a(je,{location:"bottom","open-delay":"500"},{activator:n(({props:d})=>[a(U,ne({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:p.selectedCat.length==t.filteredCat.length?"fa-eye-slash fa":"fa-eye fa",variant:"text"},d,{onClick:r[3]||(r[3]=h=>p.showAll())}),null,16,["icon"])]),default:n(()=>[x("span",null,b(p.selectedCat.length==t.filteredCat.length?_.$gettext("Hide All"):_.$gettext("Show All")),1)]),_:1}),a(Se,{modelValue:p.openMenu,"onUpdate:modelValue":r[4]||(r[4]=d=>p.openMenu=d),"close-delay":"100",transition:"slide-y-transition"},{activator:n(({props:d})=>[x("div",ne({class:"title-div"},d),[x("div",ne({class:"menu-container"},d),[x("div",Dl,[x("span",Il,b(_.$gettext("Layer")),1),x("span",Ul,b(t.selectedLayer),1)]),a(se,{variant:"text",style:{color:"white"}},{default:n(()=>[L(b(p.openMenu?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)],16)]),default:n(()=>[a(Le,null,{default:n(()=>[(m(!0),F(G,null,J(t.layerChoices,(d,h)=>(m(),S(ce,{key:h,link:"",onClick:()=>_.$emit("select-layer",d)},{default:n(()=>[a(Re,null,{default:n(()=>[L(b(d),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),a(se)]),a(ve,{"max-width":"100%","min-width":"100%",height:"calc(100vh - 250px)",class:"mx-auto scrollable"},{default:n(()=>[a(ce,null,{default:n(()=>[x("div",zl,[a(de,{modelValue:p.vmodelSelectedFilter,"onUpdate:modelValue":r[5]||(r[5]=d=>p.vmodelSelectedFilter=d),items:t.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:_.$gettext("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),a(nl,{items:t.filteredCat,"item-height":45,height:"calc(100vh - 330px)"},{default:n(({item:d})=>[(m(),F("div",{key:p.vmodelSelectedFilter.concat(d),class:"container"},[a(ol,null,{default:n(()=>[a(ul,{modelValue:p.selectedCat,"onUpdate:modelValue":r[6]||(r[6]=h=>p.selectedCat=h),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:d},null,8,["modelValue","value"])]),_:2},1024),x("div",Rl,b(d),1)]))]),_:1},8,["items"])]),_:1})])])],512),[[De,p.showLeftPanelContent]])]),_:1})],6)}const Ol=Me(wl,[["render",jl],["__scopeId","data-v-d4451114"]]),$l={class:"setting"},Bl={class:"gradient-preview"},Tl={class:"preview-title"},ql={class:"gradient"},Wl={class:"domain-title"},El={__name:"ResultsSettings",props:["displaySettings","featureChoices","type"],emits:["submit","save-preset"],setup(_,{emit:r}){const{$gettext:t}=Ne(),p=_,j=r,{displaySettings:u,featureChoices:d,type:h}=ge(p),D=ee(()=>{const M=["OrRd","Spectral","RdYlGn","Viridis","YlGn","RdYlBu"],s=Object.keys(Be.brewer).slice(0,36).filter(o=>!M.includes(o));return[...M,...s]}),k=C(!1),e=C([{name:t("selectedFeature"),type:"String",value:u.value.selectedFeature,units:"",hint:t("selectedFeature")},{name:t("minWidth"),type:"Number",value:u.value.minWidth,units:"a.u.",hint:t("minWidth")},{name:t("maxWidth"),type:"Number",value:u.value.maxWidth,units:"a.u.",hint:t("maxWidth")},{name:t("numStep"),type:"Number",value:u.value.numStep,units:"int",hint:t("numStep")},{name:t("opacity"),type:"Number",value:u.value.opacity,units:"number",hint:t("opacity")},{name:t("scale"),type:"String",value:u.value.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:t("scale")},{name:t("color map"),type:"String",choices:D,value:u.value.cmap,units:"",hint:t("cmap to use")},{name:t("show NaN"),value:u.value.showNaN,hint:t("Hide NaN on map and color map")},{name:t("reverse color"),value:u.value.reverseColor,hint:t("reverse color scale")},{name:t("scale min"),type:"Number",value:u.value.minVal,units:"a.u.",hint:t("mininum value on the color Map")},{name:t("scale max"),type:"Number",value:u.value.maxVal,units:"a.u.",hint:t("maximum value on the color Map")},{name:t("custom scale"),value:u.value.fixScale,hint:t("customize to inputs values")},{name:t("Left side driving"),value:u.value.offset,hint:t("Select which side of the road the links are display")},{name:t("3D"),value:u.value.extrusion,hint:t("display zones as 3D extrusion")},{name:t("padding"),type:"Number",value:u.value.padding,units:"number",hint:t("range of colors")},{name:t("labels"),type:"String",value:u.value.labels,hint:t("show labels")}]),c=C(!1),N=C(!1);C(!1),H(k,()=>{A(),N.value=e.value[11].value}),H(d,()=>A());function O(){e.value[11].value?(N.value=!0,e.value[9].value=u.value.minVal,e.value[10].value=u.value.maxVal):N.value=!1}function w(M){const s=[],o=e.value[8].value;let V=e.value[14].value;V=[V[0]/100,1-V[1]/100],V=o?V.reverse():V;const B=Be.scale(M).padding(V).domain([0,100]).classes(25);for(let W=0;W<100;W++)s.push(B(W).hex());return o?s.reverse():s}function A(){e.value[0].value=u.value.selectedFeature,e.value[1].value=u.value.minWidth,e.value[2].value=u.value.maxWidth,e.value[3].value=u.value.numStep,e.value[4].value=u.value.opacity,e.value[5].value=u.value.scale,e.value[6].value=u.value.cmap,e.value[7].value=u.value.showNaN,e.value[8].value=u.value.reverseColor,e.value[9].value=u.value.minVal,e.value[10].value=u.value.maxVal,e.value[11].value=u.value.fixScale,e.value[12].value=u.value.offset,e.value[13].value=u.value.extrusion,e.value[14].value=u.value.padding,e.value[15].value=u.value.labels}function I(M){{const s={selectedFeature:e.value[0].value,minWidth:Number(e.value[1].value),maxWidth:Number(e.value[2].value),numStep:Number(e.value[3].value),opacity:Number(e.value[4].value),scale:e.value[5].value,cmap:e.value[6].value,showNaN:e.value[7].value,reverseColor:e.value[8].value,minVal:Number(e.value[9].value),maxVal:Number(e.value[10].value),fixScale:e.value[11].value,offset:e.value[12].value,extrusion:e.value[13].value,padding:e.value[14].value,labels:e.value[15].value};M==="apply"?j("submit",s):M==="save"&&j("save-preset",s)}}function $(){k.value=!1}return(M,s)=>(m(),S(Se,{modelValue:k.value,"onUpdate:modelValue":s[17]||(s[17]=o=>k.value=o),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:n(({props:o})=>[x("div",$l,[a(U,ne({color:l(u).selectedFeature===null?"error":"regular"},o,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:n(()=>[a(ve,{width:"20rem",class:"setting-card","max-height":"calc(100vh - 100px)",onKeydown:[s[16]||(s[16]=X(o=>I("apply"),["enter"])),X($,["esc"])]},{default:n(()=>[a(ce,{class:"subtitle"},{append:n(()=>[a(U,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:s[0]||(s[0]=o=>c.value=!c.value)})]),default:n(()=>[L(b(l(t)("Settings"))+" ",1)]),_:1}),a(qe,{ref:"form","lazy-validation":""},{default:n(()=>[a(oe,null,{default:n(()=>[a(de,{modelValue:e.value[0].value,"onUpdate:modelValue":s[1]||(s[1]=o=>e.value[0].value=o),variant:"underlined",items:l(d).sort(),label:l(t)(e.value[0].name),hint:c.value?l(t)(e.value[0].hint):"","persistent-hint":c.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),a(ke,null,{default:n(()=>[(m(!0),F(G,null,J(e.value.slice(1,3),o=>(m(),S(oe,{key:o.name},{default:n(()=>[a(me,{modelValue:o.value,"onUpdate:modelValue":V=>o.value=V,variant:"underlined",density:"compact",type:o.type,label:l(t)(o.name),suffix:o.units,hint:c.value?l(t)(o.hint):"","persistent-hint":c.value,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),a(ke,null,{default:n(()=>[a(oe,null,{default:n(()=>[a(me,{modelValue:e.value[3].value,"onUpdate:modelValue":s[2]||(s[2]=o=>e.value[3].value=o),variant:"underlined",density:"compact",type:e.value[3].type,label:l(t)(e.value[3].name),suffix:e.value[3].units,hint:c.value?l(t)(e.value[3].hint):"","persistent-hint":c.value,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),a(oe,null,{default:n(()=>[a(de,{modelValue:e.value[5].value,"onUpdate:modelValue":s[3]||(s[3]=o=>e.value[5].value=o),density:"compact",variant:"underlined",items:e.value[5].choices,label:l(t)(e.value[5].name),hint:c.value?l(t)(e.value[5].hint):"","persistent-hint":c.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),a(de,{modelValue:e.value[6].value,"onUpdate:modelValue":s[4]||(s[4]=o=>e.value[6].value=o),density:"compact",items:e.value[6].choices,label:l(t)(e.value[6].name),hint:c.value?l(t)(e.value[6].hint):"","persistent-hint":c.value,required:"",variant:"solo"},{selection:n(({item:o})=>[x("div",Bl,[(m(!0),F(G,null,J(w(o.value),(V,B)=>(m(),F("span",{key:B,class:"grad-step-small",style:_e({backgroundColor:V})},null,4))),128)),x("span",Tl,b(o.value),1)])]),item:n(({props:o,item:V})=>[a(ce,dl(cl(o)),{title:n(()=>[x("div",ql,[(m(!0),F(G,null,J(w(V.value),(B,W)=>(m(),F("span",{key:W,class:"grad-step",style:_e({backgroundColor:B})},null,4))),128)),x("span",Wl,b(V.value),1)])]),_:2},1040)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),a(vl,{modelValue:e.value[14].value,"onUpdate:modelValue":s[5]||(s[5]=o=>e.value[14].value=o),step:"5",density:"compact",color:"primary",label:l(t)(e.value[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),a(ml,{modelValue:e.value[4].value,"onUpdate:modelValue":s[6]||(s[6]=o=>e.value[4].value=o),class:"align-center",color:"primary",label:l(t)(e.value[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":n(({modelValue:o})=>[L(b(Math.floor(o)+"%"),1)]),_:1},8,["modelValue","label"]),a(de,{modelValue:e.value[15].value,"onUpdate:modelValue":s[7]||(s[7]=o=>e.value[15].value=o),variant:"underlined",items:[null,...l(d).sort()],label:l(t)(e.value[15].name),hint:c.value?l(t)(e.value[15].hint):"","persistent-hint":c.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),(m(),S(re,{key:e.value[12].name,modelValue:e.value[12].value,"onUpdate:modelValue":s[8]||(s[8]=o=>e.value[12].value=o),density:"compact",color:"primary","hide-details":!c.value,label:l(t)(e.value[12].name),hint:c.value?l(t)(e.value[12].hint):"","persistent-hint":c.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(m(),S(re,{key:e.value[7].name,modelValue:e.value[7].value,"onUpdate:modelValue":s[9]||(s[9]=o=>e.value[7].value=o),density:"compact",color:"primary","hide-details":!c.value,label:l(t)(e.value[7].name),hint:c.value?l(t)(e.value[7].hint):"","persistent-hint":c.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(m(),S(re,{key:e.value[8].name,modelValue:e.value[8].value,"onUpdate:modelValue":s[10]||(s[10]=o=>e.value[8].value=o),density:"compact",color:"primary","hide-details":!c.value,label:l(t)(e.value[8].name),hint:c.value?l(t)(e.value[7].hint):"","persistent-hint":c.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(l(h))?(m(),S(re,{key:e.value[13].name,modelValue:e.value[13].value,"onUpdate:modelValue":s[11]||(s[11]=o=>e.value[13].value=o),density:"compact",color:"primary","hide-details":!c.value,label:l(t)(e.value[13].name),disabled:!["Polygon","extrusion"].includes(l(h)),hint:c.value?l(t)(e.value[13].hint):"","persistent-hint":c.value},null,8,["modelValue","hide-details","label","disabled","hint","persistent-hint"])):q("",!0),(m(),S(re,{key:e.value[11].name,modelValue:e.value[11].value,"onUpdate:modelValue":[s[12]||(s[12]=o=>e.value[11].value=o),s[13]||(s[13]=o=>O(e.value[11].name))],density:"compact",variant:"underlined",color:"primary","hide-details":!c.value,label:l(t)(e.value[11].name),hint:c.value?l(t)(e.value[11].hint):"","persistent-hint":c.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),a(ke,null,{default:n(()=>[(m(!0),F(G,null,J(e.value.slice(9,11),o=>(m(),S(oe,{key:o.name},{default:n(()=>[Fe(a(me,{modelValue:o.value,"onUpdate:modelValue":V=>o.value=V,variant:"underlined",type:o.type,label:l(t)(o.name),suffix:o.units,hint:c.value?l(t)(o.hint):"","persistent-hint":c.value,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"]),[[De,N.value]])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},512),a(ye,null,{default:n(()=>[a(U,{color:"grey",variant:"text",onClick:$},{default:n(()=>[L(b(l(t)("Cancel")),1)]),_:1}),a(U,{color:"green-darken-1",variant:"text",onClick:s[14]||(s[14]=o=>I("apply"))},{default:n(()=>[L(b(l(t)("Apply")),1)]),_:1}),a(he),a(U,{color:"grey",variant:"text",onClick:s[15]||(s[15]=o=>I("save"))},{default:n(()=>[a(se,{size:"small",start:""},{default:n(()=>s[18]||(s[18]=[L(" fas fa-sliders-h ")])),_:1}),L(" "+b(l(t)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Al=Me(El,[["__scopeId","data-v-c23cb2e1"]]),Hl={class:"map-view"},Zl={class:"left-panel"},Kl={style:{display:"flex"}},Gl={__name:"ResultMap",setup(_){const{$gettext:r}=Ne(),t=fl(),p=pl(),j=yl(),u=Pe(),{visibleLayer:d,NaNLayer:h,type:D,loadLayer:k,displaySettings:e,hasOD:c,ODfeatures:N,matSelectedIndex:O,changeOD:w,isIndexAvailable:A,selectedCategory:I,selectedFilter:$,attributes:M,applySettings:s,changeSelectedFilter:o,filteredCategory:V,updateSelectedFeature:B,changeSelectedCategory:W,colorScale:fe}=bl(),P=C();function Q(v){s(v),Ce(()=>P.value.update())}function be(v){o(v),B(),Ce(()=>P.value.update())}function pe(v){W(v),B(),Ce(()=>P.value.update())}const Y=C("");async function ue(v,y=null){switch(Y.value=v,v){case"links":await k(t.links,null,y);break;case"rlinks":await k(p.rlinks,null,y);break;case"nodes":await k(t.nodes,null,y);break;case"rnodes":await k(p.rnodes,null,y);break;case"od":await k(j.layer,null,y);break;default:const g=await u.getOtherFile(v,"geojson"),T=await u.getOtherFile(v,"json");await k(g,T,y);break}P.value.update()}const z=C(null),E=ee(()=>u.availableLayers),Z=ee(()=>u.visibleRasters),K=ee(()=>u.styles),i=C(""),f=C(!1),R=C(!1),le=C(""),xe=C({});async function We(v){z.value=v.name,E.value.includes(v.layer)?(await ue(v.layer,v.displaySettings),M.value.includes(v==null?void 0:v.selectedFilter)?(o(v.selectedFilter),Object.keys(v).includes("selectedCategory")&&W(v.selectedCategory)):Object.keys(v).includes("selectedFilter")&&u.changeNotification({text:v.selectedFilter+" "+r("filter does not exist. use default one"),autoClose:!0,color:"error"})):u.changeNotification({text:r("Preset Layer does not exist"),autoClose:!0,color:"error"}),Object.keys(v).includes("selectedIndex")&&A(v.selectedIndex)&&(w(v.selectedIndex),u.changeNotification({})),P.value.update()}function Ee(v){i.value=v.name,f.value=!0}function Ae(v){xe.value=v,le.value=z.value,R.value=!0}async function He(v){if((await v).valid){R.value=!1;const g={name:te.cloneDeep(le.value),layer:te.cloneDeep(Y.value),displaySettings:te.cloneDeep(xe.value),selectedFilter:te.cloneDeep($.value)};I.value.filter(Ke=>V.value.includes(Ke)).length<V.value.length&&(g.selectedCategory=te.cloneDeep(I.value)),N.value.includes(xe.value.selectedFeature)&&c.value&&(g.selectedIndex=O.value),u.addStyle(g),Z.value.includes(le.value)?u.changeNotification({text:r("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):u.changeNotification({text:r("Preset Saved"),autoClose:!0,color:"success"}),z.value=te.cloneDeep(le.value)}}function Ie(){u.deleteStyle(i.value),f.value=!1,i.value===z.value&&(z.value=null),u.changeNotification({text:r("Preset deleted"),autoClose:!0,color:"success"}),i.value=""}const ae=C(!1),Ue=C([]);function Ze(v){v.action==="featureClick"?(Ue.value=v.feature,ae.value=!0):(w(v.feature.index),P.value.update())}return(v,y)=>(m(),F("section",Hl,[a(Ol,{"selected-category":l(I),"selected-filter":l($),"layer-choices":E.value,"selected-layer":Y.value,"filter-choices":l(M),"filtered-cat":l(V),"preset-choices":K.value,"selected-preset":z.value,onUpdateSelectedCategory:pe,onUpdateSelectedFilter:be,onSelectLayer:ue,onSelectPreset:We,onDeletePreset:Ee},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset"]),x("div",Zl,[Fe(a(xl,{key:"result",order:0,"color-scale":l(fe),"display-settings":l(e)},null,8,["color-scale","display-settings"]),[[De,l(d).features.length>0]])]),l(d).features?(m(),S(Cl,{ref_key:"mapRef",ref:P,key:l(D)+String(l(e).extrusion),"selected-layer":Y.value,"layer-type":l(D),extrusion:l(e).extrusion,labels:l(e).labels,links:l(d),"nan-links":l(h),"selected-feature":l(e).selectedFeature,opacity:l(e).opacity,offset:l(e).offset,onSelectClick:Ze},{default:n(g=>[x("div",Kl,[a(Al,{"display-settings":l(e),"feature-choices":l(M),type:l(D),onSubmit:Q,onSavePreset:Ae},null,8,["display-settings","feature-choices","type"]),a(hl),K.value.length>0?(m(),S(Vl,{key:0,choices:K.value,map:g.map,"available-layers":E.value},null,8,["choices","map","available-layers"])):q("",!0)]),(m(!0),F(G,null,J(K.value,T=>(m(),F("div",{key:T.name},[Z.value.includes(T.name)&&E.value.includes(T.layer)?(m(),S(kl,{key:0,preset:T,map:g.map,order:Z.value.indexOf(T.name)+1,"visible-rasters":Z.value},null,8,["preset","map","order","visible-rasters"])):q("",!0)]))),128))]),_:1},8,["selected-layer","layer-type","extrusion","labels","links","nan-links","selected-feature","opacity","offset"])):q("",!0),a(Ve,{modelValue:ae.value,"onUpdate:modelValue":y[1]||(y[1]=g=>ae.value=g),scrollable:"",persistent:"","max-width":"300",onKeydown:[y[2]||(y[2]=X(g=>ae.value=!1,["enter"])),y[3]||(y[3]=X(g=>ae.value=!1,["esc"]))]},{default:n(()=>[a(ve,{"max-height":"60rem"},{default:n(()=>[a(we,{class:"text-h5"},{default:n(()=>[L(b(l(r)("link Properties")),1)]),_:1}),a(Oe),a($e,null,{default:n(()=>[a(Le,null,{default:n(()=>[(m(!0),F(G,null,J(Ue.value,(g,T)=>(m(),S(me,{key:T,"model-value":g,label:T,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),a(Oe),a(ye,null,{default:n(()=>[a(he),a(U,{color:"success",variant:"text",onClick:y[0]||(y[0]=g=>ae.value=!1)},{default:n(()=>[L(b(l(r)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Ve,{modelValue:R.value,"onUpdate:modelValue":y[6]||(y[6]=g=>R.value=g),persistent:"","max-width":"400",onKeydown:y[7]||(y[7]=X(g=>R.value=!1,["esc"]))},{default:n(()=>[a(ve,null,{default:n(()=>[a(we,{class:"text-h5"},{default:n(()=>[L(b(l(r)("Create or modify preset")),1)]),_:1}),a(qe,{"validate-on":"submit lazy",onSubmit:Te(He,["prevent"])},{default:n(()=>[a($e,null,{default:n(()=>[a(gl,null,{default:n(()=>[a(oe,{cols:"12"},{default:n(()=>[a(me,{modelValue:le.value,"onUpdate:modelValue":y[4]||(y[4]=g=>le.value=g),autofocus:"",rules:[g=>!!g||"Required."],label:l(r)("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),a(ye,null,{default:n(()=>[a(he),a(U,{color:"grey",variant:"text",onClick:y[5]||(y[5]=g=>R.value=!1)},{default:n(()=>[L(b(l(r)("Cancel")),1)]),_:1}),a(U,{color:"green-darken-1",variant:"text",type:"submit"},{default:n(()=>[L(b(l(r)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Ve,{modelValue:f.value,"onUpdate:modelValue":y[9]||(y[9]=g=>f.value=g),persistent:"","max-width":"400",onKeydown:[y[10]||(y[10]=X(g=>f.value=!1,["esc"])),X(Ie,["enter"])]},{default:n(()=>[a(ve,null,{default:n(()=>[a(we,{class:"text-h5"},{default:n(()=>[L(b(l(r)("Delete")+" "+i.value+" ?"),1)]),_:1}),a(ye,null,{default:n(()=>[a(he),a(U,{color:"grey",variant:"text",onClick:y[8]||(y[8]=g=>f.value=!1)},{default:n(()=>[L(b(l(r)("Cancel")),1)]),_:1}),a(U,{color:"error",variant:"text",onClick:Ie},{default:n(()=>[L(b(l(r)("delete")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Xl=Me(Gl,[["__scopeId","data-v-75cf031e"]]);export{Xl as default};
