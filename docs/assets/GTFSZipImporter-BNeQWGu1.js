import{_ as Z,h as T,g as S,i as o,j as s,bU as Y,a2 as q,O as X,F as ee,al as te,u as ae,b1 as se,aa as ne,a as le,r as k,c as g,o as oe,f as I,A as l,ae as L,B as p,C as n,m as r,ax as A,a8 as z,L as y,H as re,I as ie,bV as ue,V as de,Q as E,a9 as ce,Z as N,ah as me,aJ as W,bW as pe,am as fe}from"./index-CkVeTMkb.js";import{W as _e}from"./Warning-CQoMn3P3.js";import{T as ge}from"./TimeSeriesSelector-ZXOgH9iQ.js";import"./form-B2uRhppC.js";const ve={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(u){this.$emit("update:date",this.parseOutput(u))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(u){if(u)return new Date(u.substring(0,4)+"-"+u.substring(4,6)+"-"+u.substring(6,8))},parseOutput(u){return u.toISOString().substring(0,10).replaceAll("-","")}}};function he(u,a,d,b,i,m){return S(),T(ee,{modelValue:i.menu,"onUpdate:modelValue":a[1]||(a[1]=v=>i.menu=v),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:o(({props:v})=>[s(q,X({"model-value":m.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},v),null,16,["model-value"])]),default:o(()=>[s(Y,{modelValue:i.isoDate,"onUpdate:modelValue":a[0]||(a[0]=v=>i.isoDate=v),max:i.dateMax,min:i.dateMin},null,8,["modelValue","max","min"])]),_:1},8,["modelValue"])}const Se=Z(ve,[["render",he],["__scopeId","data-v-1eb87a33"]]),Ve={class:"background"},De={class:"list"},xe={class:"list-row bold"},ke={class:"list-item-large"},ye={class:"list-item-medium"},be={class:"list-item-medium"},we={class:"list-item-medium"},Ie={class:"list-item-small"},Te={class:"list-item-small"},Fe={class:"list-item-large"},Ce={class:"list-item-medium"},Ge={class:"list-item-medium"},Ue={class:"list-item-medium"},Me={class:"list-item-small"},Be={class:"bottom-button"},Oe=te({__name:"GTFSZipImporter",setup(u){const{$gettext:a}=ae(),d=se(),b=ne(),i=le(),m=k(!1),v=g(()=>b.linksIsEmpty),h=g(()=>d.uploadedGTFS),x=g(()=>d.running),R=g(()=>d.callID),$=g(()=>d.error),K=g(()=>d.errorMessage),F=g(()=>h.value.filter(c=>c.progress<100).length>0),C=g(()=>d.parameters),w=k(C.value.timeseries);function G(){const c=h.value.map(e=>e.name),t=h.value.map(e=>e.date);d.saveParams({files:c,timeseries:W(w.value),dates:t})}oe(()=>{G()});const U=k();function j(){U.value.click();const c=document.getElementById("zip-input");c&&(c.value="")}async function H(c){try{i.changeLoading(!0);const e=c.target.files;if(!(e!=null&&e.length)){i.changeLoading(!1);return}for(const f of Array.from(e)){const _=await pe(f),P=_.reduce((V,D)=>D.start_date<V?D.start_date:V,_[0].start_date),J=_.reduce((V,D)=>D.end_date>V?D.end_date:V,_[0].end_date),Q={content:f,info:{name:f.name,minDate:P,maxDate:J,date:P,progress:0}};await d.addGTFS(Q)}i.changeLoading(!1)}catch(t){i.changeLoading(!1),i.changeAlert(t)}}const M=k();async function B(){var t;if(await M.value.validate())if(v.value){G();const e=W(C.value),f=fe(),_={scenario_path_S3:R.value,launcher_arg:{training_folder:"/tmp",params:e},metadata:{user_email:(t=f.cognitoInfo)==null?void 0:t.email}};d.start(_)}else m.value=!0}function O(){b.$reset(),m.value=!1,B()}return(c,t)=>(S(),I("div",Ve,[l("input",{id:"zip-input",ref_key:"zipInput",ref:U,type:"file",style:{display:"none"},accept:".zip",multiple:"",onChange:H},null,544),s(E,{class:"card"},{default:o(()=>[s(L,{class:"subtitle"},{default:o(()=>[p(n(r(a)("GTFS importer")),1)]),_:1}),s(A,null,{default:o(()=>[p(n(r(a)("import GTFS from local computer")),1)]),_:1}),s(A,null,{default:o(()=>[p(n(r(a)("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),s(z,null,{default:o(()=>[s(y,{variant:"elevated",disabled:x.value,"prepend-icon":"fa-solid fa-file-archive",onClick:j},{default:o(()=>[p(n(r(a)("upload GTFS")),1)]),_:1},8,["disabled"])]),_:1}),s(_e,{show:$.value,messages:K.value},null,8,["show","messages"]),s(ge,{ref_key:"formRef",ref:M,modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e)},null,8,["modelValue"]),l("div",De,[l("li",xe,[t[4]||(t[4]=l("span",{class:"list-item-small"},null,-1)),l("span",ke,n(r(a)("name")),1),l("span",ye,n(r(a)("from")),1),l("span",be,n(r(a)("to")),1),l("span",we,n(r(a)("selected date")),1),l("span",Ie,n(r(a)("Uploaded")),1)]),(S(!0),I(re,null,ie(h.value,(e,f)=>(S(),I("ul",{key:f,class:"list-row"},[l("span",Te,n(f),1),l("span",Fe,n(e.name),1),l("span",Ce,n(e.minDate),1),l("span",Ge,n(e.maxDate),1),l("span",Ue,[s(Se,{date:e.date,from:e.minDate,to:e.maxDate,"onUpdate:date":_=>e.date=_},null,8,["date","from","to","onUpdate:date"])]),l("span",Me,[e.progress<100?(S(),T(ue,{key:0,indeterminate:e.progress===0,absolute:"",color:"primary","model-value":e.progress},null,8,["indeterminate","model-value"])):(S(),T(de,{key:1},{default:o(()=>t[5]||(t[5]=[p("fas fa-check",-1)])),_:1,__:[5]}))])]))),128))]),l("div",Be,[s(y,{loading:x.value,disabled:x.value||h.value.length==0||F.value,color:x.value||h.value.length==0||F.value?"regular":"success","prepend-icon":"fa-solid fa-play",onClick:B},{default:o(()=>[p(n(r(a)("convert")),1)]),_:1},8,["loading","disabled","color"])])]),_:1}),s(me,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=e=>m.value=e),persistent:"","max-width":"500",onKeydown:[N(O,["enter"]),t[3]||(t[3]=N(e=>m.value=!1,["esc"]))]},{default:o(()=>[s(E,null,{default:o(()=>[s(L,{class:"text-h5"},{default:o(()=>[p(n(r(a)("Overwrite current PT network ?")),1)]),_:1}),s(z,null,{default:o(()=>[s(ce),s(y,{color:"regular",onClick:t[1]||(t[1]=e=>m.value=!m.value)},{default:o(()=>[p(n(r(a)("No")),1)]),_:1}),s(y,{color:"primary",onClick:O},{default:o(()=>[p(n(r(a)("Yes")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Ee=Z(Oe,[["__scopeId","data-v-0855f022"]]);export{Ee as default};
