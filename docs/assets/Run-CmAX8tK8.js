import{al as Z,u as J,am as Q,c as _,t as re,d as X,h as D,g as c,an as ge,m as i,ao as ce,i as t,k as se,r as z,ap as ee,w as G,j as l,D as N,f as L,l as O,A as P,ae as de,B as T,C as b,W as B,E as he,$ as ye,aq as _e,H as q,I as j,a8 as Ve,L as A,a9 as we,Q as te,ar as xe,as as be,at as Se,au as ke,av as $e,Z as Ce,aw as Le,ak as Ee,aj as Ie,_ as Y,G as Re,J as le,V as ne,O as ze,F as De,ah as Te,a as Fe,ax as Pe,ay as Ae,a7 as He,R as Ue,az as Me,aA as oe,a0 as ie,a1 as Ne}from"./index-D7fX3MvK.js";import{W as ue}from"./Warning-Bh_dzi12.js";const Oe=Z({__name:"ParamInput",props:{item:{}},setup(H){const{$gettext:d}=J(),p=Q(),a=_(()=>p.scenariosList),E=_(()=>p.scenario),S=H,{item:s}=re(S);function k(e){return e.items==="$scenarios"?a.value.map(v=>v.scenario).filter(v=>v!==E.value):e.items}const $={required:e=>e!=null||d("Required"),largerThanZero:e=>e>0||d("should be larger than 0"),nonNegative:e=>e>=0||d("should be larger or equal to 0")};function h(e){if(e.items==="$scenarios"){const v=a.value.map(w=>w.scenario);Array.isArray(e.value)?e.value=e.value.filter(w=>v.includes(w)):e.value=v.includes(e.value)?e.value:""}}X(()=>h(s.value));const C=_(()=>s.value.items!==void 0?"v-select":s.value.type===void 0?"v-text-field":s.value.type.toLocaleLowerCase()==="boolean"?"v-switch":s.value.type.toLowerCase()==="number"?"v-number-input":"v-text-field");function u(e){return e.split("#")[1]}return(e,v)=>{var w,I;return c(),D(ge(C.value),{modelValue:i(s).value,"onUpdate:modelValue":[v[0]||(v[0]=U=>i(s).value=U),v[1]||(v[1]=U=>h(i(s)))],color:"primary",variant:"outlined","control-variant":"stacked",inset:"","hide-details":"",precision:i(s).precision===void 0?null:i(s).precision,label:i(s).text,prefix:u(i(s).text),suffix:i(s).units?i(s).units:void 0,type:i(s).type,rules:(w=i(s).rules)==null?void 0:w.map(U=>$[U]),multiple:(I=i(s))==null?void 0:I.multiple,items:k(i(s))},ce({_:2},[e.$slots.prepend?{name:"prepend",fn:t(()=>[se(e.$slots,"prepend")]),key:"0"}:void 0,e.$slots.append?{name:"append",fn:t(()=>[se(e.$slots,"append")]),key:"1"}:void 0]),1032,["modelValue","precision","label","prefix","suffix","type","rules","multiple","items"])}}}),Be=Number.MAX_SAFE_INTEGER;function qe(H=200,d=200,p=0,a=Be){const E=z(H),S=z(d),s=z(!1),k=z(),$=z([0,0]);function h(e){e.preventDefault(),s.value=!0,$.value=[e.clientX-k.value.clientWidth,e.clientY-k.value.clientHeight],document.addEventListener("mousemove",C),document.addEventListener("mouseup",u)}function C(e){if(s.value){const v=e.clientX-$.value[0],w=e.clientY-$.value[1];E.value=v<p?p:v>a?a:v,S.value=w<p?p:w>a?a:w}}function u(){s.value=!1,document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",u)}return{panelWidth:E,panelHeight:S,panelDiv:k,startResize:h}}const We={key:0},je={class:"expansion"},Ge={key:0,class:"categorie-info"},Xe={key:0,class:"custom-hint"},Ye=["onDblclick"],Ke=["onUpdate:modelValue"],Ze=Z({__name:"ParamForm",setup(H){const{$gettext:d}=J(),p=ee(),a=Q(),E=_(()=>a.model!==null),S=_(()=>p.filteredParameters),s=_(()=>p.selectedInfo);function k(){p.resetParameters()}const{panelHeight:$,panelDiv:h,startResize:C}=qe(0,50,50);X(()=>{if(h.value){const r=window.innerHeight,n=h.value.scrollHeight,o=n/r;$.value=o>.25?.25*r:n}});const u=z([]);X(()=>{const o=S.value.map(m=>m.params.length).map((m=>y=>m+=y)(0)).filter(m=>m<=10);u.value=o.map((m,y)=>y)});function e(){u.value.length<S.value.length?u.value=S.value.map((r,n)=>n):u.value=[]}const v=z(!1),w=z(!1),I=z({}),U=(r,n,o)=>{if(r){const m=String(n)+String(o);I.value[m]=r}};function W(r,n){w.value=!0;const o=String(r)+String(n);Ee(()=>I.value[o].focus())}G(v,r=>{r||(w.value=!1)});const M=z(!1),f=_(()=>p.variants);function g(r){return r.text.split("#")[1]}function V(r){return r.text.includes("#")}const R=_(()=>{var o;const r=(o=f.value)!=null&&o.choices?f.value.choices:[],n={};return S.value.map(m=>m.category),S.value.forEach(m=>{const y=m.params.map(x=>x.text),F=Object.groupBy(y,x=>x.split("#")[0]);Object.keys(F).forEach(x=>{const me=F[x].slice(1).map(K=>K.split("#")[1]);F[x]=r.filter(K=>!me.includes(K))}),n[m.category]=F}),n});function ae(r,n){const o=r.category,m=n.text.split("#")[0];return R.value[o][m]}function ve(r,n){n.text=n.text.split("#")[0]+`#${r}`}function pe(r,n){const o=Ie.cloneDeep(n),m=r.category,y=n.text,F=R.value[m][y][0];if(F){o.text=o.text+`#${F}`;const x=r.params.indexOf(n);r.params.splice(x+1,0,o)}}function fe(r,n){r.params=r.params.filter(o=>o!==n)}return(r,n)=>(c(),D(te,{class:"card"},{default:t(()=>[l(de,{class:"subtitle"},{default:t(()=>[T(b(i(d)("Scenario Settings")),1)]),_:1}),N(P("div",{ref_key:"resizableDiv",ref:h,class:"info-div",style:he({height:i($)+"px"})},b(s.value),5),[[B,s.value]]),N(P("div",{class:"drag-handle",onMousedown:n[0]||(n[0]=(...o)=>i(C)&&i(C)(...o))},null,544),[[B,s.value]]),S.value.length===0?(c(),L("p",We,b(i(d)("No parameters")),1)):O("",!0),P("div",je,[l(ye,{ref:"form","validate-on":"lazy"},{default:t(()=>[l(_e,{modelValue:u.value,"onUpdate:modelValue":n[2]||(n[2]=o=>u.value=o),multiple:""},{default:t(()=>[(c(!0),L(q,null,j(S.value,(o,m)=>(c(),D(xe,{key:m},{default:t(()=>[l(be,{class:"categorie"},{default:t(()=>[T(b(o.category),1)]),_:2},1024),l(Se,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:t(()=>[N(P("div",null,[o.info?(c(),L("div",Ge,b(o.info),1)):O("",!0),(c(!0),L(q,null,j(o.params,(y,F)=>(c(),L("li",{key:F,class:"param-list"},[l(Oe,{item:y},ce({_:2},[M.value&&f.value?{name:"prepend",fn:t(()=>[V(y)?(c(),D(ke,{key:0,items:ae(o,y),size:"small","model-value":g(y),"onUpdate:modelValue":x=>ve(x,y)},null,8,["items","model-value","onUpdate:modelValue"])):(c(),D(A,{key:1,variant:"tonal",size:"small",disabled:ae(o,y).length==0,icon:"fas fa-plus",onClick:x=>pe(o,y)},null,8,["disabled","onClick"]))]),key:"0"}:void 0,M.value&&V(y)?{name:"append",fn:t(()=>[l(A,{variant:"text",color:"error",size:"small",icon:"fas fa-trash",onClick:x=>fe(o,y)},null,8,["onClick"])]),key:"1"}:void 0]),1032,["item"]),l($e,null,{default:t(()=>[v.value?(c(),L("div",Xe,[w.value?N((c(),L("textarea",{key:1,ref_for:!0,ref:x=>U(x,m,F),"onUpdate:modelValue":x=>y.hint=x,rows:"1",class:"edition",onKeydown:n[1]||(n[1]=Ce(x=>w.value=!1,["enter"]))},null,40,Ke)),[[Le,y.hint]]):(c(),L("div",{key:0,onDblclick:x=>W(m,F)},b(y.hint),41,Ye))])):O("",!0)]),_:2},1024)]))),128))],512),[[B,u.value.includes(m)]])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),l(Ve,null,{default:t(()=>[N(l(A,{variant:"text",onClick:k},{default:t(()=>[T(b(i(d)("back to default")),1)]),_:1},512),[[B,E.value]]),l(we),f.value?(c(),D(A,{key:0,"prepend-icon":"fas fa-plus",variant:"text",active:M.value,onClick:n[3]||(n[3]=o=>M.value=!M.value)},{default:t(()=>[T(b(i(d)("Manage")),1)]),_:1},8,["active"])):O("",!0),l(A,{variant:"text",onClick:e},{default:t(()=>[T(b(u.value.length!=S.value.length?i(d)("Expand all"):i(d)("Collapse all")),1)]),_:1}),l(A,{icon:"far fa-question-circle",size:"small",active:v.value,onClick:n[4]||(n[4]=o=>v.value=!v.value)},null,8,["active"])]),_:1})]),_:1}))}}),Je=Y(Ze,[["__scopeId","data-v-a7e7c44a"]]),Qe="/quetzal-network-editor-dev/assets/samsung-washing-machine-melody-made-with-Voicemod-technology-C_SPFWiL.mp3",et={style:{"white-space":"pre-line"}},tt={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(H){const d=H,{disabled:p}=re(d),a=ee(),E=z(!1),S=_(()=>a.hasLogs),s=z([]);async function k(){await a.getLogs(),s.value=a.logs,s.value.sort((h,C)=>String(h.time).localeCompare(String(C.time),void 0,{sensitivity:"base"})),E.value=!0}async function $(){await a.downloadLogs()}return(h,C)=>(c(),L(q,null,[l(De,{"close-delay":"100",transition:"slide-y-transition"},{activator:t(({props:u})=>[N(l(A,ze({disabled:i(p),class:"log-button",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},u),{default:t(()=>C[1]||(C[1]=[T(" logs ")])),_:2},1040,["disabled"]),[[B,S.value]])]),default:t(()=>[l(Re,null,{default:t(()=>[l(le,{onClick:k},{prepend:t(()=>[l(ne,{icon:"fas fa-eye"})]),default:t(()=>[T(b(h.$gettext("show"))+" ",1)]),_:1}),l(le,{onClick:$},{prepend:t(()=>[l(ne,{icon:"fas fa-download"})]),default:t(()=>[T(b(h.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),l(Te,{modelValue:E.value,"onUpdate:modelValue":C[0]||(C[0]=u=>E.value=u),width:"90%"},{default:t(()=>[l(te,{style:{"overflow-y":"auto"}},{default:t(()=>[(c(!0),L(q,null,j(s.value,(u,e)=>(c(),L("div",{key:e,class:"log-container"},[P("h1",null,b(u.name),1),P("h3",null,[P("b",null,b(u.time),1)]),P("span",et,b(u.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},at=Y(tt,[["__scopeId","data-v-19036b20"]]),st={class:"title-container"},lt={class:"buttons-row ma-2"},nt={key:1},ot=Z({__name:"RunStepper",setup(H){const{$gettext:d}=J(),p=Fe(),a=ee(),E=Q(),S=_(()=>a.steps),s=_(()=>{const f=a.availableModels;return a.avalaibleStepFunctions.filter(g=>f.has(g))}),k=_({get:()=>a.selectedStepFunction,set:f=>a.selectedStepFunction=f}),$=_(()=>a.variants),h=_(()=>a.running),C=_(()=>a.status),u=_(()=>a.currentStep),e=_(()=>a.error),v=_(()=>a.errorMessage),w=_(()=>E.protected),I=_(()=>E.model!==null);X(async()=>{I.value&&(await a.getSteps(),await a.checkRunningExecution())}),G(s,f=>{I.value&&(f.includes(k.value)||(k.value=f[0],a.getSteps()))},{once:!0}),G(k,async f=>{I.value&&(s.value.includes(f)?(k.value=f,a.getSteps()):(k.value=s.value[0],a.getSteps()))});async function U(){if(await a.checkRunningExecution()){p.changeNotification({text:d("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{a.initExecution(),await p.exportToS3("inputs"),await p.deleteOutputsOnS3(),await p.deleteLogsOnS3(),p.deleteOutputs(),a.start()}catch(g){a.stopExecution(),console.log(g),p.changeAlert(g)}}const W=z(!0);G(C,f=>{f==="FINISHED"&&M()});function M(){if(W.value){const f=new Audio(Qe);f.play(),setTimeout(function(){f.pause(),f.currentTime=0},5e3)}}return(f,g)=>(c(),D(te,{class:"card"},{default:t(()=>[P("div",st,[l(de,{class:"subtitle"},{default:t(()=>[T(b(i(d)("Simulation")),1)]),_:1}),l(at,{disabled:h.value||!I.value},null,8,["disabled"])]),s.value.length>1?(c(),D(Pe,{key:0,modelValue:k.value,"onUpdate:modelValue":g[0]||(g[0]=V=>k.value=V),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:t(()=>[(c(!0),L(q,null,j(s.value,V=>(c(),D(Me,{key:V,value:V,disabled:h.value||!I.value},{default:t(()=>[T(b(V),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):O("",!0),l(Ae,{modelValue:u.value,"onUpdate:modelValue":g[5]||(g[5]=V=>u.value=V),class:"stepper"},{default:t(()=>[l(ue,{show:e.value,title:i(d)("Simulation ended with an execution error or have been aborted.         Please relauch simulation. If the problem persist, contact us."),messages:v.value},null,8,["show","title","messages"]),l(ue,{show:w.value,title:i(d)("This scenario is protected"),messages:i(d)(" You cannot run simulation.")},null,8,["show","title","messages"]),P("div",lt,[l(A,{loading:h.value,disabled:h.value||w.value||!I.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:g[1]||(g[1]=V=>U())},{default:t(()=>[T(b(i(d)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),N(l(A,{color:"grey",variant:"text",onClick:g[2]||(g[2]=V=>i(a).stopExecution())},{default:t(()=>[T(b(i(d)("Abort")),1)]),_:1},512),[[B,h.value&&u.value!==1]]),l(He,{modelValue:W.value,"onUpdate:modelValue":g[3]||(g[3]=V=>W.value=V),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",label:i(d)("End signal"),color:"success","hide-details":""},{prepend:t(()=>g[6]||(g[6]=[])),_:1},8,["modelValue","label"])]),$.value?(c(),D(Ue,{key:0,modelValue:$.value.variants,"onUpdate:modelValue":g[4]||(g[4]=V=>$.value.variants=V),class:"ma-2",label:$.value.label||"variants",chips:"",disabled:h.value,items:$.value.choices,multiple:$.value.multiple,"hide-details":!0},null,8,["modelValue","label","disabled","items","multiple"])):O("",!0),I.value?(c(),L("div",nt,[(c(!0),L(q,null,j(S.value,(V,R)=>(c(),L("div",{key:R+1},[e.value?(c(),D(oe,{key:1,complete:u.value>R+1,color:u.value>=R+1?"primary":void 0,title:V.name,value:R+1,rules:[()=>u.value!==R+1],step:R+1},null,8,["complete","color","title","value","rules","step"])):(c(),D(oe,{key:0,complete:u.value>R+1,color:u.value>=R+1?"primary":void 0,title:V.name,value:R+1,step:R+1},null,8,["complete","color","title","value","step"]))]))),128))])):O("",!0)]),_:1},8,["modelValue"])]),_:1}))}}),it=Y(ot,[["__scopeId","data-v-0d8cb97c"]]),ut={class:"section"},rt={__name:"Run",setup(H){return(d,p)=>(c(),L("section",ut,[l(Ne,{class:"col"},{default:t(()=>[l(ie,{order:"1"},{default:t(()=>[l(Je)]),_:1}),l(ie,{order:"2"},{default:t(()=>[l(it)]),_:1})]),_:1})]))}},vt=Y(rt,[["__scopeId","data-v-7193c230"]]);export{vt as default};
