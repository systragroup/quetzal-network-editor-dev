import{_ as D,ae as H,af as O,ag as q,e as g,r as P,p as J,g as o,h as m,i as t,j as l,ab as X,x as v,y as d,ah as r,ad as te,l as $,v as L,U as ae,ai as le,q as S,F as E,E as R,aj as ne,ak as se,al as oe,a1 as K,Z as ue,N as j,a2 as re,G as T,a3 as ie,V as z,L as M,t as de,z as Q,C as ce,A as W,D as pe,J as G,B as ve,a9 as fe,u as ge,w as B,Y as ye,X as Y,am as me,an as he,ao as Ve,ap as N,aq as Z}from"./index-CRKZRABL.js";const _e={class:"expansion"},xe={__name:"ParamForm",setup(A){const{$gettext:u}=H(),_=O(),a=q(),C=g(()=>_.selectedStepFunction),F=g(()=>_.parameters),f=g(()=>F.value.filter(c=>Object.keys(c).includes("category")&&c.model===C.value)),k=g(()=>{var c;return(c=F.value.filter(n=>((n==null?void 0:n.info)&&(n==null?void 0:n.model))===C.value)[0])==null?void 0:c.info}),y=P([]);J(()=>{y.value=[...Array(f.value.length).keys()].map((c,n)=>n)});const h=g(()=>a.scenariosList),b=g(()=>a.scenario);function x(){_.getParameters()}function I(){y.value.length<f.value.length?y.value=[...Array(f.value.length).keys()].map((c,n)=>n):y.value=[]}const V=P(!1),w={required:c=>c!=null||u("Required"),largerThanZero:c=>c>0||u("should be larger than 0"),nonNegative:c=>c>=0||u("should be larger or equal to 0")};function U(c){const n=h.value.map(s=>s.scenario);c.value=c.value.filter(s=>n.includes(s))}return(c,n)=>(o(),m(M,{class:"card"},{default:t(()=>[l(X,{class:"subtitle"},{default:t(()=>[v(d(r(u)("Scenario Settings")),1)]),_:1}),k.value?(o(),m(te,{key:0,class:"info-div"},{default:t(()=>[v(d(k.value),1)]),_:1})):$("",!0),L("div",_e,[l(ae,{ref:"form","lazy-validation":""},{default:t(()=>[l(le,{modelValue:y.value,"onUpdate:modelValue":n[0]||(n[0]=s=>y.value=s),multiple:""},{default:t(()=>[(o(!0),S(E,null,R(f.value,(s,i)=>(o(),m(ne,{key:i},{default:t(()=>[l(se,{class:"categorie"},{default:t(()=>[v(d(s.category),1)]),_:2},1024),l(oe,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:t(()=>[(o(!0),S(E,null,R(s.params,(e,ee)=>(o(),S("li",{key:ee,class:"param-list"},[typeof e.items>"u"&&typeof e.value=="boolean"?(o(),m(K,{key:0,modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,color:"primary",density:"compact",class:"pl-2",label:r(u)(e.text),hint:V.value?r(u)(e.hint):"","persistent-hint":V.value},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint"])):typeof e.items>"u"?(o(),m(ue,{key:1,modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,variant:"outlined",type:e.type,label:r(u)(e.text),suffix:e.units,hint:V.value?r(u)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(p=>w[p])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):e.items==="$scenarios"?(o(),m(j,{key:2,modelValue:e.value,"onUpdate:modelValue":[p=>e.value=p,p=>U(e)],variant:"outlined",type:e.type,items:h.value.map(p=>p.scenario).filter(p=>p!==b.value),multiple:e==null?void 0:e.multiple,label:r(u)(e.text),suffix:e.units,hint:V.value?r(u)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(p=>w[p])},null,8,["modelValue","onUpdate:modelValue","type","items","multiple","label","suffix","hint","persistent-hint","rules"])):(o(),m(j,{key:3,modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,variant:"outlined",type:e.type,multiple:e==null?void 0:e.multiple,items:e.items,label:r(u)(e.text),suffix:e.units,hint:V.value?r(u)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(p=>w[p])},null,8,["modelValue","onUpdate:modelValue","type","multiple","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),l(re,null,{default:t(()=>[l(T,{color:"grey",variant:"text",onClick:x},{default:t(()=>[v(d(r(u)("back to default")),1)]),_:1}),l(ie),l(T,{variant:"text",onClick:I},{default:t(()=>[v(d(y.value.length!=f.value.length?r(u)("Expand all"):r(u)("Collapse all")),1)]),_:1}),l(T,{icon:"",size:"small",onClick:n[1]||(n[1]=s=>V.value=!V.value)},{default:t(()=>[l(z,null,{default:t(()=>n[2]||(n[2]=[v("far fa-question-circle small")])),_:1})]),_:1})]),_:1})]),_:1}))}},Se=D(xe,[["__scopeId","data-v-98599a42"]]),be={style:{"white-space":"pre-line"}},we={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(A){const u=A,{disabled:_}=de(u),a=O(),C=P(!1),F=g(()=>a.hasLogs),f=P([]);async function k(){await a.getLogs(),f.value=a.logs,f.value.sort((h,b)=>String(h.time).localeCompare(String(b.time),void 0,{sensitivity:"base"})),C.value=!0}async function y(){await a.downloadLogs()}return(h,b)=>(o(),S(E,null,[l(ve,{"close-delay":"100",transition:"slide-y-transition"},{activator:t(({props:x})=>[Q(l(T,ce({disabled:r(_),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},x),{default:t(()=>b[1]||(b[1]=[v(" logs ")])),_:2},1040,["disabled"]),[[W,F.value]])]),default:t(()=>[l(pe,null,{default:t(()=>[l(G,{onClick:k},{prepend:t(()=>[l(z,{icon:"fas fa-eye"})]),default:t(()=>[v(d(h.$gettext("show"))+" ",1)]),_:1}),l(G,{onClick:y},{prepend:t(()=>[l(z,{icon:"fas fa-download"})]),default:t(()=>[v(d(h.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),l(fe,{modelValue:C.value,"onUpdate:modelValue":b[0]||(b[0]=x=>C.value=x),width:"90%"},{default:t(()=>[l(M,{style:{"overflow-y":"auto"}},{default:t(()=>[(o(!0),S(E,null,R(f.value,(x,I)=>(o(),S("div",{key:I,class:"log-container"},[L("h1",null,d(x.name),1),L("h3",null,[L("b",null,d(x.time),1)]),L("span",be,d(x.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},ke=D(we,[["__scopeId","data-v-c531ebb9"]]),Ce={class:"title-container"},Le={class:"buttons-row ma-2"},Ee={key:4},Fe={__name:"Run",setup(A){const{$gettext:u}=H(),_=ge(),a=O(),C=q(),F=g(()=>a.steps),f=g(()=>{const n=a.availableModels;return a.avalaibleStepFunctions.filter(s=>n.has(s))}),k=P(a.selectedStepFunction),y=g(()=>a.running),h=g(()=>a.currentStep),b=g(()=>a.error),x=g(()=>a.errorMessage),I=g(()=>a.synchronized),V=g(()=>C.protected),w=g(()=>C.model!==null),U=P(a.endSignal);B(U,()=>a.changeEndSignal(U.value)),J(async()=>{w.value&&(await a.getSteps(),await a.GetRunningExecution())}),B(f,n=>{w.value&&(n.includes(k.value)||(a.setSelectedStepFunction(n[0]),a.getSteps()))},{once:!0}),B(k,async n=>{w.value&&(f.value.includes(n)?(a.setSelectedStepFunction(n),a.getSteps()):(k.value=f.value[0],a.setSelectedStepFunction(f.value[0]),a.getSteps()))});async function c(){if(await a.GetRunningExecution()){_.changeNotification({text:u("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const s=q();a.initExecution(),await _.exportToS3("inputs"),await _.deleteOutputsOnS3(),await _.deleteLogsOnS3(),_.deleteOutputs(),a.startExecution({scenario:s.scenario})}catch(s){a.terminateExecution(),console.log(s),_.changeAlert(s)}}return(n,s)=>(o(),m(ye,{class:"background"},{default:t(()=>[l(Y,{order:"1"},{default:t(()=>[l(Se)]),_:1}),l(Y,{order:"2"},{default:t(()=>[l(M,{class:"card"},{default:t(()=>[L("div",Ce,[l(X,{class:"subtitle"},{default:t(()=>[v(d(r(u)("Scenario Simulation")),1)]),_:1}),l(ke,{disabled:y.value||!w.value},null,8,["disabled"])]),l(me,{modelValue:h.value,"onUpdate:modelValue":s[4]||(s[4]=i=>h.value=i),class:"stepper"},{default:t(()=>[f.value.length>1?(o(),m(he,{key:0,modelValue:k.value,"onUpdate:modelValue":s[0]||(s[0]=i=>k.value=i),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:t(()=>[(o(!0),S(E,null,R(f.value,i=>(o(),m(Ve,{key:i,value:i,disabled:y.value||!w.value},{default:t(()=>[v(d(i),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):$("",!0),I.value?$("",!0):(o(),m(N,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:t(()=>[v(d(r(u)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),b.value?(o(),m(N,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[v(d(r(u)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(o(!0),S(E,null,R(Object.keys(x.value),i=>(o(),S("p",{key:i},[L("b",null,d(i)+": ",1),v(d(x.value[i]),1)]))),128))]),_:1})):$("",!0),V.value?(o(),m(N,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[v(d(r(u)("This scenario is protected. You can not run simulation.")),1)]),_:1})):$("",!0),L("div",Le,[l(T,{loading:y.value,disabled:y.value||V.value||!w.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:s[1]||(s[1]=i=>c())},{default:t(()=>[v(d(r(u)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),Q(l(T,{color:"grey",variant:"text",onClick:s[2]||(s[2]=i=>r(a).stopExecution())},{default:t(()=>[v(d(r(u)("Abort")),1)]),_:1},512),[[W,y.value&&h.value!==1]]),l(K,{modelValue:U.value,"onUpdate:modelValue":s[3]||(s[3]=i=>U.value=i),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:t(()=>[L("span",null,d(r(u)("End signal")),1)]),_:1},8,["modelValue"])]),w.value?(o(),S("div",Ee,[(o(!0),S(E,null,R(F.value,(i,e)=>(o(),S("div",{key:e+1},[b.value?(o(),m(Z,{key:1,complete:h.value>e+1,title:i.name,value:e+1,step:e+1},null,8,["complete","title","value","step"])):(o(),m(Z,{key:0,complete:h.value>e+1,color:h.value>=e+1?"primary":"regular",title:i.name,value:e+1,compact:"",step:e+1},null,8,["complete","color","title","value","step"]))]))),128))])):$("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},$e=D(Fe,[["__scopeId","data-v-bdf210d1"]]);export{$e as default};
