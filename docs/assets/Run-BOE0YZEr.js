import{al as J,u as Q,am as ee,c as h,t as re,d as X,h as F,g as r,an as ge,m as i,ao as ce,i as t,k as se,r as T,ap as ae,w as G,j as l,D as N,f as C,l as B,A as P,ae as de,B as z,C as b,W as q,E as he,$ as ye,aq as _e,H as W,I as j,a8 as Ve,L as H,a9 as we,Q as te,ar as be,as as Se,at as xe,au as ke,av as $e,Z as Ce,aw as Le,ak as Ee,aj as Ie,_ as Y,G as Re,J as le,V as ne,O as Te,F as ze,ah as De,a as Fe,ax as Pe,ay as Ae,az as He,a7 as Ue,R as Me,aA as Ne,aB as oe,a0 as ie,a1 as Be}from"./index-BbcYXnEn.js";import{W as ue}from"./Warning-B9vFJpGZ.js";const Oe=J({__name:"ParamInput",props:{item:{}},setup(U){const{$gettext:c}=Q(),p=ee(),a=h(()=>p.scenariosList),I=h(()=>p.scenario),k=U,{item:o}=re(k);function L(e){return e.items==="$scenarios"?a.value.map(d=>d.scenario).filter(d=>d!==I.value):e.items}const S={required:e=>e!=null||c("Required"),largerThanZero:e=>e>0||c("should be larger than 0"),nonNegative:e=>e>=0||c("should be larger or equal to 0")};function y(e){if(e.items==="$scenarios"){const d=a.value.map($=>$.scenario);Array.isArray(e.value)?e.value=e.value.filter($=>d.includes($)):e.value=d.includes(e.value)?e.value:""}}X(()=>y(o.value));const g=h(()=>o.value.items!==void 0?"v-select":o.value.type===void 0?"v-text-field":o.value.type.toLocaleLowerCase()==="boolean"?"v-switch":o.value.type.toLowerCase()==="number"?"v-number-input":"v-text-field");function v(e){return e.split("#")[1]}return(e,d)=>{var $,M;return r(),F(ge(g.value),{modelValue:i(o).value,"onUpdate:modelValue":[d[0]||(d[0]=E=>i(o).value=E),d[1]||(d[1]=E=>y(i(o)))],color:"primary",variant:"outlined","control-variant":"stacked",inset:"","hide-details":"",precision:i(o).precision===void 0?null:i(o).precision,label:i(o).text,prefix:v(i(o).name),suffix:i(o).units?i(o).units:void 0,type:i(o).type,rules:($=i(o).rules)==null?void 0:$.map(E=>S[E]),multiple:(M=i(o))==null?void 0:M.multiple,items:L(i(o))},ce({_:2},[e.$slots.prepend?{name:"prepend",fn:t(()=>[se(e.$slots,"prepend")]),key:"0"}:void 0,e.$slots.append?{name:"append",fn:t(()=>[se(e.$slots,"append")]),key:"1"}:void 0]),1032,["modelValue","precision","label","prefix","suffix","type","rules","multiple","items"])}}}),qe=Number.MAX_SAFE_INTEGER;function We(U=200,c=200,p=0,a=qe){const I=T(U),k=T(c),o=T(!1),L=T(),S=T([0,0]);function y(e){e.preventDefault(),o.value=!0,S.value=[e.clientX-L.value.clientWidth,e.clientY-L.value.clientHeight],document.addEventListener("mousemove",g),document.addEventListener("mouseup",v)}function g(e){if(o.value){const d=e.clientX-S.value[0],$=e.clientY-S.value[1];I.value=d<p?p:d>a?a:d,k.value=$<p?p:$>a?a:$}}function v(){o.value=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",v)}return{panelWidth:I,panelHeight:k,panelDiv:L,startResize:y}}const je={key:0},Ge={class:"expansion"},Xe={key:0,class:"categorie-info"},Ye={key:0,class:"custom-hint"},Ke=["onDblclick"],Ze=["onUpdate:modelValue"],Je=J({__name:"ParamForm",setup(U){const{$gettext:c}=Q(),p=ae(),a=ee(),I=h(()=>a.model!==null),k=h(()=>p.filteredParameters),o=h(()=>p.selectedInfo);function L(){p.resetParameters()}const{panelHeight:S,panelDiv:y,startResize:g}=We(0,50,50);X(()=>{if(y.value){const u=window.innerHeight,s=y.value.scrollHeight,n=s/u;S.value=n>.25?.25*u:s}});const v=T([]);X(()=>{const n=k.value.map(m=>m.params.length).map((m=>_=>m+=_)(0)).filter(m=>m<=10);v.value=n.map((m,_)=>_)});function e(){v.value.length<k.value.length?v.value=k.value.map((u,s)=>s):v.value=[]}const d=T(!1),$=T(!1),M=T({}),E=(u,s,n)=>{if(u){const m=String(s)+String(n);M.value[m]=u}};function K(u,s){$.value=!0;const n=String(u)+String(s);Ee(()=>M.value[n].focus())}G(d,u=>{u||($.value=!1)});const A=T(!1),O=h(()=>p.variants);function V(u){return u.name.split("#")[1]}function f(u){return u.name.includes("#")}const w=h(()=>{var n;const u=(n=O.value)!=null&&n.choices?O.value.choices:[],s={};return k.value.map(m=>m.category),k.value.forEach(m=>{const _=m.params.map(x=>x.name),D=Object.groupBy(_,x=>x.split("#")[0]);Object.keys(D).forEach(x=>{const me=D[x].slice(1).map(Z=>Z.split("#")[1]);D[x]=u.filter(Z=>!me.includes(Z))}),s[m.category]=D}),s});function R(u,s){const n=u.category,m=s.name.split("#")[0];return w.value[n][m]}function ve(u,s){s.name=s.name.split("#")[0]+`#${u}`,s.text=s.text.split("#")[0]+`#${u}`}function pe(u,s){const n=Ie.cloneDeep(s),m=u.category,_=s.name,D=w.value[m][_][0];if(D){n.name=n.name+`#${D}`,n.text=n.text+`#${D}`;const x=u.params.indexOf(s);u.params.splice(x+1,0,n)}}function fe(u,s){u.params=u.params.filter(n=>n!==s)}return(u,s)=>(r(),F(te,{class:"card"},{default:t(()=>[l(de,{class:"subtitle"},{default:t(()=>[z(b(i(c)("Scenario Settings")),1)]),_:1}),N(P("div",{ref_key:"resizableDiv",ref:y,class:"info-div",style:he({height:i(S)+"px"})},b(o.value),5),[[q,o.value]]),N(P("div",{class:"drag-handle",onMousedown:s[0]||(s[0]=(...n)=>i(g)&&i(g)(...n))},null,544),[[q,o.value]]),k.value.length===0?(r(),C("p",je,b(i(c)("No parameters")),1)):B("",!0),P("div",Ge,[l(ye,{ref:"form","validate-on":"lazy"},{default:t(()=>[l(_e,{modelValue:v.value,"onUpdate:modelValue":s[2]||(s[2]=n=>v.value=n),multiple:""},{default:t(()=>[(r(!0),C(W,null,j(k.value,(n,m)=>(r(),F(be,{key:m},{default:t(()=>[l(Se,{class:"categorie"},{default:t(()=>[z(b(n.category),1)]),_:2},1024),l(xe,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:t(()=>[N(P("div",null,[n.info?(r(),C("div",Xe,b(n.info),1)):B("",!0),(r(!0),C(W,null,j(n.params,(_,D)=>(r(),C("li",{key:D,class:"param-list"},[l(Oe,{item:_},ce({_:2},[A.value&&O.value?{name:"prepend",fn:t(()=>[f(_)?(r(),F(ke,{key:0,items:R(n,_),size:"small","model-value":V(_),"onUpdate:modelValue":x=>ve(x,_)},null,8,["items","model-value","onUpdate:modelValue"])):(r(),F(H,{key:1,variant:"tonal",size:"small",disabled:R(n,_).length==0,icon:"fas fa-plus",onClick:x=>pe(n,_)},null,8,["disabled","onClick"]))]),key:"0"}:void 0,A.value&&f(_)?{name:"append",fn:t(()=>[l(H,{variant:"text",color:"error",size:"small",icon:"fas fa-trash",onClick:x=>fe(n,_)},null,8,["onClick"])]),key:"1"}:void 0]),1032,["item"]),l($e,null,{default:t(()=>[d.value?(r(),C("div",Ye,[$.value?N((r(),C("textarea",{key:1,ref_for:!0,ref:x=>E(x,m,D),"onUpdate:modelValue":x=>_.hint=x,rows:"1",class:"edition",onKeydown:s[1]||(s[1]=Ce(x=>$.value=!1,["enter"]))},null,40,Ze)),[[Le,_.hint]]):(r(),C("div",{key:0,onDblclick:x=>K(m,D)},b(_.hint),41,Ke))])):B("",!0)]),_:2},1024)]))),128))],512),[[q,v.value.includes(m)]])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),l(Ve,null,{default:t(()=>[N(l(H,{variant:"text",onClick:L},{default:t(()=>[z(b(i(c)("back to default")),1)]),_:1},512),[[q,I.value]]),l(we),O.value?(r(),F(H,{key:0,"prepend-icon":"fas fa-plus",variant:"text",active:A.value,onClick:s[3]||(s[3]=n=>A.value=!A.value)},{default:t(()=>[z(b(i(c)("Manage")),1)]),_:1},8,["active"])):B("",!0),l(H,{variant:"text",onClick:e},{default:t(()=>[z(b(v.value.length!=k.value.length?i(c)("Expand all"):i(c)("Collapse all")),1)]),_:1}),l(H,{icon:"far fa-question-circle",size:"small",active:d.value,onClick:s[4]||(s[4]=n=>d.value=!d.value)},null,8,["active"])]),_:1})]),_:1}))}}),Qe=Y(Je,[["__scopeId","data-v-92e1c016"]]),ea="/quetzal-network-editor-dev/assets/samsung-washing-machine-melody-made-with-Voicemod-technology-C_SPFWiL.mp3",aa={style:{"white-space":"pre-line"}},ta={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(U){const c=U,{disabled:p}=re(c),a=ae(),I=T(!1),k=h(()=>a.hasLogs),o=T([]);async function L(){await a.getLogs(),o.value=a.logs,o.value.sort((y,g)=>String(y.time).localeCompare(String(g.time),void 0,{sensitivity:"base"})),I.value=!0}async function S(){await a.downloadLogs()}return(y,g)=>(r(),C(W,null,[l(ze,{"close-delay":"100",transition:"slide-y-transition"},{activator:t(({props:v})=>[N(l(H,Te({disabled:i(p),class:"log-button",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},v),{default:t(()=>g[1]||(g[1]=[z(" logs ")])),_:2},1040,["disabled"]),[[q,k.value]])]),default:t(()=>[l(Re,null,{default:t(()=>[l(le,{onClick:L},{prepend:t(()=>[l(ne,{icon:"fas fa-eye"})]),default:t(()=>[z(b(y.$gettext("show"))+" ",1)]),_:1}),l(le,{onClick:S},{prepend:t(()=>[l(ne,{icon:"fas fa-download"})]),default:t(()=>[z(b(y.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),l(De,{modelValue:I.value,"onUpdate:modelValue":g[0]||(g[0]=v=>I.value=v),width:"90%"},{default:t(()=>[l(te,{style:{"overflow-y":"auto"}},{default:t(()=>[(r(!0),C(W,null,j(o.value,(v,e)=>(r(),C("div",{key:e,class:"log-container"},[P("h1",null,b(v.name),1),P("h3",null,[P("b",null,b(v.time),1)]),P("span",aa,b(v.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},sa=Y(ta,[["__scopeId","data-v-19036b20"]]),la={class:"title-container"},na={class:"buttons-row ma-2"},oa={key:1},ia=J({__name:"RunStepper",setup(U){const{$gettext:c}=Q(),p=Fe(),a=ae(),I=ee(),k=h(()=>a.steps),o=h(()=>a.modelTag),L=h(()=>{const V=a.availableModels;return a.avalaibleStepFunctions.filter(f=>V.has(f))}),S=h({get:()=>a.selectedStepFunction,set:V=>a.selectedStepFunction=V}),y=h(()=>a.variants),g=h(()=>a.running),v=h(()=>a.status),e=h(()=>a.currentStep),d=h(()=>a.error),$=h(()=>a.errorMessage),M=h(()=>I.protected),E=h(()=>I.model!==null);X(async()=>{E.value&&(await a.getModelTag(),await a.getSteps(),await a.checkRunningExecution())}),G(L,V=>{E.value&&(V.includes(S.value)||(S.value=V[0],a.getSteps()))},{once:!0}),G(S,async V=>{E.value&&(L.value.includes(V)?(S.value=V,a.getSteps()):(S.value=L.value[0],a.getSteps()))});async function K(){if(await a.checkRunningExecution()){p.changeNotification({text:c("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{a.initExecution(),await p.exportToS3("inputs"),await p.deleteOutputsOnS3(),await p.deleteLogsOnS3(),p.deleteOutputs(),a.start()}catch(f){a.stopExecution(),console.log(f),p.changeAlert(f)}}const A=T(!0);G(v,V=>{V==="FINISHED"&&O()});function O(){if(A.value){const V=new Audio(ea);V.play(),setTimeout(function(){V.pause(),V.currentTime=0},5e3)}}return(V,f)=>(r(),F(te,{class:"card"},{default:t(()=>[P("div",la,[l(de,{class:"subtitle"},{default:t(()=>[z(b(i(c)("Simulation")),1)]),_:1}),l(Pe,{class:"model-tag"},{default:t(()=>[z(b(o.value),1)]),_:1}),l(sa,{disabled:g.value||!E.value},null,8,["disabled"])]),L.value.length>1?(r(),F(Ae,{key:0,modelValue:S.value,"onUpdate:modelValue":f[0]||(f[0]=w=>S.value=w),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:t(()=>[(r(!0),C(W,null,j(L.value,w=>(r(),F(Ne,{key:w,value:w,disabled:g.value||!E.value},{default:t(()=>[z(b(w),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):B("",!0),l(He,{modelValue:e.value,"onUpdate:modelValue":f[5]||(f[5]=w=>e.value=w),class:"stepper"},{default:t(()=>[l(ue,{show:d.value,title:i(c)("Simulation ended with an execution error or have been aborted.         Please relauch simulation. If the problem persist, contact us."),messages:$.value},null,8,["show","title","messages"]),l(ue,{show:M.value,title:i(c)("This scenario is protected"),messages:i(c)(" You cannot run simulation.")},null,8,["show","title","messages"]),P("div",na,[l(H,{loading:g.value,disabled:g.value||M.value||!E.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:f[1]||(f[1]=w=>K())},{default:t(()=>[z(b(i(c)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),N(l(H,{color:"grey",variant:"text",onClick:f[2]||(f[2]=w=>i(a).stopExecution())},{default:t(()=>[z(b(i(c)("Abort")),1)]),_:1},512),[[q,g.value&&e.value!==1]]),l(Ue,{modelValue:A.value,"onUpdate:modelValue":f[3]||(f[3]=w=>A.value=w),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",label:i(c)("End signal"),color:"success","hide-details":""},{prepend:t(()=>f[6]||(f[6]=[])),_:1},8,["modelValue","label"])]),y.value?(r(),F(Me,{key:0,modelValue:y.value.variants,"onUpdate:modelValue":f[4]||(f[4]=w=>y.value.variants=w),class:"ma-2",label:y.value.label||"variants",chips:"",disabled:g.value,items:y.value.choices,multiple:y.value.multiple,"hide-details":!0},null,8,["modelValue","label","disabled","items","multiple"])):B("",!0),E.value?(r(),C("div",oa,[(r(!0),C(W,null,j(k.value,(w,R)=>(r(),C("div",{key:R+1},[d.value?(r(),F(oe,{key:1,complete:e.value>R+1,color:e.value>=R+1?"primary":void 0,title:w.name,value:R+1,rules:[()=>e.value!==R+1],step:R+1},null,8,["complete","color","title","value","rules","step"])):(r(),F(oe,{key:0,complete:e.value>R+1,color:e.value>=R+1?"primary":void 0,title:w.name,value:R+1,step:R+1},null,8,["complete","color","title","value","step"]))]))),128))])):B("",!0)]),_:1},8,["modelValue"])]),_:1}))}}),ua=Y(ia,[["__scopeId","data-v-6b64fd68"]]),ra={class:"section"},ca={__name:"Run",setup(U){return(c,p)=>(r(),C("section",ra,[l(Be,{class:"col"},{default:t(()=>[l(ie,{order:"1"},{default:t(()=>[l(Qe)]),_:1}),l(ie,{order:"2"},{default:t(()=>[l(ua)]),_:1})]),_:1})]))}},pa=Y(ca,[["__scopeId","data-v-7193c230"]]);export{pa as default};
