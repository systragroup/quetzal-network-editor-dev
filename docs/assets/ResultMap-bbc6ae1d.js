import{_ as J,M as Ke,a as Ze,b as Ee,c as Ae,d as Ge,u as Q,m as we,e as Je,r as S,o as u,f as y,w as n,g as i,h as Qe,i as C,j as H,k as v,l as f,n as g,t as h,V as re,p as me,v as pe,q as Ve,s as N,x as ue,y as de,F as V,z as L,A as b,B as Fe,C as Le,D as Z,E as B,G as E,H as Xe,I as Ye,J as $e,T as et,K as tt,L as ce,N as Me,O as Ne,P as He,Q as O,R as Pe,S as W,U as lt,W as at,X as j,Y as A,Z as G,$ as P,a0 as st,a1 as it,a2 as nt,a3 as ot,a4 as rt,a5 as ut,a6 as dt,a7 as w,a8 as ct,a9 as ne,aa as F,ab as oe,ac as _e,ad as De}from"./index-37a7d13b.js";const mt="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",pt=e=>e,ht={name:"ResultMap",components:{MglMap:Ke,MglNavigationControl:Ze,MglScaleControl:Ee,MglGeojsonLayer:Ae,MglImageLayer:Ge},props:["selectedFeature","layerType","extrusion","links","nanLinks","opacity","offset"],events:["selectClick"],setup(){return{store:Q()}},data(){return{mapIsLoaded:!1,mapboxPublicKey:null,selectedLinks:[],minZoom:{nodes:14,links:2}}},computed:{mapStyle(){return this.store.mapStyle},offsetValue(){return this.offset?-1:1}},watch:{mapStyle(e){this.map&&(this.map.getLayer("arrow")&&this.map.removeLayer("arrow"),this.map.getLayer("links")&&this.map.removeLayer("links"),this.map.getLayer("zones")&&this.map.removeLayer("zones"),this.map.getLayer("nodes")&&this.map.removeLayer("nodes"),this.mapIsLoaded=!1,this.saveMapPosition())}},created(){this.mapboxPublicKey=mt},beforeDestroy(){this.map.getLayer("arrow")&&this.map.removeLayer("arrow"),this.saveMapPosition()},methods:{saveMapPosition(){const e=this.map.getCenter();this.store.saveMapPosition({mapCenter:[e.lng,e.lat],mapZoom:this.map.getZoom()})},onMapLoaded(e){this.map&&(this.mapIsLoaded=!1);const l=new we.LngLatBounds;["Polygon"].includes(this.layerType)?this.links.features.forEach(o=>{try{o.geometry.type==="Polygon"?l.extend([o.geometry.coordinates[0][0],o.geometry.coordinates[0][o.geometry.coordinates.length-1]]):l.extend([o.geometry.coordinates[0][0][0],o.geometry.coordinates[0][0][o.geometry.coordinates.length-1]])}catch{}}):this.links.features.forEach(o=>{l.extend([o.geometry.coordinates[0],o.geometry.coordinates[o.geometry.coordinates.length-1]])}),Object.keys(l).length!==0&&e.map.fitBounds(l,{padding:100}),e.map.loadImage(Je,function(o,a){if(o){console.error("err image",o);return}e.map.addImage("arrow",a,{sdf:!0})}),this.map=e.map,this.extrusion?this.store.changeNotification({text:pt("Right click and drag to tilt the map"),autoClose:!0,color:"success"}):e.map.dragRotate.disable(),this.mapIsLoaded=!0},enterLink(e){var l;if(e.map.getCanvas().style.cursor="pointer",this.selectedLinks=e.mapboxEvent.features,(l=this.popup)!=null&&l.isOpen()&&this.popup.remove(),this.selectedFeature&&this.layerType!=="Polygon"){const o=this.selectedLinks[0].properties[this.selectedFeature];o&&(this.popup=new we.Popup({closeButton:!1}).setLngLat([e.mapboxEvent.lngLat.lng,e.mapboxEvent.lngLat.lat]).setHTML(`${this.selectedFeature}: <br> ${o}`).addTo(e.map))}},leaveLink(e){var l;this.selectedLinks=[],(l=this.popup)!=null&&l.isOpen()&&this.popup.remove(),e.map.getCanvas().style.cursor=""},selectClick(e){var l;this.selectedLinks=e.mapboxEvent.features,((l=this.selectedLinks)==null?void 0:l.length)>0&&this.$emit("selectClick",{feature:this.selectedLinks[0].properties,action:"featureClick"})},zoneClick(e){var l;this.selectedLinks=e.mapboxEvent.features,((l=this.selectedLinks)==null?void 0:l.length)>0&&this.$emit("selectClick",{feature:this.selectedLinks[0].properties,action:"zoneClick"})},zoneHover(e){e.map.getCanvas().style.cursor="pointer"},zoneLeave(e){e.map.getCanvas().style.cursor=""}}};function yt(e,l,o,a,t,r){const s=S("MglScaleControl"),m=S("MglNavigationControl"),k=S("MglGeojsonLayer"),M=S("MglImageLayer"),I=S("MglMap");return u(),y(I,{key:r.mapStyle,style:{width:"100%"},"access-token":t.mapboxPublicKey,"map-style":r.mapStyle,center:a.store.mapCenter,zoom:a.store.mapZoom,onLoad:r.onMapLoaded},{default:n(()=>[i(s,{position:"bottom-right"}),i(m,{position:"bottom-right"}),t.mapIsLoaded?Qe(e.$slots,"default",{key:0,map:e.map,mapIsLoaded:t.mapIsLoaded}):C("",!0),o.layerType=="LineString"?(u(),y(k,{key:1,"source-id":"links",source:{type:"geojson",data:o.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:t.minZoom.links,paint:{"line-color":["get","display_color"],"line-offset":["*",r.offsetValue*.5,["to-number",["get","display_width"]]],"line-opacity":o.opacity/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:r.enterLink,onMouseleave:r.leaveLink,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0),o.layerType=="Point"?(u(),y(k,{key:2,"source-id":"nodes",source:{type:"geojson",data:o.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:t.minZoom.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":o.opacity/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:r.enterLink,onMouseleave:r.leaveLink,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0),o.layerType=="LineString"?(u(),y(M,{key:3,"source-id":"links",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:t.minZoom.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[r.offsetValue*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":o.opacity/100}}},null,8,["layer"])):C("",!0),o.layerType==="Polygon"&&o.extrusion?(u(),y(k,{key:4,"source-id":"polygon",source:{type:"geojson",data:o.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":o.opacity/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:r.zoneHover,onMouseleave:r.zoneLeave,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0),o.layerType==="Polygon"&&!o.extrusion?(u(),y(k,{key:5,"source-id":"polygon",source:{type:"geojson",data:o.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":o.opacity/100}},onMouseenter:r.zoneHover,onMouseleave:r.zoneLeave,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0),o.layerType==="Polygon"&&!o.extrusion?(u(),y(k,{key:6,"source-id":"NaNPolygon",source:{type:"geojson",data:o.nanLinks,promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:r.zoneHover,onMouseleave:r.zoneLeave,onClick:r.zoneClick,onContextmenu:r.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):C("",!0)]),_:3},8,["access-token","map-style","center","zoom","onLoad"])}const gt=J(ht,[["render",yt]]);const ft={name:"SidePanel",components:{},props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],events:["update-selectedCategory","select-layer","update-selected-filter","select-preset","delete-preset"],setup(){const e=Q(),l=H(()=>e.showLeftPanel),o=H(()=>e.windowHeight);return{store:e,showLeftPanel:l,windowHeight:o}},data(){return{showLeftPanelContent:!0,openMenu:!1,presetsMenu:!1,selectedCat:[],vmodelSelectedFilter:""}},watch:{showLeftPanel(e){e?setTimeout(()=>{this.showLeftPanelContent=!0},500):this.showLeftPanelContent=!1},selectedCategory(e,l){e!==l&&(this.selectedCat=e)},selectedFilter(e){e!==this.vmodelSelectedFilter&&(this.vmodelSelectedFilter=e)},selectedCat(e){e!==this.selectedCategory&&this.$emit("update-selectedCategory",e)},vmodelSelectedFilter(e,l){e!==this.selectedFilter&&(this.$emit("update-selectedFilter",e),this.selectedCat=this.selectedCategory)}},created(){this.vmodelSelectedFilter=this.selectedFilter,this.selectedCat=this.selectedCategory,this.$emit("update-selectedFilter",this.selectedFilter),this.$emit("update-selectedCategory",this.selectedCategory)},methods:{init(e){this.selectedCat=e.selectedCategory},showAll(){this.selectedCat.length===this.filteredCat.length?this.selectedCat=[]:this.selectedCat=this.filteredCat}}},vt={class:"left-panel-content"},bt={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},kt={class:"preset"},Ct={class:"layer"},St={class:"item"};function xt(e,l,o,a,t,r){return u(),v("section",{class:tt(a.showLeftPanel?"left-panel elevation-4":"left-panel-close"),style:ce({width:a.showLeftPanel?"350px":"0px"})},[f("div",{class:"left-panel-toggle-btn elevation-4",onClick:l[0]||(l[0]=s=>a.store.changeLeftPanel())},[i(re,{size:"small",color:"secondarydark"},{default:n(()=>[g(h(a.showLeftPanel?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),i(et,{name:"fade"},{default:n(()=>[me(f("div",vt,[f("div",null,[f("div",bt,[f("div",kt,[i(Ve,{location:"bottom","open-delay":"500"},{activator:n(({props:s})=>[i(re,N({style:{color:"white","padding-right":"2rem"}},s),{default:n(()=>[g(" fas fa-sliders-h ")]),_:2},1040)]),default:n(()=>[f("span",null,h(e.$gettext("Presets")),1)]),_:1}),i(ue,{modelValue:t.presetsMenu,"onUpdate:modelValue":l[1]||(l[1]=s=>t.presetsMenu=s),"close-delay":"100",transition:"slide-y-transition"},{activator:n(({props:s})=>[f("span",N({class:"custom-title crop"},s),h(o.selectedPreset||e.$gettext("Presets")),17)]),default:n(()=>[i(de,null,{default:n(()=>[(u(!0),v(V,null,L(o.presetChoices,(s,m)=>(u(),y(Z,{key:m,link:"",onClick:()=>e.$emit("select-preset",s)},{append:n(()=>[i(b,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:Fe(()=>e.$emit("delete-preset",s),["stop"])},null,8,["onClick"])]),default:n(()=>[i(Le,null,{default:n(()=>[g(h(s.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),i(b,{variant:"text",style:{color:"white"},icon:t.presetsMenu?"fas fa-chevron-left":"fas fa-chevron-down",onClick:l[2]||(l[2]=s=>t.presetsMenu=!t.presetsMenu)},null,8,["icon"])]),f("div",Ct,[i(Ve,{location:"bottom","open-delay":"500"},{activator:n(({props:s})=>[i(b,N({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:t.selectedCat.length>0?"fa-eye fa":"fa-eye-slash fa",variant:"text"},s,{onClick:l[3]||(l[3]=m=>r.showAll())}),null,16,["icon"])]),default:n(()=>[f("span",null,h(t.selectedCat.length>0?e.$gettext("Hide All"):e.$gettext("Show All")),1)]),_:1}),i(ue,{modelValue:t.openMenu,"onUpdate:modelValue":l[4]||(l[4]=s=>t.openMenu=s),"close-delay":"100",transition:"slide-y-transition"},{activator:n(({props:s})=>[f("span",N({class:"custom-title crop"},s),h(o.selectedLayer),17)]),default:n(()=>[i(de,null,{default:n(()=>[(u(!0),v(V,null,L(o.layerChoices,(s,m)=>(u(),y(Z,{key:m,link:"",onClick:()=>e.$emit("select-layer",s)},{default:n(()=>[i(Le,null,{default:n(()=>[g(h(s),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),i(b,{style:{color:"white"},variant:"text",icon:t.openMenu?"fas fa-chevron-left":"fas fa-chevron-down",onClick:l[5]||(l[5]=s=>t.openMenu=!t.openMenu)},null,8,["icon"])]),i(B,{"max-width":"100%","min-width":"100%",height:a.windowHeight-180,class:"mx-auto"},{default:n(()=>[i(Z,null,{default:n(()=>[i(E,{modelValue:t.vmodelSelectedFilter,"onUpdate:modelValue":l[6]||(l[6]=s=>t.vmodelSelectedFilter=s),items:o.filterChoices,"prepend-icon":"fas fa-filter",label:e.$gettext("filter"),"item-props.color":"secondarydark",color:"secondarydark"},null,8,["modelValue","items","label"])]),_:1}),i(Xe,{items:o.filteredCat,"item-height":45,height:a.windowHeight-80},{default:n(({item:s})=>[(u(),v("div",{key:t.vmodelSelectedFilter.concat(s),class:"container"},[i(Ye,null,{default:n(()=>[i($e,{modelValue:t.selectedCat,"onUpdate:modelValue":l[7]||(l[7]=m=>t.selectedCat=m),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:s},null,8,["modelValue","value"])]),_:2},1024),f("div",St,h(s),1)]))]),_:1},8,["items","height"])]),_:1},8,["height"])])])],512),[[pe,t.showLeftPanelContent]])]),_:1})],6)}const wt=J(ft,[["render",xt],["__scopeId","data-v-39eebd91"]]);const c=e=>e,Vt={name:"ResultsSettings",props:["displaySettings","featureChoices","type"],events:["submit","save-preset"],setup(){const e=Q();return{windowHeight:H(()=>e.windowHeight-100)}},data(){return{showDialog:!1,parameters:[{name:c("selectedFeature"),type:"String",value:this.displaySettings.selectedFeature,units:"",hint:c("selectedFeature")},{name:c("minWidth"),type:"Number",value:this.displaySettings.minWidth,units:"a.u.",hint:c("minWidth")},{name:c("maxWidth"),type:"Number",value:this.displaySettings.maxWidth,units:"a.u.",hint:c("maxWidth")},{name:c("numStep"),type:"Number",value:this.displaySettings.numStep,units:"int",hint:c("numStep")},{name:c("opacity"),type:"Number",value:this.displaySettings.opacity,units:"number",hint:c("opacity")},{name:c("scale"),type:"String",value:this.displaySettings.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:c("scale")},{name:c("color map"),type:"String",choices:Object.keys(Me.brewer).slice(0,36),value:this.displaySettings.cmap,units:"",hint:c("cmap to use")},{name:c("show NaN"),value:this.displaySettings.showNaN,hint:c("Hide NaN on map and color map")},{name:c("reverse color"),value:this.displaySettings.reverseColor,hint:c("reverse color scale")},{name:c("scale min"),type:"Number",value:this.displaySettings.minVal,units:"a.u.",hint:c("mininum value on the color Map")},{name:c("scale max"),type:"Number",value:this.displaySettings.maxVal,units:"a.u.",hint:c("maximum value on the color Map")},{name:c("custom scale"),value:this.displaySettings.fixScale,hint:c("customize to inputs values")},{name:c("Left side driving"),value:this.displaySettings.offset,hint:c("Select which side of the road the links are display")},{name:c("3D"),value:this.displaySettings.extrusion,hint:c("display zones as 3D extrusion")},{name:c("padding"),type:"Number",value:this.displaySettings.padding,units:"number",hint:c("range of colors")}],showHint:!1,showFixScale:!1,shake:!1,rules:{required:e=>!!e||c("Required"),largerThanZero:e=>e>0||c("should be larger than 0"),nonNegative:e=>e>=0||c("should be larger or equal to 0")}}},watch:{showDialog(e){this.refresh(),this.showFixScale=this.parameters[11].value},featureChoices(){this.refresh()}},methods:{toggleFixScale(){this.parameters[11].value?(this.showFixScale=!0,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal):this.showFixScale=!1},getColor(e){const l=[],o=this.parameters[8].value;let a=this.parameters[14].value;a=[a[0]/100,1-a[1]/100],a=o?a.reverse():a;const t=Me.scale(e).padding(a).domain([0,100]).classes(25);for(let r=0;r<100;r++)l.push(t(r).hex());return o?l.reverse():l},refresh(){this.parameters[0].value=this.displaySettings.selectedFeature,this.parameters[1].value=this.displaySettings.minWidth,this.parameters[2].value=this.displaySettings.maxWidth,this.parameters[3].value=this.displaySettings.numStep,this.parameters[4].value=this.displaySettings.opacity,this.parameters[5].value=this.displaySettings.scale,this.parameters[6].value=this.displaySettings.cmap,this.parameters[7].value=this.displaySettings.showNaN,this.parameters[8].value=this.displaySettings.reverseColor,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal,this.parameters[11].value=this.displaySettings.fixScale,this.parameters[12].value=this.displaySettings.offset,this.parameters[13].value=this.displaySettings.extrusion,this.parameters[14].value=this.displaySettings.padding},submit(e){if(this.$refs.form.validate()){const l={selectedFeature:this.parameters[0].value,minWidth:Number(this.parameters[1].value),maxWidth:Number(this.parameters[2].value),numStep:Number(this.parameters[3].value),opacity:Number(this.parameters[4].value),scale:this.parameters[5].value,cmap:this.parameters[6].value,showNaN:this.parameters[7].value,reverseColor:this.parameters[8].value,minVal:Number(this.parameters[9].value),maxVal:Number(this.parameters[10].value),fixScale:this.parameters[11].value,offset:this.parameters[12].value,extrusion:this.parameters[13].value,padding:this.parameters[14].value};e==="apply"?this.$emit("submit",l):e==="save"&&this.$emit("save-preset",l)}else this.shake=!0,setTimeout(()=>{this.shake=!1},500)},cancel(){this.showDialog=!1}}},Lt={class:"setting"},Mt={class:"gradient"},Pt={class:"domain-title-small"},_t={class:"domain-title"};function Dt(e,l,o,a,t,r){return u(),y(ue,{modelValue:t.showDialog,"onUpdate:modelValue":l[16]||(l[16]=s=>t.showDialog=s),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:n(({props:s})=>[f("div",Lt,[i(b,N({color:o.displaySettings.selectedFeature===null?"error":"regular"},s,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:n(()=>[i(B,{width:"20rem",class:"setting-card","max-height":a.windowHeight,onKeydown:[l[15]||(l[15]=P(s=>r.submit("apply"),["enter"])),P(r.cancel,["esc"])]},{default:n(()=>[i(Z,{class:"subtitle"},{append:n(()=>[i(b,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:l[0]||(l[0]=s=>t.showHint=!t.showHint)})]),default:n(()=>[g(h(e.$gettext("Settings"))+" ",1)]),_:1}),i(Ne,{ref:"form","lazy-validation":""},{default:n(()=>[i(He,null,{default:n(()=>[i(O,null,{default:n(()=>[i(E,{modelValue:t.parameters[0].value,"onUpdate:modelValue":l[1]||(l[1]=s=>t.parameters[0].value=s),variant:"underlined",items:o.featureChoices,label:e.$gettext(t.parameters[0].name),hint:t.showHint?e.$gettext(t.parameters[0].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),i(Pe,null,{default:n(()=>[(u(!0),v(V,null,L(t.parameters.slice(1,3),s=>(u(),y(O,{key:s.name},{default:n(()=>[i(W,{modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,variant:"underlined",density:"compact",type:s.type,label:e.$gettext(s.name),suffix:s.units,hint:t.showHint?e.$gettext(s.hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),i(Pe,null,{default:n(()=>[i(O,null,{default:n(()=>[i(W,{modelValue:t.parameters[3].value,"onUpdate:modelValue":l[2]||(l[2]=s=>t.parameters[3].value=s),variant:"underlined",density:"compact",type:t.parameters[3].type,label:e.$gettext(t.parameters[3].name),suffix:t.parameters[3].units,hint:t.showHint?e.$gettext(t.parameters[3].hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),i(O,null,{default:n(()=>[i(E,{modelValue:t.parameters[5].value,"onUpdate:modelValue":l[3]||(l[3]=s=>t.parameters[5].value=s),density:"compact",variant:"underlined",items:t.parameters[5].choices,label:e.$gettext(t.parameters[5].name),hint:t.showHint?e.$gettext(t.parameters[5].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),i(E,{modelValue:t.parameters[6].value,"onUpdate:modelValue":l[4]||(l[4]=s=>t.parameters[6].value=s),density:"compact",items:t.parameters[6].choices,label:e.$gettext(t.parameters[6].name),hint:t.showHint?e.$gettext(t.parameters[6].hint):"","persistent-hint":t.showHint,required:"",variant:"solo"},{selection:n(({item:s})=>[f("div",Mt,[(u(!0),v(V,null,L(r.getColor(s.value),(m,k)=>(u(),v("span",{key:k,class:"grad-step-small",style:ce({backgroundColor:m})},null,4))),128)),f("span",Pt,h(s.value),1)])]),item:n(({props:s,item:m})=>[f("div",N({class:"gradient"},s),[(u(!0),v(V,null,L(r.getColor(m.value),(k,M)=>(u(),v("span",{key:M,class:"grad-step",style:ce({backgroundColor:k})},null,4))),128)),f("span",_t,h(m.value),1)],16)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),i(lt,{modelValue:t.parameters[14].value,"onUpdate:modelValue":l[5]||(l[5]=s=>t.parameters[14].value=s),step:"5",density:"compact",color:"primary",label:e.$gettext(t.parameters[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),i(at,{modelValue:t.parameters[4].value,"onUpdate:modelValue":l[6]||(l[6]=s=>t.parameters[4].value=s),class:"align-center",color:"primary",label:e.$gettext(t.parameters[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":n(({modelValue:s})=>[g(h(Math.floor(s)+"%"),1)]),_:1},8,["modelValue","label"]),(u(),y(j,{key:t.parameters[12].name,modelValue:t.parameters[12].value,"onUpdate:modelValue":l[7]||(l[7]=s=>t.parameters[12].value=s),density:"compact",color:"primary",label:e.$gettext(t.parameters[12].name),hint:t.showHint?e.$gettext(t.parameters[12].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(u(),y(j,{key:t.parameters[7].name,modelValue:t.parameters[7].value,"onUpdate:modelValue":l[8]||(l[8]=s=>t.parameters[7].value=s),density:"compact",color:"primary",label:e.$gettext(t.parameters[7].name),hint:t.showHint?e.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(u(),y(j,{key:t.parameters[8].name,modelValue:t.parameters[8].value,"onUpdate:modelValue":l[9]||(l[9]=s=>t.parameters[8].value=s),density:"compact",color:"primary",label:e.$gettext(t.parameters[8].name),hint:t.showHint?e.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(o.type)?(u(),y(j,{key:t.parameters[13].name,modelValue:t.parameters[13].value,"onUpdate:modelValue":l[10]||(l[10]=s=>t.parameters[13].value=s),density:"compact",color:"primary",label:e.$gettext(t.parameters[13].name),disabled:!["Polygon","extrusion"].includes(o.type),hint:t.showHint?e.$gettext(t.parameters[13].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","disabled","hint","persistent-hint"])):C("",!0),(u(),y(j,{key:t.parameters[11].name,modelValue:t.parameters[11].value,"onUpdate:modelValue":[l[11]||(l[11]=s=>t.parameters[11].value=s),l[12]||(l[12]=s=>r.toggleFixScale(t.parameters[11].name))],density:"compact",variant:"underlined",color:"primary",label:e.$gettext(t.parameters[11].name),hint:t.showHint?e.$gettext(t.parameters[11].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(u(!0),v(V,null,L(t.parameters.slice(9,11),s=>me((u(),y(W,{key:s.name,modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,variant:"underlined",type:s.type,label:e.$gettext(s.name),suffix:s.units,hint:t.showHint?e.$gettext(s.hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])),[[pe,t.showFixScale]])),128))]),_:1})]),_:1})]),_:1},512),i(A,null,{default:n(()=>[i(b,{color:"grey",variant:"text",onClick:r.cancel},{default:n(()=>[g(h(e.$gettext("Cancel")),1)]),_:1},8,["onClick"]),i(b,{color:"green-darken-1",variant:"text",onClick:l[13]||(l[13]=s=>r.submit("apply"))},{default:n(()=>[g(h(e.$gettext("Apply")),1)]),_:1}),i(G),i(b,{color:"grey",variant:"text",onClick:l[14]||(l[14]=s=>r.submit("save"))},{default:n(()=>[i(re,{size:"small",start:""},{default:n(()=>[g(" fas fa-sliders-h ")]),_:1}),g(" "+h(e.$gettext("save")),1)]),_:1})]),_:1})]),_:1},8,["max-height","onKeydown"])]),_:1},8,["modelValue"])}const Ft=J(Vt,[["render",Dt],["__scopeId","data-v-05de23bf"]]);const q=e=>e,Nt={name:"ResultMap",components:{MapResults:gt,ResultsSidePanel:wt,ResultsSettings:Ft,MapLegend:st,LayerSelector:it,StaticLayer:nt},setup(){const e=ot(),l=rt(),o=ut(),a=Q(),{visibleLayer:t,NaNLayer:r,type:s,loadLayer:m,displaySettings:k,hasOD:M,ODfeatures:I,matSelectedIndex:X,changeOD:p,isIndexAvailable:x,selectedCategory:Y,selectedFilter:he,attributes:ye,applySettings:ge,changeSelectedFilter:fe,filteredCategory:$,updateSelectedFeature:ve,changeSelectedCategory:be,colorScale:Ie}=dt();function ze(d){fe(d),ve()}function Ue(d){be(d),ve()}const z=w("links");function ee(d){var se;switch(z.value=d,d){case"links":m(e.links,null,null,"headway");break;case"rlinks":m(l.rlinks,null,null,"speed");break;case"nodes":m(e.nodes,null,null,"boardings");break;case"rnodes":m(l.rnodes,null,null,"boardings");break;case"od":m(o.layer,null,null,"name");break;default:const D=a.otherFiles.filter(T=>T.name===d),xe=D.filter(T=>T.extension==="geojson")[0].content,ie=(se=D.filter(T=>T.extension==="json")[0])==null?void 0:se.content;m(xe,ie,null,"");break}}const _=w(null),K=H(()=>a.availableLayers);ct(()=>{K.value.lenght>0&&(z.value=K.value[0]),ee(z.value)});const ke=H(()=>a.visibleRasters),Re=H(()=>a.styles),U=w(""),te=w(!1),le=w(!1),R=w(""),ae=w({});function Te(d){_.value=d.name,K.value.includes(d.layer)?(ee(d.layer),ye.value.includes(d==null?void 0:d.selectedFilter)?(fe(d.selectedFilter),Object.keys(d).includes("selectedCategory")&&be(d.selectedCategory)):Object.keys(d).includes("selectedFilter")&&a.changeNotification({text:d.selectedFilter+" "+q("filter does not exist. use default one"),autoClose:!0,color:"error"})):a.changeNotification({text:q("Preset Layer does not exist"),autoClose:!0,color:"error"}),ge(d.displaySettings),Object.keys(d).includes("selectedIndex")&&x(d.selectedIndex)&&(p(d.selectedIndex),a.changeNotification({}))}function je(d){U.value=d.name,te.value=!0}function qe(d){ae.value=d,R.value=_.value,le.value=!0}async function Oe(d){if((await d).valid){le.value=!1;const D={name:F.cloneDeep(R.value),layer:F.cloneDeep(z.value),displaySettings:F.cloneDeep(ae.value),selectedFilter:F.cloneDeep(he.value)};Y.value.filter(ie=>$.value.includes(ie)).length<$.value.length&&(D.selectedCategory=F.cloneDeep(Y)),I.value.includes(ae.value.selectedFeature)&&M.value&&(D.selectedIndex=X.value),a.addStyle(D),ke.value.includes(R.value)?a.changeNotification({text:q("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):a.changeNotification({text:q("Preset Saved"),autoClose:!0,color:"success"}),_.value=F.cloneDeep(R.value)}}function Be(){a.deleteStyle(U.value),te.value=!1,U.value===_.value&&(_.value=null),a.changeNotification({text:q("Preset deleted"),autoClose:!0,color:"success"}),U.value=""}const Ce=w(!1),Se=w([]);function We(d){d.action==="featureClick"?(Se.value=d.feature,Ce.value=!0):p(d.feature.index)}return{store:a,selectedLayer:z,selectedPreset:_,availableLayers:K,visibleLayer:t,NaNLayer:r,type:s,displaySettings:k,selectedCategory:Y,selectedFilter:he,attributes:ye,filteredCategory:$,applySettings:ge,colorScale:Ie,updateSelectedFilter:ze,updateSelectedCategory:Ue,changeLayer:ee,changePreset:Te,showDeleteDialog:te,presetToDelete:U,clickDeletePreset:je,deletePreset:Be,showPresetDialog:le,inputName:R,clickSavePreset:qe,createPreset:Oe,featureClicked:We,availableStyles:Re,visibleRasters:ke,showDialog:Ce,formData:Se}}},Ht={class:"map-view"},It={class:"left-panel"};function zt(e,l,o,a,t,r){const s=S("ResultsSidePanel"),m=S("ResultsSettings"),k=S("LayerSelector"),M=S("MapLegend"),I=S("StaticLayer"),X=S("MapResults");return u(),v("section",Ht,[i(s,{ref:"sidePanel","selected-category":a.selectedCategory,"selected-filter":a.selectedFilter,"layer-choices":a.availableLayers,"selected-layer":a.selectedLayer,"filter-choices":a.attributes,"filtered-cat":a.filteredCategory,"preset-choices":a.availableStyles,"selected-preset":a.selectedPreset,onUpdateSelectedCategory:a.updateSelectedCategory,onUpdateSelectedFilter:a.updateSelectedFilter,onSelectLayer:a.changeLayer,onSelectPreset:a.changePreset,onDeletePreset:a.clickDeletePreset},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset","onUpdateSelectedCategory","onUpdateSelectedFilter","onSelectLayer","onSelectPreset","onDeletePreset"]),i(m,{"display-settings":a.displaySettings,"feature-choices":a.attributes,type:a.type,onSubmit:a.applySettings,onSavePreset:a.clickSavePreset},null,8,["display-settings","feature-choices","type","onSubmit","onSavePreset"]),a.availableStyles.length>0?(u(),y(k,{key:0,choices:a.availableStyles,"available-layers":a.availableLayers},null,8,["choices","available-layers"])):C("",!0),f("div",It,[me(i(M,{key:"result",order:0,"color-scale":a.colorScale,"display-settings":a.displaySettings},null,8,["color-scale","display-settings"]),[[pe,a.visibleLayer.features.length>0]])]),a.visibleLayer.features?(u(),y(X,{key:a.type+String(a.displaySettings.extrusion),"layer-type":a.type,extrusion:a.displaySettings.extrusion,links:a.visibleLayer,"nan-links":a.NaNLayer,"selected-feature":a.displaySettings.selectedFeature,opacity:a.displaySettings.opacity,offset:a.displaySettings.offset,onSelectClick:a.featureClicked},{default:n(({map:p})=>[(u(!0),v(V,null,L(a.availableStyles,x=>(u(),v("div",{key:x.name},[a.visibleRasters.includes(x.name)&&a.availableLayers.includes(x.layer)?(u(),y(I,{key:0,preset:x,map:p,order:a.visibleRasters.indexOf(x.name)+1},null,8,["preset","map","order"])):C("",!0)]))),128))]),_:1},8,["layer-type","extrusion","links","nan-links","selected-feature","opacity","offset","onSelectClick"])):C("",!0),i(ne,{modelValue:a.showDialog,"onUpdate:modelValue":l[1]||(l[1]=p=>a.showDialog=p),scrollable:"",persistent:"","max-width":"300",onKeydown:[l[2]||(l[2]=P(p=>a.showDialog=!1,["enter"])),l[3]||(l[3]=P(p=>a.showDialog=!1,["esc"]))]},{default:n(()=>[i(B,{"max-height":"60rem"},{default:n(()=>[i(oe,{class:"text-h5"},{default:n(()=>[g(h(e.$gettext("link Properties")),1)]),_:1}),i(_e),i(De,null,{default:n(()=>[i(de,null,{default:n(()=>[(u(!0),v(V,null,L(a.formData,(p,x)=>(u(),y(W,{key:x,"model-value":p,label:x,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),i(_e),i(A,null,{default:n(()=>[i(G),i(b,{color:"success",variant:"text",onClick:l[0]||(l[0]=p=>a.showDialog=!1)},{default:n(()=>[g(h(e.$gettext("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(ne,{modelValue:a.showPresetDialog,"onUpdate:modelValue":l[6]||(l[6]=p=>a.showPresetDialog=p),persistent:"","max-width":"400",onKeydown:l[7]||(l[7]=P(p=>a.showPresetDialog=!1,["esc"]))},{default:n(()=>[i(B,null,{default:n(()=>[i(oe,{class:"text-h5"},{default:n(()=>[g(h(e.$gettext("Create or modify preset")),1)]),_:1}),i(Ne,{"validate-on":"submit lazy",onSubmit:Fe(a.createPreset,["prevent"])},{default:n(()=>[i(De,null,{default:n(()=>[i(He,null,{default:n(()=>[i(O,{cols:"12"},{default:n(()=>[i(W,{modelValue:a.inputName,"onUpdate:modelValue":l[4]||(l[4]=p=>a.inputName=p),autofocus:"",rules:[p=>!!p||"Required."],label:e.$gettext("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),i(A,null,{default:n(()=>[i(G),i(b,{color:"grey",variant:"text",onClick:l[5]||(l[5]=p=>a.showPresetDialog=!1)},{default:n(()=>[g(h(e.$gettext("Cancel")),1)]),_:1}),i(b,{color:"green-darken-1",variant:"text",type:"submit"},{default:n(()=>[g(h(e.$gettext("ok")),1)]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),i(ne,{modelValue:a.showDeleteDialog,"onUpdate:modelValue":l[9]||(l[9]=p=>a.showDeleteDialog=p),persistent:"","max-width":"400",onKeydown:[l[10]||(l[10]=P(p=>a.showDeleteDialog=!1,["esc"])),P(a.deletePreset,["enter"])]},{default:n(()=>[i(B,null,{default:n(()=>[i(oe,{class:"text-h5"},{default:n(()=>[g(h(e.$gettext("Delete")+" "+a.presetToDelete+" ?"),1)]),_:1}),i(A,null,{default:n(()=>[i(G),i(b,{color:"grey",variant:"text",onClick:l[8]||(l[8]=p=>a.showDeleteDialog=!1)},{default:n(()=>[g(h(e.$gettext("Cancel")),1)]),_:1}),i(b,{color:"error",variant:"text",onClick:a.deletePreset},{default:n(()=>[g(h(e.$gettext("delete")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const Rt=J(Nt,[["render",zt],["__scopeId","data-v-c2f407a1"]]);export{Rt as default};
