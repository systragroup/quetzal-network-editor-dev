import{_ as Z,h as T,g as S,i as o,j as s,bP as q,a2 as X,O as ee,F as te,al as ae,u as se,b1 as ne,aa as le,a as oe,r as b,c as p,o as re,f as I,A as l,ae as O,B as f,C as n,m as r,ax as L,a8 as z,L as k,H as ie,I as ue,bQ as de,V as ce,Q as E,a9 as me,Z as N,ah as pe,aJ as R,bR as fe,am as _e}from"./index-JvMGzoLv.js";import{W as ge}from"./Warning-DBCy96uK.js";import{T as ve}from"./TimeSeriesSelector-DUnyUyrL.js";import"./form-B2uRhppC.js";const he={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(u){this.$emit("update:date",this.parseOutput(u))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(u){if(u)return new Date(u.substring(0,4)+"-"+u.substring(4,6)+"-"+u.substring(6,8))},parseOutput(u){return u.toISOString().substring(0,10).replaceAll("-","")}}};function Se(u,a,d,y,i,m){return S(),T(te,{modelValue:i.menu,"onUpdate:modelValue":a[1]||(a[1]=v=>i.menu=v),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:o(({props:v})=>[s(X,ee({"model-value":m.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},v),null,16,["model-value"])]),default:o(()=>[s(q,{modelValue:i.isoDate,"onUpdate:modelValue":a[0]||(a[0]=v=>i.isoDate=v),max:i.dateMax,min:i.dateMin},null,8,["modelValue","max","min"])]),_:1},8,["modelValue"])}const Ve=Z(he,[["render",Se],["__scopeId","data-v-1eb87a33"]]),De={class:"background"},xe={class:"list"},be={class:"list-row bold"},ke={class:"list-item-large"},ye={class:"list-item-medium"},we={class:"list-item-medium"},Ie={class:"list-item-medium"},Te={class:"list-item-small"},Fe={class:"list-item-small"},Ce={class:"list-item-large"},Ge={class:"list-item-medium"},Me={class:"list-item-medium"},Ue={class:"list-item-medium"},Pe={class:"list-item-small"},Ae={class:"bottom-button"},Be=ae({__name:"GTFSZipImporter",setup(u){const{$gettext:a}=se(),d=ne(),y=le(),i=oe(),m=b(!1),v=p(()=>d.stateMachineArn),W=p(()=>y.linksIsEmpty),h=p(()=>d.uploadedGTFS),x=p(()=>d.running),$=p(()=>d.callID),K=p(()=>d.error),Q=p(()=>d.errorMessage),F=p(()=>h.value.filter(c=>c.progress<100).length>0),C=p(()=>d.parameters),w=b(C.value.timeseries);function G(){const c=h.value.map(e=>e.name),t=h.value.map(e=>e.date);d.saveParams({files:c,timeseries:R(w.value),dates:t})}re(()=>{G()});const M=b();function j(){M.value.click();const c=document.getElementById("zip-input");c&&(c.value="")}async function H(c){try{i.changeLoading(!0);const e=c.target.files;if(!(e!=null&&e.length)){i.changeLoading(!1);return}for(const _ of Array.from(e)){const g=await fe(_),B=g.reduce((V,D)=>D.start_date<V?D.start_date:V,g[0].start_date),J=g.reduce((V,D)=>D.end_date>V?D.end_date:V,g[0].end_date),Y={content:_,info:{name:_.name,minDate:B,maxDate:J,date:B,progress:0}};await d.addGTFS(Y)}i.changeLoading(!1)}catch(t){i.changeLoading(!1),i.changeAlert(t)}}const U=b();async function P(){var t;if(await U.value.validate())if(W.value){G();const e=R(C.value),_=_e(),g={scenario_path_S3:$.value,launcher_arg:{training_folder:"/tmp",params:e},metadata:{user_email:(t=_.cognitoInfo)==null?void 0:t.email}};d.startExecution(v.value,g)}else m.value=!0}function A(){y.$reset(),m.value=!1,P()}return(c,t)=>(S(),I("div",De,[l("input",{id:"zip-input",ref_key:"zipInput",ref:M,type:"file",style:{display:"none"},accept:".zip",multiple:"",onChange:H},null,544),s(E,{class:"card"},{default:o(()=>[s(O,{class:"subtitle"},{default:o(()=>[f(n(r(a)("GTFS importer")),1)]),_:1}),s(L,null,{default:o(()=>[f(n(r(a)("import GTFS from local computer")),1)]),_:1}),s(L,null,{default:o(()=>[f(n(r(a)("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),s(z,null,{default:o(()=>[s(k,{variant:"elevated",disabled:x.value,"prepend-icon":"fa-solid fa-file-archive",onClick:j},{default:o(()=>[f(n(r(a)("upload GTFS")),1)]),_:1},8,["disabled"])]),_:1}),s(ge,{show:K.value,messages:Q.value},null,8,["show","messages"]),s(ve,{ref_key:"formRef",ref:U,modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e)},null,8,["modelValue"]),l("div",xe,[l("li",be,[t[4]||(t[4]=l("span",{class:"list-item-small"},null,-1)),l("span",ke,n(r(a)("name")),1),l("span",ye,n(r(a)("from")),1),l("span",we,n(r(a)("to")),1),l("span",Ie,n(r(a)("selected date")),1),l("span",Te,n(r(a)("Uploaded")),1)]),(S(!0),I(ie,null,ue(h.value,(e,_)=>(S(),I("ul",{key:_,class:"list-row"},[l("span",Fe,n(_),1),l("span",Ce,n(e.name),1),l("span",Ge,n(e.minDate),1),l("span",Me,n(e.maxDate),1),l("span",Ue,[s(Ve,{date:e.date,from:e.minDate,to:e.maxDate,"onUpdate:date":g=>e.date=g},null,8,["date","from","to","onUpdate:date"])]),l("span",Pe,[e.progress<100?(S(),T(de,{key:0,indeterminate:e.progress===0,absolute:"",color:"primary","model-value":e.progress},null,8,["indeterminate","model-value"])):(S(),T(ce,{key:1},{default:o(()=>t[5]||(t[5]=[f("fas fa-check")])),_:1}))])]))),128))]),l("div",Ae,[s(k,{loading:x.value,disabled:x.value||h.value.length==0||F.value,color:x.value||h.value.length==0||F.value?"regular":"success","prepend-icon":"fa-solid fa-play",onClick:P},{default:o(()=>[f(n(r(a)("convert")),1)]),_:1},8,["loading","disabled","color"])])]),_:1}),s(pe,{modelValue:m.value,"onUpdate:modelValue":t[2]||(t[2]=e=>m.value=e),persistent:"","max-width":"500",onKeydown:[N(A,["enter"]),t[3]||(t[3]=N(e=>m.value=!1,["esc"]))]},{default:o(()=>[s(E,null,{default:o(()=>[s(O,{class:"text-h5"},{default:o(()=>[f(n(r(a)("Overwrite current PT network ?")),1)]),_:1}),s(z,null,{default:o(()=>[s(me),s(k,{color:"regular",onClick:t[1]||(t[1]=e=>m.value=!m.value)},{default:o(()=>[f(n(r(a)("No")),1)]),_:1}),s(k,{color:"primary",onClick:A},{default:o(()=>[f(n(r(a)("Yes")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Ne=Z(Be,[["__scopeId","data-v-3da8fdb7"]]);export{Ne as default};
