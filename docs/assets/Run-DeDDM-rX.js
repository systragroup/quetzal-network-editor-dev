import{_ as z,ae as ee,af as D,ag as R,e as p,r as T,p as H,g as s,h as m,i as t,j as l,ab as J,x as v,y as d,ah as h,ad as te,l as U,v as w,U as ae,ai as le,q as _,F as $,E,aj as ne,ak as se,al as oe,a1 as X,Z as ue,N as O,a2 as re,G as P,a3 as ie,V as q,L as N,z as K,C as de,A as Q,D as ce,J as j,B as pe,a9 as ve,u as fe,w as G,Y as ge,X as Y,am as me,an as ye,ao as Ve,ap as B,aq as Z}from"./index-DM4g4XUP.js";const he={class:"expansion"},_e={__name:"ParamForm",setup(M){const{$gettext:o}=ee(),n=D(),b=R(),x=p(()=>n.selectedStepFunction),C=p(()=>n.parameters),y=p(()=>C.value.filter(i=>Object.keys(i).includes("category")&&i.model===x.value)),k=p(()=>{var i;return(i=C.value.filter(a=>((a==null?void 0:a.info)&&(a==null?void 0:a.model))===x.value)[0])==null?void 0:i.info}),g=T([]);H(()=>{g.value=[...Array(y.value.length).keys()].map((i,a)=>a)});const f=p(()=>b.scenariosList),L=p(()=>b.scenario);function I(){n.getParameters()}function A(){g.value.length<y.value.length?g.value=[...Array(y.value.length).keys()].map((i,a)=>a):g.value=[]}const V=T(!1),S={required:i=>i!=null||o("Required"),largerThanZero:i=>i>0||o("should be larger than 0"),nonNegative:i=>i>=0||o("should be larger or equal to 0")};function F(i){const a=f.value.map(u=>u.scenario);i.value=i.value.filter(u=>a.includes(u))}return(i,a)=>(s(),m(N,{class:"card"},{default:t(()=>[l(J,{class:"subtitle"},{default:t(()=>[v(d(h(o)("Scenario Settings")),1)]),_:1}),k.value?(s(),m(te,{key:0,class:"info-div"},{default:t(()=>[v(d(k.value),1)]),_:1})):U("",!0),w("div",he,[l(ae,{ref:"form","lazy-validation":""},{default:t(()=>[l(le,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=u=>g.value=u),multiple:""},{default:t(()=>[(s(!0),_($,null,E(y.value,(u,r)=>(s(),m(ne,{key:r},{default:t(()=>[l(se,{class:"categorie"},{default:t(()=>[v(d(u.category),1)]),_:2},1024),l(oe,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:t(()=>[(s(!0),_($,null,E(u.params,(e,W)=>(s(),_("li",{key:W},[typeof e.items>"u"&&typeof e.value=="boolean"?(s(),m(X,{key:0,modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,color:"primary",label:h(o)(e.text),hint:V.value?h(o)(e.hint):"","persistent-hint":V.value},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint"])):typeof e.items>"u"?(s(),m(ue,{key:1,modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,variant:"underlined",type:e.type,label:h(o)(e.text),suffix:e.units,hint:V.value?h(o)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(c=>S[c])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):e.items==="$scenarios"?(s(),m(O,{key:2,modelValue:e.value,"onUpdate:modelValue":[c=>e.value=c,c=>F(e)],variant:"underlined",type:e.type,items:f.value.map(c=>c.scenario).filter(c=>c!==L.value),multiple:"",label:h(o)(e.text),suffix:e.units,hint:V.value?h(o)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(c=>S[c])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"])):(s(),m(O,{key:3,modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,variant:"underlined",type:e.type,items:e.items,label:h(o)(e.text),suffix:e.units,hint:V.value?h(o)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(c=>S[c])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),l(re,null,{default:t(()=>[l(P,{color:"grey",variant:"text",onClick:I},{default:t(()=>[v(d(h(o)("back to default")),1)]),_:1}),l(ie),l(P,{variant:"text",onClick:A},{default:t(()=>[v(d(g.value.length!=y.value.length?h(o)("Expand all"):h(o)("Collapse all")),1)]),_:1}),l(P,{icon:"",size:"small",onClick:a[1]||(a[1]=u=>V.value=!V.value)},{default:t(()=>[l(q,null,{default:t(()=>[v("far fa-question-circle small")]),_:1})]),_:1})]),_:1})]),_:1}))}},xe=z(_e,[["__scopeId","data-v-f44a874f"]]),Se={style:{"white-space":"pre-line"}},be={__name:"Logs",setup(M){const o=D(),n=T(!1),b=p(()=>o.hasLogs),x=T([]);async function C(){await o.getLogs(),x.value=o.logs,n.value=!0}async function y(){await o.downloadLogs()}return(k,g)=>(s(),_($,null,[l(pe,{"close-delay":"100",transition:"slide-y-transition"},{activator:t(({props:f})=>[K(l(P,de({class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},f),{default:t(()=>[v(" logs ")]),_:2},1040),[[Q,b.value]])]),default:t(()=>[l(ce,null,{default:t(()=>[l(j,{onClick:C},{prepend:t(()=>[l(q,{icon:"fas fa-eye"})]),default:t(()=>[v(d(k.$gettext("show"))+" ",1)]),_:1}),l(j,{onClick:y},{prepend:t(()=>[l(q,{icon:"fas fa-download"})]),default:t(()=>[v(d(k.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),l(ve,{modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=f=>n.value=f),width:"90%"},{default:t(()=>[l(N,{style:{"overflow-y":"auto"}},{default:t(()=>[(s(!0),_($,null,E(x.value,(f,L)=>(s(),_("div",{key:L,class:"log-container"},[w("h1",null,d(f.name),1),w("span",Se,d(f.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},ke=z(be,[["__scopeId","data-v-b866bcb4"]]),we={class:"title-container"},$e={class:"buttons-row ma-2"},Ce={key:4},Le={__name:"Run",setup(M){const o=fe(),n=D(),b=R(),x=T(""),C=p(()=>n.steps),y=p(()=>{const a=n.availableModels;return n.avalaibleStepFunctions.filter(u=>a.has(u))}),k=p(()=>n.selectedStepFunction),g=p(()=>n.running),f=p(()=>n.currentStep),L=p(()=>n.error),I=p(()=>n.errorMessage),A=p(()=>n.synchronized),V=p(()=>b.protected),S=p(()=>b.model!==null),F=T(n.endSignal);G(F,()=>n.changeEndSignal(F.value)),H(async()=>{S.value&&(await n.getSteps(),x.value=k.value)}),G(x,async a=>{S.value&&(y.value.includes(a)?(n.setSelectedStepFunction(a),n.getSteps()):(x.value=y.value[0],n.setSelectedStepFunction(y.value[0]),n.getSteps()))});async function i(){try{const a=R();n.initExecution(),await o.exportToS3("inputs"),await o.deleteOutputsOnS3(),o.deleteOutputs(),n.startExecution({scenario:a.scenario})}catch(a){n.terminateExecution(),console.log(a),o.changeAlert(a)}}return(a,u)=>(s(),m(ge,{class:"background"},{default:t(()=>[l(Y,{order:"1"},{default:t(()=>[l(xe)]),_:1}),l(Y,{order:"2"},{default:t(()=>[l(N,{class:"card"},{default:t(()=>[w("div",we,[l(J,{class:"subtitle"},{default:t(()=>[v(d(a.$gettext("Scenario Simulation")),1)]),_:1}),l(ke)]),l(me,{modelValue:f.value,"onUpdate:modelValue":u[4]||(u[4]=r=>f.value=r),class:"stepper"},{default:t(()=>[y.value.length>1?(s(),m(ye,{key:0,modelValue:x.value,"onUpdate:modelValue":u[0]||(u[0]=r=>x.value=r),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:t(()=>[(s(!0),_($,null,E(y.value,r=>(s(),m(Ve,{key:r,value:r,disabled:g.value||!S.value},{default:t(()=>[v(d(r),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):U("",!0),A.value?U("",!0):(s(),m(B,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:t(()=>[v(d(a.$gettext("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),L.value?(s(),m(B,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[v(d(a.$gettext("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(s(!0),_($,null,E(Object.keys(I.value),r=>(s(),_("p",{key:r},[w("b",null,d(r)+": ",1),v(d(I.value[r]),1)]))),128))]),_:1})):U("",!0),V.value?(s(),m(B,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[v(d(a.$gettext("This scenario is protected. You can not run simulation.")),1)]),_:1})):U("",!0),w("div",$e,[l(P,{loading:g.value,disabled:g.value||V.value||!S.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:u[1]||(u[1]=r=>i())},{default:t(()=>[v(d(a.$gettext("Run Simulation")),1)]),_:1},8,["loading","disabled"]),K(l(P,{color:"grey",variant:"text",onClick:u[2]||(u[2]=r=>h(n).stopExecution())},{default:t(()=>[v(d(a.$gettext("Abort")),1)]),_:1},512),[[Q,g.value&&f.value!==1]]),l(X,{modelValue:F.value,"onUpdate:modelValue":u[3]||(u[3]=r=>F.value=r),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:t(()=>[w("span",null,d(a.$gettext("End signal")),1)]),_:1},8,["modelValue"])]),S.value?(s(),_("div",Ce,[(s(!0),_($,null,E(C.value,(r,e)=>(s(),_("div",{key:e+1},[L.value?(s(),m(Z,{key:1,complete:f.value>e+1,title:r.name,value:e+1,step:e+1},null,8,["complete","title","value","step"])):(s(),m(Z,{key:0,complete:f.value>e+1,color:f.value>=e+1?"primary":"regular",title:r.name,value:e+1,compact:"",step:e+1},null,8,["complete","color","title","value","step"]))]))),128))])):U("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},Ue=z(Le,[["__scopeId","data-v-a6534b6b"]]);export{Ue as default};
