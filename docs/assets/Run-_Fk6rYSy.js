import{_ as ee,u as ie,aj as te,ak as X,c as y,v as J,r as k,w as M,al as fe,b as o,d as S,e as a,f as s,ae as de,z as g,A as r,g as f,B,y as E,W as pe,C as N,Y as me,am as ge,x as p,G as P,H as I,an as ye,ao as _e,ap as he,k as A,a5 as ce,a0 as Ve,P as be,aq as Se,X as xe,ar as we,a6 as ke,I as O,a7 as Le,V as Q,O as ae,ac as Ee,t as $e,E as Ce,F as Re,L as oe,D as Fe,ab as Ue,a as Te,$ as ze,Z as ue,as as Ae,at as Pe,au as De,av as W,aw as re}from"./index-aRpl7iwt.js";const Ie={class:"expansion"},Oe={key:0,class:"categorie-info"},He={key:0,class:"custom-hint"},Be=["onDblclick"],Me=["onUpdate:modelValue"],Ne={__name:"ParamForm",setup(q){const{$gettext:u}=ie(),h=te(),n=X();function R(e,t){return Array.isArray(e)?e.includes(t):e===t}const D=y(()=>h.selectedStepFunction),v=y(()=>h.parameters.filter(e=>Object.keys(e).includes("category")&&R(e.model,D.value))),L=y(()=>{var t;let e=h.parameters.filter(m=>m==null?void 0:m.info);return e=e.filter(m=>R(m.model,D.value)),(t=e[0])==null?void 0:t.info}),$=y(()=>n.scenariosList),V=y(()=>n.scenario);function x(){for(const e of v.value)for(const t of e.params)if(t.items==="$scenarios"){const m=$.value.map(b=>b.scenario);Array.isArray(t.value)?t.value=t.value.filter(b=>m.includes(b)):t.value=m.includes(t.value)?t.value:""}}J(()=>{x()});function w(e){return e.items==="$scenarios"?$.value.map(t=>t.scenario).filter(t=>t!==V.value):e.items}function H(){h.getParameters()}const F=k([...Array(v.value.length).keys()].map((e,t)=>t));function U(){F.value.length<v.value.length?F.value=[...Array(v.value.length).keys()].map((e,t)=>t):F.value=[]}const T={required:e=>e!=null||u("Required"),largerThanZero:e=>e>0||u("should be larger than 0"),nonNegative:e=>e>=0||u("should be larger or equal to 0")},z=k(!1),_=k(!1),i=k({}),d=(e,t,m)=>{if(e){const b=String(t)+String(m);i.value[b]=e}};function C(e,t){_.value=!0;const m=String(e)+String(t);Ee(()=>i.value[m].focus())}M(z,e=>{e||(_.value=!1)});const G=k(null),Y=k(!1),le=k(0),j=k();J(()=>{const e=G.value.clientHeight,t=window.innerHeight,m=e/t;j.value=m<.25?e:.25*t});function ve(e){e.preventDefault(),Y.value=!0,le.value=e.clientY-G.value.clientHeight,document.addEventListener("mousemove",ne),document.addEventListener("mouseup",se)}function ne(e){if(Y.value){const t=e.clientY-le.value;j.value=t}}function se(){Y.value=!1,document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",se)}return(e,t)=>{const m=fe("v-number-input");return o(),S(ae,{class:"card"},{default:a(()=>[s(de,{class:"subtitle"},{default:a(()=>[g(r(f(u)("Scenario Settings")),1)]),_:1}),B(E("div",{ref_key:"resizableDiv",ref:G,class:"info-div",style:pe({height:j.value+"px"})},r(L.value),5),[[N,L.value]]),B(E("div",{class:"drag-handle",onMousedown:ve},null,544),[[N,L.value]]),E("div",Ie,[s(me,{ref:"form","lazy-validation":""},{default:a(()=>[s(ge,{modelValue:F.value,"onUpdate:modelValue":t[1]||(t[1]=b=>F.value=b),multiple:""},{default:a(()=>[(o(!0),p(P,null,I(v.value,(b,K)=>(o(),S(ye,{key:K},{default:a(()=>[s(_e,{class:"categorie"},{default:a(()=>[g(r(b.category),1)]),_:2},1024),s(he,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:a(()=>[b.info?(o(),p("div",Oe,r(b.info),1)):A("",!0),(o(!0),p(P,null,I(b.params,(l,Z)=>(o(),p("li",{key:Z,class:"param-list"},[typeof l.items>"u"&&typeof l.value=="boolean"?(o(),S(ce,{key:0,modelValue:l.value,"onUpdate:modelValue":c=>l.value=c,color:"primary",density:"compact",class:"pl-2","hide-details":"",label:f(u)(l.text),"persistent-hint":z.value},null,8,["modelValue","onUpdate:modelValue","label","persistent-hint"])):l.type=="Number"?(o(),S(m,{key:1,modelValue:l.value,"onUpdate:modelValue":c=>l.value=c,variant:"outlined","control-variant":"stacked",type:l.type,label:f(u)(l.text),suffix:l.units,"hide-details":"",rules:l.rules.map(c=>T[c])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):typeof l.items>"u"?(o(),S(Ve,{key:2,modelValue:l.value,"onUpdate:modelValue":c=>l.value=c,variant:"outlined","hide-details":"",type:l.type,label:f(u)(l.text),suffix:l.units,rules:l.rules.map(c=>T[c])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):(o(),S(be,{key:3,modelValue:l.value,"onUpdate:modelValue":[c=>l.value=c,c=>x(l)],variant:"outlined","hide-details":"",type:l.type,multiple:l==null?void 0:l.multiple,items:w(l),label:f(u)(l.text),suffix:l.units,rules:l.rules.map(c=>T[c])},null,8,["modelValue","onUpdate:modelValue","type","multiple","items","label","suffix","rules"])),s(Se,null,{default:a(()=>[z.value?(o(),p("div",He,[_.value?B((o(),p("textarea",{key:1,ref_for:!0,ref:c=>d(c,K,Z),"onUpdate:modelValue":c=>l.hint=c,rows:"1",class:"edition",onKeydown:t[0]||(t[0]=xe(c=>_.value=!1,["enter"]))},null,40,Me)),[[we,l.hint]]):(o(),p("div",{key:0,onDblclick:c=>C(K,Z)},r(l.hint),41,Be))])):A("",!0)]),_:2},1024)]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),s(ke,null,{default:a(()=>[s(O,{color:"grey",variant:"text",onClick:H},{default:a(()=>[g(r(f(u)("back to default")),1)]),_:1}),s(Le),s(O,{variant:"text",onClick:U},{default:a(()=>[g(r(F.value.length!=v.value.length?f(u)("Expand all"):f(u)("Collapse all")),1)]),_:1}),s(O,{icon:"",size:"small",onClick:t[2]||(t[2]=b=>z.value=!z.value)},{default:a(()=>[s(Q,null,{default:a(()=>t[3]||(t[3]=[g("far fa-question-circle small")])),_:1})]),_:1})]),_:1})]),_:1})}}},qe=ee(Ne,[["__scopeId","data-v-de2279e6"]]),Ge={style:{"white-space":"pre-line"}},Ye={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(q){const u=q,{disabled:h}=$e(u),n=te(),R=k(!1),D=y(()=>n.hasLogs),v=k([]);async function L(){await n.getLogs(),v.value=n.logs,v.value.sort((V,x)=>String(V.time).localeCompare(String(x.time),void 0,{sensitivity:"base"})),R.value=!0}async function $(){await n.downloadLogs()}return(V,x)=>(o(),p(P,null,[s(Fe,{"close-delay":"100",transition:"slide-y-transition"},{activator:a(({props:w})=>[B(s(O,Ce({disabled:f(h),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},w),{default:a(()=>x[1]||(x[1]=[g(" logs ")])),_:2},1040,["disabled"]),[[N,D.value]])]),default:a(()=>[s(Re,null,{default:a(()=>[s(oe,{onClick:L},{prepend:a(()=>[s(Q,{icon:"fas fa-eye"})]),default:a(()=>[g(r(V.$gettext("show"))+" ",1)]),_:1}),s(oe,{onClick:$},{prepend:a(()=>[s(Q,{icon:"fas fa-download"})]),default:a(()=>[g(r(V.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),s(Ue,{modelValue:R.value,"onUpdate:modelValue":x[0]||(x[0]=w=>R.value=w),width:"90%"},{default:a(()=>[s(ae,{style:{"overflow-y":"auto"}},{default:a(()=>[(o(!0),p(P,null,I(v.value,(w,H)=>(o(),p("div",{key:H,class:"log-container"},[E("h1",null,r(w.name),1),E("h3",null,[E("b",null,r(w.time),1)]),E("span",Ge,r(w.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},je=ee(Ye,[["__scopeId","data-v-c531ebb9"]]),Ke={class:"section"},Ze={class:"title-container"},We={class:"buttons-row ma-2"},Xe={key:4},Je={__name:"Run",setup(q){const{$gettext:u}=ie(),h=Te(),n=te(),R=X(),D=y(()=>n.steps),v=y(()=>{const _=n.availableModels;return n.avalaibleStepFunctions.filter(i=>_.has(i))}),L=k(n.selectedStepFunction),$=y(()=>n.running),V=y(()=>n.currentStep),x=y(()=>n.error),w=y(()=>n.errorMessage),H=y(()=>n.synchronized),F=y(()=>R.protected),U=y(()=>R.model!==null),T=k(n.endSignal);M(T,()=>n.changeEndSignal(T.value)),J(async()=>{U.value&&(await n.getSteps(),await n.GetRunningExecution())}),M(v,_=>{U.value&&(_.includes(L.value)||(n.setSelectedStepFunction(_[0]),n.getSteps()))},{once:!0}),M(L,async _=>{U.value&&(v.value.includes(_)?(n.setSelectedStepFunction(_),n.getSteps()):(L.value=v.value[0],n.setSelectedStepFunction(v.value[0]),n.getSteps()))});async function z(){if(await n.GetRunningExecution()){h.changeNotification({text:u("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const i=X();n.initExecution(),await h.exportToS3("inputs"),await h.deleteOutputsOnS3(),await h.deleteLogsOnS3(),h.deleteOutputs(),n.startExecution({scenario:i.scenario})}catch(i){n.terminateExecution(),console.log(i),h.changeAlert(i)}}return(_,i)=>(o(),p("section",Ke,[s(ze,{class:"background"},{default:a(()=>[s(ue,{order:"1"},{default:a(()=>[s(qe)]),_:1}),s(ue,{order:"2"},{default:a(()=>[s(ae,{class:"card"},{default:a(()=>[E("div",Ze,[s(de,{class:"subtitle"},{default:a(()=>[g(r(f(u)("Scenario Simulation")),1)]),_:1}),s(je,{disabled:$.value||!U.value},null,8,["disabled"])]),s(Ae,{modelValue:V.value,"onUpdate:modelValue":i[4]||(i[4]=d=>V.value=d),class:"stepper"},{default:a(()=>[v.value.length>1?(o(),S(De,{key:0,modelValue:L.value,"onUpdate:modelValue":i[0]||(i[0]=d=>L.value=d),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:a(()=>[(o(!0),p(P,null,I(v.value,d=>(o(),S(Pe,{key:d,value:d,disabled:$.value||!U.value},{default:a(()=>[g(r(d),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):A("",!0),H.value?A("",!0):(o(),S(W,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:a(()=>[g(r(f(u)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),x.value?(o(),S(W,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[g(r(f(u)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(o(!0),p(P,null,I(Object.keys(w.value),d=>(o(),p("p",{key:d},[E("b",null,r(d)+": ",1),g(r(w.value[d]),1)]))),128))]),_:1})):A("",!0),F.value?(o(),S(W,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[g(r(f(u)("This scenario is protected. You can not run simulation.")),1)]),_:1})):A("",!0),E("div",We,[s(O,{loading:$.value,disabled:$.value||F.value||!U.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:i[1]||(i[1]=d=>z())},{default:a(()=>[g(r(f(u)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),B(s(O,{color:"grey",variant:"text",onClick:i[2]||(i[2]=d=>f(n).stopExecution())},{default:a(()=>[g(r(f(u)("Abort")),1)]),_:1},512),[[N,$.value&&V.value!==1]]),s(ce,{modelValue:T.value,"onUpdate:modelValue":i[3]||(i[3]=d=>T.value=d),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:a(()=>[E("span",null,r(f(u)("End signal")),1)]),_:1},8,["modelValue"])]),U.value?(o(),p("div",Xe,[(o(!0),p(P,null,I(D.value,(d,C)=>(o(),p("div",{key:C+1},[x.value?(o(),S(re,{key:1,complete:V.value>C+1,title:d.name,value:C+1,step:C+1},null,8,["complete","title","value","step"])):(o(),S(re,{key:0,complete:V.value>C+1,color:V.value>=C+1?"primary":"regular",title:d.name,value:C+1,compact:"",step:C+1},null,8,["complete","color","title","value","step"]))]))),128))])):A("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]))}},et=ee(Je,[["__scopeId","data-v-edf4fa7b"]]);export{et as default};
