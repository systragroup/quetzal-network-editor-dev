import{_ as D,ae as J,af as O,ag as q,e as p,r as A,p as X,g as n,h as g,i as t,j as l,ab as K,x as v,y as r,ah as u,ad as te,l as T,v as E,U as ae,ai as le,q as x,F as U,E as P,aj as ne,ak as se,al as oe,a1 as Q,Z as ue,N as j,a2 as re,G as I,a3 as ie,V as z,L as M,t as de,z as W,C as ce,A as ee,D as pe,J as G,B as ve,a9 as fe,u as ge,w as Y,Y as me,X as Z,am as ye,an as he,ao as Ve,ap as N,aq as H}from"./index-CGhytQ6I.js";const _e={class:"expansion"},xe={__name:"ParamForm",setup(B){const{$gettext:s}=J(),h=O(),a=q(),L=p(()=>h.selectedStepFunction),w=p(()=>h.parameters),S=p(()=>w.value.filter(o=>Object.keys(o).includes("category")&&o.model===L.value)),k=p(()=>{var o;return(o=w.value.filter(i=>((i==null?void 0:i.info)&&(i==null?void 0:i.model))===L.value)[0])==null?void 0:o.info}),b=A([]);X(()=>{b.value=[...Array(S.value.length).keys()].map((o,i)=>i)});const m=p(()=>a.scenariosList),y=p(()=>a.scenario);function V(){h.getParameters()}function $(){b.value.length<S.value.length?b.value=[...Array(S.value.length).keys()].map((o,i)=>i):b.value=[]}const _=A(!1),R={required:o=>o!=null||s("Required"),largerThanZero:o=>o>0||s("should be larger than 0"),nonNegative:o=>o>=0||s("should be larger or equal to 0")};function F(o){const i=m.value.map(f=>f.scenario);o.value=o.value.filter(f=>i.includes(f))}return(o,i)=>(n(),g(M,{class:"card"},{default:t(()=>[l(K,{class:"subtitle"},{default:t(()=>[v(r(u(s)("Scenario Settings")),1)]),_:1}),k.value?(n(),g(te,{key:0,class:"info-div"},{default:t(()=>[v(r(k.value),1)]),_:1})):T("",!0),E("div",_e,[l(ae,{ref:"form","lazy-validation":""},{default:t(()=>[l(le,{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=f=>b.value=f),multiple:""},{default:t(()=>[(n(!0),x(U,null,P(S.value,(f,d)=>(n(),g(ne,{key:d},{default:t(()=>[l(se,{class:"categorie"},{default:t(()=>[v(r(f.category),1)]),_:2},1024),l(oe,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:t(()=>[(n(!0),x(U,null,P(f.params,(e,C)=>(n(),x("li",{key:C},[typeof e.items>"u"&&typeof e.value=="boolean"?(n(),g(Q,{key:0,modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,color:"primary",label:u(s)(e.text),hint:_.value?u(s)(e.hint):"","persistent-hint":_.value},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint"])):typeof e.items>"u"?(n(),g(ue,{key:1,modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,variant:"underlined",type:e.type,label:u(s)(e.text),suffix:e.units,hint:_.value?u(s)(e.hint):"","persistent-hint":_.value,rules:e.rules.map(c=>R[c])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):e.items==="$scenarios"?(n(),g(j,{key:2,modelValue:e.value,"onUpdate:modelValue":[c=>e.value=c,c=>F(e)],variant:"underlined",type:e.type,items:m.value.map(c=>c.scenario).filter(c=>c!==y.value),multiple:"",label:u(s)(e.text),suffix:e.units,hint:_.value?u(s)(e.hint):"","persistent-hint":_.value,rules:e.rules.map(c=>R[c])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"])):(n(),g(j,{key:3,modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,variant:"underlined",type:e.type,items:e.items,label:u(s)(e.text),suffix:e.units,hint:_.value?u(s)(e.hint):"","persistent-hint":_.value,rules:e.rules.map(c=>R[c])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),l(re,null,{default:t(()=>[l(I,{color:"grey",variant:"text",onClick:V},{default:t(()=>[v(r(u(s)("back to default")),1)]),_:1}),l(ie),l(I,{variant:"text",onClick:$},{default:t(()=>[v(r(b.value.length!=S.value.length?u(s)("Expand all"):u(s)("Collapse all")),1)]),_:1}),l(I,{icon:"",size:"small",onClick:i[1]||(i[1]=f=>_.value=!_.value)},{default:t(()=>[l(z,null,{default:t(()=>[v("far fa-question-circle small")]),_:1})]),_:1})]),_:1})]),_:1}))}},Se=D(xe,[["__scopeId","data-v-f44a874f"]]),be={style:{"white-space":"pre-line"}},we={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(B){const s=B,{disabled:h}=de(s),a=O(),L=A(!1),w=p(()=>a.hasLogs),S=A([]);async function k(){await a.getLogs(),S.value=a.logs,S.value.sort((m,y)=>String(m.time).localeCompare(String(y.time),void 0,{sensitivity:"base"})),L.value=!0}async function b(){await a.downloadLogs()}return(m,y)=>(n(),x(U,null,[l(ve,{"close-delay":"100",transition:"slide-y-transition"},{activator:t(({props:V})=>[W(l(I,ce({disabled:u(h),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},V),{default:t(()=>[v(" logs ")]),_:2},1040,["disabled"]),[[ee,w.value]])]),default:t(()=>[l(pe,null,{default:t(()=>[l(G,{onClick:k},{prepend:t(()=>[l(z,{icon:"fas fa-eye"})]),default:t(()=>[v(r(m.$gettext("show"))+" ",1)]),_:1}),l(G,{onClick:b},{prepend:t(()=>[l(z,{icon:"fas fa-download"})]),default:t(()=>[v(r(m.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),l(fe,{modelValue:L.value,"onUpdate:modelValue":y[0]||(y[0]=V=>L.value=V),width:"90%"},{default:t(()=>[l(M,{style:{"overflow-y":"auto"}},{default:t(()=>[(n(!0),x(U,null,P(S.value,(V,$)=>(n(),x("div",{key:$,class:"log-container"},[E("h1",null,r(V.name),1),E("h3",null,[E("b",null,r(V.time),1)]),E("span",be,r(V.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},ke=D(we,[["__scopeId","data-v-c531ebb9"]]),Ce={class:"title-container"},Le={class:"buttons-row ma-2"},Ee={key:4},Fe={__name:"Run",setup(B){const{$gettext:s}=J(),h=ge(),a=O(),L=q(),w=A(""),S=p(()=>a.steps),k=p(()=>{const f=a.availableModels;return a.avalaibleStepFunctions.filter(d=>f.has(d))}),b=p(()=>a.selectedStepFunction),m=p(()=>a.running),y=p(()=>a.currentStep),V=p(()=>a.error),$=p(()=>a.errorMessage),_=p(()=>a.synchronized),R=p(()=>L.protected),F=p(()=>L.model!==null),o=A(a.endSignal);Y(o,()=>a.changeEndSignal(o.value)),X(async()=>{F.value&&(await a.getSteps(),w.value=b.value,await a.GetRunningExecution())}),Y(w,async f=>{F.value&&(k.value.includes(f)?(a.setSelectedStepFunction(f),a.getSteps()):(w.value=k.value[0],a.setSelectedStepFunction(k.value[0]),a.getSteps()))});async function i(){if(await a.GetRunningExecution()){h.changeNotification({text:s("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const d=q();a.initExecution(),await h.exportToS3("inputs"),await h.deleteOutputsOnS3(),await h.deleteLogsOnS3(),h.deleteOutputs(),a.startExecution({scenario:d.scenario})}catch(d){a.terminateExecution(),console.log(d),h.changeAlert(d)}}return(f,d)=>(n(),g(me,{class:"background"},{default:t(()=>[l(Z,{order:"1"},{default:t(()=>[l(Se)]),_:1}),l(Z,{order:"2"},{default:t(()=>[l(M,{class:"card"},{default:t(()=>[E("div",Ce,[l(K,{class:"subtitle"},{default:t(()=>[v(r(u(s)("Scenario Simulation")),1)]),_:1}),l(ke,{disabled:m.value||!F.value},null,8,["disabled"])]),l(ye,{modelValue:y.value,"onUpdate:modelValue":d[4]||(d[4]=e=>y.value=e),class:"stepper"},{default:t(()=>[k.value.length>1?(n(),g(he,{key:0,modelValue:w.value,"onUpdate:modelValue":d[0]||(d[0]=e=>w.value=e),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:t(()=>[(n(!0),x(U,null,P(k.value,e=>(n(),g(Ve,{key:e,value:e,disabled:m.value||!F.value},{default:t(()=>[v(r(e),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):T("",!0),_.value?T("",!0):(n(),g(N,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:t(()=>[v(r(u(s)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),V.value?(n(),g(N,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[v(r(u(s)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(n(!0),x(U,null,P(Object.keys($.value),e=>(n(),x("p",{key:e},[E("b",null,r(e)+": ",1),v(r($.value[e]),1)]))),128))]),_:1})):T("",!0),R.value?(n(),g(N,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[v(r(u(s)("This scenario is protected. You can not run simulation.")),1)]),_:1})):T("",!0),E("div",Le,[l(I,{loading:m.value,disabled:m.value||R.value||!F.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:d[1]||(d[1]=e=>i())},{default:t(()=>[v(r(u(s)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),W(l(I,{color:"grey",variant:"text",onClick:d[2]||(d[2]=e=>u(a).stopExecution())},{default:t(()=>[v(r(u(s)("Abort")),1)]),_:1},512),[[ee,m.value&&y.value!==1]]),l(Q,{modelValue:o.value,"onUpdate:modelValue":d[3]||(d[3]=e=>o.value=e),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:t(()=>[E("span",null,r(u(s)("End signal")),1)]),_:1},8,["modelValue"])]),F.value?(n(),x("div",Ee,[(n(!0),x(U,null,P(S.value,(e,C)=>(n(),x("div",{key:C+1},[V.value?(n(),g(H,{key:1,complete:y.value>C+1,title:e.name,value:C+1,step:C+1},null,8,["complete","title","value","step"])):(n(),g(H,{key:0,complete:y.value>C+1,color:y.value>=C+1?"primary":"regular",title:e.name,value:C+1,compact:"",step:C+1},null,8,["complete","color","title","value","step"]))]))),128))])):T("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},$e=D(Fe,[["__scopeId","data-v-5257f955"]]);export{$e as default};
