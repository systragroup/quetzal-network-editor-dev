import{al as Q,am as Z,c as g,t as ue,d as X,h as z,g as c,an as ge,m as u,ao as re,i as e,k as te,r as I,u as ce,ap as ee,w as G,j as l,D as M,f as k,l as B,A as F,ae as de,B as R,C as w,W as O,E as he,$ as _e,aq as ye,H as W,I as q,a8 as Ve,L as H,a9 as we,Q as ae,ar as be,as as Se,at as xe,au as ke,av as $e,Z as Ce,aw as Le,ak as Ee,aj as Ie,_ as Y,G as Re,J as se,V as le,O as Te,F as ze,ah as De,a as Fe,ax as Pe,ay as Ae,az as He,a7 as Ue,R as Me,aA as Be,aB as ne,a0 as oe,a1 as Ne}from"./index-CkVeTMkb.js";import{g as Oe}from"./form-B2uRhppC.js";import{W as ie}from"./Warning-CQoMn3P3.js";const We=Q({__name:"ParamInput",props:{item:{}},setup(U){const v=Z(),p=g(()=>v.scenariosList),a=g(()=>v.scenario),L=U,{item:o}=ue(L);function $(t){return t.items==="$scenarios"?p.value.map(i=>i.scenario).filter(i=>i!==a.value):t.items}function x(t){if(t.items==="$scenarios"){const i=p.value.map(d=>d.scenario);Array.isArray(t.value)?t.value=t.value.filter(d=>i.includes(d)):t.value=i.includes(t.value)?t.value:""}}X(()=>x(o.value));const b=g(()=>o.value.items!==void 0?"v-select":o.value.type===void 0?"v-text-field":o.value.type.toLocaleLowerCase()==="boolean"?"v-switch":o.value.type.toLowerCase()==="number"?"v-number-input":"v-text-field");function _(t){return t.split("#")[1]}return(t,i)=>{var d;return c(),z(ge(b.value),{modelValue:u(o).value,"onUpdate:modelValue":[i[0]||(i[0]=C=>u(o).value=C),i[1]||(i[1]=C=>x(u(o)))],color:"primary",variant:"outlined","control-variant":"stacked",inset:"","hide-details":"",precision:u(o).precision===void 0?null:u(o).precision,label:u(o).text,prefix:_(u(o).name),suffix:u(o).units?u(o).units:void 0,type:u(o).type,rules:u(Oe)(u(o).rules),multiple:(d=u(o))==null?void 0:d.multiple,items:$(u(o))},re({_:2},[t.$slots.prepend?{name:"prepend",fn:e(()=>[te(t.$slots,"prepend")]),key:"0"}:void 0,t.$slots.append?{name:"append",fn:e(()=>[te(t.$slots,"append")]),key:"1"}:void 0]),1032,["modelValue","precision","label","prefix","suffix","type","rules","multiple","items"])}}}),je=Number.MAX_SAFE_INTEGER;function qe(U=200,v=200,p=0,a=je){const L=I(U),o=I(v),$=I(!1),x=I(),b=I([0,0]);function _(d){d.preventDefault(),$.value=!0,b.value=[d.clientX-x.value.clientWidth,d.clientY-x.value.clientHeight],document.addEventListener("mousemove",t),document.addEventListener("mouseup",i)}function t(d){if($.value){const C=d.clientX-b.value[0],D=d.clientY-b.value[1];L.value=C<p?p:C>a?a:C,o.value=D<p?p:D>a?a:D}}function i(){$.value=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",i)}return{panelWidth:L,panelHeight:o,panelDiv:x,startResize:_}}const Ge={key:0},Xe={class:"expansion"},Ye={key:0,class:"categorie-info"},Ke={key:0,class:"custom-hint"},Je=["onDblclick"],Qe=["onUpdate:modelValue"],Ze=Q({__name:"ParamForm",setup(U){const{$gettext:v}=ce(),p=ee(),a=Z(),L=g(()=>a.model!==null),o=g(()=>p.filteredParameters),$=g(()=>p.selectedInfo);function x(){p.resetParameters()}const{panelHeight:b,panelDiv:_,startResize:t}=qe(0,50,50);X(()=>{if(_.value){const r=window.innerHeight,s=_.value.scrollHeight,n=s/r;b.value=n>.25?.25*r:s}});const i=I([]);X(()=>{const n=o.value.map(m=>m.params.length).map((m=>h=>m+=h)(0)).filter(m=>m<=10);i.value=n.map((m,h)=>h)});function d(){i.value.length<o.value.length?i.value=o.value.map((r,s)=>s):i.value=[]}const C=I(!1),D=I(!1),j=I({}),P=(r,s,n)=>{if(r){const m=String(s)+String(n);j.value[m]=r}};function K(r,s){D.value=!0;const n=String(r)+String(s);Ee(()=>j.value[n].focus())}G(C,r=>{r||(D.value=!1)});const A=I(!1),N=g(()=>p.variants);function y(r){return r.name.split("#")[1]}function f(r){return r.name.includes("#")}const V=g(()=>{var n;const r=(n=N.value)!=null&&n.choices?N.value.choices:[],s={};return o.value.map(m=>m.category),o.value.forEach(m=>{const h=m.params.map(S=>S.name),T=Object.groupBy(h,S=>S.split("#")[0]);Object.keys(T).forEach(S=>{const me=T[S].slice(1).map(J=>J.split("#")[1]);T[S]=r.filter(J=>!me.includes(J))}),s[m.category]=T}),s});function E(r,s){const n=r.category,m=s.name.split("#")[0];return V.value[n][m]}function ve(r,s){s.name=s.name.split("#")[0]+`#${r}`,s.text=s.text.split("#")[0]+`#${r}`}function pe(r,s){const n=Ie.cloneDeep(s),m=r.category,h=s.name,T=V.value[m][h][0];if(T){n.name=n.name+`#${T}`,n.text=n.text+`#${T}`;const S=r.params.indexOf(s);r.params.splice(S+1,0,n)}}function fe(r,s){r.params=r.params.filter(n=>n!==s)}return(r,s)=>(c(),z(ae,{class:"card"},{default:e(()=>[l(de,{class:"subtitle"},{default:e(()=>[R(w(u(v)("Scenario Settings")),1)]),_:1}),M(F("div",{ref_key:"resizableDiv",ref:_,class:"info-div",style:he({height:u(b)+"px"})},w($.value),5),[[O,$.value]]),M(F("div",{class:"drag-handle",onMousedown:s[0]||(s[0]=(...n)=>u(t)&&u(t)(...n))},null,544),[[O,$.value]]),o.value.length===0?(c(),k("p",Ge,w(u(v)("No parameters")),1)):B("",!0),F("div",Xe,[l(_e,{ref:"form","validate-on":"lazy"},{default:e(()=>[l(ye,{modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=n=>i.value=n),multiple:""},{default:e(()=>[(c(!0),k(W,null,q(o.value,(n,m)=>(c(),z(be,{key:m},{default:e(()=>[l(Se,{class:"categorie"},{default:e(()=>[R(w(n.category),1)]),_:2},1024),l(xe,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:e(()=>[M(F("div",null,[n.info?(c(),k("div",Ye,w(n.info),1)):B("",!0),(c(!0),k(W,null,q(n.params,(h,T)=>(c(),k("li",{key:T,class:"param-list"},[l(We,{item:h},re({_:2},[A.value&&N.value?{name:"prepend",fn:e(()=>[f(h)?(c(),z(ke,{key:0,items:E(n,h),size:"small","model-value":y(h),"onUpdate:modelValue":S=>ve(S,h)},null,8,["items","model-value","onUpdate:modelValue"])):(c(),z(H,{key:1,variant:"tonal",size:"small",disabled:E(n,h).length==0,icon:"fas fa-plus",onClick:S=>pe(n,h)},null,8,["disabled","onClick"]))]),key:"0"}:void 0,A.value&&f(h)?{name:"append",fn:e(()=>[l(H,{variant:"text",color:"error",size:"small",icon:"fas fa-trash",onClick:S=>fe(n,h)},null,8,["onClick"])]),key:"1"}:void 0]),1032,["item"]),l($e,null,{default:e(()=>[C.value?(c(),k("div",Ke,[D.value?M((c(),k("textarea",{key:1,ref_for:!0,ref:S=>P(S,m,T),"onUpdate:modelValue":S=>h.hint=S,rows:"1",class:"edition",onKeydown:s[1]||(s[1]=Ce(S=>D.value=!1,["enter"]))},null,40,Qe)),[[Le,h.hint]]):(c(),k("div",{key:0,onDblclick:S=>K(m,T)},w(h.hint),41,Je))])):B("",!0)]),_:2},1024)]))),128))],512),[[O,i.value.includes(m)]])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),l(Ve,null,{default:e(()=>[M(l(H,{variant:"text",onClick:x},{default:e(()=>[R(w(u(v)("back to default")),1)]),_:1},512),[[O,L.value]]),l(we),N.value?(c(),z(H,{key:0,"prepend-icon":"fas fa-plus",variant:"text",active:A.value,onClick:s[3]||(s[3]=n=>A.value=!A.value)},{default:e(()=>[R(w(u(v)("Manage")),1)]),_:1},8,["active"])):B("",!0),l(H,{variant:"text",onClick:d},{default:e(()=>[R(w(i.value.length!=o.value.length?u(v)("Expand all"):u(v)("Collapse all")),1)]),_:1}),l(H,{icon:"far fa-question-circle",size:"small",active:C.value,onClick:s[4]||(s[4]=n=>C.value=!C.value)},null,8,["active"])]),_:1})]),_:1}))}}),ea=Y(Ze,[["__scopeId","data-v-92e1c016"]]),aa="/quetzal-network-editor-dev/assets/samsung-washing-machine-melody-made-with-Voicemod-technology-C_SPFWiL.mp3",ta={style:{"white-space":"pre-line"}},sa={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(U){const v=U,{disabled:p}=ue(v),a=ee(),L=I(!1),o=g(()=>a.hasLogs),$=I([]);async function x(){await a.getLogs(),$.value=a.logs,$.value.sort((_,t)=>String(_.time).localeCompare(String(t.time),void 0,{sensitivity:"base"})),L.value=!0}async function b(){await a.downloadLogs()}return(_,t)=>(c(),k(W,null,[l(ze,{"close-delay":"100",transition:"slide-y-transition"},{activator:e(({props:i})=>[M(l(H,Te({disabled:u(p),class:"log-button",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},i),{default:e(()=>t[1]||(t[1]=[R(" logs ",-1)])),_:2,__:[1]},1040,["disabled"]),[[O,o.value]])]),default:e(()=>[l(Re,null,{default:e(()=>[l(se,{onClick:x},{prepend:e(()=>[l(le,{icon:"fas fa-eye"})]),default:e(()=>[R(w(_.$gettext("show"))+" ",1)]),_:1}),l(se,{onClick:b},{prepend:e(()=>[l(le,{icon:"fas fa-download"})]),default:e(()=>[R(w(_.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),l(De,{modelValue:L.value,"onUpdate:modelValue":t[0]||(t[0]=i=>L.value=i),width:"90%"},{default:e(()=>[l(ae,{style:{"overflow-y":"auto"}},{default:e(()=>[(c(!0),k(W,null,q($.value,(i,d)=>(c(),k("div",{key:d,class:"log-container"},[F("h1",null,w(i.name),1),F("h3",null,[F("b",null,w(i.time),1)]),F("span",ta,w(i.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},la=Y(sa,[["__scopeId","data-v-19036b20"]]),na={class:"title-container"},oa={class:"buttons-row ma-2"},ia={key:1},ua=Q({__name:"RunStepper",setup(U){const{$gettext:v}=ce(),p=Fe(),a=ee(),L=Z(),o=g(()=>a.steps),$=g(()=>a.modelTag),x=g(()=>{const y=a.availableModels;return a.avalaibleStepFunctions.filter(f=>y.has(f))}),b=g({get:()=>a.selectedStepFunction,set:y=>a.selectedStepFunction=y}),_=g(()=>a.variants),t=g(()=>a.running),i=g(()=>a.status),d=g(()=>a.currentStep),C=g(()=>a.error),D=g(()=>a.errorMessage),j=g(()=>L.protected),P=g(()=>L.model!==null);X(async()=>{P.value&&(await a.getModelTag(),await a.getSteps(),await a.checkRunningExecution())}),G(x,y=>{P.value&&(y.includes(b.value)||(b.value=y[0],a.getSteps()))},{once:!0}),G(b,async y=>{P.value&&(x.value.includes(y)?(b.value=y,a.getSteps()):(b.value=x.value[0],a.getSteps()))});async function K(){if(await a.checkRunningExecution()){p.changeNotification({text:v("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{a.initExecution(),await p.exportToS3("inputs"),await p.deleteOutputsOnS3(),await p.deleteLogsOnS3(),p.deleteOutputs(),a.start()}catch(f){a.stopExecution(),console.log(f),p.changeAlert(f)}}const A=I(!0);G(i,y=>{y==="FINISHED"&&N()});function N(){if(A.value){const y=new Audio(aa);y.play(),setTimeout(function(){y.pause(),y.currentTime=0},5e3)}}return(y,f)=>(c(),z(ae,{class:"card"},{default:e(()=>[F("div",na,[l(de,{class:"subtitle"},{default:e(()=>[R(w(u(v)("Simulation")),1)]),_:1}),l(Pe,{class:"model-tag"},{default:e(()=>[R(w($.value),1)]),_:1}),l(la,{disabled:t.value||!P.value},null,8,["disabled"])]),x.value.length>1?(c(),z(Ae,{key:0,modelValue:b.value,"onUpdate:modelValue":f[0]||(f[0]=V=>b.value=V),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:e(()=>[(c(!0),k(W,null,q(x.value,V=>(c(),z(Be,{key:V,value:V,disabled:t.value||!P.value},{default:e(()=>[R(w(V),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):B("",!0),l(He,{modelValue:d.value,"onUpdate:modelValue":f[5]||(f[5]=V=>d.value=V),class:"stepper"},{default:e(()=>[l(ie,{show:C.value,title:u(v)("Simulation ended with an execution error or have been aborted.         Please relauch simulation. If the problem persist, contact us."),messages:D.value},null,8,["show","title","messages"]),l(ie,{show:j.value,title:u(v)("This scenario is protected"),messages:u(v)(" You cannot run simulation.")},null,8,["show","title","messages"]),F("div",oa,[l(H,{loading:t.value,disabled:t.value||j.value||!P.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:f[1]||(f[1]=V=>K())},{default:e(()=>[R(w(u(v)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),M(l(H,{color:"grey",variant:"text",onClick:f[2]||(f[2]=V=>u(a).stopExecution())},{default:e(()=>[R(w(u(v)("Abort")),1)]),_:1},512),[[O,t.value&&d.value!==1]]),l(Ue,{modelValue:A.value,"onUpdate:modelValue":f[3]||(f[3]=V=>A.value=V),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",label:u(v)("End signal"),color:"success","hide-details":""},{prepend:e(()=>f[6]||(f[6]=[])),_:1},8,["modelValue","label"])]),_.value?(c(),z(Me,{key:0,modelValue:_.value.variants,"onUpdate:modelValue":f[4]||(f[4]=V=>_.value.variants=V),class:"ma-2",label:_.value.label||"variants",chips:"",disabled:t.value,items:_.value.choices,multiple:_.value.multiple,"hide-details":!0},null,8,["modelValue","label","disabled","items","multiple"])):B("",!0),P.value?(c(),k("div",ia,[(c(!0),k(W,null,q(o.value,(V,E)=>(c(),k("div",{key:E+1},[C.value?(c(),z(ne,{key:1,complete:d.value>E+1,color:d.value>=E+1?"primary":void 0,title:V.name,value:E+1,rules:[()=>d.value!==E+1],step:E+1},null,8,["complete","color","title","value","rules","step"])):(c(),z(ne,{key:0,complete:d.value>E+1,color:d.value>=E+1?"primary":void 0,title:V.name,value:E+1,step:E+1},null,8,["complete","color","title","value","step"]))]))),128))])):B("",!0)]),_:1},8,["modelValue"])]),_:1}))}}),ra=Y(ua,[["__scopeId","data-v-6b64fd68"]]),ca={class:"section"},da={__name:"Run",setup(U){return(v,p)=>(c(),k("section",ca,[l(Ne,{class:"col"},{default:e(()=>[l(oe,{order:"1"},{default:e(()=>[l(ea)]),_:1}),l(oe,{order:"2"},{default:e(()=>[l(ra)]),_:1})]),_:1})]))}},ma=Y(da,[["__scopeId","data-v-7193c230"]]);export{ma as default};
