import{al as x,b3 as L,u as N,b4 as M,r as o,h as w,g as v,a2 as $,O as z,Q as D,Y as O,i as p,j as f,ae as W,B as S,C as q,ag as I,$ as G,N as Q,k as B,L as Z,_ as U,f as E,m as i,ax as j,b5 as k,a as F,l as h}from"./index-BbcYXnEn.js";const C=x({__name:"PasswordInput",props:L({rules:{},match:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const{$gettext:m}=N(),e=M(g,"modelValue"),s=g,t=/^(?!\s+)(?!.*\s+$)(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*[$^*.[\]{}()?"!@#%&/\\,><':;|_~`=+\- ])[A-Za-z0-9$^*.[\]{}()?"!@#%&/\\,><':;|_~`=+\- ]{8,256}$/,r={required:a=>!!a||m("Required"),password:a=>t.test(a)||m("need at least: 1 lowercase, 1 uppercase, 1 number, and 1 symbol"),match:a=>a===s.match||m("password must match")};function u(a){return a===void 0?[]:a.map(n=>r[n])}const l=o(!1);return(a,n)=>(v(),w($,z({modelValue:e.value,"onUpdate:modelValue":n[0]||(n[0]=c=>e.value=c),type:l.value?"text":"password","append-inner-icon":l.value?"fas fa-eye":"fas fa-eye-slash"},a.$attrs,{required:"",rules:u(s.rules),"onClick:appendInner":n[1]||(n[1]=c=>l.value=!l.value)}),null,16,["modelValue","type","append-inner-icon","rules"]))}}),H=x({__name:"BaseLoginForm",props:{title:{type:String,default:"Title"},body:{type:String,default:null},confirmButton:{type:String,default:"Apply"},error:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["confirm"],setup(g,{emit:m}){const e=g,s=m,t=o(!1);async function r(u){(await u).valid?s("confirm"):(t.value=!0,setTimeout(()=>{t.value=!1},500))}return(u,l)=>(v(),w(D,{class:O(["signin",{shake:t.value}])},{default:p(()=>[f(W,{class:"text-h4"},{default:p(()=>[S(q(e.title),1)]),_:1}),f(I,{class:"text-h8",style:{"padding-bottom":"0.5rem"}},{default:p(()=>[S(q(e.body),1)]),_:1}),f(G,{ref:"form",class:"form",onSubmit:Q(r,["prevent"])},{default:p(()=>[B(u.$slots,"default",{},void 0,!0),f(I,{style:{color:"red"}},{default:p(()=>[S(q(e.error),1)]),_:1}),f(Z,{block:"",type:"submit",color:"success",loading:g.loading},{default:p(()=>[S(q(e.confirmButton),1)]),_:1},8,["loading"]),B(u.$slots,"append",{},void 0,!0)]),_:3},512)]),_:3},8,["class"]))}}),R=U(H,[["__scopeId","data-v-ddef4b30"]]),Y=x({__name:"Signin",emits:["signin","newPassword","resetPassword"],setup(g,{emit:m}){const{$gettext:e}=N(),s=m,t=o(""),r=o(""),u=o(""),l=o(!1),a=o({required:d=>!!d||e("Required")});function n(){s("resetPassword")}async function c(){l.value=!0;try{const d=await k.signin(t.value,r.value);d.nextStep.signInStep==="CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED"?s("newPassword"):s("signin",d)}catch(d){u.value=d}finally{l.value=!1}}return(d,V)=>(v(),E("section",null,[f(R,{title:i(e)("Sign In"),body:i(e)("Sign in with username or email address."),"confirm-button":i(e)("Sign in"),loading:l.value,error:u.value,onConfirm:c},{append:p(()=>[f(j,{class:"link",onClick:n},{default:p(()=>[S(q(i(e)("Forgot your password?")),1)]),_:1})]),default:p(()=>[f($,{modelValue:t.value,"onUpdate:modelValue":V[0]||(V[0]=P=>t.value=P),label:i(e)("username"),required:"",rules:[a.value.required]},null,8,["modelValue","label","rules"]),f(C,{modelValue:r.value,"onUpdate:modelValue":V[1]||(V[1]=P=>r.value=P),label:i(e)("password"),rules:["required"]},null,8,["modelValue","label"])]),_:1},8,["title","body","confirm-button","loading","error"])]))}}),J=U(Y,[["__scopeId","data-v-9be2d061"]]),K=x({__name:"NewPassword",emits:["signin"],setup(g,{emit:m}){const{$gettext:e}=N(),s=m,t=o(""),r=o(""),u=o(""),l=o(!1);async function a(){l.value=!0;try{const n=await k.completeNewPassword(t.value);s("signin",n)}catch(n){l.value=!1,u.value=n}finally{l.value=!1}}return(n,c)=>(v(),w(R,{title:i(e)("New Password"),"confirm-button":i(e)("set new password"),loading:l.value,error:u.value,onConfirm:a},{default:p(()=>[f(C,{modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=d=>t.value=d),label:i(e)("new password"),required:"",rules:["required","password"]},null,8,["modelValue","label"]),f(C,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=d=>r.value=d),label:i(e)("confirm new password"),match:t.value,required:"",rules:["required","match"]},null,8,["modelValue","label","match"])]),_:1},8,["title","confirm-button","loading","error"]))}}),X=x({__name:"ResetPassword",emits:["exit"],setup(g,{emit:m}){const e=F(),{$gettext:s}=N(),t=m,r=o(""),u=o(""),l=o(""),a=o(""),n=o(!1),c=o(""),d=o(!1),V=o({required:y=>!!y||s("Required")});async function P(){d.value=!0;try{await k.sendRecoveryEmail(r.value),n.value=!0}catch(y){c.value=y}finally{d.value=!1}}async function T(){d.value=!0;try{const y=await k.ChangePassword(r.value,u.value,l.value);e.changeNotification({text:s("Password changed"),autoClose:!0,color:"success"}),t("exit",y)}catch(y){c.value=y}finally{d.value=!1}}async function A(){n.value?T():P()}return(y,b)=>(v(),E("section",null,[f(R,{title:i(s)("Reset Password"),body:i(s)("check your email for the reset code"),"confirm-button":n.value?i(s)("change password"):i(s)("send email"),loading:d.value,error:c.value,onConfirm:A},{default:p(()=>[f($,{modelValue:r.value,"onUpdate:modelValue":b[0]||(b[0]=_=>r.value=_),readonly:n.value,label:i(s)("email or username"),required:"",rules:[V.value.required]},null,8,["modelValue","readonly","label","rules"]),n.value?(v(),w($,{key:0,modelValue:u.value,"onUpdate:modelValue":b[1]||(b[1]=_=>u.value=_),label:i(s)("reset code"),required:"",rules:[V.value.required],type:"string"},null,8,["modelValue","label","rules"])):h("",!0),n.value?(v(),w(C,{key:1,modelValue:l.value,"onUpdate:modelValue":b[2]||(b[2]=_=>l.value=_),label:i(s)("new password"),rules:["required","password"]},null,8,["modelValue","label"])):h("",!0),n.value?(v(),w(C,{key:2,modelValue:a.value,"onUpdate:modelValue":b[3]||(b[3]=_=>a.value=_),match:l.value,label:i(s)("new password"),rules:["required","match"]},null,8,["modelValue","match","label"])):h("",!0)]),_:1},8,["title","body","confirm-button","loading","error"])]))}}),ae=x({__name:"Login",emits:["signin"],setup(g,{emit:m}){const e=F(),s=m,t=o("signin"),r=o(!1);function u(l){try{e.changeLoading(!0),l?s("signin",!0):t.value="signin"}catch(a){t.value="signin",e.changeAlert(a)}finally{e.changeLoading(!1)}}return(l,a)=>r.value?(v(),w(X,{key:0,onExit:a[0]||(a[0]=()=>r.value=!1)})):t.value==="signin"?(v(),w(J,{key:1,onSignin:u,onNewPassword:a[1]||(a[1]=()=>t.value="newPassword"),onResetPassword:a[2]||(a[2]=()=>r.value=!0)})):t.value==="newPassword"?(v(),w(K,{key:2,onSignin:u})):h("",!0)}});export{ae as default};
