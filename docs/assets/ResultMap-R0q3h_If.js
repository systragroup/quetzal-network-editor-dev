import{_ as oe,M as Ee,a as Ke,b as Ae,c as Ge,d as Je,u as ie,r as x,e as I,w as O,o as Qe,t as fe,f as F,g as r,h as C,i as o,j as s,k as Xe,l as H,m as Le,n as Ye,p as _e,q as L,s as k,v as V,x as f,V as ge,y as ke,z as Ce,A as Me,B as q,C as he,D as Se,F as _,E as z,G as M,H as ze,I as Pe,J as le,K as X,L as ae,N as $e,O as et,P as tt,T as lt,Q as at,R as be,S as Ie,U as Ue,W as Q,X as De,Y,Z as st,$ as nt,a0 as G,a1 as se,a2 as ne,a3 as T,a4 as ot,a5 as it,a6 as rt,a7 as pe,a8 as j,a9 as ve,aa as Ne,ab as Fe}from"./index-OclrYkS5.js";import{c as He,M as ut,S as dt,u as ct}from"./StaticLayer-IMtoeoSW.js";import mt from"./LayerSelector-afwIFr4Y.js";const yt="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",pt=n=>n,vt={name:"ResultMap",components:{MglMap:Ee,MglNavigationControl:Ke,MglScaleControl:Ae,MglGeojsonLayer:Ge,MglImageLayer:Je},props:["selectedFeature","layerType","extrusion","links","nanLinks","opacity","offset"],events:["selectClick"],setup(n,t){const p=ie(),e=x(!1),l=yt,i=x(null),a=x({nodes:14,links:2}),m=I(()=>p.mapStyle);O(m,c=>{i.value&&(i.value.getLayer("arrow")&&i.value.removeLayer("arrow"),i.value.getLayer("links")&&i.value.removeLayer("links"),i.value.getLayer("zones")&&i.value.removeLayer("zones"),i.value.getLayer("nodes")&&i.value.removeLayer("nodes"),e.value=!1,h())}),Qe(()=>{var c;i.value&&h(),(c=i.value)!=null&&c.getLayer("arrow")&&i.value.removeLayer("arrow")});function h(){const c=i.value.getCenter();p.saveMapPosition({mapCenter:[c.lng,c.lat],mapZoom:i.value.getZoom()})}function P(c){i.value&&(e.value=!1);const g=new Le.LngLatBounds;["Polygon"].includes(w.value)?S.value.features.forEach(b=>{try{b.geometry.type==="Polygon"?g.extend([b.geometry.coordinates[0][0],b.geometry.coordinates[0][b.geometry.coordinates.length-1]]):g.extend([b.geometry.coordinates[0][0][0],b.geometry.coordinates[0][0][b.geometry.coordinates.length-1]])}catch{}}):S.value.features.forEach(b=>{g.extend([b.geometry.coordinates[0],b.geometry.coordinates[b.geometry.coordinates.length-1]])}),Object.keys(g).length!==0&&c.map.fitBounds(g,{padding:100}),c.map.loadImage(Ye,function(b,Z){if(b){console.error("err image",b);return}c.map.addImage("arrow",Z,{sdf:!0})}),i.value=c.map,D.value?p.changeNotification({text:pt("Right click and drag to tilt the map"),autoClose:!0,color:"success"}):c.map.dragRotate.disable(),e.value=!0}const v=x([]),N=x(null),{selectedFeature:y,layerType:w,extrusion:D,links:S,nanLinks:U,opacity:$,offset:B}=fe(n),W=I(()=>B.value?-1:1);function ee(c){var g;if(c.map.getCanvas().style.cursor="pointer",v.value=c.mapboxEvent.features,(g=N.value)!=null&&g.isOpen()&&N.value.remove(),y.value&&w.value!=="Polygon"){const b=v.value[0].properties[y.value];b&&(N.value=new Le.Popup({closeButton:!1}).setLngLat([c.mapboxEvent.lngLat.lng,c.mapboxEvent.lngLat.lat]).setHTML(`${y.value}: <br> ${b}`).addTo(c.map))}}function te(c){var g;v.value=[],(g=N.value)!=null&&g.isOpen()&&N.value.remove(),c.map.getCanvas().style.cursor=""}function re(c){var g;v.value=c.mapboxEvent.features,((g=v.value)==null?void 0:g.length)>0&&t.emit("selectClick",{feature:v.value[0].properties,action:"featureClick"})}function ue(c){var g;v.value=c.mapboxEvent.features,((g=v.value)==null?void 0:g.length)>0&&t.emit("selectClick",{feature:v.value[0].properties,action:"zoneClick"})}function de(c){c.map.getCanvas().style.cursor="pointer"}function R(c){c.map.getCanvas().style.cursor=""}return{store:p,mapIsLoaded:e,mapboxPublicKey:l,minZoom:a,map:i,mapStyle:m,onMapLoaded:P,layerType:w,extrusion:D,links:S,nanLinks:U,opacity:$,offset:B,offsetValue:W,enterLink:ee,leaveLink:te,selectClick:re,zoneClick:ue,zoneHover:de,zoneLeave:R}}};function ft(n,t,p,e,l,i){const a=F("MglScaleControl"),m=F("MglNavigationControl"),h=F("MglGeojsonLayer"),P=F("MglImageLayer"),v=F("MglMap");return r(),C(v,{key:e.mapStyle,style:{width:"100%"},"access-token":e.mapboxPublicKey,"map-style":e.mapStyle,center:e.store.mapCenter,zoom:e.store.mapZoom,onLoad:e.onMapLoaded},{default:o(()=>[s(a,{position:"bottom-right"}),s(m,{position:"bottom-right"}),Xe(n.$slots,"default",{map:e.map,mapIsLoaded:e.mapIsLoaded}),e.layerType=="LineString"?(r(),C(h,{key:0,"source-id":"links",source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:e.minZoom.links,paint:{"line-color":["get","display_color"],"line-offset":["*",e.offsetValue*.5,["to-number",["get","display_width"]]],"line-opacity":e.opacity/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:e.enterLink,onMouseleave:e.leaveLink,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):H("",!0),e.layerType=="Point"?(r(),C(h,{key:1,"source-id":"nodes",source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:e.minZoom.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":e.opacity/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:e.enterLink,onMouseleave:e.leaveLink,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):H("",!0),e.layerType=="LineString"?(r(),C(P,{key:2,"source-id":"links",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:e.minZoom.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[e.offsetValue*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":e.opacity/100}}},null,8,["layer"])):H("",!0),e.layerType==="Polygon"&&e.extrusion?(r(),C(h,{key:3,"source-id":"polygon",source:{type:"geojson",data:e.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":e.opacity/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):H("",!0),e.layerType==="Polygon"&&!e.extrusion?(r(),C(h,{key:4,"source-id":"polygon",source:{type:"geojson",data:e.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":e.opacity/100}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):H("",!0),e.layerType==="Polygon"&&!e.extrusion?(r(),C(h,{key:5,"source-id":"NaNPolygon",source:{type:"geojson",data:e.nanLinks,promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):H("",!0)]),_:3},8,["access-token","map-style","center","zoom","onLoad"])}const gt=oe(vt,[["render",ft]]),ht={name:"SidePanel",components:{},props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],events:["update-selectedCategory","select-layer","update-selected-filter","select-preset","delete-preset"],setup(n,t){const p=ie(),e=I(()=>p.windowHeight),l=I(()=>p.showLeftPanel),i=x(!0);O(l,S=>{S?setTimeout(()=>{i.value=!0},500):i.value=!1});const a=x(!1),m=x(!1),{selectedCategory:h,filteredCat:P}=fe(n),v=x([]);O(h,(S,U)=>{S!==U&&(v.value=S)}),O(v,S=>{S!==h.value&&t.emit("update-selectedCategory",S)});function N(S){v.value=S.selectedCategory}function y(){v.value.length===P.value.length?v.value=[]:v.value=P.value}const{selectedFilter:w}=fe(n),D=x("");return O(w,S=>{S!==D.value&&(D.value=S)}),O(D,(S,U)=>{S!==w.value&&(t.emit("update-selectedFilter",S),v.value=h.value)}),_e(()=>{D.value=w.value,v.value=h.value,t.emit("update-selectedFilter",w.value),t.emit("update-selectedCategory",h.value)}),{store:p,showLeftPanel:l,showLeftPanelContent:i,windowHeight:e,openMenu:a,presetsMenu:m,selectedCat:v,vmodelSelectedFilter:D,init:N,showAll:y}}},St={class:"left-panel-content"},bt={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},kt={class:"preset"},Ct={class:"custom-title"},wt={class:"crop"},xt={class:"layer"},Vt={class:"custom-title"},Lt={class:"crop"},Mt={class:"item"};function Pt(n,t,p,e,l,i){return r(),L("section",{class:at(e.showLeftPanel?"left-panel elevation-4":"left-panel-close"),style:be({width:e.showLeftPanel?"350px":"0px"})},[k("div",{class:"left-panel-toggle-btn elevation-4",onClick:t[0]||(t[0]=a=>e.store.changeLeftPanel())},[s(ge,{size:"small",color:"secondarydark"},{default:o(()=>[V(f(e.showLeftPanel?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),s(lt,{name:"fade"},{default:o(()=>[ke(k("div",St,[k("div",null,[k("div",bt,[k("div",kt,[s(Me,{location:"bottom","open-delay":"500"},{activator:o(({props:a})=>[s(ge,q({style:{color:"white","padding-right":"2rem"}},a),{default:o(()=>[V(" fas fa-sliders-h ")]),_:2},1040)]),default:o(()=>[k("span",null,f(n.$gettext("Presets")),1)]),_:1}),s(he,{modelValue:e.presetsMenu,"onUpdate:modelValue":t[1]||(t[1]=a=>e.presetsMenu=a),"close-delay":"100",transition:"slide-y-transition"},{activator:o(({props:a})=>[k("div",q({class:"title-div"},a),[k("span",Ct,f(n.$gettext("Presets")),1),k("span",wt,f(p.selectedPreset),1)],16)]),default:o(()=>[s(Se,null,{default:o(()=>[(r(!0),L(_,null,z(p.presetChoices,(a,m)=>(r(),C(le,{key:m,link:"",onClick:()=>n.$emit("select-preset",a)},{append:o(()=>[s(M,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:ze(()=>n.$emit("delete-preset",a),["stop"])},null,8,["onClick"])]),default:o(()=>[s(Pe,null,{default:o(()=>[V(f(a.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(M,{variant:"text",style:{color:"white"},icon:e.presetsMenu?"fas fa-chevron-left":"fas fa-chevron-down",onClick:t[2]||(t[2]=a=>e.presetsMenu=!e.presetsMenu)},null,8,["icon"])]),k("div",xt,[s(Me,{location:"bottom","open-delay":"500"},{activator:o(({props:a})=>[s(M,q({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:e.selectedCat.length>0?"fa-eye fa":"fa-eye-slash fa",variant:"text"},a,{onClick:t[3]||(t[3]=m=>e.showAll())}),null,16,["icon"])]),default:o(()=>[k("span",null,f(e.selectedCat.length>0?n.$gettext("Hide All"):n.$gettext("Show All")),1)]),_:1}),s(he,{modelValue:e.openMenu,"onUpdate:modelValue":t[4]||(t[4]=a=>e.openMenu=a),"close-delay":"100",transition:"slide-y-transition"},{activator:o(({props:a})=>[k("div",q({class:"title-div"},a),[k("span",Vt,f(n.$gettext("Layer")),1),k("span",Lt,f(p.selectedLayer),1)],16)]),default:o(()=>[s(Se,null,{default:o(()=>[(r(!0),L(_,null,z(p.layerChoices,(a,m)=>(r(),C(le,{key:m,link:"",onClick:()=>n.$emit("select-layer",a)},{default:o(()=>[s(Pe,null,{default:o(()=>[V(f(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(M,{style:{color:"white"},variant:"text",icon:e.openMenu?"fas fa-chevron-left":"fas fa-chevron-down",onClick:t[5]||(t[5]=a=>e.openMenu=!e.openMenu)},null,8,["icon"])]),s(X,{"max-width":"100%","min-width":"100%",height:e.windowHeight-180,class:"mx-auto"},{default:o(()=>[s(le,null,{default:o(()=>[s(ae,{modelValue:e.vmodelSelectedFilter,"onUpdate:modelValue":t[6]||(t[6]=a=>e.vmodelSelectedFilter=a),items:p.filterChoices,"prepend-icon":"fas fa-filter",label:n.$gettext("filter"),"item-props.color":"secondarydark",color:"secondarydark"},null,8,["modelValue","items","label"])]),_:1}),s($e,{items:p.filteredCat,"item-height":45,height:e.windowHeight-80},{default:o(({item:a})=>[(r(),L("div",{key:e.vmodelSelectedFilter.concat(a),class:"container"},[s(et,null,{default:o(()=>[s(tt,{modelValue:e.selectedCat,"onUpdate:modelValue":t[7]||(t[7]=m=>e.selectedCat=m),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:a},null,8,["modelValue","value"])]),_:2},1024),k("div",Mt,f(a),1)]))]),_:1},8,["items","height"])]),_:1},8,["height"])])])],512),[[Ce,e.showLeftPanelContent]])]),_:1})],6)}const Dt=oe(ht,[["render",Pt],["__scopeId","data-v-a68d9cc4"]]),d=n=>n,Nt={name:"ResultsSettings",props:["displaySettings","featureChoices","type"],events:["submit","save-preset"],setup(){const n=ie();return{windowHeight:I(()=>n.windowHeight-100)}},data(){return{showDialog:!1,parameters:[{name:d("selectedFeature"),type:"String",value:this.displaySettings.selectedFeature,units:"",hint:d("selectedFeature")},{name:d("minWidth"),type:"Number",value:this.displaySettings.minWidth,units:"a.u.",hint:d("minWidth")},{name:d("maxWidth"),type:"Number",value:this.displaySettings.maxWidth,units:"a.u.",hint:d("maxWidth")},{name:d("numStep"),type:"Number",value:this.displaySettings.numStep,units:"int",hint:d("numStep")},{name:d("opacity"),type:"Number",value:this.displaySettings.opacity,units:"number",hint:d("opacity")},{name:d("scale"),type:"String",value:this.displaySettings.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:d("scale")},{name:d("color map"),type:"String",choices:Object.keys(He.brewer).slice(0,36),value:this.displaySettings.cmap,units:"",hint:d("cmap to use")},{name:d("show NaN"),value:this.displaySettings.showNaN,hint:d("Hide NaN on map and color map")},{name:d("reverse color"),value:this.displaySettings.reverseColor,hint:d("reverse color scale")},{name:d("scale min"),type:"Number",value:this.displaySettings.minVal,units:"a.u.",hint:d("mininum value on the color Map")},{name:d("scale max"),type:"Number",value:this.displaySettings.maxVal,units:"a.u.",hint:d("maximum value on the color Map")},{name:d("custom scale"),value:this.displaySettings.fixScale,hint:d("customize to inputs values")},{name:d("Left side driving"),value:this.displaySettings.offset,hint:d("Select which side of the road the links are display")},{name:d("3D"),value:this.displaySettings.extrusion,hint:d("display zones as 3D extrusion")},{name:d("padding"),type:"Number",value:this.displaySettings.padding,units:"number",hint:d("range of colors")}],showHint:!1,showFixScale:!1,shake:!1,rules:{required:n=>!!n||d("Required"),largerThanZero:n=>n>0||d("should be larger than 0"),nonNegative:n=>n>=0||d("should be larger or equal to 0")}}},watch:{showDialog(n){this.refresh(),this.showFixScale=this.parameters[11].value},featureChoices(){this.refresh()}},methods:{toggleFixScale(){this.parameters[11].value?(this.showFixScale=!0,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal):this.showFixScale=!1},getColor(n){const t=[],p=this.parameters[8].value;let e=this.parameters[14].value;e=[e[0]/100,1-e[1]/100],e=p?e.reverse():e;const l=He.scale(n).padding(e).domain([0,100]).classes(25);for(let i=0;i<100;i++)t.push(l(i).hex());return p?t.reverse():t},refresh(){this.parameters[0].value=this.displaySettings.selectedFeature,this.parameters[1].value=this.displaySettings.minWidth,this.parameters[2].value=this.displaySettings.maxWidth,this.parameters[3].value=this.displaySettings.numStep,this.parameters[4].value=this.displaySettings.opacity,this.parameters[5].value=this.displaySettings.scale,this.parameters[6].value=this.displaySettings.cmap,this.parameters[7].value=this.displaySettings.showNaN,this.parameters[8].value=this.displaySettings.reverseColor,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal,this.parameters[11].value=this.displaySettings.fixScale,this.parameters[12].value=this.displaySettings.offset,this.parameters[13].value=this.displaySettings.extrusion,this.parameters[14].value=this.displaySettings.padding},submit(n){if(this.$refs.form.validate()){const t={selectedFeature:this.parameters[0].value,minWidth:Number(this.parameters[1].value),maxWidth:Number(this.parameters[2].value),numStep:Number(this.parameters[3].value),opacity:Number(this.parameters[4].value),scale:this.parameters[5].value,cmap:this.parameters[6].value,showNaN:this.parameters[7].value,reverseColor:this.parameters[8].value,minVal:Number(this.parameters[9].value),maxVal:Number(this.parameters[10].value),fixScale:this.parameters[11].value,offset:this.parameters[12].value,extrusion:this.parameters[13].value,padding:this.parameters[14].value};n==="apply"?this.$emit("submit",t):n==="save"&&this.$emit("save-preset",t)}else this.shake=!0,setTimeout(()=>{this.shake=!1},500)},cancel(){this.showDialog=!1}}},Ft={class:"setting"},Ht={class:"gradient"},_t={class:"domain-title-small"},zt={class:"domain-title"};function It(n,t,p,e,l,i){return r(),C(he,{modelValue:l.showDialog,"onUpdate:modelValue":t[16]||(t[16]=a=>l.showDialog=a),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:o(({props:a})=>[k("div",Ft,[s(M,q({color:p.displaySettings.selectedFeature===null?"error":"regular"},a,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:o(()=>[s(X,{width:"20rem",class:"setting-card","max-height":e.windowHeight,onKeydown:[t[15]||(t[15]=T(a=>i.submit("apply"),["enter"])),T(i.cancel,["esc"])]},{default:o(()=>[s(le,{class:"subtitle"},{append:o(()=>[s(M,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:t[0]||(t[0]=a=>l.showHint=!l.showHint)})]),default:o(()=>[V(f(n.$gettext("Settings"))+" ",1)]),_:1}),s(Ie,{ref:"form","lazy-validation":""},{default:o(()=>[s(Ue,null,{default:o(()=>[s(Q,null,{default:o(()=>[s(ae,{modelValue:l.parameters[0].value,"onUpdate:modelValue":t[1]||(t[1]=a=>l.parameters[0].value=a),variant:"underlined",items:p.featureChoices,label:n.$gettext(l.parameters[0].name),hint:l.showHint?n.$gettext(l.parameters[0].hint):"","persistent-hint":l.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),s(De,null,{default:o(()=>[(r(!0),L(_,null,z(l.parameters.slice(1,3),a=>(r(),C(Q,{key:a.name},{default:o(()=>[s(Y,{modelValue:a.value,"onUpdate:modelValue":m=>a.value=m,variant:"underlined",density:"compact",type:a.type,label:n.$gettext(a.name),suffix:a.units,hint:l.showHint?n.$gettext(a.hint):"","persistent-hint":l.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),s(De,null,{default:o(()=>[s(Q,null,{default:o(()=>[s(Y,{modelValue:l.parameters[3].value,"onUpdate:modelValue":t[2]||(t[2]=a=>l.parameters[3].value=a),variant:"underlined",density:"compact",type:l.parameters[3].type,label:n.$gettext(l.parameters[3].name),suffix:l.parameters[3].units,hint:l.showHint?n.$gettext(l.parameters[3].hint):"","persistent-hint":l.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),s(Q,null,{default:o(()=>[s(ae,{modelValue:l.parameters[5].value,"onUpdate:modelValue":t[3]||(t[3]=a=>l.parameters[5].value=a),density:"compact",variant:"underlined",items:l.parameters[5].choices,label:n.$gettext(l.parameters[5].name),hint:l.showHint?n.$gettext(l.parameters[5].hint):"","persistent-hint":l.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),s(ae,{modelValue:l.parameters[6].value,"onUpdate:modelValue":t[4]||(t[4]=a=>l.parameters[6].value=a),density:"compact",items:l.parameters[6].choices,label:n.$gettext(l.parameters[6].name),hint:l.showHint?n.$gettext(l.parameters[6].hint):"","persistent-hint":l.showHint,required:"",variant:"solo"},{selection:o(({item:a})=>[k("div",Ht,[(r(!0),L(_,null,z(i.getColor(a.value),(m,h)=>(r(),L("span",{key:h,class:"grad-step-small",style:be({backgroundColor:m})},null,4))),128)),k("span",_t,f(a.value),1)])]),item:o(({props:a,item:m})=>[k("div",q({class:"gradient"},a),[(r(!0),L(_,null,z(i.getColor(m.value),(h,P)=>(r(),L("span",{key:P,class:"grad-step",style:be({backgroundColor:h})},null,4))),128)),k("span",zt,f(m.value),1)],16)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),s(st,{modelValue:l.parameters[14].value,"onUpdate:modelValue":t[5]||(t[5]=a=>l.parameters[14].value=a),step:"5",density:"compact",color:"primary",label:n.$gettext(l.parameters[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),s(nt,{modelValue:l.parameters[4].value,"onUpdate:modelValue":t[6]||(t[6]=a=>l.parameters[4].value=a),class:"align-center",color:"primary",label:n.$gettext(l.parameters[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":o(({modelValue:a})=>[V(f(Math.floor(a)+"%"),1)]),_:1},8,["modelValue","label"]),(r(),C(G,{key:l.parameters[12].name,modelValue:l.parameters[12].value,"onUpdate:modelValue":t[7]||(t[7]=a=>l.parameters[12].value=a),density:"compact",color:"primary",label:n.$gettext(l.parameters[12].name),hint:l.showHint?n.$gettext(l.parameters[12].hint):"","persistent-hint":l.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(r(),C(G,{key:l.parameters[7].name,modelValue:l.parameters[7].value,"onUpdate:modelValue":t[8]||(t[8]=a=>l.parameters[7].value=a),density:"compact",color:"primary",label:n.$gettext(l.parameters[7].name),hint:l.showHint?n.$gettext(l.parameters[7].hint):"","persistent-hint":l.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(r(),C(G,{key:l.parameters[8].name,modelValue:l.parameters[8].value,"onUpdate:modelValue":t[9]||(t[9]=a=>l.parameters[8].value=a),density:"compact",color:"primary",label:n.$gettext(l.parameters[8].name),hint:l.showHint?n.$gettext(l.parameters[7].hint):"","persistent-hint":l.showHint},null,8,["modelValue","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(p.type)?(r(),C(G,{key:l.parameters[13].name,modelValue:l.parameters[13].value,"onUpdate:modelValue":t[10]||(t[10]=a=>l.parameters[13].value=a),density:"compact",color:"primary",label:n.$gettext(l.parameters[13].name),disabled:!["Polygon","extrusion"].includes(p.type),hint:l.showHint?n.$gettext(l.parameters[13].hint):"","persistent-hint":l.showHint},null,8,["modelValue","label","disabled","hint","persistent-hint"])):H("",!0),(r(),C(G,{key:l.parameters[11].name,modelValue:l.parameters[11].value,"onUpdate:modelValue":[t[11]||(t[11]=a=>l.parameters[11].value=a),t[12]||(t[12]=a=>i.toggleFixScale(l.parameters[11].name))],density:"compact",variant:"underlined",color:"primary",label:n.$gettext(l.parameters[11].name),hint:l.showHint?n.$gettext(l.parameters[11].hint):"","persistent-hint":l.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(r(!0),L(_,null,z(l.parameters.slice(9,11),a=>ke((r(),C(Y,{key:a.name,modelValue:a.value,"onUpdate:modelValue":m=>a.value=m,variant:"underlined",type:a.type,label:n.$gettext(a.name),suffix:a.units,hint:l.showHint?n.$gettext(a.hint):"","persistent-hint":l.showHint,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])),[[Ce,l.showFixScale]])),128))]),_:1})]),_:1})]),_:1},512),s(se,null,{default:o(()=>[s(M,{color:"grey",variant:"text",onClick:i.cancel},{default:o(()=>[V(f(n.$gettext("Cancel")),1)]),_:1},8,["onClick"]),s(M,{color:"green-darken-1",variant:"text",onClick:t[13]||(t[13]=a=>i.submit("apply"))},{default:o(()=>[V(f(n.$gettext("Apply")),1)]),_:1}),s(ne),s(M,{color:"grey",variant:"text",onClick:t[14]||(t[14]=a=>i.submit("save"))},{default:o(()=>[s(ge,{size:"small",start:""},{default:o(()=>[V(" fas fa-sliders-h ")]),_:1}),V(" "+f(n.$gettext("save")),1)]),_:1})]),_:1})]),_:1},8,["max-height","onKeydown"])]),_:1},8,["modelValue"])}const Ut=oe(Nt,[["render",It],["__scopeId","data-v-91477368"]]),J=n=>n,Rt={name:"ResultMap",components:{MapResults:gt,ResultsSidePanel:Dt,ResultsSettings:Ut,MapLegend:ut,LayerSelector:mt,StaticLayer:dt},setup(){const n=ot(),t=it(),p=rt(),e=ie(),{visibleLayer:l,NaNLayer:i,type:a,loadLayer:m,displaySettings:h,hasOD:P,ODfeatures:v,matSelectedIndex:N,changeOD:y,isIndexAvailable:w,selectedCategory:D,selectedFilter:S,attributes:U,applySettings:$,changeSelectedFilter:B,filteredCategory:W,updateSelectedFeature:ee,changeSelectedCategory:te,colorScale:re}=ct();function ue(u){B(u),ee()}function de(u){te(u),ee()}const R=x("links");async function c(u){switch(R.value=u,u){case"links":m(n.links,null,null,"headway");break;case"rlinks":m(t.rlinks,null,null,"speed");break;case"nodes":m(n.nodes,null,null,"boardings");break;case"rnodes":m(t.rnodes,null,null,"boardings");break;case"od":m(p.layer,null,null,"name");break;default:const Ve=await e.getOtherFile(u,"geojson"),A=await e.getOtherFile(u,"json");m(Ve,A,null,"");break}}const g=x(null),b=I(()=>e.availableLayers);_e(async()=>{b.value.lenght>0&&(R.value=b.value[0]),await c(R.value)});const Z=I(()=>e.visibleRasters),Re=I(()=>e.styles),E=x(""),ce=x(!1),me=x(!1),K=x(""),ye=x({});async function Te(u){g.value=u.name,b.value.includes(u.layer)?(await c(u.layer),U.value.includes(u==null?void 0:u.selectedFilter)?(B(u.selectedFilter),Object.keys(u).includes("selectedCategory")&&te(u.selectedCategory)):Object.keys(u).includes("selectedFilter")&&e.changeNotification({text:u.selectedFilter+" "+J("filter does not exist. use default one"),autoClose:!0,color:"error"})):e.changeNotification({text:J("Preset Layer does not exist"),autoClose:!0,color:"error"}),$(u.displaySettings),Object.keys(u).includes("selectedIndex")&&w(u.selectedIndex)&&(y(u.selectedIndex),e.changeNotification({}))}function je(u){E.value=u.name,ce.value=!0}function Oe(u){ye.value=u,K.value=g.value,me.value=!0}async function qe(u){if((await u).valid){me.value=!1;const A={name:j.cloneDeep(K.value),layer:j.cloneDeep(R.value),displaySettings:j.cloneDeep(ye.value),selectedFilter:j.cloneDeep(S.value)};D.value.filter(Ze=>W.value.includes(Ze)).length<W.value.length&&(A.selectedCategory=j.cloneDeep(D)),v.value.includes(ye.value.selectedFeature)&&P.value&&(A.selectedIndex=N.value),e.addStyle(A),Z.value.includes(K.value)?e.changeNotification({text:J("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):e.changeNotification({text:J("Preset Saved"),autoClose:!0,color:"success"}),g.value=j.cloneDeep(K.value)}}function Be(){e.deleteStyle(E.value),ce.value=!1,E.value===g.value&&(g.value=null),e.changeNotification({text:J("Preset deleted"),autoClose:!0,color:"success"}),E.value=""}const we=x(!1),xe=x([]);function We(u){u.action==="featureClick"?(xe.value=u.feature,we.value=!0):y(u.feature.index)}return{store:e,selectedLayer:R,selectedPreset:g,availableLayers:b,visibleLayer:l,NaNLayer:i,type:a,displaySettings:h,selectedCategory:D,selectedFilter:S,attributes:U,filteredCategory:W,applySettings:$,colorScale:re,updateSelectedFilter:ue,updateSelectedCategory:de,changeLayer:c,changePreset:Te,showDeleteDialog:ce,presetToDelete:E,clickDeletePreset:je,deletePreset:Be,showPresetDialog:me,inputName:K,clickSavePreset:Oe,createPreset:qe,featureClicked:We,availableStyles:Re,visibleRasters:Z,showDialog:we,formData:xe}}},Tt={class:"map-view"},jt={class:"left-panel"},Ot={style:{display:"flex"}};function qt(n,t,p,e,l,i){const a=F("ResultsSidePanel"),m=F("MapLegend"),h=F("ResultsSettings"),P=F("LayerSelector"),v=F("StaticLayer"),N=F("MapResults");return r(),L("section",Tt,[s(a,{ref:"sidePanel","selected-category":e.selectedCategory,"selected-filter":e.selectedFilter,"layer-choices":e.availableLayers,"selected-layer":e.selectedLayer,"filter-choices":e.attributes,"filtered-cat":e.filteredCategory,"preset-choices":e.availableStyles,"selected-preset":e.selectedPreset,onUpdateSelectedCategory:e.updateSelectedCategory,onUpdateSelectedFilter:e.updateSelectedFilter,onSelectLayer:e.changeLayer,onSelectPreset:e.changePreset,onDeletePreset:e.clickDeletePreset},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset","onUpdateSelectedCategory","onUpdateSelectedFilter","onSelectLayer","onSelectPreset","onDeletePreset"]),k("div",jt,[ke(s(m,{key:"result",order:0,"color-scale":e.colorScale,"display-settings":e.displaySettings},null,8,["color-scale","display-settings"]),[[Ce,e.visibleLayer.features.length>0]])]),e.visibleLayer.features?(r(),C(N,{key:e.type+String(e.displaySettings.extrusion),"layer-type":e.type,extrusion:e.displaySettings.extrusion,links:e.visibleLayer,"nan-links":e.NaNLayer,"selected-feature":e.displaySettings.selectedFeature,opacity:e.displaySettings.opacity,offset:e.displaySettings.offset,onSelectClick:e.featureClicked},{default:o(y=>[k("div",Ot,[s(h,{"display-settings":e.displaySettings,"feature-choices":e.attributes,type:e.type,onSubmit:e.applySettings,onSavePreset:e.clickSavePreset},null,8,["display-settings","feature-choices","type","onSubmit","onSavePreset"]),e.availableStyles.length>0?(r(),C(P,{key:0,choices:e.availableStyles,"available-layers":e.availableLayers},null,8,["choices","available-layers"])):H("",!0)]),(r(!0),L(_,null,z(e.availableStyles,w=>(r(),L("div",{key:w.name},[e.visibleRasters.includes(w.name)&&e.availableLayers.includes(w.layer)?(r(),C(v,{key:0,preset:w,map:y.map,order:e.visibleRasters.indexOf(w.name)+1},null,8,["preset","map","order"])):H("",!0)]))),128))]),_:1},8,["layer-type","extrusion","links","nan-links","selected-feature","opacity","offset","onSelectClick"])):H("",!0),s(pe,{modelValue:e.showDialog,"onUpdate:modelValue":t[1]||(t[1]=y=>e.showDialog=y),scrollable:"",persistent:"","max-width":"300",onKeydown:[t[2]||(t[2]=T(y=>e.showDialog=!1,["enter"])),t[3]||(t[3]=T(y=>e.showDialog=!1,["esc"]))]},{default:o(()=>[s(X,{"max-height":"60rem"},{default:o(()=>[s(ve,{class:"text-h5"},{default:o(()=>[V(f(n.$gettext("link Properties")),1)]),_:1}),s(Ne),s(Fe,null,{default:o(()=>[s(Se,null,{default:o(()=>[(r(!0),L(_,null,z(e.formData,(y,w)=>(r(),C(Y,{key:w,"model-value":y,label:w,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),s(Ne),s(se,null,{default:o(()=>[s(ne),s(M,{color:"success",variant:"text",onClick:t[0]||(t[0]=y=>e.showDialog=!1)},{default:o(()=>[V(f(n.$gettext("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(pe,{modelValue:e.showPresetDialog,"onUpdate:modelValue":t[6]||(t[6]=y=>e.showPresetDialog=y),persistent:"","max-width":"400",onKeydown:t[7]||(t[7]=T(y=>e.showPresetDialog=!1,["esc"]))},{default:o(()=>[s(X,null,{default:o(()=>[s(ve,{class:"text-h5"},{default:o(()=>[V(f(n.$gettext("Create or modify preset")),1)]),_:1}),s(Ie,{"validate-on":"submit lazy",onSubmit:ze(e.createPreset,["prevent"])},{default:o(()=>[s(Fe,null,{default:o(()=>[s(Ue,null,{default:o(()=>[s(Q,{cols:"12"},{default:o(()=>[s(Y,{modelValue:e.inputName,"onUpdate:modelValue":t[4]||(t[4]=y=>e.inputName=y),autofocus:"",rules:[y=>!!y||"Required."],label:n.$gettext("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),s(se,null,{default:o(()=>[s(ne),s(M,{color:"grey",variant:"text",onClick:t[5]||(t[5]=y=>e.showPresetDialog=!1)},{default:o(()=>[V(f(n.$gettext("Cancel")),1)]),_:1}),s(M,{color:"green-darken-1",variant:"text",type:"submit"},{default:o(()=>[V(f(n.$gettext("ok")),1)]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),s(pe,{modelValue:e.showDeleteDialog,"onUpdate:modelValue":t[9]||(t[9]=y=>e.showDeleteDialog=y),persistent:"","max-width":"400",onKeydown:[t[10]||(t[10]=T(y=>e.showDeleteDialog=!1,["esc"])),T(e.deletePreset,["enter"])]},{default:o(()=>[s(X,null,{default:o(()=>[s(ve,{class:"text-h5"},{default:o(()=>[V(f(n.$gettext("Delete")+" "+e.presetToDelete+" ?"),1)]),_:1}),s(se,null,{default:o(()=>[s(ne),s(M,{color:"grey",variant:"text",onClick:t[8]||(t[8]=y=>e.showDeleteDialog=!1)},{default:o(()=>[V(f(n.$gettext("Cancel")),1)]),_:1}),s(M,{color:"error",variant:"text",onClick:e.deletePreset},{default:o(()=>[V(f(n.$gettext("delete")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const Kt=oe(Rt,[["render",qt],["__scopeId","data-v-019a1f86"]]);export{Kt as default};
