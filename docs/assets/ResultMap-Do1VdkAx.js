import{_ as be,u as xe,t as he,a as Pe,b as Ye,r as b,s as Je,c as J,w as A,o as Qe,d as Xe,e as v,f as P,g as k,h as o,i as t,j as l,M as el,k as ll,l as al,m as ie,n as T,p as tl,q as sl,v as nl,x as ol,y as ze,z as Ie,A as g,B as C,C as h,V as se,D as $e,E as De,F as Ne,G as ne,H as Me,I as Z,J as Y,K as F,L as Be,N as Re,O as ve,P as je,Q as ce,R as de,S as ul,T as il,U as rl,W as ge,X as dl,Y as vl,Z as ee,$ as qe,a0 as oe,a1 as we,a2 as pe,a3 as cl,a4 as pl,a5 as ml,a6 as fl,a7 as re,a8 as fe,a9 as ye,aa as yl,ab as hl,ac as gl,ad as Se,ae as Le,af as bl,ag as _e,ah as Oe,ai as Te,aj as xl,ak as te}from"./index-B7w5Qyi2.js";import{c as We,u as kl,M as Vl,S as Cl}from"./StaticLayer-DPu0eKu9.js";import wl from"./LayerSelector-mRtSyr6a.js";const Sl={__name:"MapResults",props:["selectedFeature","layerType","extrusion","labels","links","nanLinks","opacity","offset","selectedLayer"],emits:["selectClick"],setup(U,{expose:w,emit:s}){const{$gettext:E}=xe(),R=U,{selectedFeature:u,layerType:L,extrusion:M,labels:D,links:x,nanLinks:e,opacity:r,offset:$,selectedLayer:j}=he(R),V=s,H=Pe(),_=Ye(),S=b(!1),i=Je(null),n=b({nodes:14,links:2}),a=J(()=>_.mapStyle);A(a,()=>{i.value&&(i.value.getLayer("arrow")&&i.value.removeLayer("arrow"),i.value.getLayer("links")&&i.value.removeLayer("links"),i.value.getLayer("zones")&&i.value.removeLayer("zones"),i.value.getLayer("nodes")&&i.value.removeLayer("nodes"),S.value=!1,p())}),Qe(()=>{var d;i.value&&p(),(d=i.value)!=null&&d.getLayer("arrow")&&i.value.removeLayer("arrow")});function p(){const d=i.value.getCenter();_.saveMapPosition({mapCenter:[d.lng,d.lat],mapZoom:i.value.getZoom()})}function W(d){i.value&&(S.value=!1),i.value=d.map,B(),i.value.loadImage(ol,function(c,I){if(c){console.error("err image",c);return}i.value.addImage("arrow",I,{sdf:!0})}),M.value&&H.changeNotification({text:E("Right click and drag to tilt the map"),autoClose:!0,color:"success"}),S.value=!0}function B(){const d=new ze.LngLatBounds;["Polygon"].includes(L.value)?x.value.features.forEach(c=>{try{c.geometry.type==="Polygon"?d.extend([c.geometry.coordinates[0][0],c.geometry.coordinates[0][c.geometry.coordinates.length-1]]):d.extend([c.geometry.coordinates[0][0][0],c.geometry.coordinates[0][0][c.geometry.coordinates.length-1]])}catch{}}):x.value.features.forEach(c=>{d.extend([c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])}),Object.keys(d).length!==0&&i.value&&i.value.fitBounds(d,{padding:100})}const{canvasDiv:ke}=Xe(i),N=b([]),Q=b(null);w({update:Ve});function Ve(){var d;S.value&&(i.value.getSource("results").setData(x.value),(d=i.value.getSource("NaNresults"))==null||d.setData(e.value),D.value||i.value.getLayer("labels")&&i.value.removeLayer("labels"))}A(j,()=>B());const me=J(()=>$.value?-1:1);function X(d){var c;if(d.map.getCanvas().style.cursor="pointer",N.value=d.mapboxEvent.features,(c=Q.value)!=null&&c.isOpen()&&Q.value.remove(),u.value&&L.value!=="Polygon"){const I=N.value[0].properties[u.value];I&&(Q.value=new ze.Popup({closeButton:!1}).setLngLat([d.mapboxEvent.lngLat.lng,d.mapboxEvent.lngLat.lat]).setHTML(`${u.value}: <br> ${I}`).addTo(d.map))}}function ue(d){var c;N.value=[],(c=Q.value)!=null&&c.isOpen()&&Q.value.remove(),d.map.getCanvas().style.cursor=""}function z(d){var c;N.value=d.mapboxEvent.features,((c=N.value)==null?void 0:c.length)>0&&V("selectClick",{feature:N.value[0].properties,action:"featureClick"})}function q(d){var c;N.value=d.mapboxEvent.features,((c=N.value)==null?void 0:c.length)>0&&V("selectClick",{feature:N.value[0].properties,action:"zoneClick"})}function K(d){d.map.getCanvas().style.cursor="pointer"}function G(d){d.map.getCanvas().style.cursor=""}return(d,c)=>(v(),P("div",{ref_key:"canvasDiv",ref:ke,class:"map"},[(v(),k(l(nl),{key:a.value,style:{width:"100%"},"access-token":l(_).key,"map-style":a.value,center:l(_).mapCenter,zoom:l(_).mapZoom,onLoad:W},{default:o(()=>[t(l(el),{position:"bottom-right"}),t(l(ll),{position:"bottom-right","visualize-pitch":!0}),al(d.$slots,"default",{map:i.value,mapIsLoaded:S.value},void 0,!0),l(L)=="LineString"?(v(),k(l(ie),{key:0,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(x),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:n.value.links,paint:{"line-color":["get","display_color"],"line-offset":["*",me.value*.5,["to-number",["get","display_width"]]],"line-opacity":l(r)/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:X,onMouseleave:ue,onClick:q,onContextmenu:z},null,8,["source","layer"])):T("",!0),l(L)=="Point"?(v(),k(l(ie),{key:1,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(x),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:n.value.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":l(r)/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:X,onMouseleave:ue,onClick:q,onContextmenu:z},null,8,["source","layer"])):T("",!0),l(L)=="LineString"?(v(),k(l(tl),{key:2,"source-id":"results",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:n.value.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[me.value*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":l(r)/100}}},null,8,["layer"])):T("",!0),l(L)==="Polygon"&&l(M)?(v(),k(l(ie),{key:3,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(x),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":l(r)/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:K,onMouseleave:G,onClick:q,onContextmenu:z},null,8,["source","layer"])):T("",!0),l(L)==="Polygon"&&!l(M)?(v(),k(l(ie),{key:4,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(x),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":l(r)/100}},onMouseenter:K,onMouseleave:G,onClick:q,onContextmenu:z},null,8,["source","layer"])):T("",!0),l(L)==="Polygon"&&!l(M)?(v(),k(l(ie),{key:5,reactive:!1,"source-id":"NaNresults",source:{type:"geojson",data:l(e),promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:K,onMouseleave:G,onClick:q,onContextmenu:z},null,8,["source"])):T("",!0),l(D)!==null?(v(),k(l(sl),{key:6,type:"symbol","source-id":"results",source:"links","layer-id":"labels",layer:{type:"symbol",layout:{"text-field":["get",l(D)],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":d.$vuetify.theme.current.colors.black}}},null,8,["layer"])):T("",!0)]),_:3},8,["access-token","map-style","center","zoom"]))],512))}},Ll=be(Sl,[["__scopeId","data-v-34ed16f6"]]),_l={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},Nl={class:"preset"},Ml={class:"title-div"},Pl={class:"custom-title"},$l={class:"crop"},Dl={class:"layer"},Fl={class:"title-div"},Ul={class:"custom-title"},zl={class:"crop"},Il={style:{"padding-top":"0.5rem"}},Rl={class:"item"},jl={__name:"ResultsSidePanel",props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],emits:["update-selectedCategory","select-layer","select-preset","delete-preset","update-selectedFilter"],setup(U,{emit:w}){const{$gettext:s}=xe(),E=U,R=w,u=Pe(),L=J(()=>u.isMobile),M=J(()=>u.showLeftPanel),D=b(!0),x=b(500);Ie(()=>{x.value=L.value?window.innerWidth-100:350}),A(M,i=>{i?setTimeout(()=>{D.value=!0},500):D.value=!1});const e=b(!1),r=b(!1),{selectedCategory:$,filteredCat:j}=he(E),V=b([]);A($,(i,n)=>{i!==n&&(V.value=i)}),A(V,i=>{i!==$.value&&R("update-selectedCategory",i)});function H(){V.value.length===j.value.length?V.value=[]:V.value=j.value}const{selectedFilter:_}=he(E),S=b("");return A(_,i=>{i!==S.value&&(S.value=i)}),A(S,i=>{i!==_.value&&(R("update-selectedFilter",i),V.value=$.value)}),Ie(()=>{S.value=_.value,V.value=$.value,R("update-selectedFilter",_.value),R("update-selectedCategory",$.value)}),(i,n)=>(v(),P("section",{class:vl(M.value?"left-panel elevation-4":"left-panel-close"),style:ge({width:M.value?x.value+"px":"0px"})},[g("div",{class:"left-panel-toggle-btn elevation-4",onClick:n[0]||(n[0]=a=>l(u).changeLeftPanel())},[t(se,{size:"small",color:"secondarydark"},{default:o(()=>[C(h(M.value?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),t(dl,{name:"fade"},{default:o(()=>[$e(g("div",{class:"left-panel-content",style:ge({width:M.value?x.value+"px":"0px"})},[g("div",null,[g("div",_l,[g("div",Nl,[t(se,{style:{color:"white","padding-right":"2rem","padding-left":"1rem"}},{default:o(()=>n[7]||(n[7]=[C(" fas fa-sliders-h ")])),_:1}),t(Ne,{modelValue:r.value,"onUpdate:modelValue":n[1]||(n[1]=a=>r.value=a),"close-delay":"100",location:"bottom center",transition:"slide-y-transition"},{activator:o(({props:a})=>[g("div",ne({class:"menu-container"},a),[g("div",Ml,[g("span",Pl,h(l(s)("Presets")),1),g("span",$l,h(U.selectedPreset),1)]),t(se,{variant:"text",style:{color:"white"}},{default:o(()=>[C(h(r.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)]),default:o(()=>[t(Me,null,{default:o(()=>[(v(!0),P(Z,null,Y(U.presetChoices,(a,p)=>(v(),k(ve,{key:p,link:"",onClick:()=>i.$emit("select-preset",a)},{append:o(()=>[t(F,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:Be(()=>i.$emit("delete-preset",a),["stop"])},null,8,["onClick"])]),default:o(()=>[t(Re,null,{default:o(()=>[C(h(a.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),t(je,{location:"bottom","open-delay":"300"},{activator:o(({props:a})=>[t(F,ne({variant:"text"},a,{disabled:U.presetChoices.length===0,style:{color:"white"},icon:"fas fa-download",onClick:n[2]||(n[2]=p=>l(u).exportFile("styles.json"))}),null,16,["disabled"])]),default:o(()=>[g("span",null,h(l(s)("Dowload presets")),1)]),_:1})]),g("div",Dl,[t(je,{location:"bottom","open-delay":"500"},{activator:o(({props:a})=>[t(F,ne({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:V.value.length==l(j).length?"fa-eye-slash fa":"fa-eye fa",variant:"text"},a,{onClick:n[3]||(n[3]=p=>H())}),null,16,["icon"])]),default:o(()=>[g("span",null,h(V.value.length==l(j).length?l(s)("Hide All"):l(s)("Show All")),1)]),_:1}),t(Ne,{modelValue:e.value,"onUpdate:modelValue":n[4]||(n[4]=a=>e.value=a),"close-delay":"100",transition:"slide-y-transition"},{activator:o(({props:a})=>[g("div",ne({class:"title-div"},a),[g("div",ne({class:"menu-container"},a),[g("div",Fl,[g("span",Ul,h(l(s)("Layer")),1),g("span",zl,h(U.selectedLayer),1)]),t(se,{variant:"text",style:{color:"white"}},{default:o(()=>[C(h(e.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)],16)]),default:o(()=>[t(Me,null,{default:o(()=>[(v(!0),P(Z,null,Y(U.layerChoices,(a,p)=>(v(),k(ve,{key:p,link:"",onClick:()=>i.$emit("select-layer",a)},{default:o(()=>[t(Re,null,{default:o(()=>[C(h(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),t(se)]),t(ce,{"max-width":"100%","min-width":"100%",height:"calc(100vh - 250px)",class:"mx-auto scrollable"},{default:o(()=>[t(ve,null,{default:o(()=>[g("div",Il,[t(de,{modelValue:S.value,"onUpdate:modelValue":n[5]||(n[5]=a=>S.value=a),items:U.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:l(s)("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),t(ul,{items:l(j),"item-height":45,height:"calc(100vh - 330px)"},{default:o(({item:a})=>[(v(),P("div",{key:S.value.concat(a),class:"container"},[t(il,null,{default:o(()=>[t(rl,{modelValue:V.value,"onUpdate:modelValue":n[6]||(n[6]=p=>V.value=p),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:a},null,8,["modelValue","value"])]),_:2},1024),g("div",Rl,h(a),1)]))]),_:1},8,["items"])]),_:1})])])],4),[[De,D.value]])]),_:1})],6))}},Ol=be(jl,[["__scopeId","data-v-26cce869"]]),Tl={class:"setting"},Wl={class:"gradient-preview"},Bl={class:"preview-title"},ql={class:"gradient"},El={class:"domain-title"},Al={__name:"ResultsSettings",props:["displaySettings","featureChoices","type"],emits:["submit","save-preset"],setup(U,{emit:w}){const{$gettext:s}=xe(),E=U,R=w,{displaySettings:u,featureChoices:L,type:M}=he(E),D=J(()=>{const i=["OrRd","Spectral","RdYlGn","Viridis","YlGn","RdYlBu"],n=Object.keys(We.brewer).slice(0,36).filter(a=>!i.includes(a));return[...i,...n]}),x=b(!1),e=b([{name:s("selectedFeature"),type:"String",value:u.value.selectedFeature,units:"",hint:s("selectedFeature")},{name:s("minWidth"),type:"Number",value:u.value.minWidth,units:"a.u.",hint:s("minWidth")},{name:s("maxWidth"),type:"Number",value:u.value.maxWidth,units:"a.u.",hint:s("maxWidth")},{name:s("numStep"),type:"Number",value:u.value.numStep,units:"int",hint:s("numStep")},{name:s("opacity"),type:"Number",value:u.value.opacity,units:"number",hint:s("opacity")},{name:s("scale"),type:"String",value:u.value.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:s("scale")},{name:s("color map"),type:"String",choices:D,value:u.value.cmap,units:"",hint:s("cmap to use")},{name:s("show NaN"),value:u.value.showNaN,hint:s("Hide NaN on map and color map")},{name:s("reverse color"),value:u.value.reverseColor,hint:s("reverse color scale")},{name:s("scale min"),type:"Number",value:u.value.minVal,units:"a.u.",hint:s("mininum value on the color Map")},{name:s("scale max"),type:"Number",value:u.value.maxVal,units:"a.u.",hint:s("maximum value on the color Map")},{name:s("custom scale"),value:u.value.fixScale,hint:s("customize to inputs values")},{name:s("Left side driving"),value:u.value.offset,hint:s("Select which side of the road the links are display")},{name:s("3D"),value:u.value.extrusion,hint:s("display zones as 3D extrusion")},{name:s("padding"),type:"Number",value:u.value.padding,units:"number",hint:s("range of colors")},{name:s("labels"),type:"String",value:u.value.labels,hint:s("show labels")}]),r=b(!1),$=b(!1);b(!1),A(x,()=>{H(),$.value=e.value[11].value}),A(L,()=>H());function j(){e.value[11].value?($.value=!0,e.value[9].value=u.value.minVal,e.value[10].value=u.value.maxVal):$.value=!1}function V(i){const n=[],a=e.value[8].value;let p=e.value[14].value;p=[p[0]/100,1-p[1]/100],p=a?p.reverse():p;const W=We.scale(i).padding(p).domain([0,100]).classes(25);for(let B=0;B<100;B++)n.push(W(B).hex());return a?n.reverse():n}function H(){e.value[0].value=u.value.selectedFeature,e.value[1].value=u.value.minWidth,e.value[2].value=u.value.maxWidth,e.value[3].value=u.value.numStep,e.value[4].value=u.value.opacity,e.value[5].value=u.value.scale,e.value[6].value=u.value.cmap,e.value[7].value=u.value.showNaN,e.value[8].value=u.value.reverseColor,e.value[9].value=u.value.minVal,e.value[10].value=u.value.maxVal,e.value[11].value=u.value.fixScale,e.value[12].value=u.value.offset,e.value[13].value=u.value.extrusion,e.value[14].value=u.value.padding,e.value[15].value=u.value.labels}function _(i){{const n={selectedFeature:e.value[0].value,minWidth:Number(e.value[1].value),maxWidth:Number(e.value[2].value),numStep:Number(e.value[3].value),opacity:Number(e.value[4].value),scale:e.value[5].value,cmap:e.value[6].value,showNaN:e.value[7].value,reverseColor:e.value[8].value,minVal:Number(e.value[9].value),maxVal:Number(e.value[10].value),fixScale:e.value[11].value,offset:e.value[12].value,extrusion:e.value[13].value,padding:e.value[14].value,labels:e.value[15].value};i==="apply"?R("submit",n):i==="save"&&R("save-preset",n)}}function S(){x.value=!1}return(i,n)=>(v(),k(Ne,{modelValue:x.value,"onUpdate:modelValue":n[17]||(n[17]=a=>x.value=a),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:o(({props:a})=>[g("div",Tl,[t(F,ne({color:l(u).selectedFeature===null?"error":"white"},a,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:o(()=>[t(ce,{width:"20rem",class:"setting-card","max-height":"calc(100vh - 100px)",onKeydown:[n[16]||(n[16]=ee(a=>_("apply"),["enter"])),ee(S,["esc"])]},{default:o(()=>[t(ve,{class:"subtitle"},{append:o(()=>[t(F,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:n[0]||(n[0]=a=>r.value=!r.value)})]),default:o(()=>[C(h(l(s)("Settings"))+" ",1)]),_:1}),t(qe,{ref:"form","validate-on":"lazy"},{default:o(()=>[t(oe,null,{default:o(()=>[t(de,{modelValue:e.value[0].value,"onUpdate:modelValue":n[1]||(n[1]=a=>e.value[0].value=a),variant:"underlined",items:l(L).sort(),label:l(s)(e.value[0].name),hint:r.value?l(s)(e.value[0].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),t(we,null,{default:o(()=>[(v(!0),P(Z,null,Y(e.value.slice(1,3),a=>(v(),k(oe,{key:a.name},{default:o(()=>[t(pe,{modelValue:a.value,"onUpdate:modelValue":p=>a.value=p,variant:"underlined",density:"compact",type:a.type,label:l(s)(a.name),suffix:a.units,hint:r.value?l(s)(a.hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),t(we,null,{default:o(()=>[t(oe,null,{default:o(()=>[t(pe,{modelValue:e.value[3].value,"onUpdate:modelValue":n[2]||(n[2]=a=>e.value[3].value=a),variant:"underlined",density:"compact",type:e.value[3].type,label:l(s)(e.value[3].name),suffix:e.value[3].units,hint:r.value?l(s)(e.value[3].hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),t(oe,null,{default:o(()=>[t(de,{modelValue:e.value[5].value,"onUpdate:modelValue":n[3]||(n[3]=a=>e.value[5].value=a),density:"compact",variant:"underlined",items:e.value[5].choices,label:l(s)(e.value[5].name),hint:r.value?l(s)(e.value[5].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),t(de,{modelValue:e.value[6].value,"onUpdate:modelValue":n[4]||(n[4]=a=>e.value[6].value=a),density:"compact",items:e.value[6].choices,label:l(s)(e.value[6].name),hint:r.value?l(s)(e.value[6].hint):"","persistent-hint":r.value,required:"",variant:"solo"},{selection:o(({item:a})=>[g("div",Wl,[(v(!0),P(Z,null,Y(V(a.value),(p,W)=>(v(),P("span",{key:W,class:"grad-step-small",style:ge({backgroundColor:p})},null,4))),128)),g("span",Bl,h(a.value),1)])]),item:o(({props:a,item:p})=>[t(ve,cl(pl(a)),{title:o(()=>[g("div",ql,[(v(!0),P(Z,null,Y(V(p.value),(W,B)=>(v(),P("span",{key:B,class:"grad-step",style:ge({backgroundColor:W})},null,4))),128)),g("span",El,h(p.value),1)])]),_:2},1040)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),t(ml,{modelValue:e.value[14].value,"onUpdate:modelValue":n[5]||(n[5]=a=>e.value[14].value=a),step:"5",density:"compact",color:"primary",label:l(s)(e.value[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),t(fl,{modelValue:e.value[4].value,"onUpdate:modelValue":n[6]||(n[6]=a=>e.value[4].value=a),class:"align-center",color:"primary",label:l(s)(e.value[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":o(({modelValue:a})=>[C(h(Math.floor(a)+"%"),1)]),_:1},8,["modelValue","label"]),t(de,{modelValue:e.value[15].value,"onUpdate:modelValue":n[7]||(n[7]=a=>e.value[15].value=a),variant:"underlined",items:[null,...l(L).sort()],label:l(s)(e.value[15].name),hint:r.value?l(s)(e.value[15].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),(v(),k(re,{key:e.value[12].name,modelValue:e.value[12].value,"onUpdate:modelValue":n[8]||(n[8]=a=>e.value[12].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(s)(e.value[12].name),hint:r.value?l(s)(e.value[12].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(v(),k(re,{key:e.value[7].name,modelValue:e.value[7].value,"onUpdate:modelValue":n[9]||(n[9]=a=>e.value[7].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(s)(e.value[7].name),hint:r.value?l(s)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(v(),k(re,{key:e.value[8].name,modelValue:e.value[8].value,"onUpdate:modelValue":n[10]||(n[10]=a=>e.value[8].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(s)(e.value[8].name),hint:r.value?l(s)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(l(M))?(v(),k(re,{key:e.value[13].name,modelValue:e.value[13].value,"onUpdate:modelValue":n[11]||(n[11]=a=>e.value[13].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(s)(e.value[13].name),disabled:!["Polygon","extrusion"].includes(l(M)),hint:r.value?l(s)(e.value[13].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","disabled","hint","persistent-hint"])):T("",!0),(v(),k(re,{key:e.value[11].name,modelValue:e.value[11].value,"onUpdate:modelValue":[n[12]||(n[12]=a=>e.value[11].value=a),n[13]||(n[13]=a=>j(e.value[11].name))],density:"compact",variant:"underlined",color:"primary","hide-details":!r.value,label:l(s)(e.value[11].name),hint:r.value?l(s)(e.value[11].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),t(we,null,{default:o(()=>[(v(!0),P(Z,null,Y(e.value.slice(9,11),a=>(v(),k(oe,{key:a.name},{default:o(()=>[$e(t(pe,{modelValue:a.value,"onUpdate:modelValue":p=>a.value=p,variant:"underlined",type:a.type,label:l(s)(a.name),suffix:a.units,hint:r.value?l(s)(a.hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"]),[[De,$.value]])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},512),t(fe,null,{default:o(()=>[t(F,{color:"grey",variant:"text",onClick:S},{default:o(()=>[C(h(l(s)("Cancel")),1)]),_:1}),t(F,{color:"green-darken-1",variant:"text",onClick:n[14]||(n[14]=a=>_("apply"))},{default:o(()=>[C(h(l(s)("Apply")),1)]),_:1}),t(ye),t(F,{color:"grey",variant:"text",onClick:n[15]||(n[15]=a=>_("save"))},{default:o(()=>[t(se,{size:"small",start:""},{default:o(()=>n[18]||(n[18]=[C(" fas fa-sliders-h ")])),_:1}),C(" "+h(l(s)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Hl=be(Al,[["__scopeId","data-v-395d41c8"]]),Kl={class:"map-view"},Gl={class:"legend"},Zl={style:{display:"flex"}},Yl={__name:"ResultMap",setup(U){const{$gettext:w}=xe(),s=yl(),E=hl(),R=gl(),u=Pe(),{visibleLayer:L,NaNLayer:M,type:D,loadLayer:x,displaySettings:e,hasOD:r,ODfeatures:$,matSelectedIndex:j,changeOD:V,isIndexAvailable:H,selectedCategory:_,selectedFilter:S,attributes:i,applySettings:n,changeSelectedFilter:a,filteredCategory:p,updateSelectedFeature:W,changeSelectedCategory:B,colorScale:ke}=kl(),N=b();function Q(f){n(f),Le(()=>N.value.update())}function Ve(f){a(f),W(),Le(()=>N.value.update())}function me(f){B(f),W(),Le(()=>N.value.update())}const X=b("");async function ue(f,m=null){switch(f){case"links":await x(s.links,null,m);break;case"rlinks":await x(E.rlinks,null,m);break;case"nodes":await x(s.nodes,null,m);break;case"rnodes":await x(E.rnodes,null,m);break;case"od":await x(R.layer,null,m);break;default:const y=await u.getOtherFile(f,"geojson"),O=await u.getOtherFile(f,"json");await x(y,O,m);break}X.value=f,N.value.update()}const z=b(null),q=J(()=>u.availableLayers),K=J(()=>u.visibleRasters),G=J(()=>u.styles),d=b(""),c=b(!1),I=b(!1),le=b(""),Ce=b({});async function Ee(f){z.value=f.name,q.value.includes(f.layer)?await ue(f.layer,f):u.changeNotification({text:w("Preset Layer does not exist"),autoClose:!0,color:"error"}),Object.keys(f).includes("selectedIndex")&&H(f.selectedIndex)&&(V(f.selectedIndex),u.changeNotification({})),N.value.update()}function Ae(f){d.value=f.name,c.value=!0}function He(f){Ce.value=f,le.value=z.value,I.value=!0}async function Ke(f){if((await f).valid){I.value=!1;const y={name:te.cloneDeep(le.value),layer:te.cloneDeep(X.value),displaySettings:te.cloneDeep(Ce.value),selectedFilter:te.cloneDeep(S.value)};_.value.filter(Ze=>p.value.includes(Ze)).length<p.value.length&&(y.selectedCategory=te.cloneDeep(_.value)),$.value.includes(Ce.value.selectedFeature)&&r.value&&(y.selectedIndex=j.value),u.addStyle(y),K.value.includes(le.value)?u.changeNotification({text:w("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):u.changeNotification({text:w("Preset Saved"),autoClose:!0,color:"success"}),z.value=te.cloneDeep(le.value)}}function Fe(){u.deleteStyle(d.value),c.value=!1,d.value===z.value&&(z.value=null),u.changeNotification({text:w("Preset deleted"),autoClose:!0,color:"success"}),d.value=""}const ae=b(!1),Ue=b([]);function Ge(f){f.action==="featureClick"?(Ue.value=f.feature,ae.value=!0):(V(f.feature.index),N.value.update())}return(f,m)=>(v(),P("section",Kl,[t(Ol,{"selected-category":l(_),"selected-filter":l(S),"layer-choices":q.value,"selected-layer":X.value,"filter-choices":l(i),"filtered-cat":l(p),"preset-choices":G.value,"selected-preset":z.value,onUpdateSelectedCategory:me,onUpdateSelectedFilter:Ve,onSelectLayer:ue,onSelectPreset:Ee,onDeletePreset:Ae},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset"]),l(L).features?(v(),k(Ll,{ref_key:"mapRef",ref:N,key:l(D)+String(l(e).extrusion),"selected-layer":X.value,"layer-type":l(D),extrusion:l(e).extrusion,labels:l(e).labels,links:l(L),"nan-links":l(M),"selected-feature":l(e).selectedFeature,opacity:l(e).opacity,offset:l(e).offset,onSelectClick:Ge},{default:o(y=>[g("div",Gl,[$e(t(Vl,{key:"result",order:0,"color-scale":l(ke),"display-settings":l(e)},null,8,["color-scale","display-settings"]),[[De,l(L).features.length>0]])]),g("div",Zl,[t(Hl,{"display-settings":l(e),"feature-choices":l(i),type:l(D),onSubmit:Q,onSavePreset:He},null,8,["display-settings","feature-choices","type"]),t(bl),G.value.length>0?(v(),k(wl,{key:0,choices:G.value,map:y.map,"available-layers":q.value},null,8,["choices","map","available-layers"])):T("",!0)]),(v(!0),P(Z,null,Y(G.value,O=>(v(),P("div",{key:O.name},[K.value.includes(O.name)&&q.value.includes(O.layer)?(v(),k(Cl,{key:0,preset:O,map:y.map,order:K.value.indexOf(O.name)+1,"visible-rasters":K.value},null,8,["preset","map","order","visible-rasters"])):T("",!0)]))),128))]),_:1},8,["selected-layer","layer-type","extrusion","labels","links","nan-links","selected-feature","opacity","offset"])):T("",!0),t(Se,{modelValue:ae.value,"onUpdate:modelValue":m[1]||(m[1]=y=>ae.value=y),scrollable:"",persistent:"","max-width":"300",onKeydown:[m[2]||(m[2]=ee(y=>ae.value=!1,["enter"])),m[3]||(m[3]=ee(y=>ae.value=!1,["esc"]))]},{default:o(()=>[t(ce,{"max-height":"60rem"},{default:o(()=>[t(_e,{class:"text-h5"},{default:o(()=>[C(h(l(w)("link Properties")),1)]),_:1}),t(Oe),t(Te,null,{default:o(()=>[t(Me,null,{default:o(()=>[(v(!0),P(Z,null,Y(Ue.value,(y,O)=>(v(),k(pe,{key:O,"model-value":y,label:O,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),t(Oe),t(fe,null,{default:o(()=>[t(ye),t(F,{color:"success",variant:"text",onClick:m[0]||(m[0]=y=>ae.value=!1)},{default:o(()=>[C(h(l(w)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Se,{modelValue:I.value,"onUpdate:modelValue":m[6]||(m[6]=y=>I.value=y),persistent:"","max-width":"400",onKeydown:m[7]||(m[7]=ee(y=>I.value=!1,["esc"]))},{default:o(()=>[t(ce,null,{default:o(()=>[t(_e,{class:"text-h5"},{default:o(()=>[C(h(l(w)("Create or modify preset")),1)]),_:1}),t(qe,{"validate-on":"submit lazy",onSubmit:Be(Ke,["prevent"])},{default:o(()=>[t(Te,null,{default:o(()=>[t(xl,null,{default:o(()=>[t(oe,{cols:"12"},{default:o(()=>[t(pe,{modelValue:le.value,"onUpdate:modelValue":m[4]||(m[4]=y=>le.value=y),autofocus:"",rules:[y=>!!y||"Required."],label:l(w)("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),t(fe,null,{default:o(()=>[t(ye),t(F,{color:"grey",variant:"text",onClick:m[5]||(m[5]=y=>I.value=!1)},{default:o(()=>[C(h(l(w)("Cancel")),1)]),_:1}),t(F,{color:"green-darken-1",variant:"text",type:"submit"},{default:o(()=>[C(h(l(w)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Se,{modelValue:c.value,"onUpdate:modelValue":m[9]||(m[9]=y=>c.value=y),persistent:"","max-width":"400",onKeydown:[m[10]||(m[10]=ee(y=>c.value=!1,["esc"])),ee(Fe,["enter"])]},{default:o(()=>[t(ce,null,{default:o(()=>[t(_e,{class:"text-h5"},{default:o(()=>[C(h(l(w)("Delete")+" "+d.value+" ?"),1)]),_:1}),t(fe,null,{default:o(()=>[t(ye),t(F,{color:"grey",variant:"text",onClick:m[8]||(m[8]=y=>c.value=!1)},{default:o(()=>[C(h(l(w)("Cancel")),1)]),_:1}),t(F,{color:"error",variant:"text",onClick:Fe},{default:o(()=>[C(h(l(w)("delete")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},ea=be(Yl,[["__scopeId","data-v-490a5200"]]);export{ea as default};
