import{_ as ue,u as xe,r as x,s as Ae,e as E,w as T,ag as Ge,ab as Se,Z as P,j as c,J as S,v as o,q as s,aC as Je,K as _,o as Qe,k as L,m as g,F as b,y as h,X as W,$ as we,a0 as Ve,G as be,x as j,C as Ce,L as z,M as H,V as M,O as Re,E as De,D as ne,A as _e,T as Y,H as oe,P as Xe,aD as Ye,W as $e,a3 as et,a4 as tt,S as ke,a7 as Ue,a8 as Te,a9 as X,ap as Ne,I as $,aE as lt,aF as at,aG as J,aa as ie,B as re,a5 as O,h as st,f as nt,Y as ot,ar as he,l as B,a6 as ge,R as Fe,al as ze}from"./index-ViPA4jl_.js";import{c as He,M as it,S as rt,u as ut}from"./StaticLayer-CgB31Vms.js";import{a as Ie}from"./mapbox-gl-Bfip1U4S.js";import{e as dt,d as ct,c as mt,M as pt,a as yt}from"./main-Ds8zas4Z.js";import{a as vt,S as ft}from"./StyleSelector-liAS4Vtx.js";import ht from"./LayerSelector-C0nvrX5T.js";const gt="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",St=n=>n,bt={name:"ResultMap",components:{MglMap:dt,MglNavigationControl:ct,MglScaleControl:mt,MglGeojsonLayer:pt,MglImageLayer:yt},props:["selectedFeature","layerType","extrusion","links","nanLinks","opacity","offset","selectedLayer"],emits:["selectClick"],setup(n,l){const v=xe(),e=x(!1),t=gt,i=Ae(null),a=x({nodes:14,links:2}),u=E(()=>v.mapStyle);T(u,()=>{i.value&&(i.value.getLayer("arrow")&&i.value.removeLayer("arrow"),i.value.getLayer("links")&&i.value.removeLayer("links"),i.value.getLayer("zones")&&i.value.removeLayer("zones"),i.value.getLayer("nodes")&&i.value.removeLayer("nodes"),e.value=!1,C())}),Ge(()=>{var r;i.value&&C(),(r=i.value)!=null&&r.getLayer("arrow")&&i.value.removeLayer("arrow")});function C(){const r=i.value.getCenter();v.saveMapPosition({mapCenter:[r.lng,r.lat],mapZoom:i.value.getZoom()})}function k(r){i.value&&(e.value=!1),i.value=r.map,D(),i.value.loadImage(vt,function(f,F){if(f){console.error("err image",f);return}i.value.addImage("arrow",F,{sdf:!0})}),I.value&&v.changeNotification({text:St("Right click and drag to tilt the map"),autoClose:!0,color:"success"}),e.value=!0}function D(){const r=new Ie.LngLatBounds;["Polygon"].includes(y.value)?R.value.features.forEach(f=>{try{f.geometry.type==="Polygon"?r.extend([f.geometry.coordinates[0][0],f.geometry.coordinates[0][f.geometry.coordinates.length-1]]):r.extend([f.geometry.coordinates[0][0][0],f.geometry.coordinates[0][0][f.geometry.coordinates.length-1]])}catch{}}):R.value.features.forEach(f=>{r.extend([f.geometry.coordinates[0],f.geometry.coordinates[f.geometry.coordinates.length-1]])}),Object.keys(r).length!==0&&i.value.fitBounds(r,{padding:100})}const w=x([]),V=x(null),{selectedFeature:m,layerType:y,extrusion:I,links:R,nanLinks:ee,opacity:te,offset:q,selectedLayer:le}=Se(n);function ae(){var r;e.value&&(i.value.getSource("results").setData(R.value),(r=i.value.getSource("NaNresults"))==null||r.setData(ee.value))}T(le,()=>D());const de=E(()=>q.value?-1:1);function N(r){var f;if(r.map.getCanvas().style.cursor="pointer",w.value=r.mapboxEvent.features,(f=V.value)!=null&&f.isOpen()&&V.value.remove(),m.value&&y.value!=="Polygon"){const F=w.value[0].properties[m.value];F&&(V.value=new Ie.Popup({closeButton:!1}).setLngLat([r.mapboxEvent.lngLat.lng,r.mapboxEvent.lngLat.lat]).setHTML(`${m.value}: <br> ${F}`).addTo(r.map))}}function ce(r){var f;w.value=[],(f=V.value)!=null&&f.isOpen()&&V.value.remove(),r.map.getCanvas().style.cursor=""}function me(r){var f;w.value=r.mapboxEvent.features,((f=w.value)==null?void 0:f.length)>0&&l.emit("selectClick",{feature:w.value[0].properties,action:"featureClick"})}function pe(r){var f;w.value=r.mapboxEvent.features,((f=w.value)==null?void 0:f.length)>0&&l.emit("selectClick",{feature:w.value[0].properties,action:"zoneClick"})}function Z(r){r.map.getCanvas().style.cursor="pointer"}function se(r){r.map.getCanvas().style.cursor=""}return{store:v,update:ae,mapIsLoaded:e,mapboxPublicKey:t,minZoom:a,map:i,mapStyle:u,onMapLoaded:k,layerType:y,extrusion:I,links:R,nanLinks:ee,opacity:te,offset:q,offsetValue:de,enterLink:N,leaveLink:ce,selectClick:me,zoneClick:pe,zoneHover:Z,zoneLeave:se}}};function Ct(n,l,v,e,t,i){const a=P("MglScaleControl"),u=P("MglNavigationControl"),C=P("MglGeojsonLayer"),k=P("MglImageLayer"),D=P("MglMap");return c(),S(D,{key:e.mapStyle,style:{width:"100%"},"access-token":e.mapboxPublicKey,"map-style":e.mapStyle,center:e.store.mapCenter,zoom:e.store.mapZoom,onLoad:e.onMapLoaded},{default:o(()=>[s(a,{position:"bottom-right"}),s(u,{position:"bottom-right","visualize-pitch":!0}),Je(n.$slots,"default",{map:e.map,mapIsLoaded:e.mapIsLoaded}),e.layerType=="LineString"?(c(),S(C,{key:0,"source-id":"results",reactive:!1,source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:e.minZoom.links,paint:{"line-color":["get","display_color"],"line-offset":["*",e.offsetValue*.5,["to-number",["get","display_width"]]],"line-opacity":e.opacity/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:e.enterLink,onMouseleave:e.leaveLink,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):_("",!0),e.layerType=="Point"?(c(),S(C,{key:1,reactive:!1,"source-id":"results",source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:e.minZoom.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":e.opacity/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:e.enterLink,onMouseleave:e.leaveLink,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):_("",!0),e.layerType=="LineString"?(c(),S(k,{key:2,"source-id":"results",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:e.minZoom.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[e.offsetValue*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":e.opacity/100}}},null,8,["layer"])):_("",!0),e.layerType==="Polygon"&&e.extrusion?(c(),S(C,{key:3,"source-id":"results",reactive:!1,source:{type:"geojson",data:e.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":e.opacity/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):_("",!0),e.layerType==="Polygon"&&!e.extrusion?(c(),S(C,{key:4,reactive:!1,"source-id":"results",source:{type:"geojson",data:e.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":e.opacity/100}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):_("",!0),e.layerType==="Polygon"&&!e.extrusion?(c(),S(C,{key:5,reactive:!1,"source-id":"NaNresults",source:{type:"geojson",data:e.nanLinks,promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","onMouseenter","onMouseleave","onClick","onContextmenu"])):_("",!0)]),_:3},8,["access-token","map-style","center","zoom","onLoad"])}const kt=ue(bt,[["render",Ct]]),xt={name:"SidePanel",components:{},props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],emits:["update-selectedCategory","select-layer","select-preset","delete-preset","update-selectedFilter"],setup(n,l){const v=xe(),e=E(()=>v.showLeftPanel),t=x(!0);T(e,y=>{y?setTimeout(()=>{t.value=!0},500):t.value=!1});const i=x(!1),a=x(!1),{selectedCategory:u,filteredCat:C}=Se(n),k=x([]);T(u,(y,I)=>{y!==I&&(k.value=y)}),T(k,y=>{y!==u.value&&l.emit("update-selectedCategory",y)});function D(y){k.value=y.selectedCategory}function w(){k.value.length===C.value.length?k.value=[]:k.value=C.value}const{selectedFilter:V}=Se(n),m=x("");return T(V,y=>{y!==m.value&&(m.value=y)}),T(m,y=>{y!==V.value&&(l.emit("update-selectedFilter",y),k.value=u.value)}),Qe(()=>{m.value=V.value,k.value=u.value,l.emit("update-selectedFilter",V.value),l.emit("update-selectedCategory",u.value)}),{store:v,showLeftPanel:e,showLeftPanelContent:t,openMenu:i,presetsMenu:a,selectedCat:k,vmodelSelectedFilter:m,init:D,showAll:w}}},wt={class:"left-panel-content"},Vt={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},Lt={class:"preset"},Mt={class:"title-div"},Pt={class:"custom-title"},Dt={class:"crop"},_t={class:"layer"},Nt={class:"title-div"},Ft={class:"custom-title"},zt={class:"crop"},Ht={style:{"padding-top":"0.5rem"}},It={class:"item"};function Rt(n,l,v,e,t,i){return c(),L("section",{class:tt(e.showLeftPanel?"left-panel elevation-4":"left-panel-close"),style:ke({width:e.showLeftPanel?"350px":"0px"})},[g("div",{class:"left-panel-toggle-btn elevation-4",onClick:l[0]||(l[0]=a=>e.store.changeLeftPanel())},[s(W,{size:"small",color:"secondarydark"},{default:o(()=>[b(h(e.showLeftPanel?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),s(et,{name:"fade"},{default:o(()=>[we(g("div",wt,[g("div",null,[g("div",Vt,[g("div",Lt,[s(W,{style:{color:"white","padding-right":"2rem","padding-left":"1rem"}},{default:o(()=>[b(" fas fa-sliders-h ")]),_:1}),s(be,{modelValue:e.presetsMenu,"onUpdate:modelValue":l[1]||(l[1]=a=>e.presetsMenu=a),"close-delay":"100",location:"bottom center",transition:"slide-y-transition"},{activator:o(({props:a})=>[g("div",j({class:"menu-container"},a),[g("div",Mt,[g("span",Pt,h(n.$gettext("Presets")),1),g("span",Dt,h(v.selectedPreset),1)]),s(W,{variant:"text",style:{color:"white"}},{default:o(()=>[b(h(e.presetsMenu?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)]),default:o(()=>[s(Ce,null,{default:o(()=>[(c(!0),L(z,null,H(v.presetChoices,(a,u)=>(c(),S(ne,{key:u,link:"",onClick:()=>n.$emit("select-preset",a)},{append:o(()=>[s(M,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:Re(()=>n.$emit("delete-preset",a),["stop"])},null,8,["onClick"])]),default:o(()=>[s(De,null,{default:o(()=>[b(h(a.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(_e,{location:"bottom","open-delay":"300"},{activator:o(({props:a})=>[s(M,j({variant:"text"},a,{disabled:v.presetChoices.length===0,style:{color:"white"},icon:"fas fa-download",onClick:l[2]||(l[2]=u=>e.store.exportFile("styles.json"))}),null,16,["disabled"])]),default:o(()=>[g("span",null,h(n.$gettext("Dowload presets")),1)]),_:1})]),g("div",_t,[s(_e,{location:"bottom","open-delay":"500"},{activator:o(({props:a})=>[s(M,j({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:e.selectedCat.length==v.filteredCat.length?"fa-eye-slash fa":"fa-eye fa",variant:"text"},a,{onClick:l[3]||(l[3]=u=>e.showAll())}),null,16,["icon"])]),default:o(()=>[g("span",null,h(e.selectedCat.length==v.filteredCat.length?n.$gettext("Hide All"):n.$gettext("Show All")),1)]),_:1}),s(be,{modelValue:e.openMenu,"onUpdate:modelValue":l[4]||(l[4]=a=>e.openMenu=a),"close-delay":"100",transition:"slide-y-transition"},{activator:o(({props:a})=>[g("div",j({class:"title-div"},a),[g("div",j({class:"menu-container"},a),[g("div",Nt,[g("span",Ft,h(n.$gettext("Layer")),1),g("span",zt,h(v.selectedLayer),1)]),s(W,{variant:"text",style:{color:"white"}},{default:o(()=>[b(h(e.openMenu?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)],16)]),default:o(()=>[s(Ce,null,{default:o(()=>[(c(!0),L(z,null,H(v.layerChoices,(a,u)=>(c(),S(ne,{key:u,link:"",onClick:()=>n.$emit("select-layer",a)},{default:o(()=>[s(De,null,{default:o(()=>[b(h(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(W)]),s(Y,{"max-width":"100%","min-width":"100%",height:"calc(100vh - 250px)",class:"mx-auto scrollable"},{default:o(()=>[s(ne,null,{default:o(()=>[g("div",Ht,[s(oe,{modelValue:e.vmodelSelectedFilter,"onUpdate:modelValue":l[5]||(l[5]=a=>e.vmodelSelectedFilter=a),items:v.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:n.$gettext("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),s(Xe,{items:v.filteredCat,"item-height":45,height:"calc(100vh - 330px)"},{default:o(({item:a})=>[(c(),L("div",{key:e.vmodelSelectedFilter.concat(a),class:"container"},[s(Ye,null,{default:o(()=>[s($e,{modelValue:e.selectedCat,"onUpdate:modelValue":l[6]||(l[6]=u=>e.selectedCat=u),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:a},null,8,["modelValue","value"])]),_:2},1024),g("div",It,h(a),1)]))]),_:1},8,["items"])]),_:1})])])],512),[[Ve,e.showLeftPanelContent]])]),_:1})],6)}const Ut=ue(xt,[["render",Rt],["__scopeId","data-v-d4451114"]]),p=n=>n,Tt={name:"ResultsSettings",props:["displaySettings","featureChoices","type"],emits:["submit","save-preset"],setup(){},data(){return{showDialog:!1,parameters:[{name:p("selectedFeature"),type:"String",value:this.displaySettings.selectedFeature,units:"",hint:p("selectedFeature")},{name:p("minWidth"),type:"Number",value:this.displaySettings.minWidth,units:"a.u.",hint:p("minWidth")},{name:p("maxWidth"),type:"Number",value:this.displaySettings.maxWidth,units:"a.u.",hint:p("maxWidth")},{name:p("numStep"),type:"Number",value:this.displaySettings.numStep,units:"int",hint:p("numStep")},{name:p("opacity"),type:"Number",value:this.displaySettings.opacity,units:"number",hint:p("opacity")},{name:p("scale"),type:"String",value:this.displaySettings.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:p("scale")},{name:p("color map"),type:"String",choices:Object.keys(He.brewer).slice(0,36),value:this.displaySettings.cmap,units:"",hint:p("cmap to use")},{name:p("show NaN"),value:this.displaySettings.showNaN,hint:p("Hide NaN on map and color map")},{name:p("reverse color"),value:this.displaySettings.reverseColor,hint:p("reverse color scale")},{name:p("scale min"),type:"Number",value:this.displaySettings.minVal,units:"a.u.",hint:p("mininum value on the color Map")},{name:p("scale max"),type:"Number",value:this.displaySettings.maxVal,units:"a.u.",hint:p("maximum value on the color Map")},{name:p("custom scale"),value:this.displaySettings.fixScale,hint:p("customize to inputs values")},{name:p("Left side driving"),value:this.displaySettings.offset,hint:p("Select which side of the road the links are display")},{name:p("3D"),value:this.displaySettings.extrusion,hint:p("display zones as 3D extrusion")},{name:p("padding"),type:"Number",value:this.displaySettings.padding,units:"number",hint:p("range of colors")}],showHint:!1,showFixScale:!1,shake:!1,rules:{required:n=>!!n||p("Required"),largerThanZero:n=>n>0||p("should be larger than 0"),nonNegative:n=>n>=0||p("should be larger or equal to 0")}}},watch:{showDialog(){this.refresh(),this.showFixScale=this.parameters[11].value},featureChoices(){this.refresh()}},methods:{toggleFixScale(){this.parameters[11].value?(this.showFixScale=!0,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal):this.showFixScale=!1},getColor(n){const l=[],v=this.parameters[8].value;let e=this.parameters[14].value;e=[e[0]/100,1-e[1]/100],e=v?e.reverse():e;const t=He.scale(n).padding(e).domain([0,100]).classes(25);for(let i=0;i<100;i++)l.push(t(i).hex());return v?l.reverse():l},refresh(){this.parameters[0].value=this.displaySettings.selectedFeature,this.parameters[1].value=this.displaySettings.minWidth,this.parameters[2].value=this.displaySettings.maxWidth,this.parameters[3].value=this.displaySettings.numStep,this.parameters[4].value=this.displaySettings.opacity,this.parameters[5].value=this.displaySettings.scale,this.parameters[6].value=this.displaySettings.cmap,this.parameters[7].value=this.displaySettings.showNaN,this.parameters[8].value=this.displaySettings.reverseColor,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal,this.parameters[11].value=this.displaySettings.fixScale,this.parameters[12].value=this.displaySettings.offset,this.parameters[13].value=this.displaySettings.extrusion,this.parameters[14].value=this.displaySettings.padding},submit(n){if(this.$refs.form.validate()){const l={selectedFeature:this.parameters[0].value,minWidth:Number(this.parameters[1].value),maxWidth:Number(this.parameters[2].value),numStep:Number(this.parameters[3].value),opacity:Number(this.parameters[4].value),scale:this.parameters[5].value,cmap:this.parameters[6].value,showNaN:this.parameters[7].value,reverseColor:this.parameters[8].value,minVal:Number(this.parameters[9].value),maxVal:Number(this.parameters[10].value),fixScale:this.parameters[11].value,offset:this.parameters[12].value,extrusion:this.parameters[13].value,padding:this.parameters[14].value};n==="apply"?this.$emit("submit",l):n==="save"&&this.$emit("save-preset",l)}else this.shake=!0,setTimeout(()=>{this.shake=!1},500)},cancel(){this.showDialog=!1}}},jt={class:"setting"},Ot={class:"gradient"},qt={class:"domain-title-small"},Bt={class:"domain-title"};function Wt(n,l,v,e,t,i){return c(),S(be,{modelValue:t.showDialog,"onUpdate:modelValue":l[16]||(l[16]=a=>t.showDialog=a),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:o(({props:a})=>[g("div",jt,[s(M,j({color:v.displaySettings.selectedFeature===null?"error":"regular"},a,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:o(()=>[s(Y,{width:"20rem",class:"setting-card","max-height":"calc(100vh - 100px)",onKeydown:[l[15]||(l[15]=O(a=>i.submit("apply"),["enter"])),O(i.cancel,["esc"])]},{default:o(()=>[s(ne,{class:"subtitle"},{append:o(()=>[s(M,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:l[0]||(l[0]=a=>t.showHint=!t.showHint)})]),default:o(()=>[b(h(n.$gettext("Settings"))+" ",1)]),_:1}),s(Ue,{ref:"form","lazy-validation":""},{default:o(()=>[s(Te,null,{default:o(()=>[s(X,null,{default:o(()=>[s(oe,{modelValue:t.parameters[0].value,"onUpdate:modelValue":l[1]||(l[1]=a=>t.parameters[0].value=a),variant:"underlined",items:v.featureChoices.sort(),label:n.$gettext(t.parameters[0].name),hint:t.showHint?n.$gettext(t.parameters[0].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),s(Ne,null,{default:o(()=>[(c(!0),L(z,null,H(t.parameters.slice(1,3),a=>(c(),S(X,{key:a.name},{default:o(()=>[s($,{modelValue:a.value,"onUpdate:modelValue":u=>a.value=u,variant:"underlined",density:"compact",type:a.type,label:n.$gettext(a.name),suffix:a.units,hint:t.showHint?n.$gettext(a.hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),s(Ne,null,{default:o(()=>[s(X,null,{default:o(()=>[s($,{modelValue:t.parameters[3].value,"onUpdate:modelValue":l[2]||(l[2]=a=>t.parameters[3].value=a),variant:"underlined",density:"compact",type:t.parameters[3].type,label:n.$gettext(t.parameters[3].name),suffix:t.parameters[3].units,hint:t.showHint?n.$gettext(t.parameters[3].hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),s(X,null,{default:o(()=>[s(oe,{modelValue:t.parameters[5].value,"onUpdate:modelValue":l[3]||(l[3]=a=>t.parameters[5].value=a),density:"compact",variant:"underlined",items:t.parameters[5].choices,label:n.$gettext(t.parameters[5].name),hint:t.showHint?n.$gettext(t.parameters[5].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),s(oe,{modelValue:t.parameters[6].value,"onUpdate:modelValue":l[4]||(l[4]=a=>t.parameters[6].value=a),density:"compact",items:t.parameters[6].choices,label:n.$gettext(t.parameters[6].name),hint:t.showHint?n.$gettext(t.parameters[6].hint):"","persistent-hint":t.showHint,required:"",variant:"solo"},{selection:o(({item:a})=>[g("div",Ot,[(c(!0),L(z,null,H(i.getColor(a.value),(u,C)=>(c(),L("span",{key:C,class:"grad-step-small",style:ke({backgroundColor:u})},null,4))),128)),g("span",qt,h(a.value),1)])]),item:o(({props:a,item:u})=>[g("div",j({class:"gradient"},a),[(c(!0),L(z,null,H(i.getColor(u.value),(C,k)=>(c(),L("span",{key:k,class:"grad-step",style:ke({backgroundColor:C})},null,4))),128)),g("span",Bt,h(u.value),1)],16)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),s(lt,{modelValue:t.parameters[14].value,"onUpdate:modelValue":l[5]||(l[5]=a=>t.parameters[14].value=a),step:"5",density:"compact",color:"primary",label:n.$gettext(t.parameters[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),s(at,{modelValue:t.parameters[4].value,"onUpdate:modelValue":l[6]||(l[6]=a=>t.parameters[4].value=a),class:"align-center",color:"primary",label:n.$gettext(t.parameters[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":o(({modelValue:a})=>[b(h(Math.floor(a)+"%"),1)]),_:1},8,["modelValue","label"]),(c(),S(J,{key:t.parameters[12].name,modelValue:t.parameters[12].value,"onUpdate:modelValue":l[7]||(l[7]=a=>t.parameters[12].value=a),density:"compact",color:"primary",label:n.$gettext(t.parameters[12].name),hint:t.showHint?n.$gettext(t.parameters[12].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(c(),S(J,{key:t.parameters[7].name,modelValue:t.parameters[7].value,"onUpdate:modelValue":l[8]||(l[8]=a=>t.parameters[7].value=a),density:"compact",color:"primary",label:n.$gettext(t.parameters[7].name),hint:t.showHint?n.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(c(),S(J,{key:t.parameters[8].name,modelValue:t.parameters[8].value,"onUpdate:modelValue":l[9]||(l[9]=a=>t.parameters[8].value=a),density:"compact",color:"primary",label:n.$gettext(t.parameters[8].name),hint:t.showHint?n.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(v.type)?(c(),S(J,{key:t.parameters[13].name,modelValue:t.parameters[13].value,"onUpdate:modelValue":l[10]||(l[10]=a=>t.parameters[13].value=a),density:"compact",color:"primary",label:n.$gettext(t.parameters[13].name),disabled:!["Polygon","extrusion"].includes(v.type),hint:t.showHint?n.$gettext(t.parameters[13].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","disabled","hint","persistent-hint"])):_("",!0),(c(),S(J,{key:t.parameters[11].name,modelValue:t.parameters[11].value,"onUpdate:modelValue":[l[11]||(l[11]=a=>t.parameters[11].value=a),l[12]||(l[12]=a=>i.toggleFixScale(t.parameters[11].name))],density:"compact",variant:"underlined",color:"primary",label:n.$gettext(t.parameters[11].name),hint:t.showHint?n.$gettext(t.parameters[11].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(c(!0),L(z,null,H(t.parameters.slice(9,11),a=>we((c(),S($,{key:a.name,modelValue:a.value,"onUpdate:modelValue":u=>a.value=u,variant:"underlined",type:a.type,label:n.$gettext(a.name),suffix:a.units,hint:t.showHint?n.$gettext(a.hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])),[[Ve,t.showFixScale]])),128))]),_:1})]),_:1})]),_:1},512),s(ie,null,{default:o(()=>[s(M,{color:"grey",variant:"text",onClick:i.cancel},{default:o(()=>[b(h(n.$gettext("Cancel")),1)]),_:1},8,["onClick"]),s(M,{color:"green-darken-1",variant:"text",onClick:l[13]||(l[13]=a=>i.submit("apply"))},{default:o(()=>[b(h(n.$gettext("Apply")),1)]),_:1}),s(re),s(M,{color:"grey",variant:"text",onClick:l[14]||(l[14]=a=>i.submit("save"))},{default:o(()=>[s(W,{size:"small",start:""},{default:o(()=>[b(" fas fa-sliders-h ")]),_:1}),b(" "+h(n.$gettext("save")),1)]),_:1})]),_:1})]),_:1},8,["onKeydown"])]),_:1},8,["modelValue"])}const Et=ue(Tt,[["render",Wt],["__scopeId","data-v-d36fb5f8"]]),Q=n=>n,Zt={name:"ResultMap",components:{MapResults:kt,ResultsSidePanel:Ut,ResultsSettings:Et,MapLegend:it,LayerSelector:ht,StyleSelector:ft,StaticLayer:rt},setup(){const n=st(),l=nt(),v=ot(),e=xe(),{visibleLayer:t,NaNLayer:i,type:a,loadLayer:u,displaySettings:C,hasOD:k,ODfeatures:D,matSelectedIndex:w,changeOD:V,isIndexAvailable:m,selectedCategory:y,selectedFilter:I,attributes:R,applySettings:ee,changeSelectedFilter:te,filteredCategory:q,updateSelectedFeature:le,changeSelectedCategory:ae,colorScale:de}=ut(),N=x();function ce(d){ee(d),N.value.update()}function me(d){te(d),le(),N.value.update()}function pe(d){ae(d),le(),N.value.update()}const Z=x("");async function se(d,U=null){switch(Z.value=d,d){case"links":await u(n.links,null,U);break;case"rlinks":await u(l.rlinks,null,U);break;case"nodes":await u(n.nodes,null,U);break;case"rnodes":await u(l.rnodes,null,U);break;case"od":await u(v.layer,null,U);break;default:const G=await e.getOtherFile(d,"geojson"),Pe=await e.getOtherFile(d,"json");await u(G,Pe,U);break}N.value.update()}const r=x(null),f=E(()=>e.availableLayers),F=E(()=>e.visibleRasters),je=E(()=>e.styles),K=x(""),ye=x(!1),ve=x(!1),A=x(""),fe=x({});async function Oe(d){r.value=d.name,f.value.includes(d.layer)?(await se(d.layer,d.displaySettings),R.value.includes(d==null?void 0:d.selectedFilter)?(te(d.selectedFilter),Object.keys(d).includes("selectedCategory")&&ae(d.selectedCategory)):Object.keys(d).includes("selectedFilter")&&e.changeNotification({text:d.selectedFilter+" "+Q("filter does not exist. use default one"),autoClose:!0,color:"error"})):e.changeNotification({text:Q("Preset Layer does not exist"),autoClose:!0,color:"error"}),Object.keys(d).includes("selectedIndex")&&m(d.selectedIndex)&&(V(d.selectedIndex),e.changeNotification({})),N.value.update()}function qe(d){K.value=d.name,ye.value=!0}function Be(d){fe.value=d,A.value=r.value,ve.value=!0}async function We(d){if((await d).valid){ve.value=!1;const G={name:B.cloneDeep(A.value),layer:B.cloneDeep(Z.value),displaySettings:B.cloneDeep(fe.value),selectedFilter:B.cloneDeep(I.value)};y.value.filter(Ke=>q.value.includes(Ke)).length<q.value.length&&(G.selectedCategory=B.cloneDeep(y.value)),D.value.includes(fe.value.selectedFeature)&&k.value&&(G.selectedIndex=w.value),e.addStyle(G),F.value.includes(A.value)?e.changeNotification({text:Q("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):e.changeNotification({text:Q("Preset Saved"),autoClose:!0,color:"success"}),r.value=B.cloneDeep(A.value)}}function Ee(){e.deleteStyle(K.value),ye.value=!1,K.value===r.value&&(r.value=null),e.changeNotification({text:Q("Preset deleted"),autoClose:!0,color:"success"}),K.value=""}const Le=x(!1),Me=x([]);function Ze(d){d.action==="featureClick"?(Me.value=d.feature,Le.value=!0):(V(d.feature.index),N.value.update())}return{store:e,mapRef:N,selectedLayer:Z,selectedPreset:r,availableLayers:f,visibleLayer:t,NaNLayer:i,type:a,displaySettings:C,selectedCategory:y,selectedFilter:I,attributes:R,filteredCategory:q,colorScale:de,updateSettings:ce,updateSelectedFilter:me,updateSelectedCategory:pe,changeLayer:se,changePreset:Oe,showDeleteDialog:ye,presetToDelete:K,clickDeletePreset:qe,deletePreset:Ee,showPresetDialog:ve,inputName:A,clickSavePreset:Be,createPreset:We,featureClicked:Ze,availableStyles:je,visibleRasters:F,showDialog:Le,formData:Me}}},Kt={class:"map-view"},At={class:"left-panel"},Gt={style:{display:"flex"}};function Jt(n,l,v,e,t,i){const a=P("ResultsSidePanel"),u=P("MapLegend"),C=P("ResultsSettings"),k=P("StyleSelector"),D=P("LayerSelector"),w=P("StaticLayer"),V=P("MapResults");return c(),L("section",Kt,[s(a,{ref:"sidePanel","selected-category":e.selectedCategory,"selected-filter":e.selectedFilter,"layer-choices":e.availableLayers,"selected-layer":e.selectedLayer,"filter-choices":e.attributes,"filtered-cat":e.filteredCategory,"preset-choices":e.availableStyles,"selected-preset":e.selectedPreset,onUpdateSelectedCategory:e.updateSelectedCategory,onUpdateSelectedFilter:e.updateSelectedFilter,onSelectLayer:e.changeLayer,onSelectPreset:e.changePreset,onDeletePreset:e.clickDeletePreset},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset","onUpdateSelectedCategory","onUpdateSelectedFilter","onSelectLayer","onSelectPreset","onDeletePreset"]),g("div",At,[we(s(u,{key:"result",order:0,"color-scale":e.colorScale,"display-settings":e.displaySettings},null,8,["color-scale","display-settings"]),[[Ve,e.visibleLayer.features.length>0]])]),e.visibleLayer.features?(c(),S(V,{ref:"mapRef",key:e.type+String(e.displaySettings.extrusion),"selected-layer":e.selectedLayer,"layer-type":e.type,extrusion:e.displaySettings.extrusion,links:e.visibleLayer,"nan-links":e.NaNLayer,"selected-feature":e.displaySettings.selectedFeature,opacity:e.displaySettings.opacity,offset:e.displaySettings.offset,onSelectClick:e.featureClicked},{default:o(m=>[g("div",Gt,[s(C,{"display-settings":e.displaySettings,"feature-choices":e.attributes,type:e.type,onSubmit:e.updateSettings,onSavePreset:e.clickSavePreset},null,8,["display-settings","feature-choices","type","onSubmit","onSavePreset"]),s(k),e.availableStyles.length>0?(c(),S(D,{key:0,choices:e.availableStyles,map:m.map,"available-layers":e.availableLayers},null,8,["choices","map","available-layers"])):_("",!0)]),(c(!0),L(z,null,H(e.availableStyles,y=>(c(),L("div",{key:y.name},[e.visibleRasters.includes(y.name)&&e.availableLayers.includes(y.layer)?(c(),S(w,{key:0,preset:y,map:m.map,order:e.visibleRasters.indexOf(y.name)+1,"visible-rasters":e.visibleRasters},null,8,["preset","map","order","visible-rasters"])):_("",!0)]))),128))]),_:1},8,["selected-layer","layer-type","extrusion","links","nan-links","selected-feature","opacity","offset","onSelectClick"])):_("",!0),s(he,{modelValue:e.showDialog,"onUpdate:modelValue":l[1]||(l[1]=m=>e.showDialog=m),scrollable:"",persistent:"","max-width":"300",onKeydown:[l[2]||(l[2]=O(m=>e.showDialog=!1,["enter"])),l[3]||(l[3]=O(m=>e.showDialog=!1,["esc"]))]},{default:o(()=>[s(Y,{"max-height":"60rem"},{default:o(()=>[s(ge,{class:"text-h5"},{default:o(()=>[b(h(n.$gettext("link Properties")),1)]),_:1}),s(Fe),s(ze,null,{default:o(()=>[s(Ce,null,{default:o(()=>[(c(!0),L(z,null,H(e.formData,(m,y)=>(c(),S($,{key:y,"model-value":m,label:y,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),s(Fe),s(ie,null,{default:o(()=>[s(re),s(M,{color:"success",variant:"text",onClick:l[0]||(l[0]=m=>e.showDialog=!1)},{default:o(()=>[b(h(n.$gettext("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(he,{modelValue:e.showPresetDialog,"onUpdate:modelValue":l[6]||(l[6]=m=>e.showPresetDialog=m),persistent:"","max-width":"400",onKeydown:l[7]||(l[7]=O(m=>e.showPresetDialog=!1,["esc"]))},{default:o(()=>[s(Y,null,{default:o(()=>[s(ge,{class:"text-h5"},{default:o(()=>[b(h(n.$gettext("Create or modify preset")),1)]),_:1}),s(Ue,{"validate-on":"submit lazy",onSubmit:Re(e.createPreset,["prevent"])},{default:o(()=>[s(ze,null,{default:o(()=>[s(Te,null,{default:o(()=>[s(X,{cols:"12"},{default:o(()=>[s($,{modelValue:e.inputName,"onUpdate:modelValue":l[4]||(l[4]=m=>e.inputName=m),autofocus:"",rules:[m=>!!m||"Required."],label:n.$gettext("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),s(ie,null,{default:o(()=>[s(re),s(M,{color:"grey",variant:"text",onClick:l[5]||(l[5]=m=>e.showPresetDialog=!1)},{default:o(()=>[b(h(n.$gettext("Cancel")),1)]),_:1}),s(M,{color:"green-darken-1",variant:"text",type:"submit"},{default:o(()=>[b(h(n.$gettext("ok")),1)]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),s(he,{modelValue:e.showDeleteDialog,"onUpdate:modelValue":l[9]||(l[9]=m=>e.showDeleteDialog=m),persistent:"","max-width":"400",onKeydown:[l[10]||(l[10]=O(m=>e.showDeleteDialog=!1,["esc"])),O(e.deletePreset,["enter"])]},{default:o(()=>[s(Y,null,{default:o(()=>[s(ge,{class:"text-h5"},{default:o(()=>[b(h(n.$gettext("Delete")+" "+e.presetToDelete+" ?"),1)]),_:1}),s(ie,null,{default:o(()=>[s(re),s(M,{color:"grey",variant:"text",onClick:l[8]||(l[8]=m=>e.showDeleteDialog=!1)},{default:o(()=>[b(h(n.$gettext("Cancel")),1)]),_:1}),s(M,{color:"error",variant:"text",onClick:e.deletePreset},{default:o(()=>[b(h(n.$gettext("delete")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const ll=ue(Zt,[["render",Jt],["__scopeId","data-v-cd1302ab"]]);export{ll as default};
