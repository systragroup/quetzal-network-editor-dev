import{_ as z,ae as H,af as D,ag as N,e as f,r as P,p as J,g as s,h as y,i as a,j as l,ab as X,x as v,y as d,ah as r,ad as ae,l as $,v as L,U as te,ai as le,q as b,F as E,E as R,aj as ne,ak as se,al as oe,a1 as K,Z as ue,N as M,a2 as re,G as T,a3 as ie,V as q,L as O,t as de,z as Q,C as ce,A as W,D as pe,J as j,B as ve,a9 as fe,u as ge,w as G,Y as me,X as Y,am as ye,an as he,ao as Ve,ap as B,aq as Z}from"./index-D1V_KQmZ.js";const _e={class:"expansion"},xe={__name:"ParamForm",setup(A){const{$gettext:o}=H(),_=D(),t=N(),w=f(()=>_.selectedStepFunction),U=f(()=>_.parameters),g=f(()=>U.value.filter(c=>Object.keys(c).includes("category")&&c.model===w.value)),k=f(()=>{var c;return(c=U.value.filter(u=>((u==null?void 0:u.info)&&(u==null?void 0:u.model))===w.value)[0])==null?void 0:c.info}),m=P([]);J(()=>{m.value=[...Array(g.value.length).keys()].map((c,u)=>u)});const h=f(()=>t.scenariosList),C=f(()=>t.scenario);function x(){_.getParameters()}function I(){m.value.length<g.value.length?m.value=[...Array(g.value.length).keys()].map((c,u)=>u):m.value=[]}const V=P(!1),S={required:c=>c!=null||o("Required"),largerThanZero:c=>c>0||o("should be larger than 0"),nonNegative:c=>c>=0||o("should be larger or equal to 0")};function F(c){const u=h.value.map(n=>n.scenario);c.value=c.value.filter(n=>u.includes(n))}return(c,u)=>(s(),y(O,{class:"card"},{default:a(()=>[l(X,{class:"subtitle"},{default:a(()=>[v(d(r(o)("Scenario Settings")),1)]),_:1}),k.value?(s(),y(ae,{key:0,class:"info-div"},{default:a(()=>[v(d(k.value),1)]),_:1})):$("",!0),L("div",_e,[l(te,{ref:"form","lazy-validation":""},{default:a(()=>[l(le,{modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=n=>m.value=n),multiple:""},{default:a(()=>[(s(!0),b(E,null,R(g.value,(n,i)=>(s(),y(ne,{key:i},{default:a(()=>[l(se,{class:"categorie"},{default:a(()=>[v(d(n.category),1)]),_:2},1024),l(oe,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:a(()=>[(s(!0),b(E,null,R(n.params,(e,ee)=>(s(),b("li",{key:ee},[typeof e.items>"u"&&typeof e.value=="boolean"?(s(),y(K,{key:0,modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,color:"primary",label:r(o)(e.text),hint:V.value?r(o)(e.hint):"","persistent-hint":V.value},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint"])):typeof e.items>"u"?(s(),y(ue,{key:1,modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,variant:"underlined",type:e.type,label:r(o)(e.text),suffix:e.units,hint:V.value?r(o)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(p=>S[p])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):e.items==="$scenarios"?(s(),y(M,{key:2,modelValue:e.value,"onUpdate:modelValue":[p=>e.value=p,p=>F(e)],variant:"underlined",type:e.type,items:h.value.map(p=>p.scenario).filter(p=>p!==C.value),multiple:"",label:r(o)(e.text),suffix:e.units,hint:V.value?r(o)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(p=>S[p])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"])):(s(),y(M,{key:3,modelValue:e.value,"onUpdate:modelValue":p=>e.value=p,variant:"underlined",type:e.type,items:e.items,label:r(o)(e.text),suffix:e.units,hint:V.value?r(o)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(p=>S[p])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),l(re,null,{default:a(()=>[l(T,{color:"grey",variant:"text",onClick:x},{default:a(()=>[v(d(r(o)("back to default")),1)]),_:1}),l(ie),l(T,{variant:"text",onClick:I},{default:a(()=>[v(d(m.value.length!=g.value.length?r(o)("Expand all"):r(o)("Collapse all")),1)]),_:1}),l(T,{icon:"",size:"small",onClick:u[1]||(u[1]=n=>V.value=!V.value)},{default:a(()=>[l(q,null,{default:a(()=>[v("far fa-question-circle small")]),_:1})]),_:1})]),_:1})]),_:1}))}},be=z(xe,[["__scopeId","data-v-f44a874f"]]),Se={style:{"white-space":"pre-line"}},we={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(A){const o=A,{disabled:_}=de(o),t=D(),w=P(!1),U=f(()=>t.hasLogs),g=P([]);async function k(){await t.getLogs(),g.value=t.logs,g.value.sort((h,C)=>String(h.time).localeCompare(String(C.time),void 0,{sensitivity:"base"})),w.value=!0}async function m(){await t.downloadLogs()}return(h,C)=>(s(),b(E,null,[l(ve,{"close-delay":"100",transition:"slide-y-transition"},{activator:a(({props:x})=>[Q(l(T,ce({disabled:r(_),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},x),{default:a(()=>[v(" logs ")]),_:2},1040,["disabled"]),[[W,U.value]])]),default:a(()=>[l(pe,null,{default:a(()=>[l(j,{onClick:k},{prepend:a(()=>[l(q,{icon:"fas fa-eye"})]),default:a(()=>[v(d(h.$gettext("show"))+" ",1)]),_:1}),l(j,{onClick:m},{prepend:a(()=>[l(q,{icon:"fas fa-download"})]),default:a(()=>[v(d(h.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),l(fe,{modelValue:w.value,"onUpdate:modelValue":C[0]||(C[0]=x=>w.value=x),width:"90%"},{default:a(()=>[l(O,{style:{"overflow-y":"auto"}},{default:a(()=>[(s(!0),b(E,null,R(g.value,(x,I)=>(s(),b("div",{key:I,class:"log-container"},[L("h1",null,d(x.name),1),L("h3",null,[L("b",null,d(x.time),1)]),L("span",Se,d(x.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},ke=z(we,[["__scopeId","data-v-c531ebb9"]]),Ce={class:"title-container"},Le={class:"buttons-row ma-2"},Ee={key:4},Ue={__name:"Run",setup(A){const{$gettext:o}=H(),_=ge(),t=D(),w=N(),U=f(()=>t.steps),g=f(()=>{const u=t.availableModels;return t.avalaibleStepFunctions.filter(n=>u.has(n))}),k=P(t.selectedStepFunction),m=f(()=>t.running),h=f(()=>t.currentStep),C=f(()=>t.error),x=f(()=>t.errorMessage),I=f(()=>t.synchronized),V=f(()=>w.protected),S=f(()=>w.model!==null),F=P(t.endSignal);G(F,()=>t.changeEndSignal(F.value)),J(async()=>{S.value&&(await t.getSteps(),await t.GetRunningExecution())}),G(k,async u=>{S.value&&(g.value.includes(u)?(t.setSelectedStepFunction(u),t.getSteps()):(k.value=g.value[0],t.setSelectedStepFunction(g.value[0]),t.getSteps()))});async function c(){if(await t.GetRunningExecution()){_.changeNotification({text:o("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const n=N();t.initExecution(),await _.exportToS3("inputs"),await _.deleteOutputsOnS3(),await _.deleteLogsOnS3(),_.deleteOutputs(),t.startExecution({scenario:n.scenario})}catch(n){t.terminateExecution(),console.log(n),_.changeAlert(n)}}return(u,n)=>(s(),y(me,{class:"background"},{default:a(()=>[l(Y,{order:"1"},{default:a(()=>[l(be)]),_:1}),l(Y,{order:"2"},{default:a(()=>[l(O,{class:"card"},{default:a(()=>[L("div",Ce,[l(X,{class:"subtitle"},{default:a(()=>[v(d(r(o)("Scenario Simulation")),1)]),_:1}),l(ke,{disabled:m.value||!S.value},null,8,["disabled"])]),l(ye,{modelValue:h.value,"onUpdate:modelValue":n[4]||(n[4]=i=>h.value=i),class:"stepper"},{default:a(()=>[g.value.length>1?(s(),y(he,{key:0,modelValue:k.value,"onUpdate:modelValue":n[0]||(n[0]=i=>k.value=i),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:a(()=>[(s(!0),b(E,null,R(g.value,i=>(s(),y(Ve,{key:i,value:i,disabled:m.value||!S.value},{default:a(()=>[v(d(i),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):$("",!0),I.value?$("",!0):(s(),y(B,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:a(()=>[v(d(r(o)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),C.value?(s(),y(B,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[v(d(r(o)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(s(!0),b(E,null,R(Object.keys(x.value),i=>(s(),b("p",{key:i},[L("b",null,d(i)+": ",1),v(d(x.value[i]),1)]))),128))]),_:1})):$("",!0),V.value?(s(),y(B,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[v(d(r(o)("This scenario is protected. You can not run simulation.")),1)]),_:1})):$("",!0),L("div",Le,[l(T,{loading:m.value,disabled:m.value||V.value||!S.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:n[1]||(n[1]=i=>c())},{default:a(()=>[v(d(r(o)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),Q(l(T,{color:"grey",variant:"text",onClick:n[2]||(n[2]=i=>r(t).stopExecution())},{default:a(()=>[v(d(r(o)("Abort")),1)]),_:1},512),[[W,m.value&&h.value!==1]]),l(K,{modelValue:F.value,"onUpdate:modelValue":n[3]||(n[3]=i=>F.value=i),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:a(()=>[L("span",null,d(r(o)("End signal")),1)]),_:1},8,["modelValue"])]),S.value?(s(),b("div",Ee,[(s(!0),b(E,null,R(U.value,(i,e)=>(s(),b("div",{key:e+1},[C.value?(s(),y(Z,{key:1,complete:h.value>e+1,title:i.name,value:e+1,step:e+1},null,8,["complete","title","value","step"])):(s(),y(Z,{key:0,complete:h.value>e+1,color:h.value>=e+1?"primary":"regular",title:i.name,value:e+1,compact:"",step:e+1},null,8,["complete","color","title","value","step"]))]))),128))])):$("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},$e=z(Ue,[["__scopeId","data-v-a1af878e"]]);export{$e as default};
