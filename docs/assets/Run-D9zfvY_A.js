import{_ as M,ae as J,af as j,ag as O,e as f,p as X,r as F,f as le,g as s,h as m,i as t,j as o,ab as Q,x as p,y as r,ah as v,ad as ne,l as E,v as U,U as se,ai as oe,q as y,F as A,E as R,aj as ue,ak as re,al as ie,a1 as W,Z as de,N as ce,z as G,a4 as pe,am as ve,a2 as fe,G as P,a3 as me,V as z,L as K,t as ye,C as ge,A as ee,D as Ve,J as H,B as _e,a9 as be,u as xe,w as B,Y as he,X as Y,an as Se,ao as ke,ap as we,aq as D,ar as Z}from"./index-BpAcyVZP.js";const Ce={class:"expansion"},$e={key:4},Le=["onUpdate:modelValue"],Ue={__name:"ParamForm",setup(q){const{$gettext:u}=J(),g=j(),n=O();function k(a,e){return Array.isArray(a)?a.includes(e):a===e}const T=f(()=>g.selectedStepFunction),c=f(()=>g.parameters.filter(a=>Object.keys(a).includes("category")&&k(a.model,T.value))),h=f(()=>{var e;let a=g.parameters.filter(d=>d==null?void 0:d.info);return a=a.filter(d=>k(d.model,T.value)),(e=a[0])==null?void 0:e.info}),S=f(()=>n.scenariosList),V=f(()=>n.scenario);function b(){for(const a of c.value)for(const e of a.params)if(e.items==="$scenarios"){const d=S.value.map(L=>L.scenario);Array.isArray(e.value)?e.value=e.value.filter(L=>d.includes(L)):e.value=d.includes(e.value)?e.value:""}}X(()=>{b()});function x(a){return a.items==="$scenarios"?S.value.map(e=>e.scenario).filter(e=>e!==V.value):a.items}function I(){g.getParameters()}const w=F([...Array(c.value.length).keys()].map((a,e)=>e));function C(){w.value.length<c.value.length?w.value=[...Array(c.value.length).keys()].map((a,e)=>e):w.value=[]}const $=F(!1),N={required:a=>a!=null||u("Required"),largerThanZero:a=>a>0||u("should be larger than 0"),nonNegative:a=>a>=0||u("should be larger or equal to 0")},_=F(!1);return(a,e)=>{const d=le("v-number-input");return s(),m(K,{class:"card"},{default:t(()=>[o(Q,{class:"subtitle"},{default:t(()=>[p(r(v(u)("Scenario Settings")),1)]),_:1}),h.value?(s(),m(ne,{key:0,class:"info-div"},{default:t(()=>[p(r(h.value),1)]),_:1})):E("",!0),U("div",Ce,[o(se,{ref:"form","lazy-validation":""},{default:t(()=>[o(oe,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=L=>w.value=L),multiple:""},{default:t(()=>[(s(!0),y(A,null,R(c.value,(L,ae)=>(s(),m(ue,{key:ae},{default:t(()=>[o(re,{class:"categorie"},{default:t(()=>[p(r(L.category),1)]),_:2},1024),o(ie,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:t(()=>[(s(!0),y(A,null,R(L.params,(l,te)=>(s(),y("li",{key:te,class:"param-list"},[typeof l.items>"u"&&typeof l.value=="boolean"?(s(),m(W,{key:0,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,color:"primary",density:"compact",class:"pl-2","hide-details":"",label:v(u)(l.text),"persistent-hint":$.value},null,8,["modelValue","onUpdate:modelValue","label","persistent-hint"])):l.type=="Number"?(s(),m(d,{key:1,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,variant:"outlined","control-variant":"stacked",type:l.type,label:v(u)(l.text),suffix:l.units,"hide-details":"",rules:l.rules.map(i=>N[i]),onKeydown:e[0]||(e[0]=i=>console.log(i))},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):typeof l.items>"u"?(s(),m(de,{key:2,modelValue:l.value,"onUpdate:modelValue":i=>l.value=i,variant:"outlined","hide-details":"",type:l.type,label:v(u)(l.text),suffix:l.units,rules:l.rules.map(i=>N[i])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):(s(),m(ce,{key:3,modelValue:l.value,"onUpdate:modelValue":[i=>l.value=i,i=>b(l)],variant:"outlined","hide-details":"",type:l.type,multiple:l==null?void 0:l.multiple,items:x(l),label:v(u)(l.text),suffix:l.units,rules:l.rules.map(i=>N[i])},null,8,["modelValue","onUpdate:modelValue","type","multiple","items","label","suffix","rules"])),$.value?(s(),y("div",$e,[_.value?G((s(),y("textarea",{key:1,"onUpdate:modelValue":i=>l.hint=i,rows:"1",class:"custom-hint edition",onKeydown:e[2]||(e[2]=pe(i=>_.value=!1,["enter"]))},null,40,Le)),[[ve,l.hint]]):(s(),y("div",{key:0,class:"custom-hint",onDblclick:e[1]||(e[1]=i=>_.value=!0)},r(l.hint),33))])):E("",!0)]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),o(fe,null,{default:t(()=>[o(P,{color:"grey",variant:"text",onClick:I},{default:t(()=>[p(r(v(u)("back to default")),1)]),_:1}),o(me),o(P,{variant:"text",onClick:C},{default:t(()=>[p(r(w.value.length!=c.value.length?v(u)("Expand all"):v(u)("Collapse all")),1)]),_:1}),o(P,{icon:"",size:"small",onClick:e[4]||(e[4]=L=>$.value=!$.value)},{default:t(()=>[o(z,null,{default:t(()=>e[5]||(e[5]=[p("far fa-question-circle small")])),_:1})]),_:1})]),_:1})]),_:1})}}},Ee=M(Ue,[["__scopeId","data-v-a7306ba9"]]),Fe={style:{"white-space":"pre-line"}},Ae={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(q){const u=q,{disabled:g}=ye(u),n=j(),k=F(!1),T=f(()=>n.hasLogs),c=F([]);async function h(){await n.getLogs(),c.value=n.logs,c.value.sort((V,b)=>String(V.time).localeCompare(String(b.time),void 0,{sensitivity:"base"})),k.value=!0}async function S(){await n.downloadLogs()}return(V,b)=>(s(),y(A,null,[o(_e,{"close-delay":"100",transition:"slide-y-transition"},{activator:t(({props:x})=>[G(o(P,ge({disabled:v(g),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},x),{default:t(()=>b[1]||(b[1]=[p(" logs ")])),_:2},1040,["disabled"]),[[ee,T.value]])]),default:t(()=>[o(Ve,null,{default:t(()=>[o(H,{onClick:h},{prepend:t(()=>[o(z,{icon:"fas fa-eye"})]),default:t(()=>[p(r(V.$gettext("show"))+" ",1)]),_:1}),o(H,{onClick:S},{prepend:t(()=>[o(z,{icon:"fas fa-download"})]),default:t(()=>[p(r(V.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),o(be,{modelValue:k.value,"onUpdate:modelValue":b[0]||(b[0]=x=>k.value=x),width:"90%"},{default:t(()=>[o(K,{style:{"overflow-y":"auto"}},{default:t(()=>[(s(!0),y(A,null,R(c.value,(x,I)=>(s(),y("div",{key:I,class:"log-container"},[U("h1",null,r(x.name),1),U("h3",null,[U("b",null,r(x.time),1)]),U("span",Fe,r(x.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},Te=M(Ae,[["__scopeId","data-v-c531ebb9"]]),Re={class:"title-container"},Pe={class:"buttons-row ma-2"},Ie={key:4},Ne={__name:"Run",setup(q){const{$gettext:u}=J(),g=xe(),n=j(),k=O(),T=f(()=>n.steps),c=f(()=>{const _=n.availableModels;return n.avalaibleStepFunctions.filter(a=>_.has(a))}),h=F(n.selectedStepFunction),S=f(()=>n.running),V=f(()=>n.currentStep),b=f(()=>n.error),x=f(()=>n.errorMessage),I=f(()=>n.synchronized),w=f(()=>k.protected),C=f(()=>k.model!==null),$=F(n.endSignal);B($,()=>n.changeEndSignal($.value)),X(async()=>{C.value&&(await n.getSteps(),await n.GetRunningExecution())}),B(c,_=>{C.value&&(_.includes(h.value)||(n.setSelectedStepFunction(_[0]),n.getSteps()))},{once:!0}),B(h,async _=>{C.value&&(c.value.includes(_)?(n.setSelectedStepFunction(_),n.getSteps()):(h.value=c.value[0],n.setSelectedStepFunction(c.value[0]),n.getSteps()))});async function N(){if(await n.GetRunningExecution()){g.changeNotification({text:u("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const a=O();n.initExecution(),await g.exportToS3("inputs"),await g.deleteOutputsOnS3(),await g.deleteLogsOnS3(),g.deleteOutputs(),n.startExecution({scenario:a.scenario})}catch(a){n.terminateExecution(),console.log(a),g.changeAlert(a)}}return(_,a)=>(s(),m(he,{class:"background"},{default:t(()=>[o(Y,{order:"1"},{default:t(()=>[o(Ee)]),_:1}),o(Y,{order:"2"},{default:t(()=>[o(K,{class:"card"},{default:t(()=>[U("div",Re,[o(Q,{class:"subtitle"},{default:t(()=>[p(r(v(u)("Scenario Simulation")),1)]),_:1}),o(Te,{disabled:S.value||!C.value},null,8,["disabled"])]),o(Se,{modelValue:V.value,"onUpdate:modelValue":a[4]||(a[4]=e=>V.value=e),class:"stepper"},{default:t(()=>[c.value.length>1?(s(),m(ke,{key:0,modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value=e),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:t(()=>[(s(!0),y(A,null,R(c.value,e=>(s(),m(we,{key:e,value:e,disabled:S.value||!C.value},{default:t(()=>[p(r(e),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):E("",!0),I.value?E("",!0):(s(),m(D,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:t(()=>[p(r(v(u)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),b.value?(s(),m(D,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[p(r(v(u)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(s(!0),y(A,null,R(Object.keys(x.value),e=>(s(),y("p",{key:e},[U("b",null,r(e)+": ",1),p(r(x.value[e]),1)]))),128))]),_:1})):E("",!0),w.value?(s(),m(D,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[p(r(v(u)("This scenario is protected. You can not run simulation.")),1)]),_:1})):E("",!0),U("div",Pe,[o(P,{loading:S.value,disabled:S.value||w.value||!C.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:a[1]||(a[1]=e=>N())},{default:t(()=>[p(r(v(u)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),G(o(P,{color:"grey",variant:"text",onClick:a[2]||(a[2]=e=>v(n).stopExecution())},{default:t(()=>[p(r(v(u)("Abort")),1)]),_:1},512),[[ee,S.value&&V.value!==1]]),o(W,{modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=e=>$.value=e),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:t(()=>[U("span",null,r(v(u)("End signal")),1)]),_:1},8,["modelValue"])]),C.value?(s(),y("div",Ie,[(s(!0),y(A,null,R(T.value,(e,d)=>(s(),y("div",{key:d+1},[b.value?(s(),m(Z,{key:1,complete:V.value>d+1,title:e.name,value:d+1,step:d+1},null,8,["complete","title","value","step"])):(s(),m(Z,{key:0,complete:V.value>d+1,color:V.value>=d+1?"primary":"regular",title:e.name,value:d+1,compact:"",step:d+1},null,8,["complete","color","title","value","step"]))]))),128))])):E("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},Be=M(Ne,[["__scopeId","data-v-bdf210d1"]]);export{Be as default};
