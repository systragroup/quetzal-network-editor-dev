import{an as ge,c as P,f as W,l as _e,g as B,E as ie,A as I,H as Le,I as ke,C as G,_ as we,bb as Me,bc as Ce,r as A,al as V,Z as se,bd as Ne,a as ne,be as qe,bf as E,bg as je,t as Fe,ab as Ae,ac as Oe,ad as Xe,d as $e,o as Re,j as ze,m as ee}from"./index-ReP_Szgl.js";const Ee={class:"gradient"},Ie={class:"domain-title"},Pe={class:"domain-min"},De={class:"domain-med"},Ge={class:"domain-max"},We=ge({__name:"MapLegend",props:{colorScale:{default:()=>[]},displaySettings:{},order:{default:0}},setup(v){const c=v,u=P(()=>50+180*c.order),h=P(()=>isFinite(c.displaySettings.maxVal)&&isFinite(c.displaySettings.minVal)),a=P(()=>{const x=(c.displaySettings.maxVal+c.displaySettings.minVal)/2;return x.toFixed(x>=10?0:1)});return(x,d)=>h.value?(B(),W("div",{key:0,class:"legend elevation-4",style:ie({left:`${u.value}px !important`})},[I("div",Ee,[(B(!0),W(Le,null,ke(x.colorScale,(i,e)=>(B(),W("span",{key:e,class:"grad-step",style:ie({backgroundColor:i})},null,4))),128)),I("span",Ie,G(x.displaySettings.legendName),1),I("span",Pe,G(Math.round(x.displaySettings.minVal)),1),I("span",De,G(a.value),1),I("span",Ge,G(Math.round(x.displaySettings.maxVal)),1)])],4)):_e("",!0)}}),Be=we(We,[["__scopeId","data-v-2b256a69"]]);var T={exports:{}},Te=T.exports,le;function He(){return le||(le=1,function(v){(function(c,u,h){function a(e){var n=this,o=i();n.next=function(){var t=2091639*n.s0+n.c*23283064365386963e-26;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=t|0)},n.c=1,n.s0=o(" "),n.s1=o(" "),n.s2=o(" "),n.s0-=o(e),n.s0<0&&(n.s0+=1),n.s1-=o(e),n.s1<0&&(n.s1+=1),n.s2-=o(e),n.s2<0&&(n.s2+=1),o=null}function x(e,n){return n.c=e.c,n.s0=e.s0,n.s1=e.s1,n.s2=e.s2,n}function d(e,n){var o=new a(e),t=n&&n.state,r=o.next;return r.int32=function(){return o.next()*4294967296|0},r.double=function(){return r()+(r()*2097152|0)*11102230246251565e-32},r.quick=r,t&&(typeof t=="object"&&x(t,o),r.state=function(){return x(o,{})}),r}function i(){var e=4022871197,n=function(o){o=String(o);for(var t=0;t<o.length;t++){e+=o.charCodeAt(t);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=r*4294967296}return(e>>>0)*23283064365386963e-26};return n}u&&u.exports?u.exports=d:this.alea=d})(Te,v)}(T)),T.exports}var H={exports:{}},Ue=H.exports,ue;function Ke(){return ue||(ue=1,function(v){(function(c,u,h){function a(i){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},i===(i|0)?e.x=i:n+=i;for(var o=0;o<n.length+64;o++)e.x^=n.charCodeAt(o)|0,e.next()}function x(i,e){return e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w,e}function d(i,e){var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(typeof o=="object"&&x(o,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.xor128=d})(Ue,v)}(H)),H.exports}var U={exports:{}},Ze=U.exports,ce;function Je(){return ce||(ce=1,function(v){(function(c,u,h){function a(i){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^(t^t<<1))|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,i===(i|0)?e.x=i:n+=i;for(var o=0;o<n.length+64;o++)e.x^=n.charCodeAt(o)|0,o==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function x(i,e){return e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w,e.v=i.v,e.d=i.d,e}function d(i,e){var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(typeof o=="object"&&x(o,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.xorwow=d})(Ze,v)}(U)),U.exports}var K={exports:{}},Qe=K.exports,fe;function Ye(){return fe||(fe=1,function(v){(function(c,u,h){function a(i){var e=this;e.next=function(){var o=e.x,t=e.i,r,l;return r=o[t],r^=r>>>7,l=r^r<<24,r=o[t+1&7],l^=r^r>>>10,r=o[t+3&7],l^=r^r>>>3,r=o[t+4&7],l^=r^r<<7,r=o[t+7&7],r=r^r<<13,l^=r^r<<9,o[t]=l,e.i=t+1&7,l};function n(o,t){var r,l=[];if(t===(t|0))l[0]=t;else for(t=""+t,r=0;r<t.length;++r)l[r&7]=l[r&7]<<15^t.charCodeAt(r)+l[r+1&7]<<13;for(;l.length<8;)l.push(0);for(r=0;r<8&&l[r]===0;++r);for(r==8?l[7]=-1:l[r],o.x=l,o.i=0,r=256;r>0;--r)o.next()}n(e,i)}function x(i,e){return e.x=i.x.slice(),e.i=i.i,e}function d(i,e){i==null&&(i=+new Date);var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(o.x&&x(o,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.xorshift7=d})(Qe,v)}(K)),K.exports}var Z={exports:{}},Ve=Z.exports,ve;function et(){return ve||(ve=1,function(v){(function(c,u,h){function a(i){var e=this;e.next=function(){var o=e.w,t=e.X,r=e.i,l,p;return e.w=o=o+1640531527|0,p=t[r+34&127],l=t[r=r+1&127],p^=p<<13,l^=l<<17,p^=p>>>15,l^=l>>>12,p=t[r]=p^l,e.i=r,p+(o^o>>>16)|0};function n(o,t){var r,l,p,L,q,k=[],O=128;for(t===(t|0)?(l=t,t=null):(t=t+"\0",l=0,O=Math.max(O,t.length)),p=0,L=-32;L<O;++L)t&&(l^=t.charCodeAt((L+32)%t.length)),L===0&&(q=l),l^=l<<10,l^=l>>>15,l^=l<<4,l^=l>>>13,L>=0&&(q=q+1640531527|0,r=k[L&127]^=l+q,p=r==0?p+1:0);for(p>=128&&(k[(t&&t.length||0)&127]=-1),p=127,L=4*128;L>0;--L)l=k[p+34&127],r=k[p=p+1&127],l^=l<<13,r^=r<<17,l^=l>>>15,r^=r>>>12,k[p]=l^r;o.w=q,o.X=k,o.i=p}n(e,i)}function x(i,e){return e.i=i.i,e.w=i.w,e.X=i.X.slice(),e}function d(i,e){i==null&&(i=+new Date);var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(o.X&&x(o,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.xor4096=d})(Ve,v)}(Z)),Z.exports}var J={exports:{}},tt=J.exports,de;function rt(){return de||(de=1,function(v){(function(c,u,h){function a(i){var e=this,n="";e.next=function(){var t=e.b,r=e.c,l=e.d,p=e.a;return t=t<<25^t>>>7^r,r=r-l|0,l=l<<24^l>>>8^p,p=p-t|0,e.b=t=t<<20^t>>>12^r,e.c=r=r-l|0,e.d=l<<16^r>>>16^p,e.a=p-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,i===Math.floor(i)?(e.a=i/4294967296|0,e.b=i|0):n+=i;for(var o=0;o<n.length+20;o++)e.b^=n.charCodeAt(o)|0,e.next()}function x(i,e){return e.a=i.a,e.b=i.b,e.c=i.c,e.d=i.d,e}function d(i,e){var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(typeof o=="object"&&x(o,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.tychei=d})(tt,v)}(J)),J.exports}var Q={exports:{}},nt=Q.exports,pe;function at(){return pe||(pe=1,function(v){(function(c,u,h){var a=256,x=6,d=52,i="random",e=h.pow(a,x),n=h.pow(2,d),o=n*2,t=a-1,r;function l(g,w,_){var S=[];w=w==!0?{entropy:!0}:w||{};var b=k(q(w.entropy?[g,R(u)]:g??O(),3),S),M=new p(S),j=function(){for(var C=M.g(x),F=e,f=0;C<n;)C=(C+f)*a,F*=a,f=M.g(1);for(;C>=o;)C/=2,F/=2,f>>>=1;return(C+f)/F};return j.int32=function(){return M.g(4)|0},j.quick=function(){return M.g(4)/4294967296},j.double=j,k(R(M.S),u),(w.pass||_||function(C,F,f,s){return s&&(s.S&&L(s,M),C.state=function(){return L(M,{})}),f?(h[i]=C,F):C})(j,b,"global"in w?w.global:this==h,w.state)}function p(g){var w,_=g.length,S=this,b=0,M=S.i=S.j=0,j=S.S=[];for(_||(g=[_++]);b<a;)j[b]=b++;for(b=0;b<a;b++)j[b]=j[M=t&M+g[b%_]+(w=j[b])],j[M]=w;(S.g=function(C){for(var F,f=0,s=S.i,y=S.j,m=S.S;C--;)F=m[s=t&s+1],f=f*a+m[t&(m[s]=m[y=t&y+F])+(m[y]=F)];return S.i=s,S.j=y,f})(a)}function L(g,w){return w.i=g.i,w.j=g.j,w.S=g.S.slice(),w}function q(g,w){var _=[],S=typeof g,b;if(w&&S=="object")for(b in g)try{_.push(q(g[b],w-1))}catch{}return _.length?_:S=="string"?g:g+"\0"}function k(g,w){for(var _=g+"",S,b=0;b<_.length;)w[t&b]=t&(S^=w[t&b]*19)+_.charCodeAt(b++);return R(w)}function O(){try{var g;return r&&(g=r.randomBytes)?g=g(a):(g=new Uint8Array(a),(c.crypto||c.msCrypto).getRandomValues(g)),R(g)}catch{var w=c.navigator,_=w&&w.plugins;return[+new Date,c,_,c.screen,R(u)]}}function R(g){return String.fromCharCode.apply(0,g)}if(k(h.random(),u),v.exports){v.exports=l;try{r=Me}catch{}}else h["seed"+i]=l})(typeof self<"u"?self:nt,[],Math)}(Q)),Q.exports}var te,ye;function ot(){if(ye)return te;ye=1;var v=He(),c=Ke(),u=Je(),h=Ye(),a=et(),x=rt(),d=at();return d.alea=v,d.xor128=c,d.xorwow=u,d.xorshift7=h,d.xor4096=a,d.tychei=x,te=d,te}var it=ot();const st=Ce(it),xe=v=>v,he={selectedFeature:"",maxWidth:10,minWidth:1,numStep:100,scale:"linear",fixScale:!1,minVal:0,maxVal:1,cmap:"OrRd",opacity:100,offset:!1,showNaN:!0,reverseColor:!1,extrusion:!1,padding:[0,100],labels:"",legendName:""};function lt(v){return/^#([0-9A-Fa-f]{3}){1,2}$/i.test(v)}function re(v,c,u,h,a,x){if(typeof v=="string")return x?0:st(v)();if(x){if(v<c?v=c:v>u&&(v=u),v=Math.abs(v),c<0&&u>0)u=Math.max(Math.abs(c),Math.abs(u)),c=0;else if(c<0&&u<=0){const i=Math.abs(u);u=Math.max(Math.abs(c),i),c=Math.min(Math.abs(c),i)}}else{if(v<c)return h?1:0;if(v>u)return h?0:1;c<0&&(v=v-c,u=u-c,c=0)}let d=v;return a==="log"?(c<1&&(u+=1,v+=1,c+=1),c=c>0?Math.log10(c):0,u=u>0?Math.log10(u):0,d=v>0?Math.log10(v):0):a==="sqrt"?(c=Math.sqrt(c),u=Math.sqrt(u),d=Math.sqrt(v)):a==="exp"?(c=c/u,v=v/u,u=1,c=10**c,u=10**u,d=10**v):a==="quad"&&(c=c**2,u=u**2,d=v**2),h?d=(-d+u)/(u-c):d=(d-c)/(u-c),d}function ut(){const v=A(E()),c=A(E()),u=A(E()),h=A("LineString"),a=A(V.cloneDeep(he)),x=A([]),d=A(""),i=A([]),e=A(!1),n=A({}),o=A({}),t=A("");function r(){v.value=E(),c.value=E(),u.value=E(),h.value="LineString",a.value=V.cloneDeep(he),x.value=[],d.value="",i.value=[],e.value=!1,n.value={},o.value={},t.value=""}function l(f,s,y=null){var X;r(),v.value=f,h.value=(X=v.value.features[0])==null?void 0:X.geometry.type,h.value=h.value==="MultiPolygon"?"Polygon":h.value,h.value!=="Polygon"&&(a.value.extrusion=!1),e.value=typeof s=="object"&&s!==null,e.value&&q(s),b(),y!=null&&y.selectedFilter&&x.value.includes(y.selectedFilter)&&(M(y.selectedFilter),y!=null&&y.selectedCategory&&(i.value=y.selectedCategory));const m=y==null?void 0:y.displaySettings;m&&p(m),_(),S(),qe(v.value)||ne().changeNotification({text:xe("invalid or missing CRS. use CRS84 / EPSG:4326"),autoClose:!0,color:"warning"})}function p(f){const s=Object.keys(f);for(const y of s)a.value[y]=f[y]}const L=P(()=>Object.keys(n.value));function q(f){Object.keys(f).forEach(s=>{n.value[`${s} (Interactive)`]=f[s]}),v.value.features.forEach(s=>s.properties.index=String(s.properties.index)),L.value.forEach(s=>{o.value[s]=Object.keys(n.value[s]),v.value.features.forEach(y=>y.properties[s]=null)})}function k(f){const s=a.value.selectedFeature;return s&&L.value.includes(s)?o.value[s].includes(f):!1}function O(f){const s=a.value.selectedFeature;if(s&&L.value.includes(s)&&e.value){t.value=f;const y=n.value[s][t.value];v.value.features.forEach(m=>m.properties[s]=y?y[m.properties.index]:null)}_(),S()}function R(){const f=a.value.selectedFeature,s=a.value.labels;c.value.features=c.value.features.map(y=>{var m;return{type:"Feature",geometry:y.geometry,properties:{[f]:y.properties[f],[s]:y.properties[s],index:(m=y.properties)==null?void 0:m.index}}})}function g(){if(!a.value.showNaN){const s=a.value.selectedFeature;u.value.features=c.value.features.filter(y=>!y.properties[s])}else u.value=E()}function w(){if(!a.value.showNaN){const s=a.value.selectedFeature,y=v.value.features.filter(X=>X.properties[s]).length===0,m=Object.keys(o.value).includes(s);if(y&&m&&e.value)return;c.value.features=c.value.features.filter(X=>X.properties[s])}}function _(){const f=new Set(i.value),s=d.value;c.value.features=v.value.features.filter(y=>f.has(y.properties[s])),h.value==="Polygon"&&g(),w(),R()}function S(){const f=a.value.selectedFeature,s=a.value.maxWidth,y=a.value.minWidth,m=a.value.scale,X=a.value.numStep,z=a.value.cmap,me=c.value.features.filter(N=>N.properties[f]).map(N=>N.properties[f]);if(!a.value.fixScale){const[N,$]=Ne(me);a.value.minVal=Math.round(N*100)/100,a.value.maxVal=Math.round($*100)/100}const ae=a.value.minVal,oe=a.value.maxVal,be=a.value.reverseColor;c.value.features.forEach(N=>{let $=N.properties[f];$=re($,ae,oe,!1,m,!0),N.properties.display_width=(s-y)*$+y});let D=V.cloneDeep(a.value.padding);D=[D[0]/100,1-D[1]/100],a.value.reverseColor&&D.reverse();const Se=se.scale(z).padding(D).domain([0,1],0,m).classes(X);if(c.value.features.forEach(N=>{const $=N.properties[f];lt($)?N.properties.display_color=$:N.properties.display_color=Se(re($,ae,oe,be,m,!1)).hex()}),v.value.features.filter(N=>N.properties[f]).length===0&&e.value&&Object.keys(o.value).includes(f)){const N=new Set(o.value[f]);c.value.features.forEach(Y=>{N.has(Y.properties.index)&&(Y.properties.display_width=10,Y.properties.display_color="#4CAF50")}),ne().changeNotification({text:xe("Clickable element in green"),autoClose:!0,color:"success"})}}function b(){const f=new Set([]);v.value.features.forEach(s=>{Object.keys(s.properties).forEach(y=>f.add(y))}),x.value=Array.from(f),x.value=x.value.filter(s=>!["display_width","display_color"].includes(s)),d.value=f.has("route_type")?"route_type":f.has("highway")?"highway":x.value[0],i.value=Array.from(new Set(v.value.features.map(s=>s.properties[d.value])))}function M(f){d.value=f,i.value=Array.from(new Set(v.value.features.map(s=>s.properties[d.value])))}function j(f){i.value=f}const C=P(()=>{let f=Array.from(new Set(v.value.features.map(s=>s.properties[d.value])));return f=f.sort((s,y)=>s-y),f}),F=P(()=>{const f=[];let s=a.value.padding;s=[s[0]/100,1-s[1]/100],a.value.reverseColor&&s.reverse();const y=se.scale(a.value.cmap).padding(s).domain([0,1]).classes(a.value.numStep);for(let m=0;m<100;m++)f.push(y(re(m,0,100,a.value.reverseColor,a.value.scale,!1)));return f});return{layer:v,type:h,attributes:x,visibleLayer:c,nanLayer:u,displaySettings:a,selectedFilter:d,selectedCategory:i,hasOD:e,attributesWithOD:L,matAvailableIndex:o,matSelectedIndex:t,changeOD:O,isIndexAvailable:k,loadLayer:l,getLayerProperties:b,refreshVisibleLinks:_,updateSelectedFeature:S,changeSelectedFilter:M,changeSelectedCategory:j,applySettings:p,filteredCategory:C,colorScale:F}}const ct={class:"map-legend"},ft=ge({__name:"StaticLayer",props:{preset:{},map:{},order:{},visibleLayers:{}},setup(v){const c=je(),u=v,{preset:h,map:a,order:x,visibleLayers:d}=Fe(u),i=Ae(),e=Oe(),n=Xe(),o=ne(),t=h.value.name,r=t+"-source",l=t+"-layer",p=t+"-labels",{visibleLayer:L,type:q,loadLayer:k,displaySettings:O,colorScale:R,isIndexAvailable:g,changeOD:w}=ut(),_=h.value.displaySettings.opacity,S=h.value.displaySettings.offset?-1:1,b=h.value.displaySettings.labels;async function M(f,s=null){switch(f){case"links":k(i.links,null,s);break;case"rlinks":k(e.rlinks,null,s);break;case"nodes":k(i.nodes,null,s);break;case"rnodes":k(e.rnodes,null,s);break;case"od":k(n.layer,null,s);break;default:const y=await o.getOtherFile(f,"geojson"),m=await o.getOtherFile(f,"json");k(y,m,s);break}}$e(async()=>{var f;await M(h.value.layer,h.value),(f=h.value)!=null&&f.selectedIndex&&g(h.value.selectedIndex)&&(w(h.value.selectedIndex),o.changeNotification({text:""})),L.value.features=L.value.features.map(s=>({type:"Feature",geometry:s.geometry,properties:{display_color:s.properties.display_color,display_width:s.properties.display_width,label:s.properties[b]}})),j(),C()});function j(){a.value.addSource(r,{type:"geojson",data:L.value}),q.value==="LineString"?a.value.addLayer({id:l,type:"line",minzoom:5,source:r,layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"},paint:{"line-color":["get","display_color"],"line-opacity":_/100,"line-offset":["*",S*.5,["to-number",["get","display_width"]]],"line-width":["get","display_width"]}}):q.value==="Point"?a.value.addLayer({id:l,type:"circle",minzoom:5,source:r,layout:{"circle-sort-key":["to-number",["get","display_width"]]},paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":_/100}}):["MultiPolygon","Polygon"].includes(q.value)&&!O.value.extrusion?a.value.addLayer({id:l,type:"fill",minzoom:5,source:r,paint:{"fill-color":["get","display_color"],"fill-opacity":_/100}}):["MultiPolygon","Polygon"].includes(q.value)&&O.value.extrusion&&a.value.addLayer({id:l,type:"fill-extrusion",minzoom:5,source:r,paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":_/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}}),b!==null&&a.value.addLayer({id:p,source:r,type:"symbol",layout:{"text-field":["get","label"],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":c.current.value.colors.black}})}function C(){const f=a.value.getStyle();if(!f)return;const s=f.layers.map(z=>z.id),y=d.value.indexOf(t);let m=d.value.map(z=>z+"-layer").splice(0,y);m=m.filter(z=>s.includes(z));const X=m.slice(-1)[0];X?a.value.moveLayer(l,X):F()}function F(){a.value.getLayer("results")?a.value.moveLayer(l,"results"):a.value.getLayer("rlinks")?a.value.moveLayer(l,"rlinks"):a.value.getLayer("links")&&a.value.moveLayer(l,"links")}return Re(()=>{a.value.getLayer(p)&&a.value.removeLayer(p),a.value.getLayer(l)&&(a.value.removeLayer(l),a.value.removeSource(r))}),(f,s)=>(B(),W("section",null,[I("div",ct,[ze(Be,{"color-scale":ee(R),"display-settings":ee(O),order:ee(x)},null,8,["color-scale","display-settings","order"])])]))}}),vt=we(ft,[["__scopeId","data-v-169b9e6a"]]),yt=Object.freeze(Object.defineProperty({__proto__:null,default:vt},Symbol.toStringTag,{value:"Module"}));export{Be as M,vt as S,yt as a,ut as u};
