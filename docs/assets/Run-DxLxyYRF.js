import{an as Z,ao as ee,c as h,t as re,d as X,h as z,g as c,ap as ge,m as u,aq as ce,i as e,k as se,r as E,u as de,ar as ae,w as G,j as l,D as B,f as k,l as N,A as F,ag as ve,B as I,C as V,W as O,E as he,a0 as _e,as as ye,H as W,I as j,a9 as we,L as A,aa as Ve,Q as te,at as be,au as Se,av as xe,aw as ke,ax as $e,$ as Ce,ay as Le,am as Ee,al as Ie,_ as Y,G as Re,J as le,V as ne,O as Te,F as ze,aj as De,a as Fe,az as Pe,aA as Ae,aB as He,a8 as Ue,R as Me,aC as Be,aD as oe,a1 as ie,a2 as Ne}from"./index-B3varY1O.js";import{g as Oe}from"./form-B2uRhppC.js";import{W as ue}from"./Warning-Bfqr-wGj.js";const We=Z({__name:"ParamInput",props:{item:{}},setup(H){const p=ee(),m=h(()=>p.scenariosList),a=h(()=>p.scenario),L=H,{item:o}=re(L);function $(t){return t.items==="$scenarios"?m.value.map(i=>i.scenario).filter(i=>i!==a.value):t.items}function x(t){if(t.items==="$scenarios"){const i=m.value.map(d=>d.scenario);Array.isArray(t.value)?t.value=t.value.filter(d=>i.includes(d)):t.value=i.includes(t.value)?t.value:""}}X(()=>x(o.value));const b=h(()=>o.value.items!==void 0?"v-select":o.value.type===void 0?"v-text-field":o.value.type.toLocaleLowerCase()==="boolean"?"v-switch":o.value.type.toLowerCase()==="number"?"v-number-input":"v-text-field");function y(t){return t.split("#")[1]}return(t,i)=>{var d;return c(),z(ge(b.value),{modelValue:u(o).value,"onUpdate:modelValue":[i[0]||(i[0]=C=>u(o).value=C),i[1]||(i[1]=C=>x(u(o)))],variant:"outlined","control-variant":"stacked",inset:"","hide-details":"",precision:u(o).precision===void 0?null:u(o).precision,label:u(o).text,prefix:y(u(o).name),suffix:u(o).units?u(o).units:void 0,rules:u(Oe)(u(o).rules),multiple:(d=u(o))==null?void 0:d.multiple,items:$(u(o))},ce({_:2},[t.$slots.prepend?{name:"prepend",fn:e(()=>[se(t.$slots,"prepend")]),key:"0"}:void 0,t.$slots.append?{name:"append",fn:e(()=>[se(t.$slots,"append")]),key:"1"}:void 0]),1032,["modelValue","precision","label","prefix","suffix","rules","multiple","items"])}}}),qe=Number.MAX_SAFE_INTEGER;function je(H=200,p=200,m=0,a=qe){const L=E(H),o=E(p),$=E(!1),x=E(),b=E([0,0]);function y(d){d.preventDefault(),$.value=!0,b.value=[d.clientX-x.value.clientWidth,d.clientY-x.value.clientHeight],document.addEventListener("mousemove",t),document.addEventListener("mouseup",i)}function t(d){if($.value){const C=d.clientX-b.value[0],D=d.clientY-b.value[1];L.value=C<m?m:C>a?a:C,o.value=D<m?m:D>a?a:D}}function i(){$.value=!1,document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",i)}return{panelWidth:L,panelHeight:o,panelDiv:x,startResize:y}}const Ge={key:0},Xe={class:"expansion"},Ye={key:0,class:"categorie-info"},Ke={key:0,class:"custom-hint"},Je=["onDblclick"],Qe=["onUpdate:modelValue"],Ze=Z({__name:"ParamForm",setup(H){const{$gettext:p}=de(),m=ae(),a=ee(),L=h(()=>a.model!==null),o=h(()=>m.filteredParameters),$=h(()=>m.selectedInfo);function x(){m.resetParameters()}const{panelHeight:b,panelDiv:y,startResize:t}=je(0,50,50);X(()=>{if(y.value){const r=window.innerHeight,s=y.value.scrollHeight,n=s/r;b.value=n>.25?.25*r:s}});const i=E([]);X(()=>{const n=o.value.map(g=>g.params.length).map((g=>_=>g+=_)(0)).filter(g=>g<=10);i.value=n.map((g,_)=>_)});function d(){i.value.length<o.value.length?i.value=o.value.map((r,s)=>s):i.value=[]}const C=E(!1),D=E(!1),q=E({}),P=(r,s,n)=>{if(r){const g=String(s)+String(n);q.value[g]=r}};function K(r,s){D.value=!0;const n=String(r)+String(s);Ee(()=>q.value[n].focus())}G(C,r=>{r||(D.value=!1)});const M=E(!1),U=h(()=>m.variants);function J(r){return r.name.split("#")[1]}function w(r){return r.name.includes("#")}const v=h(()=>{var n;const r=(n=U.value)!=null&&n.choices?U.value.choices:[],s={};return o.value.map(g=>g.category),o.value.forEach(g=>{const _=g.params.map(S=>S.name),T=Object.groupBy(_,S=>S.split("#")[0]);Object.keys(T).forEach(S=>{const me=T[S].slice(1).map(Q=>Q.split("#")[1]);T[S]=r.filter(Q=>!me.includes(Q))}),s[g.category]=T}),s});function f(r,s){const n=r.category,g=s.name.split("#")[0];return v.value[n][g]}function R(r,s){s.name=s.name.split("#")[0]+`#${r}`,s.text=s.text.split("#")[0]+`#${r}`}function pe(r,s){const n=Ie.cloneDeep(s),g=r.category,_=s.name,T=v.value[g][_][0];if(T){n.name=n.name+`#${T}`,n.text=n.text+`#${T}`;const S=r.params.indexOf(s);r.params.splice(S+1,0,n)}}function fe(r,s){r.params=r.params.filter(n=>n!==s)}return(r,s)=>(c(),z(te,{class:"card"},{default:e(()=>[l(ve,{class:"subtitle"},{default:e(()=>[I(V(u(p)("Scenario Settings")),1)]),_:1}),B(F("div",{ref_key:"resizableDiv",ref:y,class:"info-div",style:he({height:u(b)+"px"})},V($.value),5),[[O,$.value]]),B(F("div",{class:"drag-handle",onMousedown:s[0]||(s[0]=(...n)=>u(t)&&u(t)(...n))},null,544),[[O,$.value]]),o.value.length===0?(c(),k("p",Ge,V(u(p)("No parameters")),1)):N("",!0),F("div",Xe,[l(_e,{ref:"form","validate-on":"lazy"},{default:e(()=>[l(ye,{modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=n=>i.value=n),multiple:""},{default:e(()=>[(c(!0),k(W,null,j(o.value,(n,g)=>(c(),z(be,{key:g},{default:e(()=>[l(Se,{class:"categorie"},{default:e(()=>[I(V(n.category),1)]),_:2},1024),l(xe,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:e(()=>[B(F("div",null,[n.info?(c(),k("div",Ye,V(n.info),1)):N("",!0),(c(!0),k(W,null,j(n.params,(_,T)=>(c(),k("li",{key:T,class:"param-list"},[l(We,{item:_},ce({_:2},[M.value&&U.value?{name:"prepend",fn:e(()=>[w(_)?(c(),z(ke,{key:0,items:f(n,_),size:"small","model-value":J(_),"onUpdate:modelValue":S=>R(S,_)},null,8,["items","model-value","onUpdate:modelValue"])):(c(),z(A,{key:1,variant:"tonal",size:"small",disabled:f(n,_).length==0,icon:"fas fa-plus",onClick:S=>pe(n,_)},null,8,["disabled","onClick"]))]),key:"0"}:void 0,M.value&&w(_)?{name:"append",fn:e(()=>[l(A,{variant:"text",color:"error",size:"small",icon:"fas fa-trash",onClick:S=>fe(n,_)},null,8,["onClick"])]),key:"1"}:void 0]),1032,["item"]),l($e,null,{default:e(()=>[C.value?(c(),k("div",Ke,[D.value?B((c(),k("textarea",{key:1,ref_for:!0,ref:S=>P(S,g,T),"onUpdate:modelValue":S=>_.hint=S,rows:"1",class:"edition",onKeydown:s[1]||(s[1]=Ce(S=>D.value=!1,["enter"]))},null,40,Qe)),[[Le,_.hint]]):(c(),k("div",{key:0,onDblclick:S=>K(g,T)},V(_.hint),41,Je))])):N("",!0)]),_:2},1024)]))),128))],512),[[O,i.value.includes(g)]])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),l(we,null,{default:e(()=>[B(l(A,{variant:"text",onClick:x},{default:e(()=>[I(V(u(p)("back to default")),1)]),_:1},512),[[O,L.value]]),l(Ve),U.value?(c(),z(A,{key:0,"prepend-icon":"fas fa-plus",variant:"text",active:M.value,onClick:s[3]||(s[3]=n=>M.value=!M.value)},{default:e(()=>[I(V(u(p)("Manage")),1)]),_:1},8,["active"])):N("",!0),l(A,{variant:"text",onClick:d},{default:e(()=>[I(V(i.value.length!=o.value.length?u(p)("Expand all"):u(p)("Collapse all")),1)]),_:1}),l(A,{icon:"far fa-question-circle",size:"small",active:C.value,onClick:s[4]||(s[4]=n=>C.value=!C.value)},null,8,["active"])]),_:1})]),_:1}))}}),ea=Y(Ze,[["__scopeId","data-v-92e1c016"]]),aa="/quetzal-network-editor-dev/assets/samsung-washing-machine-melody-made-with-Voicemod-technology-C_SPFWiL.mp3",ta="/quetzal-network-editor-dev/assets/Thunderstruck_crop-Cww6_uS3.mp3",sa={style:{"white-space":"pre-line"}},la={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(H){const p=H,{disabled:m}=re(p),a=ae(),L=E(!1),o=h(()=>a.hasLogs),$=E([]);async function x(){await a.getLogs(),$.value=a.logs,$.value.sort((y,t)=>String(y.time).localeCompare(String(t.time),void 0,{sensitivity:"base"})),L.value=!0}async function b(){await a.downloadLogs()}return(y,t)=>(c(),k(W,null,[l(ze,{"close-delay":"100",transition:"slide-y-transition"},{activator:e(({props:i})=>[B(l(A,Te({disabled:u(m),class:"log-button",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},i),{default:e(()=>[...t[1]||(t[1]=[I(" logs ",-1)])]),_:1},16,["disabled"]),[[O,o.value]])]),default:e(()=>[l(Re,null,{default:e(()=>[l(le,{onClick:x},{prepend:e(()=>[l(ne,{icon:"fas fa-eye"})]),default:e(()=>[I(V(y.$gettext("show"))+" ",1)]),_:1}),l(le,{onClick:b},{prepend:e(()=>[l(ne,{icon:"fas fa-download"})]),default:e(()=>[I(V(y.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),l(De,{modelValue:L.value,"onUpdate:modelValue":t[0]||(t[0]=i=>L.value=i),width:"90%"},{default:e(()=>[l(te,{style:{"overflow-y":"auto"}},{default:e(()=>[(c(!0),k(W,null,j($.value,(i,d)=>(c(),k("div",{key:d,class:"log-container"},[F("h1",null,V(i.name),1),F("h3",null,[F("b",null,V(i.time),1)]),F("span",sa,V(i.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},na=Y(la,[["__scopeId","data-v-19036b20"]]),oa={class:"title-container"},ia={class:"buttons-row ma-2"},ua={key:1},ra=Z({__name:"RunStepper",setup(H){const{$gettext:p}=de(),m=Fe(),a=ae(),L=ee(),o=h(()=>a.steps),$=h(()=>a.modelTag),x=h(()=>{const w=a.availableModels;return a.avalaibleStepFunctions.filter(v=>w.has(v))}),b=h({get:()=>a.selectedStepFunction,set:w=>a.selectedStepFunction=w}),y=h(()=>a.variants),t=h(()=>a.running),i=h(()=>a.status),d=h(()=>a.currentStep),C=h(()=>a.error),D=h(()=>a.errorMessage),q=h(()=>L.protected),P=h(()=>L.model!==null),K=h(()=>L.model);X(async()=>{P.value&&(await a.getModelTag(),await a.getSteps(),await a.checkRunningExecution())}),G(x,w=>{P.value&&(w.includes(b.value)||(b.value=w[0],a.getSteps()))},{once:!0}),G(b,async w=>{P.value&&(x.value.includes(w)?(b.value=w,a.getSteps()):(b.value=x.value[0],a.getSteps()))});async function M(){if(await a.checkRunningExecution()){m.changeNotification({text:p("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{a.initExecution(),await m.exportToS3("inputs"),await m.deleteOutputsOnS3(),await m.deleteLogsOnS3(),m.deleteOutputs(),a.start()}catch(v){a.stopExecution(),console.log(v),m.changeAlert(v)}}const U=E(!0);G(i,w=>{w==="FINISHED"&&J()});function J(){if(U.value){let w=5e3,v=aa;K.value==="quetzal-thunder-track"&&(v=ta,w=11e3);const f=new Audio(v);f.play(),setTimeout(function(){f.pause(),f.currentTime=0},w)}}return(w,v)=>(c(),z(te,{class:"card"},{default:e(()=>[F("div",oa,[l(ve,{class:"subtitle"},{default:e(()=>[I(V(u(p)("Simulation")),1)]),_:1}),l(Pe,{class:"model-tag"},{default:e(()=>[I(V($.value),1)]),_:1}),l(na,{disabled:t.value||!P.value},null,8,["disabled"])]),x.value.length>1?(c(),z(Ae,{key:0,modelValue:b.value,"onUpdate:modelValue":v[0]||(v[0]=f=>b.value=f),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:e(()=>[(c(!0),k(W,null,j(x.value,f=>(c(),z(Be,{key:f,value:f,disabled:t.value||!P.value},{default:e(()=>[I(V(f),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):N("",!0),l(He,{modelValue:d.value,"onUpdate:modelValue":v[5]||(v[5]=f=>d.value=f),class:"stepper"},{default:e(()=>[l(ue,{show:C.value,title:u(p)("Simulation ended with an execution error or have been aborted.         Please relauch simulation. If the problem persist, contact us."),messages:D.value},null,8,["show","title","messages"]),l(ue,{show:q.value,title:u(p)("This scenario is protected"),messages:u(p)(" You cannot run simulation.")},null,8,["show","title","messages"]),F("div",ia,[l(A,{loading:t.value,disabled:t.value||q.value||!P.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:v[1]||(v[1]=f=>M())},{default:e(()=>[I(V(u(p)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),B(l(A,{color:"grey",variant:"text",onClick:v[2]||(v[2]=f=>u(a).stopExecution())},{default:e(()=>[I(V(u(p)("Abort")),1)]),_:1},512),[[O,t.value&&d.value!==1]]),l(Ue,{modelValue:U.value,"onUpdate:modelValue":v[3]||(v[3]=f=>U.value=f),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",label:u(p)("End signal"),color:"success","hide-details":""},{prepend:e(()=>[...v[6]||(v[6]=[])]),_:1},8,["modelValue","label"])]),y.value?(c(),z(Me,{key:0,modelValue:y.value.variants,"onUpdate:modelValue":v[4]||(v[4]=f=>y.value.variants=f),class:"ma-2",label:y.value.label||"variants",chips:"",disabled:t.value,items:y.value.choices,multiple:y.value.multiple,"hide-details":!0},null,8,["modelValue","label","disabled","items","multiple"])):N("",!0),P.value?(c(),k("div",ua,[(c(!0),k(W,null,j(o.value,(f,R)=>(c(),k("div",{key:R+1},[C.value?(c(),z(oe,{key:1,complete:d.value>R+1,color:d.value>=R+1?"primary":void 0,title:f.name,value:R+1,rules:[()=>d.value!==R+1],step:R+1},null,8,["complete","color","title","value","rules","step"])):(c(),z(oe,{key:0,complete:d.value>R+1,color:d.value>=R+1?"primary":void 0,title:f.name,value:R+1,step:R+1},null,8,["complete","color","title","value","step"]))]))),128))])):N("",!0)]),_:1},8,["modelValue"])]),_:1}))}}),ca=Y(ra,[["__scopeId","data-v-b956fc20"]]),da={class:"section"},va={__name:"Run",setup(H){return(p,m)=>(c(),k("section",da,[l(Ne,{class:"col"},{default:e(()=>[l(ie,{order:"1"},{default:e(()=>[l(ea)]),_:1}),l(ie,{order:"2"},{default:e(()=>[l(ca)]),_:1})]),_:1})]))}},ga=Y(va,[["__scopeId","data-v-7193c230"]]);export{ga as default};
