import{al as W,t as ee,h as O,g as k,ao as ae,i as f,k as B,m as a,an as ce,b5 as K,u as te,b6 as pe,r as I,c as m,f as U,Y as ve,j as u,$ as fe,H as me,I as he,l as J,B as R,C as q,L as N,a8 as ne,a9 as se,V as ye,D as oe,O as ge,au as ke,W as re,aj as L,_ as le,a as Q,bZ as be,aa as we,ac as Ve,d as _e,o as Se,af as xe,R as Ce,Q as $e,am as Y,aC as A}from"./index-CkVeTMkb.js";import{g as Ie}from"./form-B2uRhppC.js";import{W as X}from"./Warning-CQoMn3P3.js";import{M as De}from"./Markdown-0f5kVtRK.js";const Te=W({__name:"FormInput",props:{item:{},showHint:{type:Boolean,default:!1}},emits:["change"],setup(E,{emit:d}){const F=E,{item:e,showHint:y}=ee(F),S=d;function g(i){S("change",i)}function M(i){switch(i){case"number":return"v-number-input";case"boolean":return"v-switch";case"select":return"v-select";default:return"v-text-field"}}return(i,b)=>(k(),O(ce(M(a(e).type)),{modelValue:a(e).value,"onUpdate:modelValue":[b[0]||(b[0]=w=>a(e).value=w),b[1]||(b[1]=w=>g(a(e)))],"control-variant":"stacked",hint:a(y)?a(e).hint:"",density:a(e).type==="boolean"?"compact":"default","persistent-hint":a(y),variant:a(e).disabled?"underlined":"filled",disabled:a(e).disabled,units:a(e).units,color:a(e).type==="boolean"?"primary":void 0,precision:a(e).precision===void 0?null:a(e).precision,suffix:a(e).units,prefix:a(e).variant,items:a(e).items,min:a(e).min,max:a(e).max,rules:a(Ie)(a(e).rules),label:i.$gettext(a(e).label),multiple:a(e).multiple},ae({_:2},[i.$slots.prepend?{name:"prepend",fn:f(()=>[B(i.$slots,"prepend")]),key:"0"}:void 0,i.$slots.append?{name:"append",fn:f(()=>[B(i.$slots,"append")]),key:"1"}:void 0]),1032,["modelValue","hint","density","persistent-hint","variant","disabled","units","color","precision","suffix","prefix","items","min","max","rules","label","multiple"]))}}),je=W({__name:"VariantForm",props:K({variants:{default:()=>[""]}},{modelValue:{default:[]},modelModifiers:{}}),emits:K(["change"],["update:modelValue"]),setup(E,{expose:d,emit:F}){const{$gettext:e}=te(),y=E,{variants:S}=ee(y),g=pe(E,"modelValue"),M=F,i=I(!1),b=I(),w=I(!1);async function H(){const s=await b.value.validate();return s.valid||(i.value=!0,setTimeout(()=>{i.value=!1},500)),s.valid}d({validate:H});const h=I(!1);function x(s){const r=S.value?S.value:[],V=g.value.filter(c=>c.key===s).map(c=>c.variant);return r.filter(c=>!V.includes(c))}function C(s){return s.variant!==""}function D(s,r){r.variant=s}function z(s){const r=L.cloneDeep(s),o=s.key,V=x(o)[0];if(V){r.variant=V;const c=g.value.indexOf(s);g.value.splice(c+1,0,r)}}function T(s){g.value=g.value.filter(r=>r!==s)}const j=I(!1),$=m(()=>[...g.value].sort((s,r)=>s.advanced===r.advanced?0:s.advanced?1:-1)),P=m(()=>$.value.findIndex(s=>s.advanced));return(s,r)=>(k(),U("div",{class:ve(["box",{shake:i.value}])},[u(fe,{ref_key:"formRef",ref:b},{default:f(()=>[(k(!0),U(me,null,he($.value,(o,V)=>(k(),U("div",{key:V,class:"form"},[V===P.value?(k(),O(N,{key:0,variant:"text",class:"lower-button",onClick:r[0]||(r[0]=c=>j.value=!j.value)},{default:f(()=>[R(q(j.value?a(e)("▾ Hide Advanced"):a(e)("▸ Show Advanced")),1)]),_:1})):J("",!0),B(s.$slots,o.key,{item:o,showHint:w.value,"onUpdate:modelValue":c=>M("change",o)},()=>[oe(u(Te,ge({item:o},{ref_for:!0},s.$attrs,{"show-hint":w.value}),ae({_:2},[h.value&&o.showVariant?{name:"prepend",fn:f(()=>[C(o)?(k(),O(ke,{key:0,items:x(o.key),size:"small","model-value":o.variant,"onUpdate:modelValue":c=>D(c,o)},null,8,["items","model-value","onUpdate:modelValue"])):(k(),O(N,{key:1,variant:"tonal",size:"small",disabled:x(o.key).length==0,icon:"fas fa-plus",onClick:c=>z(o)},null,8,["disabled","onClick"]))]),key:"0"}:void 0,h.value&&C(o)?{name:"append",fn:f(()=>[u(N,{variant:"text",color:"error",size:"small",icon:"fas fa-trash",onClick:c=>T(o)},null,8,["onClick"])]),key:"1"}:void 0]),1040,["item","show-hint"]),[[re,!o.advanced||j.value]])],!0)]))),128)),u(ne,null,{default:f(()=>[B(s.$slots,"default",{},void 0,!0),u(se),a(S).length>1?(k(),O(N,{key:0,"prepend-icon":"fas fa-plus",variant:"text",active:h.value,onClick:r[1]||(r[1]=o=>h.value=!h.value)},{default:f(()=>[R(q(a(e)("Manage")),1)]),_:1},8,["active"])):J("",!0),u(N,{size:"small",onClick:r[2]||(r[2]=o=>w.value=!w.value)},{default:f(()=>[u(ye,null,{default:f(()=>r[3]||(r[3]=[R("far fa-question-circle small",-1)])),_:1,__:[3]})]),_:1})]),_:3})]),_:3},512)],2))}}),Ne=le(je,[["__scopeId","data-v-fbfe440b"]]),Oe={class:"background"},Ee=`
# Transit Analysis
## inputs
* **PT network**
* **inputs/population.geojson** (optional) with **density** in $\\frac{people}{km^2}$.

* **road network** (optional)
* od/od.geojson (optional) 
## outputs
* metrics (.csv) per **route_id** and **route_type**. 

* the path used by each OD (*If OD are provided*).
* catchemnt radius on each PT nodes
`,Fe=W({__name:"Transit",setup(E){const{$gettext:d}=te(),F=Q(),e=be(),y=we(),S=Ve(),g=m(()=>y.linksIsEmpty),M=m(()=>S.layerIsEmpty),i=m(()=>e.running),b=m(()=>e.status),w=m(()=>e.error),H=m(()=>e.errorMessage),h=m(()=>e.callID),x=m(()=>e.bucket),C=m(()=>e.parameters),D=m(()=>F.otherFiles.filter(l=>l.path==="inputs/population.geojson")[0]),z=m(()=>g.value),T=I([]),j={use_road_network:{key:"use_road_network",label:d("use road network"),value:null,type:"boolean",variant:"",category:"general",advanced:!1,hint:"Use road network nodes to compute population mesh (population is distributed on road nodes.)",rules:["required","nonNegative"],showVariant:!1},step_size:{key:"step_size",label:d("Population mesh size (0.001 ~100m)"),value:null,type:"number",variant:"",category:"general",min:5e-4,advanced:!0,units:"degree",hint:"Population is created from zones as a mesh of point with this distance",rules:["required","nonNegative"],showVariant:!1},duration:{key:"duration",label:d("duration"),value:null,type:"number",variant:"",category:"general",units:"minutes",hint:"duration of the period (minutes) for metrics",advanced:!1,rules:["required","nonNegative"],showVariant:!0},max_length:{key:"max_length",label:d("Footpaths max length"),value:null,type:"number",units:"metres",variant:"",category:"footpaths",advanced:!0,hint:"max length for a footpath (walk distance between stations)",rules:["required","nonNegative"],showVariant:!0},speed:{key:"speed",label:d("Footpaths speed"),value:null,advanced:!0,type:"number",units:"km/h",variant:"",category:"footpaths",showVariant:!0,hint:"as the crow flight walking speed",rules:["required","largerThanZero"]},n_ntlegs:{key:"n_ntlegs",label:d("zone connectors"),value:null,advanced:!0,type:"number",variant:"",category:"footpaths",showVariant:!0,hint:"number of connection between the zones and the stations (or roads if using the road network)",rules:["required","largerThanZero"]},catchment_radius:{key:"catchment_radius",label:d("Catchment radius"),value:500,advanced:!1,type:"number",units:"metres",variant:"",category:"catchment_radius",hint:"vehicle type catchment radius",rules:["required","nonNegative"],showVariant:!0}},$=m(()=>y.variantChoice.map(l=>l.split("#")[1]||l)),P=I($.value);function s(){const l=new Set([...$.value,""]),t=new Set(C.value.map(p=>p.variant));Array.from(t).filter(p=>!l.has(p)).forEach(p=>e.deleteVariant(p))}function r(){const l=C.value.filter(v=>v.category==="catchment_radius"),t=new Set(l.map(v=>v.key)),n=new Set(y.links.features.map(v=>v.properties.route_type));Array.from(n).filter(v=>!t.has(v)).forEach(v=>e.addCatchmentRadius(v)),Array.from(t).filter(v=>!n.has(v)).forEach(v=>e.deleteParam("catchment_radius",v))}function o(l){C.value.filter(n=>n.category===l).forEach(n=>{const p=L.cloneDeep(j[n.key]);p.value=n.value,p.variant=n.variant,T.value.push(p)})}function V(){C.value.filter(t=>t.category==="catchment_radius").forEach(t=>{const n=L.cloneDeep(j.catchment_radius);n.value=t.value,n.variant=t.variant,n.key=t.key,n.label=`${n.label} (${t.key})`,T.value.push(n)})}_e(()=>{r(),s(),o("general"),o("footpaths"),V()}),Se(()=>{c()});function c(){e.saveParams(T.value),Z()}function Z(){const l=Object.groupBy(C.value,n=>n.category),t={};return Object.keys(l).forEach(n=>{t[n]=l[n].reduce((p,_)=>{const v=_.variant!==""?`${_.key}#${_.variant}`:_.key;return p[v]=_.value,p},{})}),t}async function ie(){var _;if(!await G.value.validate())return;c();const t=Y();e.running=!0,e.setCallID(),await ue();const n=Z(),p={scenario_path_S3:h.value,variants:P.value,launcher_arg:{training_folder:"/tmp",params:n},metadata:{user_email:(_=t.cognitoInfo)==null?void 0:_.email}};e.start(p)}async function ue(){const l=Y(),t=[];try{t.push(A.putObject(x.value,h.value.concat("/inputs/pt/links.geojson"),JSON.stringify(y.links))),t.push(A.putObject(x.value,h.value.concat("/inputs/pt/nodes.geojson"),JSON.stringify(y.nodes))),M.value||t.push(A.putObject(x.value,h.value.concat("/inputs/od/od.geojson"),JSON.stringify(S.layer))),D.value&&(D.value.content==null&&l.model!==null&&(D.value.content=await A.readJson(l.model,l.scenario+"/"+D.value.path)),t.push(A.putObject(x.value,h.value.concat("/inputs/population.geojson"),JSON.stringify(D.value.content)))),await Promise.all(t)}catch(n){Q().changeAlert(n),e.running=!1}}function de(){e.stopExecution()}const G=I();return(l,t)=>(k(),U("section",Oe,[u($e,{class:"card"},{default:f(()=>[u(De,{source:Ee}),u(X,{show:z.value,title:a(d)("need PT network"),type:"warning"},null,8,["show","title"]),u(X,{show:w.value,messages:H.value},null,8,["show","messages"]),u(se),u(xe),$.value.length>1?(k(),O(Ce,{key:0,modelValue:P.value,"onUpdate:modelValue":t[0]||(t[0]=n=>P.value=n),class:"ma-2",label:a(d)("periods"),chips:"",disabled:i.value,items:$.value,multiple:!0,"hide-details":!1,"persistent-hint":!0,hint:a(d)("Click ' + manage ' to add period specific parameters such as the duration of each period")},null,8,["modelValue","label","disabled","items","hint"])):J("",!0),u(Ne,{ref_key:"formRef",ref:G,modelValue:T.value,"onUpdate:modelValue":t[2]||(t[2]=n=>T.value=n),variants:$.value},{default:f(()=>[u(ne,null,{default:f(()=>[u(N,{variant:"outlined",color:"success",loading:i.value,disabled:i.value||z.value,onClick:ie},{default:f(()=>[R(q(a(d)("Process")),1)]),_:1},8,["loading","disabled"]),oe(u(N,{color:"grey",variant:"text",onClick:t[1]||(t[1]=n=>de())},{default:f(()=>[R(q(a(d)("Abort")),1)]),_:1},512),[[re,i.value&&b.value==="RUNNING"]])]),_:1})]),_:1},8,["modelValue","variants"])]),_:1})]))}}),ze=le(Fe,[["__scopeId","data-v-43d78a98"]]);export{ze as default};
