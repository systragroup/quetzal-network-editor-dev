import{an as ge,e as W,k as _e,p as P,f as B,E as ie,A as I,H as Le,I as ke,C as G,_ as we,bb as Me,bc as Ce,r as A,al as V,bd as Ne,aa as se,a as ne,be as qe,bf as E,bg as Fe,t as je,ab as Ae,ac as Oe,ad as Xe,c as $e,o as Re,i as ze,l as ee}from"./index-Be1jW7-T.js";const Ee={class:"gradient"},Ie={class:"domain-title"},Pe={class:"domain-min"},De={class:"domain-med"},Ge={class:"domain-max"},We=ge({__name:"MapLegend",props:{colorScale:{default:()=>[]},displaySettings:{},order:{default:0}},setup(c){const f=c,u=P(()=>50+180*f.order),x=P(()=>isFinite(f.displaySettings.maxVal)&&isFinite(f.displaySettings.minVal)),a=P(()=>{const h=(f.displaySettings.maxVal+f.displaySettings.minVal)/2;return h.toFixed(h>=10?0:1)});return(h,d)=>x.value?(B(),W("div",{key:0,class:"legend elevation-4",style:ie({left:`${u.value}px !important`})},[I("div",Ee,[(B(!0),W(Le,null,ke(c.colorScale,(i,e)=>(B(),W("span",{key:e,class:"grad-step",style:ie({backgroundColor:i})},null,4))),128)),I("span",Ie,G(c.displaySettings.legendName),1),I("span",Pe,G(Math.round(c.displaySettings.minVal)),1),I("span",De,G(a.value),1),I("span",Ge,G(Math.round(c.displaySettings.maxVal)),1)])],4)):_e("",!0)}}),Be=we(We,[["__scopeId","data-v-2b256a69"]]);var T={exports:{}},Te=T.exports,le;function He(){return le||(le=1,function(c){(function(f,u,x){function a(e){var n=this,o=i();n.next=function(){var t=2091639*n.s0+n.c*23283064365386963e-26;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=t|0)},n.c=1,n.s0=o(" "),n.s1=o(" "),n.s2=o(" "),n.s0-=o(e),n.s0<0&&(n.s0+=1),n.s1-=o(e),n.s1<0&&(n.s1+=1),n.s2-=o(e),n.s2<0&&(n.s2+=1),o=null}function h(e,n){return n.c=e.c,n.s0=e.s0,n.s1=e.s1,n.s2=e.s2,n}function d(e,n){var o=new a(e),t=n&&n.state,r=o.next;return r.int32=function(){return o.next()*4294967296|0},r.double=function(){return r()+(r()*2097152|0)*11102230246251565e-32},r.quick=r,t&&(typeof t=="object"&&h(t,o),r.state=function(){return h(o,{})}),r}function i(){var e=4022871197,n=function(o){o=String(o);for(var t=0;t<o.length;t++){e+=o.charCodeAt(t);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=r*4294967296}return(e>>>0)*23283064365386963e-26};return n}u&&u.exports?u.exports=d:this.alea=d})(Te,c)}(T)),T.exports}var H={exports:{}},Ue=H.exports,ue;function Ke(){return ue||(ue=1,function(c){(function(f,u,x){function a(i){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},i===(i|0)?e.x=i:n+=i;for(var o=0;o<n.length+64;o++)e.x^=n.charCodeAt(o)|0,e.next()}function h(i,e){return e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w,e}function d(i,e){var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(typeof o=="object"&&h(o,n),t.state=function(){return h(n,{})}),t}u&&u.exports?u.exports=d:this.xor128=d})(Ue,c)}(H)),H.exports}var U={exports:{}},Je=U.exports,ce;function Qe(){return ce||(ce=1,function(c){(function(f,u,x){function a(i){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^(t^t<<1))|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,i===(i|0)?e.x=i:n+=i;for(var o=0;o<n.length+64;o++)e.x^=n.charCodeAt(o)|0,o==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function h(i,e){return e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w,e.v=i.v,e.d=i.d,e}function d(i,e){var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(typeof o=="object"&&h(o,n),t.state=function(){return h(n,{})}),t}u&&u.exports?u.exports=d:this.xorwow=d})(Je,c)}(U)),U.exports}var K={exports:{}},Ye=K.exports,fe;function Ze(){return fe||(fe=1,function(c){(function(f,u,x){function a(i){var e=this;e.next=function(){var o=e.x,t=e.i,r,l;return r=o[t],r^=r>>>7,l=r^r<<24,r=o[t+1&7],l^=r^r>>>10,r=o[t+3&7],l^=r^r>>>3,r=o[t+4&7],l^=r^r<<7,r=o[t+7&7],r=r^r<<13,l^=r^r<<9,o[t]=l,e.i=t+1&7,l};function n(o,t){var r,l=[];if(t===(t|0))l[0]=t;else for(t=""+t,r=0;r<t.length;++r)l[r&7]=l[r&7]<<15^t.charCodeAt(r)+l[r+1&7]<<13;for(;l.length<8;)l.push(0);for(r=0;r<8&&l[r]===0;++r);for(r==8?l[7]=-1:l[r],o.x=l,o.i=0,r=256;r>0;--r)o.next()}n(e,i)}function h(i,e){return e.x=i.x.slice(),e.i=i.i,e}function d(i,e){i==null&&(i=+new Date);var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(o.x&&h(o,n),t.state=function(){return h(n,{})}),t}u&&u.exports?u.exports=d:this.xorshift7=d})(Ye,c)}(K)),K.exports}var J={exports:{}},Ve=J.exports,ve;function et(){return ve||(ve=1,function(c){(function(f,u,x){function a(i){var e=this;e.next=function(){var o=e.w,t=e.X,r=e.i,l,p;return e.w=o=o+1640531527|0,p=t[r+34&127],l=t[r=r+1&127],p^=p<<13,l^=l<<17,p^=p>>>15,l^=l>>>12,p=t[r]=p^l,e.i=r,p+(o^o>>>16)|0};function n(o,t){var r,l,p,L,q,k=[],O=128;for(t===(t|0)?(l=t,t=null):(t=t+"\0",l=0,O=Math.max(O,t.length)),p=0,L=-32;L<O;++L)t&&(l^=t.charCodeAt((L+32)%t.length)),L===0&&(q=l),l^=l<<10,l^=l>>>15,l^=l<<4,l^=l>>>13,L>=0&&(q=q+1640531527|0,r=k[L&127]^=l+q,p=r==0?p+1:0);for(p>=128&&(k[(t&&t.length||0)&127]=-1),p=127,L=4*128;L>0;--L)l=k[p+34&127],r=k[p=p+1&127],l^=l<<13,r^=r<<17,l^=l>>>15,r^=r>>>12,k[p]=l^r;o.w=q,o.X=k,o.i=p}n(e,i)}function h(i,e){return e.i=i.i,e.w=i.w,e.X=i.X.slice(),e}function d(i,e){i==null&&(i=+new Date);var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(o.X&&h(o,n),t.state=function(){return h(n,{})}),t}u&&u.exports?u.exports=d:this.xor4096=d})(Ve,c)}(J)),J.exports}var Q={exports:{}},tt=Q.exports,de;function rt(){return de||(de=1,function(c){(function(f,u,x){function a(i){var e=this,n="";e.next=function(){var t=e.b,r=e.c,l=e.d,p=e.a;return t=t<<25^t>>>7^r,r=r-l|0,l=l<<24^l>>>8^p,p=p-t|0,e.b=t=t<<20^t>>>12^r,e.c=r=r-l|0,e.d=l<<16^r>>>16^p,e.a=p-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,i===Math.floor(i)?(e.a=i/4294967296|0,e.b=i|0):n+=i;for(var o=0;o<n.length+20;o++)e.b^=n.charCodeAt(o)|0,e.next()}function h(i,e){return e.a=i.a,e.b=i.b,e.c=i.c,e.d=i.d,e}function d(i,e){var n=new a(i),o=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,l=(n.next()>>>0)/4294967296,p=(r+l)/(1<<21);while(p===0);return p},t.int32=n.next,t.quick=t,o&&(typeof o=="object"&&h(o,n),t.state=function(){return h(n,{})}),t}u&&u.exports?u.exports=d:this.tychei=d})(tt,c)}(Q)),Q.exports}var Y={exports:{}},nt=Y.exports,pe;function at(){return pe||(pe=1,function(c){(function(f,u,x){var a=256,h=6,d=52,i="random",e=x.pow(a,h),n=x.pow(2,d),o=n*2,t=a-1,r;function l(g,w,_){var S=[];w=w==!0?{entropy:!0}:w||{};var b=k(q(w.entropy?[g,R(u)]:g??O(),3),S),M=new p(S),F=function(){for(var C=M.g(h),j=e,v=0;C<n;)C=(C+v)*a,j*=a,v=M.g(1);for(;C>=o;)C/=2,j/=2,v>>>=1;return(C+v)/j};return F.int32=function(){return M.g(4)|0},F.quick=function(){return M.g(4)/4294967296},F.double=F,k(R(M.S),u),(w.pass||_||function(C,j,v,s){return s&&(s.S&&L(s,M),C.state=function(){return L(M,{})}),v?(x[i]=C,j):C})(F,b,"global"in w?w.global:this==x,w.state)}function p(g){var w,_=g.length,S=this,b=0,M=S.i=S.j=0,F=S.S=[];for(_||(g=[_++]);b<a;)F[b]=b++;for(b=0;b<a;b++)F[b]=F[M=t&M+g[b%_]+(w=F[b])],F[M]=w;(S.g=function(C){for(var j,v=0,s=S.i,y=S.j,m=S.S;C--;)j=m[s=t&s+1],v=v*a+m[t&(m[s]=m[y=t&y+j])+(m[y]=j)];return S.i=s,S.j=y,v})(a)}function L(g,w){return w.i=g.i,w.j=g.j,w.S=g.S.slice(),w}function q(g,w){var _=[],S=typeof g,b;if(w&&S=="object")for(b in g)try{_.push(q(g[b],w-1))}catch{}return _.length?_:S=="string"?g:g+"\0"}function k(g,w){for(var _=g+"",S,b=0;b<_.length;)w[t&b]=t&(S^=w[t&b]*19)+_.charCodeAt(b++);return R(w)}function O(){try{var g;return r&&(g=r.randomBytes)?g=g(a):(g=new Uint8Array(a),(f.crypto||f.msCrypto).getRandomValues(g)),R(g)}catch{var w=f.navigator,_=w&&w.plugins;return[+new Date,f,_,f.screen,R(u)]}}function R(g){return String.fromCharCode.apply(0,g)}if(k(x.random(),u),c.exports){c.exports=l;try{r=Me}catch{}}else x["seed"+i]=l})(typeof self<"u"?self:nt,[],Math)}(Y)),Y.exports}var te,ye;function ot(){if(ye)return te;ye=1;var c=He(),f=Ke(),u=Qe(),x=Ze(),a=et(),h=rt(),d=at();return d.alea=c,d.xor128=f,d.xorwow=u,d.xorshift7=x,d.xor4096=a,d.tychei=h,te=d,te}var it=ot();const st=Ce(it),xe=c=>c,he={selectedFeature:"",maxWidth:10,minWidth:1,numStep:100,scale:"linear",fixScale:!1,minVal:0,maxVal:1,cmap:"OrRd",opacity:100,offset:!1,showNaN:!0,reverseColor:!1,extrusion:!1,padding:[0,100],labels:"",legendName:""};function lt(c){return/^#([0-9A-Fa-f]{3}){1,2}$/i.test(c)}function re(c,f,u,x,a,h){if(typeof c=="string")return h?0:st(c)();if(h){if(c<f?c=f:c>u&&(c=u),c=Math.abs(c),f<0&&u>0)u=Math.max(Math.abs(f),Math.abs(u)),f=0;else if(f<0&&u<=0){const i=Math.abs(u);u=Math.max(Math.abs(f),i),f=Math.min(Math.abs(f),i)}}else{if(c<f)return x?1:0;if(c>u)return x?0:1;f<0&&(c=c-f,u=u-f,f=0)}let d=c;return a==="log"?(f<1&&(u+=1,c+=1,f+=1),f=f>0?Math.log10(f):0,u=u>0?Math.log10(u):0,d=c>0?Math.log10(c):0):a==="sqrt"?(f=Math.sqrt(f),u=Math.sqrt(u),d=Math.sqrt(c)):a==="exp"?(f=f/u,c=c/u,u=1,f=10**f,u=10**u,d=10**c):a==="quad"&&(f=f**2,u=u**2,d=c**2),x?d=(-d+u)/(u-f):d=(d-f)/(u-f),d}function ut(){const c=A(E()),f=A(E()),u=A(E()),x=A("LineString"),a=A(V.cloneDeep(he)),h=A([]),d=A(""),i=A([]),e=A(!1),n=A({}),o=A({}),t=A("");function r(){c.value=E(),f.value=E(),u.value=E(),x.value="LineString",a.value=V.cloneDeep(he),h.value=[],d.value="",i.value=[],e.value=!1,n.value={},o.value={},t.value=""}function l(v,s,y=null){var X;r(),c.value=v,x.value=(X=c.value.features[0])==null?void 0:X.geometry.type,x.value=x.value==="MultiPolygon"?"Polygon":x.value,x.value!=="Polygon"&&(a.value.extrusion=!1),e.value=typeof s=="object"&&s!==null,e.value&&q(s),b(),y!=null&&y.selectedFilter&&h.value.includes(y.selectedFilter)&&(M(y.selectedFilter),y!=null&&y.selectedCategory&&(i.value=y.selectedCategory));const m=y==null?void 0:y.displaySettings;m&&p(m),_(),S(),qe(c.value)||ne().changeNotification({text:xe("invalid or missing CRS. use CRS84 / EPSG:4326"),autoClose:!0,color:"warning"})}function p(v){const s=Object.keys(v);for(const y of s)a.value[y]=v[y]}const L=P(()=>Object.keys(n.value));function q(v){Object.keys(v).forEach(s=>{n.value[`${s} (Interactive)`]=v[s]}),c.value.features.forEach(s=>s.properties.index=String(s.properties.index)),L.value.forEach(s=>{o.value[s]=Object.keys(n.value[s]),c.value.features.forEach(y=>y.properties[s]=null)})}function k(v){const s=a.value.selectedFeature;return s&&L.value.includes(s)?o.value[s].includes(v):!1}function O(v){const s=a.value.selectedFeature;if(s&&L.value.includes(s)&&e.value){t.value=v;const y=n.value[s][t.value];c.value.features.forEach(m=>m.properties[s]=y?y[m.properties.index]:null)}_(),S()}function R(){const v=a.value.selectedFeature,s=a.value.labels;f.value.features=f.value.features.map(y=>{var m;return{type:"Feature",geometry:y.geometry,properties:{[v]:y.properties[v],[s]:y.properties[s],index:(m=y.properties)==null?void 0:m.index}}})}function g(){if(!a.value.showNaN){const s=a.value.selectedFeature;u.value.features=f.value.features.filter(y=>!y.properties[s])}else u.value=E()}function w(){if(!a.value.showNaN){const s=a.value.selectedFeature,y=c.value.features.filter(X=>X.properties[s]).length===0,m=Object.keys(o.value).includes(s);if(y&&m&&e.value)return;f.value.features=f.value.features.filter(X=>X.properties[s])}}function _(){const v=new Set(i.value),s=d.value;f.value.features=c.value.features.filter(y=>v.has(y.properties[s])),x.value==="Polygon"&&g(),w(),R()}function S(){const v=a.value.selectedFeature,s=a.value.maxWidth,y=a.value.minWidth,m=a.value.scale,X=a.value.numStep,z=a.value.cmap,me=f.value.features.filter(N=>N.properties[v]).map(N=>N.properties[v]);if(!a.value.fixScale){const[N,$]=Ne(me);a.value.minVal=Math.round(N*100)/100,a.value.maxVal=Math.round($*100)/100}const ae=a.value.minVal,oe=a.value.maxVal,be=a.value.reverseColor;f.value.features.forEach(N=>{let $=N.properties[v];$=re($,ae,oe,!1,m,!0),N.properties.display_width=(s-y)*$+y});let D=V.cloneDeep(a.value.padding);D=[D[0]/100,1-D[1]/100],a.value.reverseColor&&D.reverse();const Se=se.scale(z).padding(D).domain([0,1],0,m).classes(X);if(f.value.features.forEach(N=>{const $=N.properties[v];lt($)?N.properties.display_color=$:N.properties.display_color=Se(re($,ae,oe,be,m,!1)).hex()}),c.value.features.filter(N=>N.properties[v]).length===0&&e.value&&Object.keys(o.value).includes(v)){const N=new Set(o.value[v]);f.value.features.forEach(Z=>{N.has(Z.properties.index)&&(Z.properties.display_width=10,Z.properties.display_color="#4CAF50")}),ne().changeNotification({text:xe("Clickable element in green"),autoClose:!0,color:"success"})}}function b(){const v=new Set([]);c.value.features.forEach(s=>{Object.keys(s.properties).forEach(y=>v.add(y))}),h.value=Array.from(v),h.value=h.value.filter(s=>!["display_width","display_color"].includes(s)),d.value=v.has("route_type")?"route_type":v.has("highway")?"highway":h.value[0],i.value=Array.from(new Set(c.value.features.map(s=>s.properties[d.value])))}function M(v){d.value=v,i.value=Array.from(new Set(c.value.features.map(s=>s.properties[d.value])))}function F(v){i.value=v}const C=P(()=>{let v=Array.from(new Set(c.value.features.map(s=>s.properties[d.value])));return v=v.sort((s,y)=>s-y),v}),j=P(()=>{const v=[];let s=a.value.padding;s=[s[0]/100,1-s[1]/100],a.value.reverseColor&&s.reverse();const y=se.scale(a.value.cmap).padding(s).domain([0,1]).classes(a.value.numStep);for(let m=0;m<100;m++)v.push(y(re(m,0,100,a.value.reverseColor,a.value.scale,!1)));return v});return{layer:c,type:x,attributes:h,visibleLayer:f,nanLayer:u,displaySettings:a,selectedFilter:d,selectedCategory:i,hasOD:e,attributesWithOD:L,matAvailableIndex:o,matSelectedIndex:t,changeOD:O,isIndexAvailable:k,loadLayer:l,getLayerProperties:b,refreshVisibleLinks:_,updateSelectedFeature:S,changeSelectedFilter:M,changeSelectedCategory:F,applySettings:p,filteredCategory:C,colorScale:j}}const ct={class:"map-legend"},ft=ge({__name:"StaticLayer",props:{preset:{},map:{},order:{},visibleLayers:{}},setup(c){const f=Fe(),u=c,{preset:x,map:a,order:h,visibleLayers:d}=je(u),i=Ae(),e=Oe(),n=Xe(),o=ne(),t=x.value.name,r=t+"-source",l=t+"-layer",p=t+"-labels",{visibleLayer:L,type:q,loadLayer:k,displaySettings:O,colorScale:R,isIndexAvailable:g,changeOD:w}=ut(),_=x.value.displaySettings.opacity,S=x.value.displaySettings.offset?-1:1,b=x.value.displaySettings.labels;async function M(v,s=null){switch(v){case"links":k(i.links,null,s);break;case"rlinks":k(e.rlinks,null,s);break;case"nodes":k(i.nodes,null,s);break;case"rnodes":k(e.rnodes,null,s);break;case"od":k(n.layer,null,s);break;default:const y=await o.getOtherFile(v,"geojson"),m=await o.getOtherFile(v,"json");k(y,m,s);break}}$e(async()=>{var v;await M(x.value.layer,x.value),(v=x.value)!=null&&v.selectedIndex&&g(x.value.selectedIndex)&&(w(x.value.selectedIndex),o.changeNotification({text:""})),L.value.features=L.value.features.map(s=>({type:"Feature",geometry:s.geometry,properties:{display_color:s.properties.display_color,display_width:s.properties.display_width,label:s.properties[b]}})),F(),C()});function F(){a.value.addSource(r,{type:"geojson",data:L.value}),q.value==="LineString"?a.value.addLayer({id:l,type:"line",minzoom:5,source:r,layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"},paint:{"line-color":["get","display_color"],"line-opacity":_/100,"line-offset":["*",S*.5,["to-number",["get","display_width"]]],"line-width":["get","display_width"]}}):q.value==="Point"?a.value.addLayer({id:l,type:"circle",minzoom:5,source:r,layout:{"circle-sort-key":["to-number",["get","display_width"]]},paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":_/100}}):["MultiPolygon","Polygon"].includes(q.value)&&!O.value.extrusion?a.value.addLayer({id:l,type:"fill",minzoom:5,source:r,paint:{"fill-color":["get","display_color"],"fill-opacity":_/100}}):["MultiPolygon","Polygon"].includes(q.value)&&O.value.extrusion&&a.value.addLayer({id:l,type:"fill-extrusion",minzoom:5,source:r,paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":_/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}}),b!==null&&a.value.addLayer({id:p,source:r,type:"symbol",layout:{"text-field":["get","label"],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":f.current.value.colors.black}})}function C(){const v=a.value.getStyle();if(!v)return;const s=v.layers.map(z=>z.id),y=d.value.indexOf(t);let m=d.value.map(z=>z+"-layer").splice(0,y);m=m.filter(z=>s.includes(z));const X=m.slice(-1)[0];X?a.value.moveLayer(l,X):j()}function j(){a.value.getLayer("results")?a.value.moveLayer(l,"results"):a.value.getLayer("rlinks")?a.value.moveLayer(l,"rlinks"):a.value.getLayer("links")&&a.value.moveLayer(l,"links")}return Re(()=>{a.value.getLayer(p)&&a.value.removeLayer(p),a.value.getLayer(l)&&(a.value.removeLayer(l),a.value.removeSource(r))}),(v,s)=>(B(),W("section",null,[I("div",ct,[ze(Be,{"color-scale":ee(R),"display-settings":ee(O),order:ee(h)},null,8,["color-scale","display-settings","order"])])]))}}),vt=we(ft,[["__scopeId","data-v-169b9e6a"]]),yt=Object.freeze(Object.defineProperty({__proto__:null,default:vt},Symbol.toStringTag,{value:"Module"}));export{Be as M,vt as S,yt as a,ut as u};
