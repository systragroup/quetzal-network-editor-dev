import{_ as C,g as i,h as S,i as l,Y as O,B as A,j as o,b6 as H,C as N,aF as K,a4 as R,u as W,r as f,e as v,o as Z,b7 as j,f as Y,q as _,s as r,a9 as F,x as n,v as m,aA as D,a1 as b,G as y,al as J,F as V,E as k,l as Q,L as X,b8 as $,V as ee,K as G,a2 as te,a3 as I,a7 as se,b4 as ae,b5 as ne}from"./index-6PCbpzoH.js";const re={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(e){this.$emit("update:date",this.parseOutput(e))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(e){if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))},parseOutput(e){return e.toISOString().substring(0,10).replaceAll("-","")}}};function le(e,a,h,s,g,d){return i(),S(N,{modelValue:g.menu,"onUpdate:modelValue":a[1]||(a[1]=c=>g.menu=c),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:l(({props:c})=>[o(O,A({"model-value":d.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},c),null,16,["model-value"])]),default:l(()=>[o(H,{modelValue:g.isoDate,"onUpdate:modelValue":a[0]||(a[0]=c=>g.isoDate=c)},null,8,["modelValue"])]),_:1},8,["modelValue"])}const oe=C(re,[["render",le]]),U=e=>e,ie={name:"GTFSWebImporter",components:{DatePicker:oe},setup(){const e=K(),a=R(),h=W(),s=f(!1),g=f(null),d=f({}),c=f([]),t=f(!1),u=f(!1),p=v(()=>a.linksIsEmpty),T=v(()=>e.UploadedGTFS),E=v(()=>e.callID),L=v(()=>e.running),M=v(()=>e.error),P=v(()=>e.errorMessage),B=v(()=>T.value.filter(w=>w.progress<100).length>0);Z(()=>{e.saveParams(x.value)});const q=/^(0?[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/,z={required:w=>!!w||U("Required"),timeRule:w=>q.test(w)||U("invalid date time")},x=f([{name:"start_time",text:"start time",value:e.parameters.start_time,type:"String",units:"",hint:"Start Time to restrict the GTFS in a period",rules:["required","timeRule"]},{name:"end_time",text:"end time",value:e.parameters.end_time,type:"String",units:"",hint:"End Time to restrict the GTFS in a period",rules:["required","timeRule"]}]);return{showOverwriteDialog:s,poly:g,runGTFS:e,store:h,nodes:d,gtfsList:c,checkall:t,showHint:u,parameters:x,rules:z,linksIsEmpty:p,UploadedGTFS:T,callID:E,running:L,error:M,errorMessage:P,isUploading:B}},methods:{uploadGTFS(){this.$refs.zipInput.click(),document.getElementById("zip-input").value=""},async readZip(e){try{this.store.changeLoading(!0);const a=e.target.files;if(!a.length){this.store.changeLoading(!1);return}for(const h of a){const s=await j(h),g=s.reduce((t,u)=>u.start_date<t?u.start_date:t,s[0].start_date),d=s.reduce((t,u)=>u.end_date>t?u.end_date:t,s[0].end_date),c={content:h,info:{name:h.name,minDate:g,maxDate:d,date:g,progress:0}};await this.runGTFS.addGTFS(c)}this.store.changeLoading(!1)}catch(a){this.store.changeLoading(!1),this.store.changeAlert(a)}},importGTFS(){if(this.linksIsEmpty){const e=this.UploadedGTFS.map(s=>s.name),a=this.UploadedGTFS.map(s=>s.date),h={files:e,dates:a};this.parameters.forEach(s=>{h[s.name]=s.value}),this.runGTFS.startExecution(h)}else this.showOverwriteDialog=!0},applyOverwriteDialog(){this.store.initLinks(),this.showOverwriteDialog=!1,this.importGTFS()}}},de=e=>(ae("data-v-f2e16997"),e=e(),ne(),e),ue={class:"params-row"},ce={class:"list"},pe={class:"list-row bold"},me=de(()=>r("span",{class:"list-item-small"},null,-1)),he={class:"list-item-large"},ge={class:"list-item-medium"},fe={class:"list-item-medium"},ve={class:"list-item-medium"},_e={class:"list-item-small"},Se={class:"list-item-small"},we={class:"list-item-large"},ye={class:"list-item-medium"},De={class:"list-item-medium"},Ve={class:"list-item-medium"},ke={class:"list-item-small"},Te={class:"bottom-button"};function xe(e,a,h,s,g,d){const c=Y("DatePicker");return i(),_("div",null,[r("input",{id:"zip-input",ref:"zipInput",type:"file",style:{display:"none"},accept:".zip",multiple:"multiple",onChange:a[0]||(a[0]=(...t)=>d.readZip&&d.readZip(...t))},null,544),o(G,{class:"card"},{default:l(()=>[o(F,{class:"subtitle"},{default:l(()=>[m(n(e.$gettext("GTFS importer")),1)]),_:1}),o(D,null,{default:l(()=>[m(n(e.$gettext("import GTFS from local computer")),1)]),_:1}),o(D,null,{default:l(()=>[m(n(e.$gettext("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),o(b,null,{default:l(()=>[o(y,{variant:"elevated",disabled:s.running,"prepend-icon":"fa-solid fa-file-archive",onClick:d.uploadGTFS},{default:l(()=>[m(n(e.$gettext("upload GTFS")),1)]),_:1},8,["disabled","onClick"])]),_:1}),o(D,null,{default:l(()=>[s.error?(i(),S(J,{key:0,density:"compact",variant:"outlined",text:"",type:"error"},{default:l(()=>[m(n(e.$gettext("There as been an error while converting your GTFS.             Please try again. If the problem persist, contact us."))+" ",1),(i(!0),_(V,null,k(Object.keys(s.errorMessage),t=>(i(),_("p",{key:t},[r("b",null,n(t)+": ",1),m(n(s.errorMessage[t]),1)]))),128))]),_:1})):Q("",!0)]),_:1}),r("div",ue,[(i(!0),_(V,null,k(s.parameters,(t,u)=>(i(),_("div",{key:u,class:"params"},[typeof t.items>"u"?(i(),S(O,{key:0,modelValue:t.value,"onUpdate:modelValue":p=>t.value=p,type:t.type,variant:"underlined",label:e.$gettext(t.text),suffix:t.units,hint:s.showHint?e.$gettext(t.hint):"","persistent-hint":s.showHint,rules:t.rules.map(p=>s.rules[p]),required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):(i(),S(X,{key:1,modelValue:t.value,"onUpdate:modelValue":p=>t.value=p,type:t.type,items:t.items,label:e.$gettext(t.text),suffix:t.units,hint:s.showHint?e.$gettext(t.hint):"","persistent-hint":s.showHint,rules:t.rules.map(p=>s.rules[p]),required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),r("div",ce,[r("li",pe,[me,r("span",he,n(e.$gettext("name")),1),r("span",ge,n(e.$gettext("from")),1),r("span",fe,n(e.$gettext("to")),1),r("span",ve,n(e.$gettext("selected date")),1),r("span",_e,n(e.$gettext("Uploaded")),1)]),(i(!0),_(V,null,k(s.UploadedGTFS,(t,u)=>(i(),_("ul",{key:u,class:"list-row"},[r("span",Se,n(u),1),r("span",we,n(t.name),1),r("span",ye,n(t.minDate),1),r("span",De,n(t.maxDate),1),r("span",Ve,[o(c,{date:t.date,from:t.minDate,to:t.maxDate,"onUpdate:date":p=>t.date=p},null,8,["date","from","to","onUpdate:date"])]),r("span",ke,[t.progress<100?(i(),S($,{key:0,indeterminate:t.progress===0,absolute:"",color:"primary","model-value":t.progress},null,8,["indeterminate","model-value"])):(i(),S(ee,{key:1},{default:l(()=>[m("fas fa-check")]),_:1}))])]))),128))]),r("div",Te,[o(y,{loading:s.running,disabled:s.running||s.UploadedGTFS.length==0||s.isUploading,color:s.running||s.UploadedGTFS.length==0||s.isUploading?"regular":"success","prepend-icon":"fa-solid fa-play",onClick:d.importGTFS},{default:l(()=>[m(n(e.$gettext("convert")),1)]),_:1},8,["loading","disabled","color","onClick"])])]),_:1}),o(se,{modelValue:s.showOverwriteDialog,"onUpdate:modelValue":a[2]||(a[2]=t=>s.showOverwriteDialog=t),persistent:"","max-width":"500",onKeydown:[I(d.applyOverwriteDialog,["enter"]),a[3]||(a[3]=I(t=>s.showOverwriteDialog=!1,["esc"]))]},{default:l(()=>[o(G,null,{default:l(()=>[o(F,{class:"text-h5"},{default:l(()=>[m(n(e.$gettext("Overwrite current road network ?")),1)]),_:1}),o(b,null,{default:l(()=>[o(te),o(y,{color:"regular",onClick:a[1]||(a[1]=t=>s.showOverwriteDialog=!s.showOverwriteDialog)},{default:l(()=>[m(n(e.$gettext("No")),1)]),_:1}),o(y,{color:"primary",onClick:d.applyOverwriteDialog},{default:l(()=>[m(n(e.$gettext("Yes")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const be=C(ie,[["render",xe],["__scopeId","data-v-f2e16997"]]);export{be as default};
