import{al as W,t as te,h as M,g as w,ao as ae,i as m,k as B,m as n,an as ve,b5 as K,u as ne,b6 as pe,r as C,c as f,f as U,Y as fe,j as i,$ as me,H as he,I as ye,l as J,B as R,C as q,L as E,a8 as se,a9 as oe,V as ge,D as re,au as ke,W as le,aj as L,_ as ie,a as Q,bY as be,aa as we,ac as Ve,d as _e,o as Se,af as xe,R as Ce,Q as $e,am as X,aC as P}from"./index-BtJGpesS.js";import{g as Ie}from"./form-B2uRhppC.js";import{W as ee}from"./Warning-BIwhOVX5.js";import{M as De}from"./Markdown-BYaAUrOe.js";const Te=W({__name:"FormInput",props:{item:{},showHint:{type:Boolean,default:!1}},emits:["change"],setup(N,{emit:u}){const A=N,{item:e,showHint:y}=te(A),x=u;function g(c){x("change",c)}function O(c){switch(c){case"number":return"v-number-input";case"boolean":return"v-switch";case"select":return"v-select";default:return"v-text-field"}}return(c,h)=>(w(),M(ve(O(n(e).type)),{modelValue:n(e).value,"onUpdate:modelValue":[h[0]||(h[0]=V=>n(e).value=V),h[1]||(h[1]=V=>g(n(e)))],"control-variant":"stacked",hint:n(y)?n(e).hint:"",density:n(e).type==="boolean"?"compact":"default","persistent-hint":n(y),variant:n(e).disabled?"underlined":"filled",disabled:n(e).disabled,units:n(e).units,color:n(e).type==="boolean"?"primary":void 0,precision:n(e).precision===void 0?null:n(e).precision,suffix:n(e).units,prefix:n(e).variant,items:n(e).items,rules:n(Ie)(n(e).rules),label:c.$gettext(n(e).label),multiple:n(e).multiple},ae({_:2},[c.$slots.prepend?{name:"prepend",fn:m(()=>[B(c.$slots,"prepend")]),key:"0"}:void 0,c.$slots.append?{name:"append",fn:m(()=>[B(c.$slots,"append")]),key:"1"}:void 0]),1032,["modelValue","hint","density","persistent-hint","variant","disabled","units","color","precision","suffix","prefix","items","rules","label","multiple"]))}}),je=W({__name:"VariantForm",props:K({variants:{default:()=>[""]}},{modelValue:{default:[]},modelModifiers:{}}),emits:K(["change"],["update:modelValue"]),setup(N,{expose:u,emit:A}){const{$gettext:e}=ne(),y=N,{variants:x}=te(y),g=pe(N,"modelValue"),O=A,c=C(!1),h=C(),V=C(!1);async function H(){const s=await h.value.validate();return s.valid||(c.value=!0,setTimeout(()=>{c.value=!1},500)),s.valid}u({validate:H});const $=C(!1);function _(s){const o=x.value?x.value:[],b=g.value.filter(v=>v.key===s).map(v=>v.variant);return o.filter(v=>!b.includes(v))}function I(s){return s.variant!==""}function D(s,o){o.variant=s}function T(s){const o=L.cloneDeep(s),r=s.key,b=_(r)[0];if(b){o.variant=b;const v=g.value.indexOf(s);g.value.splice(v+1,0,o)}}function z(s){g.value=g.value.filter(o=>o!==s)}const k=C(!1),F=f(()=>[...g.value].sort((s,o)=>s.advanced===o.advanced?0:s.advanced?1:-1)),j=f(()=>F.value.findIndex(s=>s.advanced));return(s,o)=>(w(),U("div",{class:fe(["box",{shake:c.value}])},[i(me,{ref_key:"formRef",ref:h},{default:m(()=>[(w(!0),U(he,null,ye(F.value,(r,b)=>(w(),U("div",{key:b,class:"form"},[b===j.value?(w(),M(E,{key:0,variant:"text",class:"lower-button",onClick:o[0]||(o[0]=v=>k.value=!k.value)},{default:m(()=>[R(q(k.value?n(e)("▾ Hide Advanced"):n(e)("▸ Show Advanced")),1)]),_:1})):J("",!0),B(s.$slots,r.key,{item:r,showHint:V.value,"onUpdate:modelValue":v=>O("change",r)},()=>[re(i(Te,{item:r,"show-hint":V.value},ae({_:2},[$.value&&r.showVariant?{name:"prepend",fn:m(()=>[I(r)?(w(),M(ke,{key:0,items:_(r.key),size:"small","model-value":r.variant,"onUpdate:modelValue":v=>D(v,r)},null,8,["items","model-value","onUpdate:modelValue"])):(w(),M(E,{key:1,variant:"tonal",size:"small",disabled:_(r.key).length==0,icon:"fas fa-plus",onClick:v=>T(r)},null,8,["disabled","onClick"]))]),key:"0"}:void 0,$.value&&I(r)?{name:"append",fn:m(()=>[i(E,{variant:"text",color:"error",size:"small",icon:"fas fa-trash",onClick:v=>z(r)},null,8,["onClick"])]),key:"1"}:void 0]),1032,["item","show-hint"]),[[le,!r.advanced||k.value]])],!0)]))),128)),i(se,null,{default:m(()=>[B(s.$slots,"default",{},void 0,!0),i(oe),n(x).length>1?(w(),M(E,{key:0,"prepend-icon":"fas fa-plus",variant:"text",active:$.value,onClick:o[1]||(o[1]=r=>$.value=!$.value)},{default:m(()=>[R(q(n(e)("Manage")),1)]),_:1},8,["active"])):J("",!0),i(E,{size:"small",onClick:o[2]||(o[2]=r=>V.value=!V.value)},{default:m(()=>[i(ge,null,{default:m(()=>o[3]||(o[3]=[R("far fa-question-circle small")])),_:1,__:[3]})]),_:1})]),_:3})]),_:3},512)],2))}}),Ee=ie(je,[["__scopeId","data-v-187320fb"]]),Me={class:"background"},Ne=`
# Transit Analysis
## inputs
* **PT network**
* **inputs/population.geojson** (optional) with **density** in $\\frac{people}{km^2}$.

* **road network** (optional)
* od/od.geojson (optional) 
## outputs
* metrics (.csv) per **route_id** and **route_type**. 

* the path used by each OD (*If OD are provided*).
* catchemnt radius on each PT nodes
`,Ae=W({__name:"Transit",setup(N){const{$gettext:u}=ne(),A=Q(),e=be(),y=we(),x=Ve(),g=f(()=>y.linksIsEmpty),O=f(()=>x.layerIsEmpty),c=f(()=>e.stateMachineArn),h=f(()=>e.running),V=f(()=>e.status),H=f(()=>e.error),$=f(()=>e.errorMessage),_=f(()=>e.callID),I=f(()=>e.bucket),D=f(()=>e.parameters),T=f(()=>A.otherFiles.filter(l=>l.path==="inputs/population.geojson")[0]),z=f(()=>g.value),k=C([]),F={use_road_network:{key:"use_road_network",label:u("use road network"),value:null,type:"boolean",variant:"",category:"general",advanced:!1,hint:"Use road network nodes to compute population mesh (population is distributed on road nodes.)",rules:["required","nonNegative"],showVariant:!1},step_size:{key:"step_size",label:u("Population mesh size (0.001 ~100m)"),value:null,type:"number",variant:"",category:"general",advanced:!0,units:"degree",hint:"Population is created from zones as a mesh of point with this distance",rules:["required","nonNegative"],showVariant:!1},duration:{key:"duration",label:u("duration"),value:null,type:"number",variant:"",category:"general",units:"minutes",hint:"duration of the period (minutes) for metrics",advanced:!1,rules:["required","nonNegative"],showVariant:!0},max_length:{key:"max_length",label:u("Footpaths max length"),value:null,type:"number",units:"metres",variant:"",category:"footpaths",advanced:!0,hint:"max length for a footpath (walk distance between stations)",rules:["required","nonNegative"],showVariant:!0},speed:{key:"speed",label:u("Footpaths speed"),value:null,advanced:!0,type:"number",units:"km/h",variant:"",category:"footpaths",showVariant:!0,hint:"as the crow flight walking speed",rules:["required","largerThanZero"]},n_ntlegs:{key:"n_ntlegs",label:u("zone connectors"),value:null,advanced:!0,type:"number",variant:"",category:"footpaths",showVariant:!0,hint:"number of connection between the zones and the stations (or roads if using the road network)",rules:["required","largerThanZero"]},catchment_radius:{key:"catchment_radius",label:u("Catchment radius"),value:500,advanced:!1,type:"number",units:"metres",variant:"",category:"catchment_radius",hint:"vehicle type catchment radius",rules:["required","nonNegative"],showVariant:!0}},j=f(()=>y.variantChoice.map(l=>l.split("#")[1]||l)),s=C(j.value);function o(){const l=new Set([...j.value,""]),t=new Set(D.value.map(d=>d.variant));Array.from(t).filter(d=>!l.has(d)).forEach(d=>e.deleteVariant(d))}function r(){const l=D.value.filter(p=>p.category==="catchment_radius"),t=new Set(l.map(p=>p.key)),a=new Set(y.links.features.map(p=>p.properties.route_type));Array.from(a).filter(p=>!t.has(p)).forEach(p=>e.addCatchmentRadius(p)),Array.from(t).filter(p=>!a.has(p)).forEach(p=>e.deleteParam("catchment_radius",p))}function b(l){D.value.filter(a=>a.category===l).forEach(a=>{const d=L.cloneDeep(F[a.key]);d.value=a.value,d.variant=a.variant,k.value.push(d)})}function v(){D.value.filter(t=>t.category==="catchment_radius").forEach(t=>{const a=L.cloneDeep(F.catchment_radius);a.value=t.value,a.variant=t.variant,a.key=t.key,a.label=`${a.label} (${t.key})`,k.value.push(a)})}_e(()=>{r(),o(),b("general"),b("footpaths"),v()}),Se(()=>{G()});function G(){e.saveParams(k.value),Y()}function Y(){const l=Object.groupBy(D.value,a=>a.category),t={};return Object.keys(l).forEach(a=>{t[a]=l[a].reduce((d,S)=>{const p=S.variant!==""?`${S.key}#${S.variant}`:S.key;return d[p]=S.value,d},{})}),t}async function ue(){var S;if(!await Z.value.validate())return;G();const t=X();e.running=!0,e.setCallID(),await de();const a=Y(),d={scenario_path_S3:_.value,variants:s.value,launcher_arg:{training_folder:"/tmp",params:a},metadata:{user_email:(S=t.cognitoInfo)==null?void 0:S.email}};e.startExecution(c.value,d)}async function de(){const l=X(),t=[];try{t.push(P.putObject(I.value,_.value.concat("/inputs/pt/links.geojson"),JSON.stringify(y.links))),t.push(P.putObject(I.value,_.value.concat("/inputs/pt/nodes.geojson"),JSON.stringify(y.nodes))),O.value||t.push(P.putObject(I.value,_.value.concat("/inputs/od/od.geojson"),JSON.stringify(x.layer))),T.value&&(T.value.content==null&&l.model!==null&&(T.value.content=await P.readJson(l.model,l.scenario+"/"+T.value.path)),t.push(P.putObject(I.value,_.value.concat("/inputs/population.geojson"),JSON.stringify(T.value.content)))),await Promise.all(t)}catch(a){Q().changeAlert(a),e.running=!1}}function ce(){e.stopExecution()}const Z=C();return(l,t)=>(w(),U("section",Me,[i($e,{class:"card"},{default:m(()=>[i(De,{source:Ne}),i(ee,{show:z.value,title:n(u)("need PT network"),type:"warning"},null,8,["show","title"]),i(ee,{show:H.value,messages:$.value},null,8,["show","messages"]),i(oe),i(xe),j.value.length>1?(w(),M(Ce,{key:0,modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),class:"ma-2",label:n(u)("periods"),chips:"",disabled:h.value,items:j.value,multiple:!0,"hide-details":!1,"persistent-hint":!0,hint:n(u)("Click ' + manage ' to add period specific parameters such as the duration of each period")},null,8,["modelValue","label","disabled","items","hint"])):J("",!0),i(Ee,{ref_key:"formRef",ref:Z,modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=a=>k.value=a),variants:j.value},{default:m(()=>[i(se,null,{default:m(()=>[i(E,{variant:"outlined",color:"success",loading:h.value,disabled:h.value||z.value,onClick:ue},{default:m(()=>[R(q(n(u)("Process")),1)]),_:1},8,["loading","disabled"]),re(i(E,{color:"grey",variant:"text",onClick:t[1]||(t[1]=a=>ce())},{default:m(()=>[R(q(n(u)("Abort")),1)]),_:1},512),[[le,h.value&&V.value==="RUNNING"]])]),_:1})]),_:1},8,["modelValue","variants"])]),_:1})]))}}),ze=ie(Ae,[["__scopeId","data-v-9380d93e"]]);export{ze as default};
