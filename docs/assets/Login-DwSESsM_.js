import{al as x,b5 as L,u as N,b6 as M,r as n,h as w,g as p,a2 as $,O as z,m as i,Q as D,Y as O,i as f,j as c,ae as W,B as S,C as q,ag as I,$ as G,N as Q,k as B,L as Z,_ as U,f as E,ax as j,b7 as k,a as F,l as h}from"./index-Byf-vw9r.js";import{g as H}from"./form-B2uRhppC.js";const C=x({__name:"PasswordInput",props:L({rules:{},match:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const{$gettext:m}=N(),e=M(g,"modelValue"),s=g,l=/^(?!\s+)(?!.*\s+$)(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*[$^*.[\]{}()?"!@#%&/\\,><':;|_~`=+\- ])[A-Za-z0-9$^*.[\]{}()?"!@#%&/\\,><':;|_~`=+\- ]{8,256}$/,r={required:a=>!!a||m("Required"),password:a=>l.test(a)||m("need at least: 1 lowercase, 1 uppercase, 1 number, and 1 symbol"),match:a=>a===s.match||m("password must match")},t=n(!1);return(a,o)=>(p(),w($,z({modelValue:e.value,"onUpdate:modelValue":o[0]||(o[0]=u=>e.value=u),type:t.value?"text":"password","append-inner-icon":t.value?"fas fa-eye":"fas fa-eye-slash"},a.$attrs,{required:"",rules:i(H)(s.rules.map(u=>r[u])),"onClick:appendInner":o[1]||(o[1]=u=>t.value=!t.value)}),null,16,["modelValue","type","append-inner-icon","rules"]))}}),Y=x({__name:"BaseLoginForm",props:{title:{type:String,default:"Title"},body:{type:String,default:null},confirmButton:{type:String,default:"Apply"},error:{type:String,default:""},loading:{type:Boolean,default:!1}},emits:["confirm"],setup(g,{emit:m}){const e=g,s=m,l=n(!1);async function r(t){(await t).valid?s("confirm"):(l.value=!0,setTimeout(()=>{l.value=!1},500))}return(t,a)=>(p(),w(D,{class:O(["signin",{shake:l.value}])},{default:f(()=>[c(W,{class:"text-h4"},{default:f(()=>[S(q(e.title),1)]),_:1}),c(I,{class:"text-h8",style:{"padding-bottom":"0.5rem"}},{default:f(()=>[S(q(e.body),1)]),_:1}),c(G,{ref:"form",class:"form",onSubmit:Q(r,["prevent"])},{default:f(()=>[B(t.$slots,"default",{},void 0,!0),c(I,{style:{color:"red"}},{default:f(()=>[S(q(e.error),1)]),_:1}),c(Z,{block:"",type:"submit",color:"success",loading:g.loading},{default:f(()=>[S(q(e.confirmButton),1)]),_:1},8,["loading"]),B(t.$slots,"append",{},void 0,!0)]),_:3},512)]),_:3},8,["class"]))}}),R=U(Y,[["__scopeId","data-v-ddef4b30"]]),J=x({__name:"Signin",emits:["signin","newPassword","resetPassword"],setup(g,{emit:m}){const{$gettext:e}=N(),s=m,l=n(""),r=n(""),t=n(""),a=n(!1),o=n({required:d=>!!d||e("Required")});function u(){s("resetPassword")}async function v(){a.value=!0;try{const d=await k.signin(l.value,r.value);d.nextStep.signInStep==="CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED"?s("newPassword"):s("signin",d)}catch(d){t.value=d}finally{a.value=!1}}return(d,V)=>(p(),E("section",null,[c(R,{title:i(e)("Sign In"),body:i(e)("Sign in with username or email address."),"confirm-button":i(e)("Sign in"),loading:a.value,error:t.value,onConfirm:v},{append:f(()=>[c(j,{class:"link",onClick:u},{default:f(()=>[S(q(i(e)("Forgot your password?")),1)]),_:1})]),default:f(()=>[c($,{modelValue:l.value,"onUpdate:modelValue":V[0]||(V[0]=P=>l.value=P),label:i(e)("username"),required:"",rules:[o.value.required]},null,8,["modelValue","label","rules"]),c(C,{modelValue:r.value,"onUpdate:modelValue":V[1]||(V[1]=P=>r.value=P),label:i(e)("password"),rules:["required"]},null,8,["modelValue","label"])]),_:1},8,["title","body","confirm-button","loading","error"])]))}}),K=U(J,[["__scopeId","data-v-9be2d061"]]),X=x({__name:"NewPassword",emits:["signin"],setup(g,{emit:m}){const{$gettext:e}=N(),s=m,l=n(""),r=n(""),t=n(""),a=n(!1);async function o(){a.value=!0;try{const u=await k.completeNewPassword(l.value);s("signin",u)}catch(u){a.value=!1,t.value=u}finally{a.value=!1}}return(u,v)=>(p(),w(R,{title:i(e)("New Password"),"confirm-button":i(e)("set new password"),loading:a.value,error:t.value,onConfirm:o},{default:f(()=>[c(C,{modelValue:l.value,"onUpdate:modelValue":v[0]||(v[0]=d=>l.value=d),label:i(e)("new password"),required:"",rules:["required","password"]},null,8,["modelValue","label"]),c(C,{modelValue:r.value,"onUpdate:modelValue":v[1]||(v[1]=d=>r.value=d),label:i(e)("confirm new password"),match:l.value,required:"",rules:["required","match"]},null,8,["modelValue","label","match"])]),_:1},8,["title","confirm-button","loading","error"]))}}),ee=x({__name:"ResetPassword",emits:["exit"],setup(g,{emit:m}){const e=F(),{$gettext:s}=N(),l=m,r=n(""),t=n(""),a=n(""),o=n(""),u=n(!1),v=n(""),d=n(!1),V=n({required:y=>!!y||s("Required")});async function P(){d.value=!0;try{await k.sendRecoveryEmail(r.value),u.value=!0}catch(y){v.value=y}finally{d.value=!1}}async function T(){d.value=!0;try{const y=await k.ChangePassword(r.value,t.value,a.value);e.changeNotification({text:s("Password changed"),autoClose:!0,color:"success"}),l("exit",y)}catch(y){v.value=y}finally{d.value=!1}}async function A(){u.value?T():P()}return(y,b)=>(p(),E("section",null,[c(R,{title:i(s)("Reset Password"),body:i(s)("check your email for the reset code"),"confirm-button":u.value?i(s)("change password"):i(s)("send email"),loading:d.value,error:v.value,onConfirm:A},{default:f(()=>[c($,{modelValue:r.value,"onUpdate:modelValue":b[0]||(b[0]=_=>r.value=_),readonly:u.value,label:i(s)("email or username"),required:"",rules:[V.value.required]},null,8,["modelValue","readonly","label","rules"]),u.value?(p(),w($,{key:0,modelValue:t.value,"onUpdate:modelValue":b[1]||(b[1]=_=>t.value=_),label:i(s)("reset code"),required:"",rules:[V.value.required],type:"string"},null,8,["modelValue","label","rules"])):h("",!0),u.value?(p(),w(C,{key:1,modelValue:a.value,"onUpdate:modelValue":b[2]||(b[2]=_=>a.value=_),label:i(s)("new password"),rules:["required","password"]},null,8,["modelValue","label"])):h("",!0),u.value?(p(),w(C,{key:2,modelValue:o.value,"onUpdate:modelValue":b[3]||(b[3]=_=>o.value=_),match:a.value,label:i(s)("new password"),rules:["required","match"]},null,8,["modelValue","match","label"])):h("",!0)]),_:1},8,["title","body","confirm-button","loading","error"])]))}}),le=x({__name:"Login",emits:["signin"],setup(g,{emit:m}){const e=F(),s=m,l=n("signin"),r=n(!1);function t(a){try{e.changeLoading(!0),a?s("signin",!0):l.value="signin"}catch(o){l.value="signin",e.changeAlert(o)}finally{e.changeLoading(!1)}}return(a,o)=>r.value?(p(),w(ee,{key:0,onExit:o[0]||(o[0]=()=>r.value=!1)})):l.value==="signin"?(p(),w(K,{key:1,onSignin:t,onNewPassword:o[1]||(o[1]=()=>l.value="newPassword"),onResetPassword:o[2]||(o[2]=()=>r.value=!0)})):l.value==="newPassword"?(p(),w(X,{key:2,onSignin:t})):h("",!0)}});export{le as default};
