import{_ as ee,u as ie,ak as te,al as Q,c as y,y as W,r as k,w as B,am as fe,d as o,f as b,g as a,h as s,af as de,A as g,B as r,i as f,C as O,z as L,U as pe,D as M,Z as me,an as ge,e as p,H as P,I,ao as ye,ap as he,aq as _e,m as A,a6 as ce,a1 as Ve,Q as Se,ar as be,Y as xe,as as we,a7 as ke,J as H,a8 as Ee,V as X,P as ae,ad as Le,t as $e,F as Ce,G as Re,N as oe,E as Ue,ac as Fe,a as Te,a0 as ze,$ as ue,at as Ae,au as Pe,av as De,aw as J,ax as re}from"./index-BLBFgIFO.js";const Ie={class:"expansion"},He={key:0,class:"categorie-info"},Ne={key:0,class:"custom-hint"},Oe=["onDblclick"],Be=["onUpdate:modelValue"],Me={__name:"ParamForm",setup(q){const{$gettext:u}=ie(),_=te(),n=Q();function R(e,t){return Array.isArray(e)?e.includes(t):e===t}const D=y(()=>_.selectedStepFunction),v=y(()=>_.parameters.filter(e=>Object.keys(e).includes("category")&&R(e.model,D.value))),E=y(()=>{var t;let e=_.parameters.filter(m=>m==null?void 0:m.info);return e=e.filter(m=>R(m.model,D.value)),(t=e[0])==null?void 0:t.info}),$=y(()=>n.scenariosList),V=y(()=>n.scenario);function x(){for(const e of v.value)for(const t of e.params)if(t.items==="$scenarios"){const m=$.value.map(S=>S.scenario);Array.isArray(t.value)?t.value=t.value.filter(S=>m.includes(S)):t.value=m.includes(t.value)?t.value:""}}W(()=>{x()});function w(e){return e.items==="$scenarios"?$.value.map(t=>t.scenario).filter(t=>t!==V.value):e.items}function N(){_.getParameters()}const U=k([...Array(v.value.length).keys()].map((e,t)=>t));function F(){U.value.length<v.value.length?U.value=[...Array(v.value.length).keys()].map((e,t)=>t):U.value=[]}const T={required:e=>e!=null||u("Required"),largerThanZero:e=>e>0||u("should be larger than 0"),nonNegative:e=>e>=0||u("should be larger or equal to 0")},z=k(!1),h=k(!1),i=k({}),d=(e,t,m)=>{if(e){const S=String(t)+String(m);i.value[S]=e}};function C(e,t){h.value=!0;const m=String(e)+String(t);Le(()=>i.value[m].focus())}B(z,e=>{e||(h.value=!1)});const G=k(null),Y=k(!1),le=k(0),j=k();W(()=>{const e=G.value.clientHeight,t=window.innerHeight,m=e/t;j.value=m<.25?e:.25*t});function ve(e){e.preventDefault(),Y.value=!0,le.value=e.clientY-G.value.clientHeight,document.addEventListener("mousemove",ne),document.addEventListener("mouseup",se)}function ne(e){if(Y.value){const t=e.clientY-le.value;j.value=t}}function se(){Y.value=!1,document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",se)}return(e,t)=>{const m=fe("v-number-input");return o(),b(ae,{class:"card"},{default:a(()=>[s(de,{class:"subtitle"},{default:a(()=>[g(r(f(u)("Scenario Settings")),1)]),_:1}),O(L("div",{ref_key:"resizableDiv",ref:G,class:"info-div",style:pe({height:j.value+"px"})},r(E.value),5),[[M,E.value]]),O(L("div",{class:"drag-handle",onMousedown:ve},null,544),[[M,E.value]]),L("div",Ie,[s(me,{ref:"form","validate-on":"lazy"},{default:a(()=>[s(ge,{modelValue:U.value,"onUpdate:modelValue":t[1]||(t[1]=S=>U.value=S),multiple:""},{default:a(()=>[(o(!0),p(P,null,I(v.value,(S,K)=>(o(),b(ye,{key:K},{default:a(()=>[s(he,{class:"categorie"},{default:a(()=>[g(r(S.category),1)]),_:2},1024),s(_e,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:a(()=>[S.info?(o(),p("div",He,r(S.info),1)):A("",!0),(o(!0),p(P,null,I(S.params,(l,Z)=>(o(),p("li",{key:Z,class:"param-list"},[typeof l.items>"u"&&typeof l.value=="boolean"?(o(),b(ce,{key:0,modelValue:l.value,"onUpdate:modelValue":c=>l.value=c,color:"primary",density:"compact",class:"pl-2","hide-details":"",label:f(u)(l.text),"persistent-hint":z.value},null,8,["modelValue","onUpdate:modelValue","label","persistent-hint"])):l.type=="Number"?(o(),b(m,{key:1,modelValue:l.value,"onUpdate:modelValue":c=>l.value=c,variant:"outlined","control-variant":"stacked",type:l.type,label:f(u)(l.text),suffix:l.units,"hide-details":"",rules:l.rules.map(c=>T[c])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):typeof l.items>"u"?(o(),b(Ve,{key:2,modelValue:l.value,"onUpdate:modelValue":c=>l.value=c,variant:"outlined","hide-details":"",type:l.type,label:f(u)(l.text),suffix:l.units,rules:l.rules.map(c=>T[c])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):(o(),b(Se,{key:3,modelValue:l.value,"onUpdate:modelValue":[c=>l.value=c,c=>x(l)],variant:"outlined","hide-details":"",type:l.type,multiple:l==null?void 0:l.multiple,items:w(l),label:f(u)(l.text),suffix:l.units,rules:l.rules.map(c=>T[c])},null,8,["modelValue","onUpdate:modelValue","type","multiple","items","label","suffix","rules"])),s(be,null,{default:a(()=>[z.value?(o(),p("div",Ne,[h.value?O((o(),p("textarea",{key:1,ref_for:!0,ref:c=>d(c,K,Z),"onUpdate:modelValue":c=>l.hint=c,rows:"1",class:"edition",onKeydown:t[0]||(t[0]=xe(c=>h.value=!1,["enter"]))},null,40,Be)),[[we,l.hint]]):(o(),p("div",{key:0,onDblclick:c=>C(K,Z)},r(l.hint),41,Oe))])):A("",!0)]),_:2},1024)]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),s(ke,null,{default:a(()=>[s(H,{color:"grey",variant:"text",onClick:N},{default:a(()=>[g(r(f(u)("back to default")),1)]),_:1}),s(Ee),s(H,{variant:"text",onClick:F},{default:a(()=>[g(r(U.value.length!=v.value.length?f(u)("Expand all"):f(u)("Collapse all")),1)]),_:1}),s(H,{icon:"",size:"small",onClick:t[2]||(t[2]=S=>z.value=!z.value)},{default:a(()=>[s(X,null,{default:a(()=>t[3]||(t[3]=[g("far fa-question-circle small")])),_:1})]),_:1})]),_:1})]),_:1})}}},qe=ee(Me,[["__scopeId","data-v-dda83074"]]),Ge={style:{"white-space":"pre-line"}},Ye={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(q){const u=q,{disabled:_}=$e(u),n=te(),R=k(!1),D=y(()=>n.hasLogs),v=k([]);async function E(){await n.getLogs(),v.value=n.logs,v.value.sort((V,x)=>String(V.time).localeCompare(String(x.time),void 0,{sensitivity:"base"})),R.value=!0}async function $(){await n.downloadLogs()}return(V,x)=>(o(),p(P,null,[s(Ue,{"close-delay":"100",transition:"slide-y-transition"},{activator:a(({props:w})=>[O(s(H,Ce({disabled:f(_),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},w),{default:a(()=>x[1]||(x[1]=[g(" logs ")])),_:2},1040,["disabled"]),[[M,D.value]])]),default:a(()=>[s(Re,null,{default:a(()=>[s(oe,{onClick:E},{prepend:a(()=>[s(X,{icon:"fas fa-eye"})]),default:a(()=>[g(r(V.$gettext("show"))+" ",1)]),_:1}),s(oe,{onClick:$},{prepend:a(()=>[s(X,{icon:"fas fa-download"})]),default:a(()=>[g(r(V.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),s(Fe,{modelValue:R.value,"onUpdate:modelValue":x[0]||(x[0]=w=>R.value=w),width:"90%"},{default:a(()=>[s(ae,{style:{"overflow-y":"auto"}},{default:a(()=>[(o(!0),p(P,null,I(v.value,(w,N)=>(o(),p("div",{key:N,class:"log-container"},[L("h1",null,r(w.name),1),L("h3",null,[L("b",null,r(w.time),1)]),L("span",Ge,r(w.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},je=ee(Ye,[["__scopeId","data-v-c531ebb9"]]),Ke={class:"section"},Ze={class:"title-container"},Je={class:"buttons-row ma-2"},Qe={key:4},We={__name:"Run",setup(q){const{$gettext:u}=ie(),_=Te(),n=te(),R=Q(),D=y(()=>n.steps),v=y(()=>{const h=n.availableModels;return n.avalaibleStepFunctions.filter(i=>h.has(i))}),E=k(n.selectedStepFunction),$=y(()=>n.running),V=y(()=>n.currentStep),x=y(()=>n.error),w=y(()=>n.errorMessage),N=y(()=>n.synchronized),U=y(()=>R.protected),F=y(()=>R.model!==null),T=k(n.endSignal);B(T,()=>n.changeEndSignal(T.value)),W(async()=>{F.value&&(await n.getSteps(),await n.GetRunningExecution())}),B(v,h=>{F.value&&(h.includes(E.value)||(n.setSelectedStepFunction(h[0]),n.getSteps()))},{once:!0}),B(E,async h=>{F.value&&(v.value.includes(h)?(n.setSelectedStepFunction(h),n.getSteps()):(E.value=v.value[0],n.setSelectedStepFunction(v.value[0]),n.getSteps()))});async function z(){if(await n.GetRunningExecution()){_.changeNotification({text:u("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const i=Q();n.initExecution(),await _.exportToS3("inputs"),await _.deleteOutputsOnS3(),await _.deleteLogsOnS3(),_.deleteOutputs(),n.startExecution({scenario:i.scenario})}catch(i){n.terminateExecution(),console.log(i),_.changeAlert(i)}}return(h,i)=>(o(),p("section",Ke,[s(ze,{class:"background"},{default:a(()=>[s(ue,{order:"1"},{default:a(()=>[s(qe)]),_:1}),s(ue,{order:"2"},{default:a(()=>[s(ae,{class:"card"},{default:a(()=>[L("div",Ze,[s(de,{class:"subtitle"},{default:a(()=>[g(r(f(u)("Scenario Simulation")),1)]),_:1}),s(je,{disabled:$.value||!F.value},null,8,["disabled"])]),s(Ae,{modelValue:V.value,"onUpdate:modelValue":i[4]||(i[4]=d=>V.value=d),class:"stepper"},{default:a(()=>[v.value.length>1?(o(),b(De,{key:0,modelValue:E.value,"onUpdate:modelValue":i[0]||(i[0]=d=>E.value=d),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:a(()=>[(o(!0),p(P,null,I(v.value,d=>(o(),b(Pe,{key:d,value:d,disabled:$.value||!F.value},{default:a(()=>[g(r(d),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):A("",!0),N.value?A("",!0):(o(),b(J,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:a(()=>[g(r(f(u)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),x.value?(o(),b(J,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[g(r(f(u)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(o(!0),p(P,null,I(Object.keys(w.value),d=>(o(),p("p",{key:d},[L("b",null,r(d)+": ",1),g(r(w.value[d]),1)]))),128))]),_:1})):A("",!0),U.value?(o(),b(J,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[g(r(f(u)("This scenario is protected. You can not run simulation.")),1)]),_:1})):A("",!0),L("div",Je,[s(H,{loading:$.value,disabled:$.value||U.value||!F.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:i[1]||(i[1]=d=>z())},{default:a(()=>[g(r(f(u)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),O(s(H,{color:"grey",variant:"text",onClick:i[2]||(i[2]=d=>f(n).stopExecution())},{default:a(()=>[g(r(f(u)("Abort")),1)]),_:1},512),[[M,$.value&&V.value!==1]]),s(ce,{modelValue:T.value,"onUpdate:modelValue":i[3]||(i[3]=d=>T.value=d),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:a(()=>[L("span",null,r(f(u)("End signal")),1)]),_:1},8,["modelValue"])]),F.value?(o(),p("div",Qe,[(o(!0),p(P,null,I(D.value,(d,C)=>(o(),p("div",{key:C+1},[x.value?(o(),b(re,{key:1,complete:V.value>C+1,title:d.name,value:C+1,step:C+1},null,8,["complete","title","value","step"])):(o(),b(re,{key:0,complete:V.value>C+1,color:V.value>=C+1?"primary":"regular",title:d.name,value:C+1,compact:"",step:C+1},null,8,["complete","color","title","value","step"]))]))),128))])):A("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]))}},et=ee(We,[["__scopeId","data-v-edf4fa7b"]]);export{et as default};
