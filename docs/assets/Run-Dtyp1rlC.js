import{al as Z,u as J,am as Q,c as _,t as re,d as X,h as T,g as c,an as ge,m as i,ao as ce,i as a,k as se,r as z,ap as ee,w as G,j as o,D as N,f as L,l as O,A as P,ae as de,B as F,C as S,W as B,E as he,$ as ye,aq as _e,H as q,I as j,a8 as Ve,L as A,a9 as we,Q as ae,ar as be,as as Se,at as xe,au as ke,av as $e,Z as Ce,aw as Le,ak as Ee,aj as Ie,_ as Y,G as Re,J as le,V as ne,O as ze,F as De,ah as Te,a as Fe,ax as Pe,ay as Ae,a7 as He,R as Ue,az as Me,aA as oe,a0 as ie,a1 as Ne}from"./index-CH46N1Xy.js";import{W as ue}from"./Warning-DadvRqlX.js";const Oe=Z({__name:"ParamInput",props:{item:{}},setup(H){const{$gettext:d}=J(),p=Q(),t=_(()=>p.scenariosList),E=_(()=>p.scenario),x=H,{item:s}=re(x);function k(e){return e.items==="$scenarios"?t.value.map(v=>v.scenario).filter(v=>v!==E.value):e.items}const $={required:e=>e!=null||d("Required"),largerThanZero:e=>e>0||d("should be larger than 0"),nonNegative:e=>e>=0||d("should be larger or equal to 0")};function h(e){if(e.items==="$scenarios"){const v=t.value.map(w=>w.scenario);Array.isArray(e.value)?e.value=e.value.filter(w=>v.includes(w)):e.value=v.includes(e.value)?e.value:""}}X(()=>h(s.value));const C=_(()=>s.value.items!==void 0?"v-select":s.value.type===void 0?"v-text-field":s.value.type.toLocaleLowerCase()==="boolean"?"v-switch":s.value.type.toLowerCase()==="number"?"v-number-input":"v-text-field");function u(e){return e.split("#")[1]}return(e,v)=>{var w,I;return c(),T(ge(C.value),{modelValue:i(s).value,"onUpdate:modelValue":[v[0]||(v[0]=U=>i(s).value=U),v[1]||(v[1]=U=>h(i(s)))],color:"primary",variant:"outlined","control-variant":"stacked",inset:"","hide-details":"",precision:i(s).precision===void 0?null:i(s).precision,label:i(s).text,prefix:u(i(s).name),suffix:i(s).units?i(s).units:void 0,type:i(s).type,rules:(w=i(s).rules)==null?void 0:w.map(U=>$[U]),multiple:(I=i(s))==null?void 0:I.multiple,items:k(i(s))},ce({_:2},[e.$slots.prepend?{name:"prepend",fn:a(()=>[se(e.$slots,"prepend")]),key:"0"}:void 0,e.$slots.append?{name:"append",fn:a(()=>[se(e.$slots,"append")]),key:"1"}:void 0]),1032,["modelValue","precision","label","prefix","suffix","type","rules","multiple","items"])}}}),Be=Number.MAX_SAFE_INTEGER;function qe(H=200,d=200,p=0,t=Be){const E=z(H),x=z(d),s=z(!1),k=z(),$=z([0,0]);function h(e){e.preventDefault(),s.value=!0,$.value=[e.clientX-k.value.clientWidth,e.clientY-k.value.clientHeight],document.addEventListener("mousemove",C),document.addEventListener("mouseup",u)}function C(e){if(s.value){const v=e.clientX-$.value[0],w=e.clientY-$.value[1];E.value=v<p?p:v>t?t:v,x.value=w<p?p:w>t?t:w}}function u(){s.value=!1,document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",u)}return{panelWidth:E,panelHeight:x,panelDiv:k,startResize:h}}const We={key:0},je={class:"expansion"},Ge={key:0,class:"categorie-info"},Xe={key:0,class:"custom-hint"},Ye=["onDblclick"],Ke=["onUpdate:modelValue"],Ze=Z({__name:"ParamForm",setup(H){const{$gettext:d}=J(),p=ee(),t=Q(),E=_(()=>t.model!==null),x=_(()=>p.filteredParameters),s=_(()=>p.selectedInfo);function k(){p.resetParameters()}const{panelHeight:$,panelDiv:h,startResize:C}=qe(0,50,50);X(()=>{if(h.value){const r=window.innerHeight,l=h.value.scrollHeight,n=l/r;$.value=n>.25?.25*r:l}});const u=z([]);X(()=>{const n=x.value.map(m=>m.params.length).map((m=>y=>m+=y)(0)).filter(m=>m<=10);u.value=n.map((m,y)=>y)});function e(){u.value.length<x.value.length?u.value=x.value.map((r,l)=>l):u.value=[]}const v=z(!1),w=z(!1),I=z({}),U=(r,l,n)=>{if(r){const m=String(l)+String(n);I.value[m]=r}};function W(r,l){w.value=!0;const n=String(r)+String(l);Ee(()=>I.value[n].focus())}G(v,r=>{r||(w.value=!1)});const M=z(!1),f=_(()=>p.variants);function g(r){return r.name.split("#")[1]}function V(r){return r.name.includes("#")}const R=_(()=>{var n;const r=(n=f.value)!=null&&n.choices?f.value.choices:[],l={};return x.value.map(m=>m.category),x.value.forEach(m=>{const y=m.params.map(b=>b.name),D=Object.groupBy(y,b=>b.split("#")[0]);Object.keys(D).forEach(b=>{const me=D[b].slice(1).map(K=>K.split("#")[1]);D[b]=r.filter(K=>!me.includes(K))}),l[m.category]=D}),l});function te(r,l){const n=r.category,m=l.name.split("#")[0];return R.value[n][m]}function ve(r,l){l.name=l.name.split("#")[0]+`#${r}`,l.text=l.text.split("#")[0]+`#${r}`}function pe(r,l){const n=Ie.cloneDeep(l),m=r.category,y=l.name,D=R.value[m][y][0];if(D){n.name=n.name+`#${D}`,n.text=n.text+`#${D}`;const b=r.params.indexOf(l);r.params.splice(b+1,0,n)}}function fe(r,l){r.params=r.params.filter(n=>n!==l)}return(r,l)=>(c(),T(ae,{class:"card"},{default:a(()=>[o(de,{class:"subtitle"},{default:a(()=>[F(S(i(d)("Scenario Settings")),1)]),_:1}),N(P("div",{ref_key:"resizableDiv",ref:h,class:"info-div",style:he({height:i($)+"px"})},S(s.value),5),[[B,s.value]]),N(P("div",{class:"drag-handle",onMousedown:l[0]||(l[0]=(...n)=>i(C)&&i(C)(...n))},null,544),[[B,s.value]]),x.value.length===0?(c(),L("p",We,S(i(d)("No parameters")),1)):O("",!0),P("div",je,[o(ye,{ref:"form","validate-on":"lazy"},{default:a(()=>[o(_e,{modelValue:u.value,"onUpdate:modelValue":l[2]||(l[2]=n=>u.value=n),multiple:""},{default:a(()=>[(c(!0),L(q,null,j(x.value,(n,m)=>(c(),T(be,{key:m},{default:a(()=>[o(Se,{class:"categorie"},{default:a(()=>[F(S(n.category),1)]),_:2},1024),o(xe,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:a(()=>[N(P("div",null,[n.info?(c(),L("div",Ge,S(n.info),1)):O("",!0),(c(!0),L(q,null,j(n.params,(y,D)=>(c(),L("li",{key:D,class:"param-list"},[o(Oe,{item:y},ce({_:2},[M.value&&f.value?{name:"prepend",fn:a(()=>[V(y)?(c(),T(ke,{key:0,items:te(n,y),size:"small","model-value":g(y),"onUpdate:modelValue":b=>ve(b,y)},null,8,["items","model-value","onUpdate:modelValue"])):(c(),T(A,{key:1,variant:"tonal",size:"small",disabled:te(n,y).length==0,icon:"fas fa-plus",onClick:b=>pe(n,y)},null,8,["disabled","onClick"]))]),key:"0"}:void 0,M.value&&V(y)?{name:"append",fn:a(()=>[o(A,{variant:"text",color:"error",size:"small",icon:"fas fa-trash",onClick:b=>fe(n,y)},null,8,["onClick"])]),key:"1"}:void 0]),1032,["item"]),o($e,null,{default:a(()=>[v.value?(c(),L("div",Xe,[w.value?N((c(),L("textarea",{key:1,ref_for:!0,ref:b=>U(b,m,D),"onUpdate:modelValue":b=>y.hint=b,rows:"1",class:"edition",onKeydown:l[1]||(l[1]=Ce(b=>w.value=!1,["enter"]))},null,40,Ke)),[[Le,y.hint]]):(c(),L("div",{key:0,onDblclick:b=>W(m,D)},S(y.hint),41,Ye))])):O("",!0)]),_:2},1024)]))),128))],512),[[B,u.value.includes(m)]])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),o(Ve,null,{default:a(()=>[N(o(A,{variant:"text",onClick:k},{default:a(()=>[F(S(i(d)("back to default")),1)]),_:1},512),[[B,E.value]]),o(we),f.value?(c(),T(A,{key:0,"prepend-icon":"fas fa-plus",variant:"text",active:M.value,onClick:l[3]||(l[3]=n=>M.value=!M.value)},{default:a(()=>[F(S(i(d)("Manage")),1)]),_:1},8,["active"])):O("",!0),o(A,{variant:"text",onClick:e},{default:a(()=>[F(S(u.value.length!=x.value.length?i(d)("Expand all"):i(d)("Collapse all")),1)]),_:1}),o(A,{icon:"far fa-question-circle",size:"small",active:v.value,onClick:l[4]||(l[4]=n=>v.value=!v.value)},null,8,["active"])]),_:1})]),_:1}))}}),Je=Y(Ze,[["__scopeId","data-v-92e1c016"]]),Qe="/quetzal-network-editor-dev/assets/samsung-washing-machine-melody-made-with-Voicemod-technology-C_SPFWiL.mp3",ea={style:{"white-space":"pre-line"}},aa={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(H){const d=H,{disabled:p}=re(d),t=ee(),E=z(!1),x=_(()=>t.hasLogs),s=z([]);async function k(){await t.getLogs(),s.value=t.logs,s.value.sort((h,C)=>String(h.time).localeCompare(String(C.time),void 0,{sensitivity:"base"})),E.value=!0}async function $(){await t.downloadLogs()}return(h,C)=>(c(),L(q,null,[o(De,{"close-delay":"100",transition:"slide-y-transition"},{activator:a(({props:u})=>[N(o(A,ze({disabled:i(p),class:"log-button",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},u),{default:a(()=>C[1]||(C[1]=[F(" logs ")])),_:2},1040,["disabled"]),[[B,x.value]])]),default:a(()=>[o(Re,null,{default:a(()=>[o(le,{onClick:k},{prepend:a(()=>[o(ne,{icon:"fas fa-eye"})]),default:a(()=>[F(S(h.$gettext("show"))+" ",1)]),_:1}),o(le,{onClick:$},{prepend:a(()=>[o(ne,{icon:"fas fa-download"})]),default:a(()=>[F(S(h.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),o(Te,{modelValue:E.value,"onUpdate:modelValue":C[0]||(C[0]=u=>E.value=u),width:"90%"},{default:a(()=>[o(ae,{style:{"overflow-y":"auto"}},{default:a(()=>[(c(!0),L(q,null,j(s.value,(u,e)=>(c(),L("div",{key:e,class:"log-container"},[P("h1",null,S(u.name),1),P("h3",null,[P("b",null,S(u.time),1)]),P("span",ea,S(u.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},ta=Y(aa,[["__scopeId","data-v-19036b20"]]),sa={class:"title-container"},la={class:"buttons-row ma-2"},na={key:1},oa=Z({__name:"RunStepper",setup(H){const{$gettext:d}=J(),p=Fe(),t=ee(),E=Q(),x=_(()=>t.steps),s=_(()=>{const f=t.availableModels;return t.avalaibleStepFunctions.filter(g=>f.has(g))}),k=_({get:()=>t.selectedStepFunction,set:f=>t.selectedStepFunction=f}),$=_(()=>t.variants),h=_(()=>t.running),C=_(()=>t.status),u=_(()=>t.currentStep),e=_(()=>t.error),v=_(()=>t.errorMessage),w=_(()=>E.protected),I=_(()=>E.model!==null);X(async()=>{I.value&&(await t.getSteps(),await t.checkRunningExecution())}),G(s,f=>{I.value&&(f.includes(k.value)||(k.value=f[0],t.getSteps()))},{once:!0}),G(k,async f=>{I.value&&(s.value.includes(f)?(k.value=f,t.getSteps()):(k.value=s.value[0],t.getSteps()))});async function U(){if(await t.checkRunningExecution()){p.changeNotification({text:d("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{t.initExecution(),await p.exportToS3("inputs"),await p.deleteOutputsOnS3(),await p.deleteLogsOnS3(),p.deleteOutputs(),t.start()}catch(g){t.stopExecution(),console.log(g),p.changeAlert(g)}}const W=z(!0);G(C,f=>{f==="FINISHED"&&M()});function M(){if(W.value){const f=new Audio(Qe);f.play(),setTimeout(function(){f.pause(),f.currentTime=0},5e3)}}return(f,g)=>(c(),T(ae,{class:"card"},{default:a(()=>[P("div",sa,[o(de,{class:"subtitle"},{default:a(()=>[F(S(i(d)("Simulation")),1)]),_:1}),o(ta,{disabled:h.value||!I.value},null,8,["disabled"])]),s.value.length>1?(c(),T(Pe,{key:0,modelValue:k.value,"onUpdate:modelValue":g[0]||(g[0]=V=>k.value=V),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:a(()=>[(c(!0),L(q,null,j(s.value,V=>(c(),T(Me,{key:V,value:V,disabled:h.value||!I.value},{default:a(()=>[F(S(V),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):O("",!0),o(Ae,{modelValue:u.value,"onUpdate:modelValue":g[5]||(g[5]=V=>u.value=V),class:"stepper"},{default:a(()=>[o(ue,{show:e.value,title:i(d)("Simulation ended with an execution error or have been aborted.         Please relauch simulation. If the problem persist, contact us."),messages:v.value},null,8,["show","title","messages"]),o(ue,{show:w.value,title:i(d)("This scenario is protected"),messages:i(d)(" You cannot run simulation.")},null,8,["show","title","messages"]),P("div",la,[o(A,{loading:h.value,disabled:h.value||w.value||!I.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:g[1]||(g[1]=V=>U())},{default:a(()=>[F(S(i(d)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),N(o(A,{color:"grey",variant:"text",onClick:g[2]||(g[2]=V=>i(t).stopExecution())},{default:a(()=>[F(S(i(d)("Abort")),1)]),_:1},512),[[B,h.value&&u.value!==1]]),o(He,{modelValue:W.value,"onUpdate:modelValue":g[3]||(g[3]=V=>W.value=V),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",label:i(d)("End signal"),color:"success","hide-details":""},{prepend:a(()=>g[6]||(g[6]=[])),_:1},8,["modelValue","label"])]),$.value?(c(),T(Ue,{key:0,modelValue:$.value.variants,"onUpdate:modelValue":g[4]||(g[4]=V=>$.value.variants=V),class:"ma-2",label:$.value.label||"variants",chips:"",disabled:h.value,items:$.value.choices,multiple:$.value.multiple,"hide-details":!0},null,8,["modelValue","label","disabled","items","multiple"])):O("",!0),I.value?(c(),L("div",na,[(c(!0),L(q,null,j(x.value,(V,R)=>(c(),L("div",{key:R+1},[e.value?(c(),T(oe,{key:1,complete:u.value>R+1,color:u.value>=R+1?"primary":void 0,title:V.name,value:R+1,rules:[()=>u.value!==R+1],step:R+1},null,8,["complete","color","title","value","rules","step"])):(c(),T(oe,{key:0,complete:u.value>R+1,color:u.value>=R+1?"primary":void 0,title:V.name,value:R+1,step:R+1},null,8,["complete","color","title","value","step"]))]))),128))])):O("",!0)]),_:1},8,["modelValue"])]),_:1}))}}),ia=Y(oa,[["__scopeId","data-v-4101aa42"]]),ua={class:"section"},ra={__name:"Run",setup(H){return(d,p)=>(c(),L("section",ua,[o(Ne,{class:"col"},{default:a(()=>[o(ie,{order:"1"},{default:a(()=>[o(Je)]),_:1}),o(ie,{order:"2"},{default:a(()=>[o(ia)]),_:1})]),_:1})]))}},va=Y(ra,[["__scopeId","data-v-7193c230"]]);export{va as default};
