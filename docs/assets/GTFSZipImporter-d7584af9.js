import{_ as O,o as i,f as y,w as r,g as l,R as z,s as Z,b2 as H,x as N,$ as R,u as W,a2 as f,j as _,az as j,b3 as K,r as T,k as v,l as o,a6 as F,n as c,t as n,aA as V,A as D,aj as $,F as k,z as b,i as Y,G as X,b4 as J,V as G,E as I,X as Q,Y as ee,Z as U,a4 as te,b0 as se,b1 as ae}from"./index-ce256897.js";import{a as ne}from"./Microservices-d5c3a302.js";import"./index-3c68deeb.js";const re={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(e){this.$emit("update:date",this.parseOutput(e))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(e){if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))},parseOutput(e){return e.toISOString().substring(0,10).replaceAll("-","")}}};function le(e,a,m,s,h,d){return i(),y(N,{modelValue:h.menu,"onUpdate:modelValue":a[1]||(a[1]=p=>h.menu=p),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:r(({props:p})=>[l(z,Z({"model-value":d.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},p),null,16,["model-value"])]),default:r(()=>[l(H,{modelValue:h.isoDate,"onUpdate:modelValue":a[0]||(a[0]=p=>h.isoDate=p)},null,8,["modelValue"])]),_:1},8,["modelValue"])}const oe=O(re,[["render",le]]);const C=e=>e,ie={name:"GTFSWebImporter",components:{DatePicker:oe},setup(){const e=ne(),a=R(),m=W(),s=f(!1),h=f(null),d=f({}),p=f([]),g=f(!1),t=f(!1),S=_(()=>a.linksIsEmpty),u=_(()=>e.UploadedGTFS),E=_(()=>e.callID),M=_(()=>e.running),P=_(()=>e.error),L=_(()=>e.errorMessage),A=_(()=>u.value.filter(w=>w.progress<100).length>0);j(()=>{e.saveParams(x.value)});const B=/^(0?[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/,q={required:w=>!!w||C("Required"),timeRule:w=>B.test(w)||C("invalid date time")},x=f([{name:"start_time",text:"start time",value:e.parameters.start_time,type:"String",units:"",hint:"Start Time to restrict the GTFS in a period",rules:["required","timeRule"]},{name:"end_time",text:"end time",value:e.parameters.end_time,type:"String",units:"",hint:"End Time to restrict the GTFS in a period",rules:["required","timeRule"]}]);return{showOverwriteDialog:s,poly:h,runGTFS:e,store:m,nodes:d,gtfsList:p,checkall:g,showHint:t,parameters:x,rules:q,linksIsEmpty:S,UploadedGTFS:u,callID:E,running:M,error:P,errorMessage:L,isUploading:A}},methods:{uploadGTFS(){this.$refs.zipInput.click(),document.getElementById("zip-input").value=""},async readZip(e){try{this.store.changeLoading(!0);const a=e.target.files;if(!a.length){this.store.changeLoading(!1);return}for(const m of a){const s=await K(m),h=s.reduce((g,t)=>t.start_date<g?t.start_date:g,s[0].start_date),d=s.reduce((g,t)=>t.end_date>g?t.end_date:g,s[0].end_date),p={content:m,info:{name:m.name,minDate:h,maxDate:d,date:h,progress:0}};await this.runGTFS.addGTFS(p)}this.store.changeLoading(!1)}catch(a){this.store.changeLoading(!1),this.store.changeAlert(a)}},importGTFS(){if(this.linksIsEmpty){const e=this.UploadedGTFS.map(s=>s.name),a=this.UploadedGTFS.map(s=>s.date),m={files:e,dates:a};this.parameters.forEach(s=>{m[s.name]=s.value}),this.runGTFS.startExecution(m)}else this.showOverwriteDialog=!0},applyOverwriteDialog(){this.store.initLinks(),this.showOverwriteDialog=!1,this.importGTFS()}}},de=e=>(se("data-v-15c8ebf3"),e=e(),ae(),e),ue={class:"params-row"},ce={class:"list"},pe={class:"list-row bold"},me=de(()=>o("span",{class:"list-item-small"},null,-1)),he={class:"list-item-large"},ge={class:"list-item-medium"},fe={class:"list-item-medium"},_e={class:"list-item-medium"},ve={class:"list-item-small"},Se={class:"list-item-small"},ye={class:"list-item-large"},we={class:"list-item-medium"},De={class:"list-item-medium"},Ve={class:"list-item-medium"},ke={class:"list-item-small"},be={class:"bottom-button"};function xe(e,a,m,s,h,d){const p=T("v-card-action"),g=T("DatePicker");return i(),v("div",null,[o("input",{id:"zip-input",ref:"zipInput",type:"file",style:{display:"none"},accept:".zip",multiple:"multiple",onChange:a[0]||(a[0]=(...t)=>d.readZip&&d.readZip(...t))},null,544),l(I,{class:"card"},{default:r(()=>[l(F,{class:"subtitle"},{default:r(()=>[c(n(e.$gettext("GTFS importer")),1)]),_:1}),l(V,null,{default:r(()=>[c(n(e.$gettext("import GTFS from local computer")),1)]),_:1}),l(V,null,{default:r(()=>[c(n(e.$gettext("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),l(p,null,{default:r(()=>[l(D,{disabled:s.running,"prepend-icon":"fa-solid fa-file-archive",onClick:d.uploadGTFS},{default:r(()=>[c(n(e.$gettext("upload GTFS")),1)]),_:1},8,["disabled","onClick"])]),_:1}),l(V,null,{default:r(()=>[s.error?(i(),y($,{key:0,density:"compact",variant:"outlined",text:"",type:"error"},{default:r(()=>[c(n(e.$gettext("There as been an error while converting your GTFS.             Please try again. If the problem persist, contact us."))+" ",1),(i(!0),v(k,null,b(Object.keys(s.errorMessage),t=>(i(),v("p",{key:t},[o("b",null,n(t)+": ",1),c(n(s.errorMessage[t]),1)]))),128))]),_:1})):Y("",!0)]),_:1}),o("div",ue,[(i(!0),v(k,null,b(s.parameters,(t,S)=>(i(),v("div",{key:S,class:"params"},[typeof t.items>"u"?(i(),y(z,{key:0,modelValue:t.value,"onUpdate:modelValue":u=>t.value=u,type:t.type,variant:"underlined",label:e.$gettext(t.text),suffix:t.units,hint:s.showHint?e.$gettext(t.hint):"","persistent-hint":s.showHint,rules:t.rules.map(u=>s.rules[u]),required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):(i(),y(X,{key:1,modelValue:t.value,"onUpdate:modelValue":u=>t.value=u,type:t.type,items:t.items,label:e.$gettext(t.text),suffix:t.units,hint:s.showHint?e.$gettext(t.hint):"","persistent-hint":s.showHint,rules:t.rules.map(u=>s.rules[u]),required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),o("div",ce,[o("li",pe,[me,o("span",he,n(e.$gettext("name")),1),o("span",ge,n(e.$gettext("from")),1),o("span",fe,n(e.$gettext("to")),1),o("span",_e,n(e.$gettext("selected date")),1),o("span",ve,n(e.$gettext("Uploaded")),1)]),(i(!0),v(k,null,b(s.UploadedGTFS,(t,S)=>(i(),v("ul",{key:S,class:"list-row"},[o("span",Se,n(S),1),o("span",ye,n(t.name),1),o("span",we,n(t.minDate),1),o("span",De,n(t.maxDate),1),o("span",Ve,[l(g,{date:t.date,from:t.minDate,to:t.maxDate,"onUpdate:date":u=>t.date=u},null,8,["date","from","to","onUpdate:date"])]),o("span",ke,[t.progress<100?(i(),y(J,{key:0,indeterminate:t.progress===0,absolute:"",color:"primary","model-value":t.progress},null,8,["indeterminate","model-value"])):(i(),y(G,{key:1},{default:r(()=>[c("fas fa-check")]),_:1}))])]))),128))]),o("div",be,[l(D,{loading:s.running,disabled:s.running||s.UploadedGTFS.length==0||s.isUploading,color:"success",onClick:d.importGTFS},{default:r(()=>[l(G,{size:"small",style:{"margin-right":"10px"}},{default:r(()=>[c(" fa-solid fa-play ")]),_:1}),c(" "+n(e.$gettext("convert")),1)]),_:1},8,["loading","disabled","onClick"])])]),_:1}),l(te,{modelValue:s.showOverwriteDialog,"onUpdate:modelValue":a[2]||(a[2]=t=>s.showOverwriteDialog=t),persistent:"","max-width":"500",onKeydown:[U(d.applyOverwriteDialog,["enter"]),a[3]||(a[3]=U(t=>s.showOverwriteDialog=!1,["esc"]))]},{default:r(()=>[l(I,null,{default:r(()=>[l(F,{class:"text-h5"},{default:r(()=>[c(n(e.$gettext("Overwrite current road network ?")),1)]),_:1}),l(Q,null,{default:r(()=>[l(ee),l(D,{color:"regular",onClick:a[1]||(a[1]=t=>s.showOverwriteDialog=!s.showOverwriteDialog)},{default:r(()=>[c(n(e.$gettext("No")),1)]),_:1}),l(D,{color:"primary",onClick:d.applyOverwriteDialog},{default:r(()=>[c(n(e.$gettext("Yes")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const Ie=O(ie,[["render",xe],["__scopeId","data-v-15c8ebf3"]]);export{Ie as default};
