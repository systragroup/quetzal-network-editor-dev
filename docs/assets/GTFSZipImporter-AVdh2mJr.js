import{_ as K,g as T,f as S,h as o,i as s,cx as q,a1 as J,O as X,F as ee,an as te,u as ae,b2 as se,ab as ne,a as le,r as y,p as g,o as oe,e as b,A as l,ag as z,B as m,C as n,l as r,az as L,a8 as A,L as k,H as re,I as ie,cy as ue,V as de,Q as E,a9 as ce,Z as N,aj as pe,aK as Z,cz as me,ao as fe}from"./index-CVO2KWKY.js";import{W as _e}from"./Warning-C-Ysmcj3.js";import{T as ge}from"./TimeSeriesSelector-CgsomE-f.js";import"./form-B2uRhppC.js";const ve={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(u){this.$emit("update:date",this.parseOutput(u))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(u){if(u)return new Date(u.substring(0,4)+"-"+u.substring(4,6)+"-"+u.substring(6,8))},parseOutput(u){return u.toISOString().substring(0,10).replaceAll("-","")}}};function he(u,a,d,w,i,p){return S(),T(ee,{modelValue:i.menu,"onUpdate:modelValue":a[1]||(a[1]=v=>i.menu=v),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:o(({props:v})=>[s(J,X({"model-value":p.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},v),null,16,["model-value"])]),default:o(()=>[s(q,{modelValue:i.isoDate,"onUpdate:modelValue":a[0]||(a[0]=v=>i.isoDate=v),max:i.dateMax,min:i.dateMin},null,8,["modelValue","max","min"])]),_:1},8,["modelValue"])}const Se=K(ve,[["render",he],["__scopeId","data-v-1eb87a33"]]),Ve={class:"background"},De={class:"list"},xe={class:"list-row bold"},ye={class:"list-item-large"},ke={class:"list-item-medium"},we={class:"list-item-medium"},Ie={class:"list-item-medium"},be={class:"list-item-small"},Te={class:"list-item-small"},Fe={class:"list-item-large"},Ce={class:"list-item-medium"},Ge={class:"list-item-medium"},Ue={class:"list-item-medium"},Me={class:"list-item-small"},Be={class:"bottom-button"},Oe=te({__name:"GTFSZipImporter",setup(u){const{$gettext:a}=ae(),d=se(),w=ne(),i=le(),p=y(!1),v=g(()=>w.linksIsEmpty),h=g(()=>d.uploadedGTFS),x=g(()=>d.running),R=g(()=>d.callID),W=g(()=>d.error),$=g(()=>d.errorMessage),F=g(()=>h.value.filter(c=>c.progress<100).length>0),C=g(()=>d.parameters),I=y(C.value.timeseries);function G(){const c=h.value.map(e=>e.name),t=h.value.map(e=>e.date);d.saveParams({files:c,timeseries:Z(I.value),dates:t})}oe(()=>{G()});const U=y();function j(){U.value.click();const c=document.getElementById("zip-input");c&&(c.value="")}async function H(c){try{i.changeLoading(!0);const e=c.target.files;if(!(e!=null&&e.length)){i.changeLoading(!1);return}for(const f of Array.from(e)){const _=await me(f),P=_.reduce((V,D)=>D.start_date<V?D.start_date:V,_[0].start_date),Q=_.reduce((V,D)=>D.end_date>V?D.end_date:V,_[0].end_date),Y={content:f,info:{name:f.name,minDate:P,maxDate:Q,date:P,progress:0}};await d.addGTFS(Y)}i.changeLoading(!1)}catch(t){i.changeLoading(!1),i.changeAlert(t)}}const M=y();async function B(){var t;if(await M.value.validate())if(v.value){G();const e=Z(C.value),f=fe(),_={scenario_path_S3:R.value,launcher_arg:{training_folder:"/tmp",params:e},metadata:{user_email:(t=f.cognitoInfo)==null?void 0:t.email}};d.start(_)}else p.value=!0}function O(){w.$reset(),p.value=!1,B()}return(c,t)=>(S(),b("div",Ve,[l("input",{id:"zip-input",ref_key:"zipInput",ref:U,type:"file",style:{display:"none"},accept:".zip",multiple:"",onChange:H},null,544),s(E,{class:"card"},{default:o(()=>[s(z,{class:"subtitle"},{default:o(()=>[m(n(r(a)("GTFS importer")),1)]),_:1}),s(L,null,{default:o(()=>[m(n(r(a)("import GTFS from local computer")),1)]),_:1}),s(L,null,{default:o(()=>[m(n(r(a)("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),s(A,null,{default:o(()=>[s(k,{variant:"elevated",disabled:x.value,"prepend-icon":"fa-solid fa-file-archive",onClick:j},{default:o(()=>[m(n(r(a)("upload GTFS")),1)]),_:1},8,["disabled"])]),_:1}),s(_e,{show:W.value,messages:$.value},null,8,["show","messages"]),s(ge,{ref_key:"formRef",ref:M,modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e)},null,8,["modelValue"]),l("div",De,[l("li",xe,[t[4]||(t[4]=l("span",{class:"list-item-small"},null,-1)),l("span",ye,n(r(a)("name")),1),l("span",ke,n(r(a)("from")),1),l("span",we,n(r(a)("to")),1),l("span",Ie,n(r(a)("selected date")),1),l("span",be,n(r(a)("Uploaded")),1)]),(S(!0),b(re,null,ie(h.value,(e,f)=>(S(),b("ul",{key:f,class:"list-row"},[l("span",Te,n(f),1),l("span",Fe,n(e.name),1),l("span",Ce,n(e.minDate),1),l("span",Ge,n(e.maxDate),1),l("span",Ue,[s(Se,{date:e.date,from:e.minDate,to:e.maxDate,"onUpdate:date":_=>e.date=_},null,8,["date","from","to","onUpdate:date"])]),l("span",Me,[e.progress<100?(S(),T(ue,{key:0,indeterminate:e.progress===0,absolute:"",color:"primary","model-value":e.progress},null,8,["indeterminate","model-value"])):(S(),T(de,{key:1},{default:o(()=>[...t[5]||(t[5]=[m("fas fa-check",-1)])]),_:1}))])]))),128))]),l("div",Be,[s(k,{loading:x.value,disabled:x.value||h.value.length==0||F.value,color:x.value||h.value.length==0||F.value?"regular":"success","prepend-icon":"fa-solid fa-play",onClick:B},{default:o(()=>[m(n(r(a)("convert")),1)]),_:1},8,["loading","disabled","color"])])]),_:1}),s(pe,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),persistent:"","max-width":"500",onKeydown:[N(O,["enter"]),t[3]||(t[3]=N(e=>p.value=!1,["esc"]))]},{default:o(()=>[s(E,null,{default:o(()=>[s(z,{class:"text-h5"},{default:o(()=>[m(n(r(a)("Overwrite current PT network ?")),1)]),_:1}),s(A,null,{default:o(()=>[s(ce),s(k,{color:"regular",onClick:t[1]||(t[1]=e=>p.value=!p.value)},{default:o(()=>[m(n(r(a)("No")),1)]),_:1}),s(k,{color:"primary",onClick:O},{default:o(()=>[m(n(r(a)("Yes")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),Ee=K(Oe,[["__scopeId","data-v-0855f022"]]);export{Ee as default};
