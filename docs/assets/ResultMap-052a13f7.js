import{n,g as p,p as d,M as u,a as h,b as m,c as g,h as y,m as o,i as f,j as c}from"./index-63e2fb46.js";const v={name:"SidePanel",components:{},model:{prop:"selectedCategory",event:"update-selectedCategory"},props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer"],events:["update-selectedCategory","select-layer","update-selected-filter"],data(){return{showLeftPanelContent:!0,height:null,editorTrip:!1,showDialog:!1,openMenu:!1,selectedCat:[],vmodelSelectedFilter:""}},computed:{showLeftPanel(){return this.$store.getters.showLeftPanel},windowHeight(){return this.$store.getters.windowHeight-130},running(){return this.$store.getters["run/running"]}},watch:{showLeftPanel(a){a?setTimeout(()=>{this.showLeftPanelContent=!0},500):this.showLeftPanelContent=!1},selectedCat(a){this.$emit("update-selectedCategory",a)},selectedFilter(a){a!==this.vmodelSelectedFilter&&(this.vmodelSelectedFilter=a,this.selectedCat=this.selectedCategory)},vmodelSelectedFilter(a,e){e&&(this.$emit("update-selectedFilter",a),this.selectedCat=this.selectedCategory)}},created(){this.selectedCat=this.selectedCategory,this.vmodelSelectedFilter=this.selectedFilter},methods:{showAll(){this.selectedCat.length===this.filteredCat.length?this.selectedCat=[]:this.selectedCat=this.filteredCat}}};var _=function(){var e=this,t=e._self._c;return t("section",{class:e.showLeftPanel?"left-panel elevation-4":"left-panel-close",style:{width:e.showLeftPanel?"350px":"0px"}},[t("div",{staticClass:"left-panel-toggle-btn elevation-4",on:{click:function(s){return e.$store.commit("changeLeftPanel")}}},[t("v-icon",{attrs:{small:"",color:"secondarydark"}},[e._v(" "+e._s(e.showLeftPanel?"fas fa-chevron-left":"fas fa-chevron-right")+" ")])],1),t("transition",{attrs:{name:"fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showLeftPanelContent,expression:"showLeftPanelContent"}],staticClass:"left-panel-content"},[t("div",[t("div",{style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},[t("v-card-title",{staticClass:"white--text secondary"},[t("v-tooltip",{attrs:{bottom:"","open-delay":"500"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:l}){return[t("v-btn",e._g(e._b({staticClass:"ma-2",style:{color:"white"},attrs:{icon:""},on:{click:function(r){return e.showAll()}}},"v-btn",l,!1),s),[t("v-icon",{staticClass:"list-item-icon"},[e._v(" "+e._s(e.selectedCat.length>0?"fa-eye fa":"fa-eye-slash fa")+" ")])],1)]}}])},[t("span",[e._v(e._s(e.selectedCat.length>0?e.$gettext("Hide All"):e.$gettext("Show All")))])]),t("v-spacer"),t("v-menu",{attrs:{"close-delay":"100","offset-y":"",transition:"slide-y-transition"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:l}){return[t("span",e._g(e._b({staticClass:"title"},"span",l,!1),s),[e._v(e._s(e.selectedLayer))])]}}]),model:{value:e.openMenu,callback:function(s){e.openMenu=s},expression:"openMenu"}},[t("v-list",e._l(e.layerChoices,function(s,l){return t("v-list-item",{key:l,attrs:{link:""}},[t("v-list-item-title",{on:{click:()=>e.$emit("select-layer",s)}},[e._v(" "+e._s(s)+" ")])],1)}),1)],1),t("v-spacer"),t("v-btn",{staticClass:"ma-2",style:{color:"white"},attrs:{icon:"",dark:""},on:{click:function(s){e.openMenu=!e.openMenu}}},[t("v-icon",[e._v(" "+e._s(e.openMenu?"fas fa-chevron-left":"fas fa-chevron-down"))])],1)],1),t("v-card",{staticClass:"mx-auto scrollable",attrs:{"max-width":"100%","min-width":"100%",height:e.windowHeight}},[t("v-list-item",[t("v-select",{attrs:{items:e.filterChoices,"prepend-icon":"fas fa-filter",label:e.$gettext("filter"),"item-color":"secondarydark",color:"secondarydark"},model:{value:e.vmodelSelectedFilter,callback:function(s){e.vmodelSelectedFilter=s},expression:"vmodelSelectedFilter"}})],1),t("v-virtual-scroll",{attrs:{items:e.filteredCat,"item-height":45,height:e.windowHeight-80},scopedSlots:e._u([{key:"default",fn:function({item:s}){return[t("v-list-item",{key:e.vmodelSelectedFilter.concat(s),staticClass:"pl-2"},[t("v-list-item-action",[t("v-checkbox",{staticClass:"pl-2",attrs:{"on-icon":"fa-eye fa","off-icon":"fa-eye-slash fa",color:"primary",value:s,size:"10","hide-details":""},model:{value:e.selectedCat,callback:function(l){e.selectedCat=l},expression:"selectedCat"}})],1),t("v-list-item-title",[e._v(" "+e._s(s)+" ")])],1)]}}])})],1)],1)])])])],1)},k=[],w=n(v,_,k,!1,null,"37d54a60",null,null);const x=w.exports;function b(a,e){e===void 0&&(e={});var t=0,s=0,l=0;return p(a,function(r){t+=r[0],s+=r[1],l++},!0),d([t/l,s/l],e.properties)}const S="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",$={name:"ResultMap",components:{MglMap:u,MglNavigationControl:h,MglScaleControl:m,MglGeojsonLayer:g,MglImageLayer:y},props:["links","selectedFeature","opacity","offset"],events:["selectClick"],data(){return{mapIsLoaded:!1,mapboxPublicKey:null,selectedLinks:[],minZoom:{nodes:14,links:2}}},computed:{mapStyle(){return this.$store.getters.mapStyle},layerType(){return this.$store.getters["results/type"]},offsetValue(){return this.offset?-1:1}},watch:{mapStyle(a){this.map&&(this.map.getLayer("arrow")&&this.map.removeLayer("arrow"),this.map.getLayer("links")&&this.map.removeLayer("links"),this.map.getLayer("zones")&&this.map.removeLayer("zones"),this.map.getLayer("nodes")&&this.map.removeLayer("nodes"),this.mapIsLoaded=!1,this.saveMapPosition())}},created(){this.mapboxPublicKey=S},beforeDestroy(){this.map.getLayer("arrow")&&this.map.removeLayer("arrow"),this.saveMapPosition()},methods:{saveMapPosition(){const a=this.map.getCenter();this.$store.commit("saveMapPosition",{mapCenter:[a.lng,a.lat],mapZoom:this.map.getZoom()})},onMapLoaded(a){this.map&&(this.mapIsLoaded=!1);const e=new o.LngLatBounds;this.layerType==="Polygon"?this.links.features.forEach(t=>{try{t.geometry.type==="Polygon"?e.extend([t.geometry.coordinates[0][0],t.geometry.coordinates[0][t.geometry.coordinates.length-1]]):e.extend([t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][t.geometry.coordinates.length-1]])}catch(s){this.$store.commit("changeAlert",s)}}):this.links.features.forEach(t=>{e.extend([t.geometry.coordinates[0],t.geometry.coordinates[t.geometry.coordinates.length-1]])}),Object.keys(e).length!==0&&a.map.fitBounds(e,{padding:100}),a.map.loadImage(f,function(t,s){if(t){console.error("err image",t);return}a.map.addImage("arrow",s,{sdf:!0})}),this.map=a.map,a.map.dragRotate.disable(),this.mapIsLoaded=!0},enterLink(a){var e;if(a.map.getCanvas().style.cursor="pointer",this.selectedLinks=a.mapboxEvent.features,(e=this.popup)!=null&&e.isOpen()&&this.popup.remove(),this.selectedFeature.length>0&&this.layerType!=="Polygon"){const t=this.selectedLinks[0].properties[this.selectedFeature];this.popup=new o.Popup({closeButton:!1}).setLngLat([a.mapboxEvent.lngLat.lng,a.mapboxEvent.lngLat.lat]).setHTML(`${this.selectedFeature}: <br> ${t}`).addTo(a.map)}},leaveLink(a){var e;this.selectedLinks=[],(e=this.popup)!=null&&e.isOpen()&&this.popup.remove(),a.map.getCanvas().style.cursor=""},selectClick(a){var e;this.selectedLinks=a.mapboxEvent.features,((e=this.selectedLinks)==null?void 0:e.length)>0&&this.$emit("selectClick",{feature:this.selectedLinks[0].properties,action:"featureClick"})},zoneClick(a){var e;this.selectedLinks=a.mapboxEvent.features,((e=this.selectedLinks)==null?void 0:e.length)>0&&this.$emit("selectClick",{feature:this.selectedLinks[0].properties,action:"zoneClick"})},zoneHover(a){var e,t;if(((e=this.selectedLinks[0])==null?void 0:e.id)!==a.mapboxEvent.features[0].id&&(this.selectedLinks=a.mapboxEvent.features,(t=this.popup)!=null&&t.isOpen()&&this.popup.remove(),this.selectedFeature.length>0)){const s=this.selectedLinks[0].properties[this.selectedFeature];this.popup=new o.Popup({closeButton:!1}).setLngLat(b(this.selectedLinks[0].geometry).geometry.coordinates).setHTML(`${this.selectedFeature}: <br> ${s}`).addTo(a.map)}}}};var C=function(){var e=this,t=e._self._c;return t("MglMap",{key:e.mapStyle,style:{width:"100%"},attrs:{"access-token":e.mapboxPublicKey,"map-style":e.mapStyle,center:e.$store.getters.mapCenter,zoom:e.$store.getters.mapZoom},on:{load:e.onMapLoaded}},[t("MglScaleControl",{attrs:{position:"bottom-right"}}),t("MglNavigationControl",{attrs:{position:"bottom-right"}}),e.layerType=="LineString"?t("MglGeojsonLayer",{attrs:{"source-id":"links",source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"links",layer:{interactive:!0,type:"line",minzoom:e.minZoom.links,paint:{"line-color":["case",["has","display_color"],["get","display_color"],"#B5E0D6"],"line-offset":["*",e.offsetValue*.5,["to-number",["get","display_width"]]],"line-opacity":e.opacity/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["case",["has","display_width"],["get","display_width"],4]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}}},on:{mouseenter:e.enterLink,mouseleave:e.leaveLink,click:e.zoneClick,contextmenu:e.selectClick}}):e._e(),e.layerType=="Point"?t("MglGeojsonLayer",{attrs:{"source-id":"nodes",source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"nodes",layer:{interactive:!0,type:"circle",minzoom:e.minZoom.links,paint:{"circle-color":["case",["has","display_color"],["get","display_color"],"#B5E0D6"],"circle-radius":["case",["has","display_width"],["get","display_width"],3],"circle-opacity":e.opacity/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}}},on:{mouseenter:e.enterLink,mouseleave:e.leaveLink,click:e.zoneClick,contextmenu:e.selectClick}}):e._e(),e.layerType=="LineString"?t("MglImageLayer",{attrs:{"source-id":"links",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:e.minZoom.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[e.offsetValue*5,5]},paint:{"icon-color":["case",["has","display_color"],["get","display_color"],"#B5E0D6"],"icon-opacity":e.opacity/100}}}}):e._e(),e.layerType==="Polygon"?t("MglGeojsonLayer",{attrs:{"source-id":"polygon",source:{type:"geojson",data:e.links,promoteId:"index"},"layer-id":"zones",layer:{interactive:!0,type:"fill",paint:{"fill-color":["case",["has","display_color"],["get","display_color"],e.$vuetify.theme.currentTheme.linksprimary],"fill-opacity":e.opacity/100}}},on:{click:e.zoneClick,contextmenu:e.selectClick}}):e._e()],1)},L=[],F=n($,C,L,!1,null,"ca31dba9",null,null);const M=F.exports;const i=a=>a,H={name:"ResultsSettings",model:{prop:"show",event:"update-show"},props:["show","displaySettings","featureChoices"],events:["update-show","submit"],data(){return{parameters:[{name:i("selectedFeature"),type:"String",value:this.displaySettings.selectedFeature,units:"",hint:i("selectedFeature")},{name:i("maxWidth"),type:"Number",value:this.displaySettings.maxWidth,units:"a.u.",hint:i("maxWidth")},{name:i("minWidth"),type:"Number",value:this.displaySettings.minWidth,units:"a.u.",hint:i("minWidth")},{name:i("numStep"),type:"Number",value:this.displaySettings.numStep,units:"int",hint:i("numStep")},{name:i("opacity"),type:"Number",value:this.displaySettings.opacity,units:"number",hint:i("opacity")},{name:i("scale"),type:"String",value:this.displaySettings.scale,choices:["linear","sqrt","log"],units:"",hint:i("scale")},{name:i("color map"),type:"String",choices:Object.keys(c.brewer).slice(0,36),value:this.displaySettings.cmap,units:"",hint:i("cmap to use")},{name:i("show NaN"),value:this.displaySettings.showNaN,hint:i("Hide NaN on map and color map")},{name:i("reverse color"),value:this.displaySettings.reverseColor,hint:i("reverse color scale")},{name:i("scale min"),type:"Number",value:this.displaySettings.minVal,units:"a.u.",hint:i("mininum value on the color Map")},{name:i("scale max"),type:"Number",value:this.displaySettings.maxVal,units:"a.u.",hint:i("maximum value on the color Map")},{name:i("custom scale"),value:this.displaySettings.fixScale,hint:i("customize to inputs values")},{name:i("Left side driving"),value:this.displaySettings.offset,hint:i("Select which side of the road the links are display")}],errorMessage:null,showHint:!1,showFixScale:!1,shake:!1,rules:{required:a=>!!a||i("Required"),largerThanZero:a=>a>0||i("should be larger than 0"),nonNegative:a=>a>=0||i("should be larger or equal to 0")},showDialog:!1}},watch:{showDialog(a){this.refresh(),this.showFixScale=this.parameters[11].value,this.$emit("update-show",a)},featureChoices(){this.refresh()}},created(){this.showDialog=this.show},methods:{toggleFixScale(){this.parameters[11].value?(this.showFixScale=!0,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal):this.showFixScale=!1},getColor(a){const e=[],t=c.scale(a).padding([.2,0]).domain([0,100]).classes(25);for(let s=0;s<100;s++)e.push(t(s).hex());return e},refresh(){this.parameters[0].value=this.displaySettings.selectedFeature,this.parameters[1].value=this.displaySettings.maxWidth,this.parameters[2].value=this.displaySettings.minWidth,this.parameters[3].value=this.displaySettings.numStep,this.parameters[4].value=this.displaySettings.opacity,this.parameters[5].value=this.displaySettings.scale,this.parameters[6].value=this.displaySettings.cmap,this.parameters[7].value=this.displaySettings.showNaN,this.parameters[8].value=this.displaySettings.reverseColor,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal,this.parameters[11].value=this.displaySettings.fixScale,this.parameters[12].value=this.displaySettings.offset},submit(){this.$refs.form.validate()?this.$emit("submit",{selectedFeature:this.parameters[0].value,maxWidth:Number(this.parameters[1].value),minWidth:Number(this.parameters[2].value),numStep:Number(this.parameters[3].value),opacity:Number(this.parameters[4].value),scale:this.parameters[5].value,cmap:this.parameters[6].value,showNaN:this.parameters[7].value,reverseColor:this.parameters[8].value,minVal:Number(this.parameters[9].value),maxVal:Number(this.parameters[10].value),fixScale:this.parameters[11].value,offset:this.parameters[12].value}):(this.shake=!0,setTimeout(()=>{this.shake=!1},500))},cancel(){this.showDialog=!1}}};var P=function(){var e=this,t=e._self._c;return t("v-menu",{attrs:{"close-on-content-click":!1,"close-on-click":!1,origin:"top right",transition:"scale-transition","position-y":30,"nudge-width":200,"offset-x":"","offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:l}){return[t("div",{staticClass:"setting"},[t("v-btn",e._g(e._b({attrs:{fab:"",small:""}},"v-btn",l,!1),s),[t("v-icon",{attrs:{color:isFinite(e.displaySettings.maxVal)?"regular":"error"}},[e._v(" fa-solid fa-cog ")])],1)],1)]}}]),model:{value:e.showDialog,callback:function(s){e.showDialog=s},expression:"showDialog"}},[t("v-card",{class:{shake:e.shake},attrs:{"max-width":"20rem"},on:{keydown:[function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.submit.apply(null,arguments)},function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"esc",27,s.key,["Esc","Escape"])?null:e.cancel.apply(null,arguments)}]}},[t("v-card-title",{staticClass:"subtitle"},[e._v(" "+e._s(e.$gettext("Settings"))+" "),t("v-spacer"),t("v-btn",{attrs:{icon:"",small:""},on:{click:e.cancel}},[t("v-icon",{attrs:{color:"regular"}},[e._v(" fa-solid fa-times ")])],1)],1),t("v-card-text",[t("v-form",{ref:"form",attrs:{"lazy-validation":""}},[t("v-container",[t("v-col",[t("v-select",{attrs:{items:e.featureChoices,label:e.$gettext(e.parameters[0].name),hint:e.showHint?e.$gettext(e.parameters[0].hint):"","persistent-hint":e.showHint,required:""},model:{value:e.parameters[0].value,callback:function(s){e.$set(e.parameters[0],"value",s)},expression:"parameters[0].value"}}),t("v-row",e._l(e.parameters.slice(1,3),function(s){return t("v-col",{key:s.name},[t("v-text-field",{attrs:{type:s.type,label:e.$gettext(s.name),suffix:s.units,hint:e.showHint?e.$gettext(s.hint):"","persistent-hint":e.showHint,required:""},on:{wheel:()=>{}},model:{value:s.value,callback:function(l){e.$set(s,"value",l)},expression:"item.value"}})],1)}),1),t("v-text-field",{attrs:{type:e.parameters[3].type,label:e.$gettext(e.parameters[3].name),suffix:e.parameters[3].units,hint:e.showHint?e.$gettext(e.parameters[3].hint):"","persistent-hint":e.showHint,required:""},on:{wheel:()=>{}},model:{value:e.parameters[3].value,callback:function(s){e.$set(e.parameters[3],"value",s)},expression:"parameters[3].value"}}),t("v-select",{attrs:{items:e.parameters[5].choices,label:e.$gettext(e.parameters[5].name),hint:e.showHint?e.$gettext(e.parameters[5].hint):"","persistent-hint":e.showHint,required:""},model:{value:e.parameters[5].value,callback:function(s){e.$set(e.parameters[5],"value",s)},expression:"parameters[5].value"}}),t("v-select",{attrs:{items:e.parameters[6].choices,label:e.$gettext(e.parameters[6].name),hint:e.showHint?e.$gettext(e.parameters[6].hint):"","persistent-hint":e.showHint,required:""},scopedSlots:e._u([{key:"item",fn:function({item:s}){return[t("div",{staticClass:"gradient"},[e._l(e.getColor(s),function(l,r){return t("span",{key:r,staticClass:"grad-step",style:{backgroundColor:l}})}),t("span",{staticClass:"domain-title"},[e._v(e._s(s))])],2)]}}]),model:{value:e.parameters[6].value,callback:function(s){e.$set(e.parameters[6],"value",s)},expression:"parameters[6].value"}}),t("v-slider",{staticClass:"align-center",attrs:{"inverse-label":"",label:e.$gettext(e.parameters[4].name),"track-color":"secondary",max:100,"thumb-label":"",min:0,"hide-details":""},scopedSlots:e._u([{key:"thumb-label",fn:function({value:s}){return[e._v(" "+e._s(s+"%")+" ")]}}]),model:{value:e.parameters[4].value,callback:function(s){e.$set(e.parameters[4],"value",s)},expression:"parameters[4].value"}}),t("v-switch",{key:e.parameters[12].name,attrs:{label:e.$gettext(e.parameters[12].name),hint:e.showHint?e.$gettext(e.parameters[12].hint):"","persistent-hint":e.showHint},model:{value:e.parameters[12].value,callback:function(s){e.$set(e.parameters[12],"value",s)},expression:"parameters[12].value"}}),t("v-switch",{key:e.parameters[7].name,attrs:{label:e.$gettext(e.parameters[7].name),hint:e.showHint?e.$gettext(e.parameters[7].hint):"","persistent-hint":e.showHint},model:{value:e.parameters[7].value,callback:function(s){e.$set(e.parameters[7],"value",s)},expression:"parameters[7].value"}}),t("v-switch",{key:e.parameters[8].name,attrs:{label:e.$gettext(e.parameters[8].name),hint:e.showHint?e.$gettext(e.parameters[7].hint):"","persistent-hint":e.showHint},model:{value:e.parameters[8].value,callback:function(s){e.$set(e.parameters[8],"value",s)},expression:"parameters[8].value"}}),t("v-switch",{key:e.parameters[11].name,attrs:{label:e.$gettext(e.parameters[11].name),hint:e.showHint?e.$gettext(e.parameters[11].hint):"","persistent-hint":e.showHint},on:{click:function(s){return e.toggleFixScale(e.parameters[11].name)}},model:{value:e.parameters[11].value,callback:function(s){e.$set(e.parameters[11],"value",s)},expression:"parameters[11].value"}}),e._l(e.parameters.slice(9,11),function(s){return t("v-text-field",{directives:[{name:"show",rawName:"v-show",value:e.showFixScale,expression:"showFixScale"}],key:s.name,attrs:{type:s.type,label:e.$gettext(s.name),suffix:s.units,hint:e.showHint?e.$gettext(s.hint):"","persistent-hint":e.showHint,required:""},on:{wheel:()=>{}},model:{value:s.value,callback:function(l){e.$set(s,"value",l)},expression:"item.value"}})})],2)],1)],1)],1),t("v-card-actions",[t("v-btn",{attrs:{color:"grey",text:""},on:{click:e.cancel}},[e._v(" "+e._s(e.$gettext("Cancel"))+" ")]),t("v-btn",{attrs:{color:"green darken-1",text:""},on:{click:e.submit}},[e._v(" "+e._s(e.$gettext("Save"))+" ")]),t("v-spacer"),t("v-btn",{attrs:{icon:"",small:""},on:{click:function(s){e.showHint=!e.showHint}}},[t("v-icon",[e._v("far fa-question-circle small")])],1)],1)],1)],1)},N=[],D=n(H,P,N,!1,null,"e03a20f1",null,null);const R=D.exports;const E={name:"MapLegend",components:{},props:{colorScale:{type:Array,default:()=>[]},displaySettings:{type:Object,default:()=>{}}},data(){return{}},watch:{},methods:{}};var j=function(){var e=this,t=e._self._c;return t("div",{staticClass:"gradient"},[e._l(e.colorScale,function(s,l){return t("span",{key:l,staticClass:"grad-step",style:{backgroundColor:s}})}),t("span",{staticClass:"domain-title"},[e._v(e._s(e.displaySettings.selectedFeature))]),t("span",{staticClass:"domain-min"},[e._v(e._s(Math.round(e.displaySettings.minVal)))]),t("span",{staticClass:"domain-med"},[e._v(e._s(Math.round((e.displaySettings.maxVal+e.displaySettings.minVal)/2)))]),t("span",{staticClass:"domain-max"},[e._v(e._s(Math.round(e.displaySettings.maxVal)))])],2)},z=[],I=n(E,j,z,!1,null,"26c39026",null,null);const T=I.exports;const V={name:"ResultMap",components:{ResultsSidePanel:x,MapResults:M,ResultsSettings:R,MapLegend:T},data(){return{mapIsLoaded:!1,minZoom:{nodes:14,links:8},showSettings:!1,selectedLayer:"links",selectedCategory:[],form:{},showDialog:!1}},computed:{windowHeight(){return this.$store.getters.windowHeight-100},availableLayers(){return this.$store.getters.availableLayers},links(){return this.$store.getters["results/links"]},visibleLinks(){return this.$store.getters["results/visibleLinks"]},filterChoices(){return this.$store.getters["results/lineAttributes"]},displaySettings(){return this.$store.getters["results/displaySettings"]},selectedFilter(){return this.$store.getters["results/selectedFilter"]},colorScale(){return this.$store.getters["results/colorScale"]},filteredCategory(){return Array.from(new Set(this.links.features.map(e=>e.properties[this.selectedFilter])))}},watch:{selectedCategory(a){this.$store.commit("results/changeSelectedCategory",a),this.$store.commit("results/updateSelectedFeature")}},created(){this.changeLayer(this.selectedLayer)},methods:{applySettings(a){this.$store.commit("results/applySettings",a)},updateSelectedFilter(a){this.$store.commit("results/changeSelectedFilter",a),this.$store.commit("results/updateSelectedFeature")},changeLayer(a){switch(this.selectedLayer=a,a){case"links":this.$store.commit("results/loadLinks",{geojson:this.$store.getters.links,type:"LineString",selectedFeature:"headway"});break;case"rlinks":this.$store.commit("results/loadLinks",{geojson:this.$store.getters.rlinks,type:"LineString",selectedFeature:"speed"});break;case"nodes":this.$store.commit("results/loadLinks",{geojson:this.$store.getters.nodes,type:"Point",selectedFeature:"boardings"});break;case"rnodes":this.$store.commit("results/loadLinks",{geojson:this.$store.getters.rnodes,type:"Point",selectedFeature:"boardings"});break;default:this.$store.commit("results/loadLinks",{geojson:this.$store.getters[`${a}/layer`],type:this.$store.getters[`${a}/type`]});break}this.selectedCategory=this.$store.getters["results/selectedCategory"]},featureClicked(a){if(a.action==="featureClick")this.form=a.feature,this.showDialog=!0;else if(this.$store.getters[`${this.selectedLayer}/hasOD`]){const e=this.displaySettings.selectedFeature;this.$store.commit(`${this.selectedLayer}/changeZone`,{index:a.feature.index,selectedProperty:e}),this.$store.commit("results/updateLinks",this.$store.getters[`${this.selectedLayer}/layer`])}}}};var q=function(){var e=this,t=e._self._c;return t("section",{staticClass:"map-view"},[t("ResultsSidePanel",{attrs:{"selected-filter":e.selectedFilter,"layer-choices":e.availableLayers,"selected-layer":e.selectedLayer,"filter-choices":e.filterChoices,"filtered-cat":e.filteredCategory},on:{"update-selectedFilter":e.updateSelectedFilter,"select-layer":e.changeLayer},model:{value:e.selectedCategory,callback:function(s){e.selectedCategory=s},expression:"selectedCategory"}}),t("ResultsSettings",{attrs:{"display-settings":e.displaySettings,"feature-choices":e.filterChoices},on:{submit:e.applySettings},model:{value:e.showSettings,callback:function(s){e.showSettings=s},expression:"showSettings"}}),t("div",{staticClass:"left-panel"},[t("div",{class:e.$store.getters.showLeftPanel?"legend-open elevation-4":"legend-close elevation-4",style:{top:`${e.windowHeight}px`}},[t("MapLegend",{attrs:{"color-scale":e.colorScale,"display-settings":e.displaySettings}})],1)]),t("MapResults",{key:e.$store.getters["results/type"],attrs:{links:e.visibleLinks,"selected-feature":e.displaySettings.selectedFeature,opacity:e.displaySettings.opacity,offset:e.displaySettings.offset},on:{selectClick:e.featureClicked}}),t("v-dialog",{attrs:{scrollable:"",persistent:"","max-width":"300"},on:{keydown:[function(s){if(!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter"))return null;e.showDialog=!1},function(s){if(!s.type.indexOf("key")&&e._k(s.keyCode,"esc",27,s.key,["Esc","Escape"]))return null;e.showDialog=!1}]},model:{value:e.showDialog,callback:function(s){e.showDialog=s},expression:"showDialog"}},[t("v-card",{attrs:{"max-height":"60rem"}},[t("v-card-title",{staticClass:"text-h5"},[e._v(" "+e._s(e.$gettext("link Properties"))+" ")]),t("v-divider"),t("v-card-text",[t("v-list",e._l(e.form,function(s,l){return t("v-text-field",{key:l,attrs:{value:s,label:l,filled:"",readonly:""}})}),1)],1),t("v-divider"),t("v-card-actions",[t("v-spacer"),t("v-btn",{attrs:{color:"success",text:""},on:{click:function(s){e.showDialog=!1}}},[e._v(" "+e._s(e.$gettext("ok"))+" ")])],1)],1)],1)],1)},Z=[],O=n(V,q,Z,!1,null,"52e5a8b0",null,null);const W=O.exports;export{W as default};
