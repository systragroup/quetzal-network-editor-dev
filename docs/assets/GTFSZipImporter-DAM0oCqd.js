import{_ as U,g as m,h as w,i as o,j as r,Z as C,C as z,bW as q,B as A,aX as N,a6 as Z,u as W,r as f,e as _,o as H,bX as K,f as j,q as v,v as l,ab as b,x as p,y as n,aS as y,a2 as F,G as S,ap as X,F as T,E as V,l as Y,bY as R,V as J,L as G,a3 as Q,a4 as I,a9 as $,bU as ee,bV as te}from"./index-CGhytQ6I.js";const se={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(e){this.$emit("update:date",this.parseOutput(e))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(e){if(e)return new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8))},parseOutput(e){return e.toISOString().substring(0,10).replaceAll("-","")}}};function ae(e,a,g,t,i,d){return m(),w(A,{modelValue:i.menu,"onUpdate:modelValue":a[1]||(a[1]=c=>i.menu=c),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:o(({props:c})=>[r(C,z({"model-value":d.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},c),null,16,["model-value"])]),default:o(()=>[r(q,{modelValue:i.isoDate,"onUpdate:modelValue":a[0]||(a[0]=c=>i.isoDate=c),max:i.dateMax,min:i.dateMin},null,8,["modelValue","max","min"])]),_:1},8,["modelValue"])}const ne=U(se,[["render",ae],["__scopeId","data-v-1eb87a33"]]),re=e=>e,le={name:"GTFSWebImporter",components:{DatePicker:ne},setup(){const e=N(),a=Z(),g=W(),t=f(!1),i=f(null),d=f({}),c=f([]),s=f(!1),u=f(!1),h=_(()=>a.linksIsEmpty),k=_(()=>e.UploadedGTFS),O=_(()=>e.callID),M=_(()=>e.running),P=_(()=>e.error),E=_(()=>e.errorMessage),L=_(()=>k.value.filter(D=>D.progress<100).length>0);H(()=>{e.saveParams(x.value)});const B={required:D=>!!D||re("Required")},x=f([{name:"start_time",text:"start time",value:e.parameters.start_time,type:"time",units:"",hint:"Start Time to restrict the GTFS in a period",rules:["required"]},{name:"end_time",text:"end time",value:e.parameters.end_time,type:"time",units:"",hint:"End Time to restrict the GTFS in a period",rules:["required"]}]);return{showOverwriteDialog:t,poly:i,runGTFS:e,store:g,nodes:d,gtfsList:c,checkall:s,showHint:u,parameters:x,rules:B,linksIsEmpty:h,UploadedGTFS:k,callID:O,running:M,error:P,errorMessage:E,isUploading:L}},methods:{uploadGTFS(){this.$refs.zipInput.click(),document.getElementById("zip-input").value=""},async readZip(e){try{this.store.changeLoading(!0);const a=e.target.files;if(!a.length){this.store.changeLoading(!1);return}for(const g of a){const t=await K(g),i=t.reduce((s,u)=>u.start_date<s?u.start_date:s,t[0].start_date),d=t.reduce((s,u)=>u.end_date>s?u.end_date:s,t[0].end_date),c={content:g,info:{name:g.name,minDate:i,maxDate:d,date:i,progress:0}};await this.runGTFS.addGTFS(c)}this.store.changeLoading(!1)}catch(a){this.store.changeLoading(!1),this.store.changeAlert(a)}},importGTFS(){if(this.linksIsEmpty){const e=this.UploadedGTFS.map(t=>t.name),a=this.UploadedGTFS.map(t=>t.date),g={files:e,dates:a};this.parameters.forEach(t=>{g[t.name]=t.value}),this.runGTFS.startExecution(g)}else this.showOverwriteDialog=!0},applyOverwriteDialog(){this.store.initLinks(),this.showOverwriteDialog=!1,this.importGTFS()}}},oe=e=>(ee("data-v-4e45eec4"),e=e(),te(),e),ie={class:"params-row"},de={class:"list"},ue={class:"list-row bold"},ce=oe(()=>l("span",{class:"list-item-small"},null,-1)),pe={class:"list-item-large"},me={class:"list-item-medium"},ge={class:"list-item-medium"},he={class:"list-item-medium"},fe={class:"list-item-small"},_e={class:"list-item-small"},ve={class:"list-item-large"},Se={class:"list-item-medium"},we={class:"list-item-medium"},De={class:"list-item-medium"},ye={class:"list-item-small"},Te={class:"bottom-button"};function Ve(e,a,g,t,i,d){const c=j("DatePicker");return m(),v("div",null,[l("input",{id:"zip-input",ref:"zipInput",type:"file",style:{display:"none"},accept:".zip",multiple:"multiple",onChange:a[0]||(a[0]=(...s)=>d.readZip&&d.readZip(...s))},null,544),r(G,{class:"card"},{default:o(()=>[r(b,{class:"subtitle"},{default:o(()=>[p(n(e.$gettext("GTFS importer")),1)]),_:1}),r(y,null,{default:o(()=>[p(n(e.$gettext("import GTFS from local computer")),1)]),_:1}),r(y,null,{default:o(()=>[p(n(e.$gettext("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),r(F,null,{default:o(()=>[r(S,{variant:"elevated",disabled:t.running,"prepend-icon":"fa-solid fa-file-archive",onClick:d.uploadGTFS},{default:o(()=>[p(n(e.$gettext("upload GTFS")),1)]),_:1},8,["disabled","onClick"])]),_:1}),r(y,null,{default:o(()=>[t.error?(m(),w(X,{key:0,density:"compact",variant:"outlined",text:"",type:"error"},{default:o(()=>[p(n(e.$gettext("There as been an error while converting your GTFS.             Please try again. If the problem persist, contact us."))+" ",1),(m(!0),v(T,null,V(Object.keys(t.errorMessage),s=>(m(),v("p",{key:s},[l("b",null,n(s)+": ",1),p(n(t.errorMessage[s]),1)]))),128))]),_:1})):Y("",!0)]),_:1}),l("div",ie,[(m(!0),v(T,null,V(t.parameters,(s,u)=>(m(),v("div",{key:u,class:"params"},[r(C,{modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,type:s.type,step:"1",variant:"underlined",label:e.$gettext(s.text),suffix:s.units,hint:t.showHint?e.$gettext(s.hint):"","persistent-hint":t.showHint,rules:s.rules.map(h=>t.rules[h]),required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])]))),128))]),l("div",de,[l("li",ue,[ce,l("span",pe,n(e.$gettext("name")),1),l("span",me,n(e.$gettext("from")),1),l("span",ge,n(e.$gettext("to")),1),l("span",he,n(e.$gettext("selected date")),1),l("span",fe,n(e.$gettext("Uploaded")),1)]),(m(!0),v(T,null,V(t.UploadedGTFS,(s,u)=>(m(),v("ul",{key:u,class:"list-row"},[l("span",_e,n(u),1),l("span",ve,n(s.name),1),l("span",Se,n(s.minDate),1),l("span",we,n(s.maxDate),1),l("span",De,[r(c,{date:s.date,from:s.minDate,to:s.maxDate,"onUpdate:date":h=>s.date=h},null,8,["date","from","to","onUpdate:date"])]),l("span",ye,[s.progress<100?(m(),w(R,{key:0,indeterminate:s.progress===0,absolute:"",color:"primary","model-value":s.progress},null,8,["indeterminate","model-value"])):(m(),w(J,{key:1},{default:o(()=>[p("fas fa-check")]),_:1}))])]))),128))]),l("div",Te,[r(S,{loading:t.running,disabled:t.running||t.UploadedGTFS.length==0||t.isUploading,color:t.running||t.UploadedGTFS.length==0||t.isUploading?"regular":"success","prepend-icon":"fa-solid fa-play",onClick:d.importGTFS},{default:o(()=>[p(n(e.$gettext("convert")),1)]),_:1},8,["loading","disabled","color","onClick"])])]),_:1}),r($,{modelValue:t.showOverwriteDialog,"onUpdate:modelValue":a[2]||(a[2]=s=>t.showOverwriteDialog=s),persistent:"","max-width":"500",onKeydown:[I(d.applyOverwriteDialog,["enter"]),a[3]||(a[3]=I(s=>t.showOverwriteDialog=!1,["esc"]))]},{default:o(()=>[r(G,null,{default:o(()=>[r(b,{class:"text-h5"},{default:o(()=>[p(n(e.$gettext("Overwrite current PT network ?")),1)]),_:1}),r(F,null,{default:o(()=>[r(Q),r(S,{color:"regular",onClick:a[1]||(a[1]=s=>t.showOverwriteDialog=!t.showOverwriteDialog)},{default:o(()=>[p(n(e.$gettext("No")),1)]),_:1}),r(S,{color:"primary",onClick:d.applyOverwriteDialog},{default:o(()=>[p(n(e.$gettext("Yes")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const xe=U(le,[["render",Ve],["__scopeId","data-v-4e45eec4"]]);export{xe as default};
