import{_ as ee,u as ie,al as te,am as Q,c as y,d as W,r as k,w as M,an as pe,f as o,h as b,i as a,j as s,ah as de,B as g,C as r,k as p,D as B,A as L,W as fe,E as N,$ as me,ao as ge,g as f,I as D,J as P,ap as ye,aq as he,ar as _e,p as z,a7 as ce,a2 as Ve,R as Se,as as be,Z as xe,at as we,a8 as ke,K as O,a9 as Ee,V as X,Q as ae,af as Le,t as $e,G as Ce,H as Re,O as oe,F as Fe,ad as Ue,a as Te,a1 as Ae,a0 as ue,au as ze,av as De,aw as Ie,ax as J,ay as re}from"./index-BH1OIb0u.js";const Pe={class:"expansion"},Oe={key:0,class:"categorie-info"},He={key:0,class:"custom-hint"},Be=["onDblclick"],Me=["onUpdate:modelValue"],Ne={__name:"ParamForm",setup(q){const{$gettext:u}=ie(),_=te(),n=Q();function R(e,t){return Array.isArray(e)?e.includes(t):e===t}const I=y(()=>_.selectedStepFunction),v=y(()=>_.parameters.filter(e=>Object.keys(e).includes("category")&&R(e.model,I.value))),E=y(()=>{var t;let e=_.parameters.filter(m=>m==null?void 0:m.info);return e=e.filter(m=>R(m.model,I.value)),(t=e[0])==null?void 0:t.info}),$=y(()=>n.scenariosList),V=y(()=>n.scenario);function x(){for(const e of v.value)for(const t of e.params)if(t.items==="$scenarios"){const m=$.value.map(S=>S.scenario);Array.isArray(t.value)?t.value=t.value.filter(S=>m.includes(S)):t.value=m.includes(t.value)?t.value:""}}W(()=>{x()});function w(e){return e.items==="$scenarios"?$.value.map(t=>t.scenario).filter(t=>t!==V.value):e.items}function H(){_.getParameters()}const F=k([...Array(v.value.length).keys()].map((e,t)=>t));function U(){F.value.length<v.value.length?F.value=[...Array(v.value.length).keys()].map((e,t)=>t):F.value=[]}const T={required:e=>e!=null||u("Required"),largerThanZero:e=>e>0||u("should be larger than 0"),nonNegative:e=>e>=0||u("should be larger or equal to 0")},A=k(!1),h=k(!1),i=k({}),d=(e,t,m)=>{if(e){const S=String(t)+String(m);i.value[S]=e}};function C(e,t){h.value=!0;const m=String(e)+String(t);Le(()=>i.value[m].focus())}M(A,e=>{e||(h.value=!1)});const G=k(null),j=k(!1),le=k(0),K=k();W(()=>{const e=G.value.clientHeight,t=window.innerHeight,m=e/t;K.value=m<.25?e:.25*t});function ve(e){e.preventDefault(),j.value=!0,le.value=e.clientY-G.value.clientHeight,document.addEventListener("mousemove",ne),document.addEventListener("mouseup",se)}function ne(e){if(j.value){const t=e.clientY-le.value;K.value=t}}function se(){j.value=!1,document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",se)}return(e,t)=>{const m=pe("v-number-input");return o(),b(ae,{class:"card"},{default:a(()=>[s(de,{class:"subtitle"},{default:a(()=>[g(r(p(u)("Scenario Settings")),1)]),_:1}),B(L("div",{ref_key:"resizableDiv",ref:G,class:"info-div",style:fe({height:K.value+"px"})},r(E.value),5),[[N,E.value]]),B(L("div",{class:"drag-handle",onMousedown:ve},null,544),[[N,E.value]]),L("div",Pe,[s(me,{ref:"form","validate-on":"lazy"},{default:a(()=>[s(ge,{modelValue:F.value,"onUpdate:modelValue":t[1]||(t[1]=S=>F.value=S),multiple:""},{default:a(()=>[(o(!0),f(D,null,P(v.value,(S,Y)=>(o(),b(ye,{key:Y},{default:a(()=>[s(he,{class:"categorie"},{default:a(()=>[g(r(S.category),1)]),_:2},1024),s(_e,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:a(()=>[S.info?(o(),f("div",Oe,r(S.info),1)):z("",!0),(o(!0),f(D,null,P(S.params,(l,Z)=>(o(),f("li",{key:Z,class:"param-list"},[typeof l.items>"u"&&typeof l.value=="boolean"?(o(),b(ce,{key:0,modelValue:l.value,"onUpdate:modelValue":c=>l.value=c,color:"primary",density:"compact",class:"pl-2","hide-details":"",label:p(u)(l.text),"persistent-hint":A.value},null,8,["modelValue","onUpdate:modelValue","label","persistent-hint"])):l.type=="Number"?(o(),b(m,{key:1,modelValue:l.value,"onUpdate:modelValue":c=>l.value=c,variant:"outlined","control-variant":"stacked",type:l.type,precision:l.precision===void 0?null:l.precision,label:p(u)(l.text),suffix:l.units,"hide-details":"",rules:l.rules.map(c=>T[c])},null,8,["modelValue","onUpdate:modelValue","type","precision","label","suffix","rules"])):typeof l.items>"u"?(o(),b(Ve,{key:2,modelValue:l.value,"onUpdate:modelValue":c=>l.value=c,variant:"outlined","hide-details":"",type:l.type,label:p(u)(l.text),suffix:l.units,rules:l.rules.map(c=>T[c])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):(o(),b(Se,{key:3,modelValue:l.value,"onUpdate:modelValue":[c=>l.value=c,c=>x(l)],variant:"outlined","hide-details":"",type:l.type,multiple:l==null?void 0:l.multiple,items:w(l),label:p(u)(l.text),suffix:l.units,rules:l.rules.map(c=>T[c])},null,8,["modelValue","onUpdate:modelValue","type","multiple","items","label","suffix","rules"])),s(be,null,{default:a(()=>[A.value?(o(),f("div",He,[h.value?B((o(),f("textarea",{key:1,ref_for:!0,ref:c=>d(c,Y,Z),"onUpdate:modelValue":c=>l.hint=c,rows:"1",class:"edition",onKeydown:t[0]||(t[0]=xe(c=>h.value=!1,["enter"]))},null,40,Me)),[[we,l.hint]]):(o(),f("div",{key:0,onDblclick:c=>C(Y,Z)},r(l.hint),41,Be))])):z("",!0)]),_:2},1024)]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),s(ke,null,{default:a(()=>[s(O,{color:"grey",variant:"text",onClick:H},{default:a(()=>[g(r(p(u)("back to default")),1)]),_:1}),s(Ee),s(O,{variant:"text",onClick:U},{default:a(()=>[g(r(F.value.length!=v.value.length?p(u)("Expand all"):p(u)("Collapse all")),1)]),_:1}),s(O,{icon:"",size:"small",onClick:t[2]||(t[2]=S=>A.value=!A.value)},{default:a(()=>[s(X,null,{default:a(()=>t[3]||(t[3]=[g("far fa-question-circle small")])),_:1})]),_:1})]),_:1})]),_:1})}}},qe=ee(Ne,[["__scopeId","data-v-38316471"]]),Ge={style:{"white-space":"pre-line"}},je={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(q){const u=q,{disabled:_}=$e(u),n=te(),R=k(!1),I=y(()=>n.hasLogs),v=k([]);async function E(){await n.getLogs(),v.value=n.logs,v.value.sort((V,x)=>String(V.time).localeCompare(String(x.time),void 0,{sensitivity:"base"})),R.value=!0}async function $(){await n.downloadLogs()}return(V,x)=>(o(),f(D,null,[s(Fe,{"close-delay":"100",transition:"slide-y-transition"},{activator:a(({props:w})=>[B(s(O,Ce({disabled:p(_),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},w),{default:a(()=>x[1]||(x[1]=[g(" logs ")])),_:2},1040,["disabled"]),[[N,I.value]])]),default:a(()=>[s(Re,null,{default:a(()=>[s(oe,{onClick:E},{prepend:a(()=>[s(X,{icon:"fas fa-eye"})]),default:a(()=>[g(r(V.$gettext("show"))+" ",1)]),_:1}),s(oe,{onClick:$},{prepend:a(()=>[s(X,{icon:"fas fa-download"})]),default:a(()=>[g(r(V.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),s(Ue,{modelValue:R.value,"onUpdate:modelValue":x[0]||(x[0]=w=>R.value=w),width:"90%"},{default:a(()=>[s(ae,{style:{"overflow-y":"auto"}},{default:a(()=>[(o(!0),f(D,null,P(v.value,(w,H)=>(o(),f("div",{key:H,class:"log-container"},[L("h1",null,r(w.name),1),L("h3",null,[L("b",null,r(w.time),1)]),L("span",Ge,r(w.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},Ke=ee(je,[["__scopeId","data-v-c531ebb9"]]),Ye={class:"section"},Ze={class:"title-container"},Je={class:"buttons-row ma-2"},Qe={key:4},We={__name:"Run",setup(q){const{$gettext:u}=ie(),_=Te(),n=te(),R=Q(),I=y(()=>n.steps),v=y(()=>{const h=n.availableModels;return n.avalaibleStepFunctions.filter(i=>h.has(i))}),E=k(n.selectedStepFunction),$=y(()=>n.running),V=y(()=>n.currentStep),x=y(()=>n.error),w=y(()=>n.errorMessage),H=y(()=>n.synchronized),F=y(()=>R.protected),U=y(()=>R.model!==null),T=k(n.endSignal);M(T,()=>n.changeEndSignal(T.value)),W(async()=>{U.value&&(await n.getSteps(),await n.GetRunningExecution())}),M(v,h=>{U.value&&(h.includes(E.value)||(n.setSelectedStepFunction(h[0]),n.getSteps()))},{once:!0}),M(E,async h=>{U.value&&(v.value.includes(h)?(n.setSelectedStepFunction(h),n.getSteps()):(E.value=v.value[0],n.setSelectedStepFunction(v.value[0]),n.getSteps()))});async function A(){if(await n.GetRunningExecution()){_.changeNotification({text:u("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const i=Q();n.initExecution(),await _.exportToS3("inputs"),await _.deleteOutputsOnS3(),await _.deleteLogsOnS3(),_.deleteOutputs(),n.startExecution({scenario:i.scenario})}catch(i){n.terminateExecution(),console.log(i),_.changeAlert(i)}}return(h,i)=>(o(),f("section",Ye,[s(Ae,{class:"background"},{default:a(()=>[s(ue,{order:"1"},{default:a(()=>[s(qe)]),_:1}),s(ue,{order:"2"},{default:a(()=>[s(ae,{class:"card"},{default:a(()=>[L("div",Ze,[s(de,{class:"subtitle"},{default:a(()=>[g(r(p(u)("Scenario Simulation")),1)]),_:1}),s(Ke,{disabled:$.value||!U.value},null,8,["disabled"])]),s(ze,{modelValue:V.value,"onUpdate:modelValue":i[4]||(i[4]=d=>V.value=d),class:"stepper"},{default:a(()=>[v.value.length>1?(o(),b(Ie,{key:0,modelValue:E.value,"onUpdate:modelValue":i[0]||(i[0]=d=>E.value=d),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:a(()=>[(o(!0),f(D,null,P(v.value,d=>(o(),b(De,{key:d,value:d,disabled:$.value||!U.value},{default:a(()=>[g(r(d),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):z("",!0),H.value?z("",!0):(o(),b(J,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:a(()=>[g(r(p(u)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),x.value?(o(),b(J,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[g(r(p(u)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(o(!0),f(D,null,P(Object.keys(w.value),d=>(o(),f("p",{key:d},[L("b",null,r(d)+": ",1),g(r(w.value[d]),1)]))),128))]),_:1})):z("",!0),F.value?(o(),b(J,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[g(r(p(u)("This scenario is protected. You can not run simulation.")),1)]),_:1})):z("",!0),L("div",Je,[s(O,{loading:$.value,disabled:$.value||F.value||!U.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:i[1]||(i[1]=d=>A())},{default:a(()=>[g(r(p(u)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),B(s(O,{color:"grey",variant:"text",onClick:i[2]||(i[2]=d=>p(n).stopExecution())},{default:a(()=>[g(r(p(u)("Abort")),1)]),_:1},512),[[N,$.value&&V.value!==1]]),s(ce,{modelValue:T.value,"onUpdate:modelValue":i[3]||(i[3]=d=>T.value=d),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:a(()=>[L("span",null,r(p(u)("End signal")),1)]),_:1},8,["modelValue"])]),U.value?(o(),f("div",Qe,[(o(!0),f(D,null,P(I.value,(d,C)=>(o(),f("div",{key:C+1},[x.value?(o(),b(re,{key:1,complete:V.value>C+1,title:d.name,value:C+1,step:C+1},null,8,["complete","title","value","step"])):(o(),b(re,{key:0,complete:V.value>C+1,color:V.value>=C+1?"primary":"regular",title:d.name,value:C+1,compact:"",step:C+1},null,8,["complete","color","title","value","step"]))]))),128))])):z("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]))}},et=ee(We,[["__scopeId","data-v-8dea1874"]]);export{et as default};
