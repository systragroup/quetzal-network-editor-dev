import{_ as D,ae as ee,af as N,ag as q,e as p,r as I,p as H,g as n,h as m,i as t,j as l,ab as J,x as v,y as i,ah as h,ad as te,l as E,v as $,U as ae,ai as le,q as b,F as C,E as P,aj as ne,ak as se,al as oe,a1 as X,Z as ue,N as M,a2 as re,G as T,a3 as ie,V as z,L as O,t as de,z as K,C as ce,A as Q,D as pe,J as j,B as ve,a9 as fe,u as ge,w as G,Y as me,X as Y,am as ye,an as he,ao as Ve,ap as R,aq as Z}from"./index-Bs36Odvz.js";const _e={class:"expansion"},Se={__name:"ParamForm",setup(B){const{$gettext:o}=ee(),s=N(),x=q(),_=p(()=>s.selectedStepFunction),L=p(()=>s.parameters),f=p(()=>L.value.filter(d=>Object.keys(d).includes("category")&&d.model===_.value)),F=p(()=>{var d;return(d=L.value.filter(a=>((a==null?void 0:a.info)&&(a==null?void 0:a.model))===_.value)[0])==null?void 0:d.info}),g=I([]);H(()=>{g.value=[...Array(f.value.length).keys()].map((d,a)=>a)});const y=p(()=>x.scenariosList),w=p(()=>x.scenario);function S(){s.getParameters()}function A(){g.value.length<f.value.length?g.value=[...Array(f.value.length).keys()].map((d,a)=>a):g.value=[]}const V=I(!1),k={required:d=>d!=null||o("Required"),largerThanZero:d=>d>0||o("should be larger than 0"),nonNegative:d=>d>=0||o("should be larger or equal to 0")};function U(d){const a=y.value.map(u=>u.scenario);d.value=d.value.filter(u=>a.includes(u))}return(d,a)=>(n(),m(O,{class:"card"},{default:t(()=>[l(J,{class:"subtitle"},{default:t(()=>[v(i(h(o)("Scenario Settings")),1)]),_:1}),F.value?(n(),m(te,{key:0,class:"info-div"},{default:t(()=>[v(i(F.value),1)]),_:1})):E("",!0),$("div",_e,[l(ae,{ref:"form","lazy-validation":""},{default:t(()=>[l(le,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=u=>g.value=u),multiple:""},{default:t(()=>[(n(!0),b(C,null,P(f.value,(u,r)=>(n(),m(ne,{key:r},{default:t(()=>[l(se,{class:"categorie"},{default:t(()=>[v(i(u.category),1)]),_:2},1024),l(oe,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:t(()=>[(n(!0),b(C,null,P(u.params,(e,W)=>(n(),b("li",{key:W},[typeof e.items>"u"&&typeof e.value=="boolean"?(n(),m(X,{key:0,modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,color:"primary",label:h(o)(e.text),hint:V.value?h(o)(e.hint):"","persistent-hint":V.value},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint"])):typeof e.items>"u"?(n(),m(ue,{key:1,modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,variant:"underlined",type:e.type,label:h(o)(e.text),suffix:e.units,hint:V.value?h(o)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(c=>k[c])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):e.items==="$scenarios"?(n(),m(M,{key:2,modelValue:e.value,"onUpdate:modelValue":[c=>e.value=c,c=>U(e)],variant:"underlined",type:e.type,items:y.value.map(c=>c.scenario).filter(c=>c!==w.value),multiple:"",label:h(o)(e.text),suffix:e.units,hint:V.value?h(o)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(c=>k[c])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"])):(n(),m(M,{key:3,modelValue:e.value,"onUpdate:modelValue":c=>e.value=c,variant:"underlined",type:e.type,items:e.items,label:h(o)(e.text),suffix:e.units,hint:V.value?h(o)(e.hint):"","persistent-hint":V.value,rules:e.rules.map(c=>k[c])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),l(re,null,{default:t(()=>[l(T,{color:"grey",variant:"text",onClick:S},{default:t(()=>[v(i(h(o)("back to default")),1)]),_:1}),l(ie),l(T,{variant:"text",onClick:A},{default:t(()=>[v(i(g.value.length!=f.value.length?h(o)("Expand all"):h(o)("Collapse all")),1)]),_:1}),l(T,{icon:"",size:"small",onClick:a[1]||(a[1]=u=>V.value=!V.value)},{default:t(()=>[l(z,null,{default:t(()=>[v("far fa-question-circle small")]),_:1})]),_:1})]),_:1})]),_:1}))}},be=D(Se,[["__scopeId","data-v-f44a874f"]]),xe={style:{"white-space":"pre-line"}},ke={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(B){const o=B,{disabled:s}=de(o),x=N(),_=I(!1),L=p(()=>x.hasLogs),f=I([]);async function F(){await x.getLogs(),f.value=x.logs,f.value.sort((y,w)=>String(y.time).localeCompare(String(w.time),void 0,{sensitivity:"base"})),_.value=!0}async function g(){await x.downloadLogs()}return(y,w)=>(n(),b(C,null,[l(ve,{"close-delay":"100",transition:"slide-y-transition"},{activator:t(({props:S})=>[K(l(T,ce({disabled:h(s),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},S),{default:t(()=>[v(" logs ")]),_:2},1040,["disabled"]),[[Q,L.value]])]),default:t(()=>[l(pe,null,{default:t(()=>[l(j,{onClick:F},{prepend:t(()=>[l(z,{icon:"fas fa-eye"})]),default:t(()=>[v(i(y.$gettext("show"))+" ",1)]),_:1}),l(j,{onClick:g},{prepend:t(()=>[l(z,{icon:"fas fa-download"})]),default:t(()=>[v(i(y.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),l(fe,{modelValue:_.value,"onUpdate:modelValue":w[0]||(w[0]=S=>_.value=S),width:"90%"},{default:t(()=>[l(O,{style:{"overflow-y":"auto"}},{default:t(()=>[(n(!0),b(C,null,P(f.value,(S,A)=>(n(),b("div",{key:A,class:"log-container"},[$("h1",null,i(S.name),1),$("h3",null,[$("b",null,i(S.time),1)]),$("span",xe,i(S.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},we=D(ke,[["__scopeId","data-v-c531ebb9"]]),$e={class:"title-container"},Ce={class:"buttons-row ma-2"},Le={key:4},Fe={__name:"Run",setup(B){const o=ge(),s=N(),x=q(),_=I(""),L=p(()=>s.steps),f=p(()=>{const a=s.availableModels;return s.avalaibleStepFunctions.filter(u=>a.has(u))}),F=p(()=>s.selectedStepFunction),g=p(()=>s.running),y=p(()=>s.currentStep),w=p(()=>s.error),S=p(()=>s.errorMessage),A=p(()=>s.synchronized),V=p(()=>x.protected),k=p(()=>x.model!==null),U=I(s.endSignal);G(U,()=>s.changeEndSignal(U.value)),H(async()=>{k.value&&(await s.getSteps(),_.value=F.value)}),G(_,async a=>{k.value&&(f.value.includes(a)?(s.setSelectedStepFunction(a),s.getSteps()):(_.value=f.value[0],s.setSelectedStepFunction(f.value[0]),s.getSteps()))});async function d(){try{const a=q();s.initExecution(),await o.exportToS3("inputs"),await o.deleteOutputsOnS3(),await o.deleteLogsOnS3(),o.deleteOutputs(),s.startExecution({scenario:a.scenario})}catch(a){s.terminateExecution(),console.log(a),o.changeAlert(a)}}return(a,u)=>(n(),m(me,{class:"background"},{default:t(()=>[l(Y,{order:"1"},{default:t(()=>[l(be)]),_:1}),l(Y,{order:"2"},{default:t(()=>[l(O,{class:"card"},{default:t(()=>[$("div",$e,[l(J,{class:"subtitle"},{default:t(()=>[v(i(a.$gettext("Scenario Simulation")),1)]),_:1}),l(we,{disabled:g.value||!k.value},null,8,["disabled"])]),l(ye,{modelValue:y.value,"onUpdate:modelValue":u[4]||(u[4]=r=>y.value=r),class:"stepper"},{default:t(()=>[f.value.length>1?(n(),m(he,{key:0,modelValue:_.value,"onUpdate:modelValue":u[0]||(u[0]=r=>_.value=r),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:t(()=>[(n(!0),b(C,null,P(f.value,r=>(n(),m(Ve,{key:r,value:r,disabled:g.value||!k.value},{default:t(()=>[v(i(r),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):E("",!0),A.value?E("",!0):(n(),m(R,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:t(()=>[v(i(a.$gettext("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),w.value?(n(),m(R,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[v(i(a.$gettext("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(n(!0),b(C,null,P(Object.keys(S.value),r=>(n(),b("p",{key:r},[$("b",null,i(r)+": ",1),v(i(S.value[r]),1)]))),128))]),_:1})):E("",!0),V.value?(n(),m(R,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:t(()=>[v(i(a.$gettext("This scenario is protected. You can not run simulation.")),1)]),_:1})):E("",!0),$("div",Ce,[l(T,{loading:g.value,disabled:g.value||V.value||!k.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:u[1]||(u[1]=r=>d())},{default:t(()=>[v(i(a.$gettext("Run Simulation")),1)]),_:1},8,["loading","disabled"]),K(l(T,{color:"grey",variant:"text",onClick:u[2]||(u[2]=r=>h(s).stopExecution())},{default:t(()=>[v(i(a.$gettext("Abort")),1)]),_:1},512),[[Q,g.value&&y.value!==1]]),l(X,{modelValue:U.value,"onUpdate:modelValue":u[3]||(u[3]=r=>U.value=r),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:t(()=>[$("span",null,i(a.$gettext("End signal")),1)]),_:1},8,["modelValue"])]),k.value?(n(),b("div",Le,[(n(!0),b(C,null,P(L.value,(r,e)=>(n(),b("div",{key:e+1},[w.value?(n(),m(Z,{key:1,complete:y.value>e+1,title:r.name,value:e+1,step:e+1},null,8,["complete","title","value","step"])):(n(),m(Z,{key:0,complete:y.value>e+1,color:y.value>=e+1?"primary":"regular",title:r.name,value:e+1,compact:"",step:e+1},null,8,["complete","color","title","value","step"]))]))),128))])):E("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},Ee=D(Fe,[["__scopeId","data-v-4f9fece8"]]);export{Ee as default};
