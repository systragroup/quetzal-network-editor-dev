const __vite__fileDeps=["assets/LayerSelector-zBNtFyAn.js","assets/index-B6nWekF8.js","assets/index-DK2Wv73L.css","assets/LayerSelector-D3fvwrXt.css","assets/StaticLayer-n_pza96f.js","assets/StaticLayer-DK8kX-Dz.css","assets/RoadLinks-BmRZWHJZ.js","assets/main-Du9rCCzM.js","assets/main-Dp6BdGE5.css","assets/index-B6OCYKLH.js","assets/mapbox-gl-DQdX9bqB.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as ve,u as Me,a as ue,b as pe,c as M,r as y,o as Be,l as ce,w as Z,d as O,e as ee,f as E,g as e,h as l,V as A,m as j,t as b,i as m,j as Y,k as ae,n as he,p as oe,q as me,s as $,v as Ie,x as Ve,y as be,z as te,A as de,F as ge,B as ke,C as gt,D as _e,E as lt,G as yt,H as xe,I as Te,J as se,K as dt,L as Oe,M as bt,N as $e,O as Fe,P as Ge,Q as we,R as Ne,S as Ee,T as kt,U as We,W as wt,X as ot,Y as Xe,Z as at,$ as Ct,a0 as xt,a1 as ct,a2 as Pe,a3 as ze,a4 as Ce,a5 as It,a6 as Ae,a7 as ft,a8 as St,a9 as Lt,aa as Nt,ab as Et,ac as Je,ad as Ze,ae as De,af as _t,ag as rt,ah as st,ai as ut,aj as Dt,ak as Ye,al as ye}from"./index-B6nWekF8.js";import{a as et}from"./mapbox-gl-DQdX9bqB.js";import{M as fe,a as vt,b as tt,c as Vt,d as Ft,e as Pt}from"./main-Du9rCCzM.js";import{S as At,a as Mt}from"./StyleSelector-DV_uOj60.js";const Bt={class:"text-white bg-secondary header"},Tt={style:{color:"white"}},Ot={class:"container",style:{"padding-top":"0.5rem"}},zt={class:"container"},Rt={class:"item"},Ht={class:"mx-auto py-2 card"},$t={key:0},Gt={class:"action-row"},jt={key:1,style:{"justify-content":"flex-end"}},Qe=200,Ut={__name:"LinksSidePanel",emits:["selectEditorTrip","confirmChanges","abortChanges","cloneButton","deleteButton","propertiesButton","newLine"],setup(i,{emit:o}){const{$gettext:u}=Me(),t=o,n=ue(),L=pe(),a=M(()=>L.editorTrip),w=M(()=>L.selectedTrips),g=y([]);Be(()=>{g.value=ce.cloneDeep(w.value)}),Z(g,p=>{L.changeSelectedTrips(p)});function s(){g.value.length===d.value.length?g.value=[]:g.value=d.value}const d=M(()=>L.tripId);Z(d,(p,c)=>{if(p.length<c.length)g.value=g.value.filter(r=>p.includes(r));else if(p.length>c.length){const r=p.filter(f=>!c.includes(f))[0];g.value=[...g.value,r]}else{const r={};c.forEach(function(f,k){r[f]=p[k]}),g.value=g.value.map(f=>r[f])}});const I=M(()=>L.lineAttributes),S=y("route_type"),B=y(new Set([]));Z(S,()=>{B.value=new Set([])});function _(p){p.isOpen&&B.value.add(p.key)}const N=y(""),v=M(()=>[...new Map(L.links.features.map(c=>[c.properties.trip_id,c.properties])).values()].filter(c=>c.trip_id.toLowerCase().startsWith(N.value.toLowerCase()))),G=M(()=>Array.from(new Set(v.value.map(c=>c[S.value])))),z=M(()=>{if(G.value.length>Qe)return[];const p=[],c={name:u("undefined"),tripId:[]};return G.value.forEach(r=>{const f=v.value.filter(k=>k[S.value]===r).map(k=>k.trip_id).sort();r===null||r===""||r===void 0?c.tripId.push(...f):p.push({name:r,tripId:f})}),c.tripId.length>0&&p.push(c),p});function W(p){p.some(c=>g.value.includes(c))?g.value=g.value.filter(c=>!p.includes(c)):g.value=Array.from(new Set([...g.value,...p]))}function q(p){a.value||(L.setEditorTrip({tripId:p,changeBounds:!0}),n.changeNotification({text:"",autoClose:!0}))}function Q(p){typeof p=="object"?t("propertiesButton",{action:"Edit Group Info",lingering:!1,tripIds:p}):a.value?(t("propertiesButton",{action:"Edit Line Info",lingering:!0}),n.changeNotification({text:"",autoClose:!0})):(L.setEditorTrip({tripId:p,changeBounds:!1}),t("propertiesButton",{action:"Edit Line Info",lingering:!1}))}function D(){const p="trip_"+dt.generate();L.setEditorTrip({tripId:p,changeBounds:!1}),t("propertiesButton",{action:"Edit Line Info",lingering:!0})}function F(p){t("cloneButton",p)}function T(p){t("deleteButton",p)}return(p,c)=>(O(),ee("section",null,[E("div",Bt,[e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:r})=>[e(A,j({variant:"text",icon:g.value.length===d.value.length?"fa-eye-slash fa":"fa-eye fa",class:"ma-2",style:{color:"white"}},r,{onClick:c[0]||(c[0]=f=>s())}),null,16,["icon"])]),default:l(()=>[E("span",null,b(g.value.length===d.value.length?m(u)("Hide All"):m(u)("Show All")),1)]),_:1}),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:r})=>[e(A,j({variant:"text",icon:"fas fa-list",class:"ma-2",style:{color:"white"},disabled:g.value.length===0},r,{onClick:c[1]||(c[1]=f=>Q(g.value))}),null,16,["disabled"])]),default:l(()=>[E("span",null,b(m(u)("Edit Visibles Properties")),1)]),_:1}),e(ae),E("span",Tt,b(m(u)("Lines")),1),e(ae),e(ae),e(Ie,{"open-on-hover":"","close-delay":"100",transition:"slide-y-transition"},{activator:l(({props:r})=>[e(A,j({variant:"text",icon:"fas fa-download",class:"ma-2",style:{color:"white"}},r),null,16)]),default:l(()=>[e(he,null,{default:l(()=>[e(oe,{link:"",onClick:c[2]||(c[2]=r=>m(n).exportFiles())},{default:l(()=>[e(me,null,{default:l(()=>[$(b(m(u)("Export All")),1)]),_:1})]),_:1}),e(oe,{link:"",onClick:c[3]||(c[3]=r=>m(n).exportFiles("visibles"))},{default:l(()=>[e(me,null,{default:l(()=>[$(b(m(u)("Export Only Visible")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),e(se,{"max-width":"100%","min-width":"100%",style:Te(a.value?{height:"calc(100vh - 300px)"}:{height:"calc(100vh - 260px)"}),class:"mx-auto scrollable"},{default:l(()=>[e(oe,null,{default:l(()=>[E("div",Ot,[e(Ve,{modelValue:S.value,"onUpdate:modelValue":c[4]||(c[4]=r=>S.value=r),items:I.value.sort(),style:{flex:1.3},"prepend-inner-icon":"fas fa-filter",label:m(u)("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"]),e(be,{modelValue:N.value,"onUpdate:modelValue":c[5]||(c[5]=r=>N.value=r),style:{"padding-right":"0.5rem",flex:1},density:"compact",variant:"outlined","clear-icon":"fas fa-times-circle",clearable:"",label:m(u)("search"),"hide-details":"","persistent-clear":"","prepend-inner-icon":"fas fa-search","onClick:clear":c[6]||(c[6]=r=>N.value="")},null,8,["modelValue","label"])])]),_:1}),e(he,null,{default:l(()=>[G.value.length>Qe?(O(),te(oe,{key:0},{default:l(()=>[E("span",null,b(m(u)("Cannot filter by this field as it result in %{res} groups. max is %{maxSize} ",{res:G.value.length,maxSize:Qe})),1)]),_:1})):de("",!0),G.value.length===0&&N.value!==""?(O(),te(oe,{key:1},{default:l(()=>[E("span",null,b(m(u)("Nothing to display.")),1)]),_:1})):de("",!0),(O(!0),ee(ge,null,ke(z.value,(r,f)=>(O(),te(gt,{key:String(r.name)+String(f),color:"secondarydark"},{activator:l(({props:k,isOpen:C})=>[e(oe,j(k,{onClick:()=>_({key:r.name+f,isOpen:!C})}),{default:l(()=>[E("div",zt,[e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:x})=>[e(A,j({variant:"text",icon:r.tripId.some(R=>g.value.includes(R))?"fa-eye fa":"fa-eye-slash fa"},x,{onClick:_e(R=>W(r.tripId),["stop"])}),null,16,["icon","onClick"])]),default:l(()=>[E("span",null,b(r.tripId.some(x=>g.value.includes(x))?m(u)("Hide All"):m(u)("Show All")),1)]),_:2},1024),E("div",Rt,[E("strong",null,b(r.name=="undefined"?m(u)(r.name):r.name),1)]),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:x})=>[e(A,j({variant:"text",icon:"fas fa-list",class:"ma-1",disabled:a.value!=null},x,{onClick:_e(R=>Q(r.tripId),["stop"])}),null,16,["disabled","onClick"])]),default:l(()=>[E("span",null,b(m(u)("Edit Group Properties")),1)]),_:2},1024),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:x})=>[e(A,j({variant:"text",icon:"fas fa-trash",class:"ma-1",disabled:!!a.value},x,{onClick:_e(R=>T({trip:r.tripId,message:r.name,action:"deleteTrip"}),["stop"])}),null,16,["disabled","onClick"])]),default:l(()=>[E("span",null,b(m(u)("Delete Group")),1)]),_:2},1024)])]),_:2},1040,["onClick"])]),default:l(()=>[B.value.has(r.name+f)?(O(),te(lt,{key:0,items:r.tripId,"item-height":45,"max-height":a.value?"calc(100vh - 250px - 190px)":"calc(100vh - 250px - 150px)",class:"virtual-scroll"},{default:l(({item:k})=>[(O(),ee("div",{key:k,class:"container"},[e(yt,{modelValue:g.value,"onUpdate:modelValue":c[7]||(c[7]=C=>g.value=C),class:"ml-4 mr-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",density:"compact",value:k,"hide-details":""},null,8,["modelValue","value"]),e(Y,{location:"right","open-delay":"300"},{activator:l(({props:C})=>[e(me,j(C,{style:{"font-weight":k===a.value?"bold":"normal"},class:a.value?"item":"item clickable",onClick:x=>q(k)}),{default:l(()=>[$(b(k),1)]),_:2},1040,["style","class","onClick"])]),default:l(()=>[E("span",null,b(k),1)]),_:2},1024),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:C})=>[e(A,j({variant:"text",icon:"fas fa-pen",size:"small",density:"compact",class:"ma-1",color:"regular",disabled:!!a.value},C,{onClick:x=>q(k)}),null,16,["disabled","onClick"])]),default:l(()=>[E("span",null,b(m(u)("Edit Line")),1)]),_:2},1024),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:C})=>[e(A,j({variant:"text",icon:"fas fa-list",size:"small",density:"compact",class:"ma-1",color:"regular",disabled:k!=a.value&&a.value!=null},C,{onClick:x=>Q(k)}),null,16,["disabled","onClick"])]),default:l(()=>[E("span",null,b(m(u)("Edit Line Properties")),1)]),_:2},1024),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:C})=>[e(A,j({variant:"text",icon:"fas fa-clone",size:"small",density:"compact",class:"ma-1",color:"regular",disabled:!!a.value},C,{onClick:x=>F({trip:k,message:k})}),null,16,["disabled","onClick"])]),default:l(()=>[E("span",null,b(m(u)("Duplicate and reverse")),1)]),_:2},1024),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:C})=>[e(A,j({variant:"text",size:"small",density:"compact",class:"ml-1 mr-3",icon:"fas fa-trash",disabled:!!a.value},C,{onClick:x=>T({trip:k,message:k,action:"deleteTrip"})}),null,16,["disabled","onClick"])]),default:l(()=>[E("span",null,b(m(u)("Delete Line")),1)]),_:2},1024)]))]),_:2},1032,["items","max-height"])):de("",!0)]),_:2},1024))),128))]),_:1}),e(xe)]),_:1},8,["style"]),E("div",Ht,[a.value?(O(),ee("div",$t,[E("div",Gt,[e(Y,{location:"right","open-delay":"500"},{activator:l(({props:r})=>[e(A,j({class:"mx-1",color:m(n).anchorMode?"grey":"regular"},r,{size:"small",icon:"fas fa-anchor",onClick:c[8]||(c[8]=f=>m(n).changeAnchorMode())}),null,16,["color"])]),default:l(()=>[E("span",null,b(m(u)("Edit Line geometry")),1)]),_:1}),e(Y,{location:"right","open-delay":"500"},{activator:l(({props:r})=>[e(A,j({class:"mx-1",size:"small",color:m(n).stickyMode?"green":"regular"},r,{icon:"fa-solid fa-magnet",onClick:c[9]||(c[9]=f=>m(n).changeStickyMode())}),null,16,["color"])]),default:l(()=>[E("span",null,b(m(u)("stick nodes on existing nodes")),1)]),_:1})]),E("div",null,[e(A,{"prepend-icon":"fas fa-times-circle",width:"40%",onClick:c[10]||(c[10]=r=>p.$emit("abortChanges"))},{default:l(()=>[$(b(m(u)("Abort")),1)]),_:1}),e(A,{color:"primary",class:"mx-2",width:"55%","prepend-icon":"fas fa-save",onClick:c[11]||(c[11]=r=>p.$emit("confirmChanges"))},{default:l(()=>[$(b(m(u)("Confirm")),1)]),_:1})])])):(O(),ee("div",jt,[e(A,{color:"primary",block:"","prepend-icon":"fas fa-plus",onClick:D},{default:l(()=>[$(b(m(u)("new Line")),1)]),_:1})]))])]))}},qt=ve(Ut,[["__scopeId","data-v-f3346a63"]]),Kt={name:"RoadSidePanel",components:{},emits:["deleteButton","propertiesButton","update-tripList"],setup(){const i=ue(),o=Oe(),u=pe(),t=M(()=>o.selectedrGroup),n=y([]);Be(()=>{n.value=ce.cloneDeep(t.value)}),Z(n,(s,d)=>{let I="",S="add";JSON.stringify(s)===JSON.stringify(g.value)?(I=s,S="showAll"):s.length===0?(I=[],S="hideAll"):s.length<d.length?(I=d.filter(B=>!s.includes(B)),S="remove"):s.length>d.length&&(I=s.filter(B=>!d.includes(B)),S="add"),I!==""&&o.changeVisibleRoads({category:a.value,data:I,method:S})}),Z(t,s=>{const d=new Set(s),I=new Set(n.value);d.size===I.size&&new Set([...d,...I]).size===d.size||(n.value=bt(s))});const L=y(""),a=y(""),w=M(()=>o.rlineAttributes),g=M(()=>o.filteredrCategory);return{store:i,rlinksStore:o,selectedrGoup:t,localSelectedTrip:n,selectedFilter:L,vmodelSelectedFilter:a,linksStore:u,filterChoices:w,filteredCat:g}},watch:{vmodelSelectedFilter(i,o){this.selectedFilter=i,this.rlinksStore.changeSelectedrFilter(this.selectedFilter),o&&(this.localSelectedTrip=[])}},mounted(){this.selectedFilter=this.rlinksStore.selectedrFilter,this.vmodelSelectedFilter=this.selectedFilter,this.rlinksStore.changeSelectedrFilter(this.selectedFilter),this.linksStore.links.features.length===0&&!this.store.projectIsEmpty&&this.selectedrGoup.length===0&&this.showAll()},methods:{propertiesButton(i){this.$emit("propertiesButton",{action:"Edit Road Group Info",lingering:!1,category:this.vmodelSelectedFilter,group:i})},editVisible(){this.$emit("propertiesButton",{action:"Edit Visible Road Info",lingering:!1})},deleteButton(i){this.$emit("deleteButton",i)},showAll(){this.localSelectedTrip.length===this.filteredCat.length?this.localSelectedTrip=[]:this.localSelectedTrip=this.filteredCat},showGroup(i){this.localSelectedTrip=Array.from(new Set([...this.localSelectedTrip,...i]))}}},Wt={class:"text-white bg-secondary header"},Jt={style:{color:"white"}},Zt={style:{"padding-top":"0.5rem"}},Qt={class:"ma-2 item"};function Xt(i,o,u,t,n,L){return O(),ee("section",null,[E("div",Wt,[e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:a})=>[e(A,j({variant:"text",icon:t.localSelectedTrip.length===t.filteredCat.length?"fa-eye-slash fa":"fa-eye fa",class:"ma-2",style:{color:"white"}},a,{onClick:o[0]||(o[0]=w=>L.showAll())}),null,16,["icon"])]),default:l(()=>[E("span",null,b(t.localSelectedTrip.length===t.filteredCat.length?i.$gettext("Hide All"):i.$gettext("Show All")),1)]),_:1}),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:a})=>[e(A,j({variant:"text",icon:"fas fa-list",class:"ma-2",style:{color:"white"},disabled:t.localSelectedTrip.length===0},a,{onClick:o[1]||(o[1]=w=>L.editVisible())}),null,16,["disabled"])]),default:l(()=>[E("span",null,b(i.$gettext("Edit Visibles Properties")),1)]),_:1}),e(ae),E("span",Jt,b(i.$gettext("Roads")),1),e(ae),e(ae),e(Ie,{"open-on-hover":"","close-delay":"100",transition:"slide-y-transition"},{activator:l(({props:a})=>[e(A,j({variant:"text",icon:"fa-solid fa-download",class:"ma-2",style:{color:"white"}},a),null,16)]),default:l(()=>[e(he,null,{default:l(()=>[e(oe,{link:"",onClick:o[2]||(o[2]=a=>t.store.exportFiles("all"))},{default:l(()=>[e(me,null,{default:l(()=>[$(b(i.$gettext("Export All")),1)]),_:1})]),_:1}),e(oe,{link:"",onClick:o[3]||(o[3]=a=>t.store.exportFiles("visible"))},{default:l(()=>[e(me,null,{default:l(()=>[$(b(i.$gettext("Export Only Visible")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),e(se,{"max-width":"100%","min-width":"100%",style:Te({height:"calc(100vh - 250px)"}),class:"mx-auto scrollable"},{default:l(()=>[e(oe,null,{default:l(()=>[E("div",Zt,[e(Ve,{modelValue:t.vmodelSelectedFilter,"onUpdate:modelValue":o[4]||(o[4]=a=>t.vmodelSelectedFilter=a),items:t.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:i.$gettext("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),e(lt,{items:t.filteredCat,"item-height":45,height:"calc(100vh - 250px - 88px)"},{default:l(({item:a})=>[(O(),ee("div",{key:t.vmodelSelectedFilter.concat(a),class:"container"},[e($e,{modelValue:t.localSelectedTrip,"onUpdate:modelValue":o[5]||(o[5]=w=>t.localSelectedTrip=w),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:a},null,8,["modelValue","value"]),E("div",Qt,b(a),1),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:w})=>[e(A,j({variant:"text",icon:"fas fa-list",class:"ma-1",disabled:!1},w,{onClick:g=>L.propertiesButton(a)}),null,16,["onClick"])]),default:l(()=>[E("span",null,b(i.$gettext("Edit Line Properties")),1)]),_:2},1024),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:w})=>[e(A,j({variant:"text",icon:"fas fa-trash",class:"ma-1",size:"small",disabled:!1},w,{onClick:g=>L.deleteButton({trip:a,group:t.selectedFilter,message:a,action:"deleterGroup"})}),null,16,["onClick"])]),default:l(()=>[E("span",null,b(i.$gettext("Delete Line")),1)]),_:2},1024)]))]),_:1},8,["items","height"]),e(xe)]),_:1},8,["style"]),e(se,{class:"mx-auto py-2"},{default:l(()=>[e(Y,{location:"right","open-delay":"500"},{activator:l(({props:a})=>[e(A,j({class:"mx-2",color:t.store.anchorMode?"grey":"regular"},a,{onClick:o[6]||(o[6]=w=>t.store.changeAnchorMode())}),{default:l(()=>[e(Fe,{size:"small"},{default:l(()=>[$(" fas fa-anchor ")]),_:1})]),_:2},1040,["color"])]),default:l(()=>[E("span",null,b(i.$gettext("Edit Line geometry")),1)]),_:1}),e(Y,{location:"right","open-delay":"500"},{activator:l(({props:a})=>[e(A,j({class:"mx-2",disabled:!t.rlinksStore.hasCycleway,color:t.store.cyclewayMode?"green":"regular"},a,{onClick:o[7]||(o[7]=w=>t.store.changeCyclewayMode())}),{default:l(()=>[e(Fe,{size:"small"},{default:l(()=>[$(" fas fa-biking ")]),_:1})]),_:2},1040,["disabled","color"])]),default:l(()=>[E("span",null,b(i.$gettext("Show Cycleway direction instead of road")),1)]),_:1}),e(ae)]),_:1})])}const Yt=ve(Kt,[["render",Xt],["__scopeId","data-v-08150660"]]),el={name:"RoadSidePanel",components:{},emits:["deleteButton","propertiesButton"],setup(){const i=ue(),o=Ge(),u=M(()=>o.layer),t=M(()=>o.layerAttributes),n=M(()=>o.selectedFilter),L=M(()=>o.selectedCategory),a=M(()=>o.filteredCategory);return{store:i,odStore:o,layer:u,filterChoices:t,selectedFilter:n,selectedCat:L,filteredCat:a}},data(){return{vmodelSelectedFilter:"cycleway",vmodelSelectedCat:[]}},watch:{vmodelSelectedCat(i){this.odStore.changeSelectedCategory(i)},vmodelSelectedFilter(i){this.odStore.changeSelectedFilter(i),this.vmodelSelectedCat=[]}},mounted(){this.vmodelSelectedCat=this.selectedCat,this.vmodelSelectedFilter=this.selectedFilter},methods:{propertiesButton(i){this.$emit("propertiesButton",{action:"Edit OD Group Info",lingering:!1,category:this.vmodelSelectedFilter,group:i})},editVisible(){this.$emit("propertiesButton",{action:"Edit Visible OD Info",lingering:!1})},deleteButton(i){this.$emit("deleteButton",i)},showAll(){this.vmodelSelectedCat.length===this.filteredCat.length?this.vmodelSelectedCat=[]:this.vmodelSelectedCat=this.filteredCat},showGroup(i){this.tripList=Array.from(new Set([...this.tripList,...i]))}}},tl={class:"text-white bg-secondary header"},ll={style:{color:"white"}},ol={style:{"padding-top":"0.5rem"}};function al(i,o,u,t,n,L){return O(),ee("section",null,[E("div",tl,[e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:a})=>[e(A,j({variant:"text",icon:n.vmodelSelectedCat.length===t.filteredCat.length?"fa-eye-slash fa":"fa-eye fa",class:"ma-2",style:{color:"white"}},a,{onClick:o[0]||(o[0]=w=>L.showAll())}),null,16,["icon"])]),default:l(()=>[E("span",null,b(n.vmodelSelectedCat.length===t.filteredCat.length?i.$gettext("Hide All"):i.$gettext("Show All")),1)]),_:1}),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:a})=>[e(A,j({variant:"text",icon:"fas fa-list",class:"ma-2",style:{color:"white"},disabled:n.vmodelSelectedCat.length===0},a,{onClick:o[1]||(o[1]=w=>L.editVisible())}),null,16,["disabled"])]),default:l(()=>[E("span",null,b(i.$gettext("Edit Visibles Properties")),1)]),_:1}),e(ae),E("span",ll,b(i.$gettext("OD")),1),e(ae),e(ae),e(Ie,{"open-on-hover":"","close-delay":"100",transition:"slide-y-transition"},{activator:l(({props:a})=>[e(A,j({variant:"text",icon:"fa-solid fa-download",class:"ma-2",style:{color:"white"}},a),null,16)]),default:l(()=>[e(he,null,{default:l(()=>[e(oe,{link:"",onClick:o[2]||(o[2]=a=>t.store.exportFiles("all"))},{default:l(()=>[e(me,null,{default:l(()=>[$(b(i.$gettext("Export All")),1)]),_:1})]),_:1}),e(oe,{link:"",onClick:o[3]||(o[3]=a=>t.store.exportFiles("visibles"))},{default:l(()=>[e(me,null,{default:l(()=>[$(b(i.$gettext("Export Only Visible")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),e(se,{"max-width":"100%","min-width":"100%",style:Te({height:"calc(100vh - 250px)"}),class:"mx-auto scrollable"},{default:l(()=>[e(oe,null,{default:l(()=>[E("div",ol,[e(Ve,{modelValue:n.vmodelSelectedFilter,"onUpdate:modelValue":o[4]||(o[4]=a=>n.vmodelSelectedFilter=a),items:t.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:i.$gettext("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),e(lt,{items:t.filteredCat,"item-height":45,height:"calc(100vh - 250px - 88px)"},{default:l(({item:a})=>[(O(),ee("div",{key:n.vmodelSelectedFilter.concat(a),class:"container"},[e($e,{modelValue:n.vmodelSelectedCat,"onUpdate:modelValue":o[5]||(o[5]=w=>n.vmodelSelectedCat=w),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:a},null,8,["modelValue","value"]),e(Y,{location:"right","open-delay":"300","content-class":"custom-tooltip"},{activator:l(({props:w})=>[E("div",j({class:"item ma-2"},w),b(a),17)]),default:l(()=>[E("span",null,b(a),1)]),_:2},1024),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:w})=>[e(A,j({variant:"text",icon:" fas fa-list",class:"ma-1",color:"regular",disabled:!1},w,{onClick:g=>L.propertiesButton(a)}),null,16,["onClick"])]),default:l(()=>[E("span",null,b(i.$gettext("Edit Line Properties")),1)]),_:2},1024),e(Y,{location:"bottom","open-delay":"500"},{activator:l(({props:w})=>[e(A,j({variant:"text",icon:" fas fa-trash",class:"ma-1",size:"small",color:"regular",disabled:!1},w,{onClick:g=>L.deleteButton({trip:a,group:t.selectedFilter,message:a,action:"deleteODGroup"})}),null,16,["onClick"])]),default:l(()=>[E("span",null,b(i.$gettext("Delete Line")),1)]),_:2},1024)]))]),_:1},8,["items","height"]),e(xe)]),_:1},8,["style"]),e(se,{class:"mx-auto"},{default:l(()=>[e(oe,null,{default:l(()=>[e(ae)]),_:1})]),_:1})])}const nl=ve(el,[["render",al],["__scopeId","data-v-89ddf55f"]]),il={name:"SidePanel",components:{LinksSidePanel:qt,RoadSidePanel:Yt,ODSidePanel:nl},emits:["selectEditorTrip","confirmChanges","abortChanges","cloneButton","deleteButton","propertiesButton","change-mode"],setup(i,o){const u=ue(),t=pe(),n=M(()=>u.showLeftPanel),L=y(!0);Z(n,N=>{N?setTimeout(()=>{L.value=!0},500):L.value=!1});const a=M(()=>t.editorTrip),w=y("pt");Be(()=>{t.links.features.length===0&&!u.projectIsEmpty&&(w.value="road")}),Z(w,N=>{o.emit("change-mode",N)});const g=y(null),s=y(!1),d=y(0),I=y(400);function S(N){N.preventDefault(),s.value=!0,d.value=N.clientX-g.value.clientWidth,document.addEventListener("mousemove",B),document.addEventListener("mouseup",_)}function B(N){if(s.value){const v=N.clientX-d.value;I.value=v>400?v:400}}function _(){s.value=!1,document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",_)}return{tab:w,store:u,showLeftPanel:n,showLeftPanelContent:L,editorTrip:a,leftPanelDiv:g,isResizing:s,windowOffest:d,width:I,startResize:S}}},rl={id:"left-panel",ref:"leftPanel",class:"left-panel-content"},sl={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}};function ul(i,o,u,t,n,L){const a=we("LinksSidePanel"),w=we("RoadSidePanel"),g=we("ODSidePanel");return O(),ee("section",{ref:"leftPanelDiv",class:ot(t.showLeftPanel?"left-panel elevation-4":"left-panel-close"),style:Te({width:t.showLeftPanel?t.width+"px":"0px"})},[E("div",{class:"left-panel-toggle-btn elevation-4",onClick:o[0]||(o[0]=s=>t.store.changeLeftPanel())},[e(Fe,{size:"small",color:"secondarydark"},{default:l(()=>[$(b(t.showLeftPanel?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),E("div",{class:"resizable-handle",onMousedown:o[1]||(o[1]=(...s)=>t.startResize&&t.startResize(...s))},null,32),e(wt,{name:"fade"},{default:l(()=>[Ne(E("div",rl,[E("div",null,[E("div",sl,[e(kt,{modelValue:t.tab,"onUpdate:modelValue":o[2]||(o[2]=s=>t.tab=s),disabled:t.editorTrip!==null,"bg-color":"secondary",grow:""},{default:l(()=>[e(We,{value:"pt"},{default:l(()=>[$(b(i.$gettext("PT")),1)]),_:1}),e(We,{value:"road"},{default:l(()=>[$(b(i.$gettext("Road")),1)]),_:1}),e(We,{value:"od"},{default:l(()=>[$(b(i.$gettext("OD")),1)]),_:1})]),_:1},8,["modelValue","disabled"]),Ne(e(a,{onConfirmChanges:o[3]||(o[3]=s=>i.$emit("confirmChanges",s)),onAbortChanges:o[4]||(o[4]=s=>i.$emit("abortChanges",s)),onCloneButton:o[5]||(o[5]=s=>i.$emit("cloneButton",s)),onDeleteButton:o[6]||(o[6]=s=>i.$emit("deleteButton",s)),onPropertiesButton:o[7]||(o[7]=s=>i.$emit("propertiesButton",s))},null,512),[[Ee,t.tab==="pt"]]),Ne(e(w,{onDeleteButton:o[8]||(o[8]=s=>i.$emit("deleteButton",s)),onPropertiesButton:o[9]||(o[9]=s=>i.$emit("propertiesButton",s))},null,512),[[Ee,t.tab==="road"]]),Ne(e(g,{onDeleteButton:o[10]||(o[10]=s=>i.$emit("deleteButton",s)),onPropertiesButton:o[11]||(o[11]=s=>i.$emit("propertiesButton",s))},null,512),[[Ee,t.tab==="od"]])])])],512),[[Ee,t.showLeftPanelContent]])]),_:1})],6)}const dl=ve(il,[["render",ul],["__scopeId","data-v-c52bcbdf"]]),ne=i=>i,cl={name:"Settings",emits:["submit"],setup(i,o){const u=ue(),t=pe(),n=Oe(),L=y(!1),a=y({name:ne("Road speed"),type:"Number",value:0,units:"km/h",hint:ne("Speed used to calculate road travel time when a link is drawn")}),w=y({name:ne("PT Popup Content"),type:"String",choices:[],value:"",hint:ne("Link field to display when hovering a trip on the map")}),g=y({name:ne("Road Popup Content"),type:"String",choices:[],value:"",hint:ne("Link field to display when hovering road link on the map")}),s=y({name:ne("Road Highway name"),type:"String",value:"",hint:ne("New road links Highway property name")}),d=y({name:ne("Export name"),type:"String",value:"",units:".zip",hint:ne("the name of the exported zip file")}),I=[z=>!!z||ne("Required"),z=>z>=0||ne("should be larger than 0")],S=[z=>z.slice(-4)!==".zip"||ne("do not add .zip to the end")],B=()=>{a.value.value=n.roadSpeed,w.value.choices=t.lineAttributes,w.value.value=u.linksPopupContent,g.value.choices=n.rlineAttributes,g.value.value=u.roadsPopupContent,s.value.value=n.defaultHighway,d.value.value=u.outputName},_=y(!1),N=y(!1);function v(){o.emit("submit",!1),N.value=!1}async function G(z){if((await z).valid){const q={roadSpeed:a.value.value,linksPopupContent:w.value.value,roadsPopupContent:g.value.value,outputName:d.value.value,defaultHighway:s.value.value};u.applySettings(q),o.emit("submit",!0),N.value=!1,u.changeNotification({text:ne("modification applied"),autoClose:!0,color:"success"})}else _.value=!0,setTimeout(()=>{_.value=!1},500)}return Z(N,z=>{z&&B()}),{showHint:L,roadSpeed:a,linksPopupContent:w,roadsPopupContent:g,defaultHighway:s,outputName:d,rules:I,zipRules:S,fetch:B,submit:G,cancel:v,shake:_,show:N}}},fl={class:"setting"};function vl(i,o,u,t,n,L){return O(),te(Ie,{modelValue:t.show,"onUpdate:modelValue":o[6]||(o[6]=a=>t.show=a),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:l(({props:a})=>[E("div",fl,[e(A,j({icon:"fa-solid fa-cog"},a),null,16)])]),default:l(()=>[e(se,{class:ot({shake:t.shake}),width:300,onKeydown:[Xe(t.submit,["enter"]),Xe(t.cancel,["esc"])]},{default:l(()=>[e(at,{class:"subtitle"},{default:l(()=>[$(b(i.$gettext("Settings")),1)]),_:1}),e(Ct,{"validate-on":"submit lazy",onSubmit:_e(t.submit,["prevent"])},{default:l(()=>[e(xt,null,{default:l(()=>[e(ct,null,{default:l(()=>[e(be,{modelValue:t.roadSpeed.value,"onUpdate:modelValue":o[0]||(o[0]=a=>t.roadSpeed.value=a),variant:"underlined",type:t.roadSpeed.type,label:i.$gettext(t.roadSpeed.name),suffix:t.roadSpeed.units,hint:t.showHint?i.$gettext(t.roadSpeed.hint):"","persistent-hint":t.showHint,rules:t.rules,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint","rules"]),e(Ve,{modelValue:t.linksPopupContent.value,"onUpdate:modelValue":o[1]||(o[1]=a=>t.linksPopupContent.value=a),variant:"underlined",items:t.linksPopupContent.choices.sort(),label:i.$gettext(t.linksPopupContent.name),hint:t.showHint?i.$gettext(t.linksPopupContent.hint):"","persistent-hint":t.showHint,"menu-props":{top:!0,offsetY:!0},chips:"",multiple:""},null,8,["modelValue","items","label","hint","persistent-hint"]),e(Ve,{modelValue:t.roadsPopupContent.value,"onUpdate:modelValue":o[2]||(o[2]=a=>t.roadsPopupContent.value=a),variant:"underlined",items:t.roadsPopupContent.choices.sort(),label:i.$gettext(t.roadsPopupContent.name),hint:t.showHint?i.$gettext(t.roadsPopupContent.hint):"","persistent-hint":t.showHint,"menu-props":{top:!0,offsetY:!0},chips:"",multiple:""},null,8,["modelValue","items","label","hint","persistent-hint"]),e(be,{modelValue:t.defaultHighway.value,"onUpdate:modelValue":o[3]||(o[3]=a=>t.defaultHighway.value=a),variant:"underlined",type:t.defaultHighway.type,label:i.$gettext(t.defaultHighway.name),suffix:t.defaultHighway.units,hint:t.showHint?i.$gettext(t.defaultHighway.hint):"","persistent-hint":t.showHint,rules:t.zipRules,required:""},null,8,["modelValue","type","label","suffix","hint","persistent-hint","rules"]),e(be,{modelValue:t.outputName.value,"onUpdate:modelValue":o[4]||(o[4]=a=>t.outputName.value=a),variant:"underlined",type:t.outputName.type,label:i.$gettext(t.outputName.name),suffix:t.outputName.units,hint:t.showHint?i.$gettext(t.outputName.hint):"","persistent-hint":t.showHint,rules:t.zipRules,required:""},null,8,["modelValue","type","label","suffix","hint","persistent-hint","rules"])]),_:1})]),_:1}),e(Pe,null,{default:l(()=>[e(A,{color:"grey",variant:"text",onClick:t.cancel},{default:l(()=>[$(b(i.$gettext("Cancel")),1)]),_:1},8,["onClick"]),e(A,{color:"green-darken-1",variant:"text",type:"submit"},{default:l(()=>[$(b(i.$gettext("Save")),1)]),_:1}),e(ae),e(A,{icon:"",size:"small",onClick:o[5]||(o[5]=a=>t.showHint=!t.showHint)},{default:l(()=>[e(Fe,null,{default:l(()=>[$("far fa-question-circle small")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["class","onKeydown"])]),_:1},8,["modelValue"])}const pl=ve(cl,[["render",vl],["__scopeId","data-v-7ea8f9c4"]]),ml={__name:"StaticLinks",props:["map","isEditorMode","mode"],emits:["rightClick","onHover","offHover"],setup(i,{emit:o}){const u=i,t=o,n=ue(),L=pe(),{map:a,isEditorMode:w,mode:g}=ze(u);Z(w,D=>{D?a.value.off("dblclick",q):a.value.on("dblclick",q)},{immediate:!0}),Z(g,D=>{D!=="pt"?a.value.off("dblclick",q):a.value.on("dblclick",q)});const s=M(()=>L.links),d=M(()=>L.nodes),I=M(()=>n.linksPopupContent),S=M(()=>L.selectedTrips);Z(S,()=>{W()});const B=y(ce.cloneDeep(Ce)),_=y(ce.cloneDeep(Ce)),N=y([]),v=y(null);Be(()=>{W()});function G(D){var F;if(D.map.getCanvas().style.cursor="pointer",N.value=D.mapboxEvent.features,(F=v.value)!=null&&F.isOpen()&&v.value.remove(),I.value.length>0){let T=I.value.map(p=>`${p}: <b>${N.value[0].properties[p]}</b>`);T=T.join("<br> "),v.value=new et.Popup({closeButton:!1}).setLngLat([D.mapboxEvent.lngLat.lng,D.mapboxEvent.lngLat.lat]).setHTML(T).addTo(D.map)}}function z(D){var F;N.value=[],(F=v.value)!=null&&F.isOpen()&&v.value.remove(),D.map.getCanvas().style.cursor=""}function W(){const D=new Set(S.value);_.value.features=s.value.features.filter(c=>D.has(c.properties.trip_id)),B.value.features=It(B.value,_.value);const F=[...new Set(_.value.features.map(c=>Number(c.properties.route_width)))],T={};F.forEach(c=>T[c]=new Set),_.value.features.map(c=>[c.properties.a,c.properties.b].forEach(r=>T[Number(c.properties.route_width)].add(r)));let p=new Set;for(let c=0;c<F.length-1;c++){const r=T[F[c+1]],f=T[F[c]];p=new Set([...p,...f]),T[F[c+1]]=new Set([...r].filter(k=>!p.has(k)))}F.forEach(c=>{const r=d.value.features.filter(f=>T[c].has(f.properties.index));r.map(f=>f.properties.route_width=c),B.value.features.push(...r)}),L.setVisibleNodes(B.value),a.value.getSource("links").setData(_.value),a.value.getSource("nodes").setData(B.value)}function q(D){if(g.value==="pt"){if(D.preventDefault(),N.value.length===0){const F=[[D.point.x-5,D.point.y-5],[D.point.x+5,D.point.y+5]];N.value=a.value.queryRenderedFeatures(F,{layers:["links"]})}N.value.length>0&&(L.setEditorTrip({tripId:N.value[0].properties.trip_id,changeBounds:!1}),n.changeNotification({text:"",autoClose:!0}))}}function Q(D){L.setEditorTrip({tripId:D.mapboxEvent.features[0].properties.trip_id,changeBounds:!1}),t("rightClick",{action:"Edit Line Info",lingering:!1})}return(D,F)=>(O(),ee("section",null,[e(m(fe),j({"source-id":"links",reactive:!1,source:{type:"geojson",data:_.value,buffer:0,promoteId:"index"},"layer-id":"links",layer:{interactive:!0,type:"line",minzoom:1,maxzoom:18,paint:{"line-color":["case",["has","route_color"],["concat","#",["get","route_color"]],D.$vuetify.theme.current.colors.linksprimary],"line-opacity":["case",["boolean",m(w),!1],.1,1],"line-width":["case",["has","route_width"],["case",["to-boolean",["to-number",["get","route_width"]]],["to-number",["get","route_width"]],3],3]},layout:{"line-sort-key":["to-number",["get","route_width"]],"line-cap":"round"}}},Ae(m(w)?{mouseenter:()=>{},mouseleave:()=>{},contextmenu:()=>{}}:{mouseenter:G,mouseleave:z,contextmenu:Q})),null,16,["source","layer"]),e(m(fe),{"source-id":"nodes",reactive:!1,source:{type:"geojson",data:B.value,buffer:0,promoteId:"index"},"layer-id":"nodes",layer:{interactive:!0,type:"circle",minzoom:12,maxzoom:18,paint:{"circle-color":["case",["boolean",m(w),!1],D.$vuetify.theme.current.colors.mediumgrey,D.$vuetify.theme.current.colors.accent],"circle-stroke-color":D.$vuetify.theme.current.colors.white,"circle-stroke-width":1,"circle-radius":["case",["has","route_width"],["case",["to-boolean",["to-number",["get","route_width"]]],["to-number",["get","route_width"]],3],3]}}},null,8,["source","layer"])]))}},hl=E("hr",null,null,-1),gl=E("hr",null,null,-1),yl={__name:"EditorLinks",props:["map"],emits:["clickFeature","onHover","onHoverSticky","offHover","useStickyNode"],setup(i,{emit:o}){const{$gettext:u}=Me(),t=i,n=o,L=ue(),a=pe(),w=M(()=>a.editorLinks),g=M(()=>a.editorNodes),s=M(()=>L.stickyMode),d=M(()=>a.selectedTrips),I=M(()=>s.value?a.visibleNodes:Ce);Be(()=>{_.value.getSource("stickyNodes").setData(I.value)}),Z(s,()=>{_.value.getSource("stickyNodes").setData(I.value)}),Z(d,()=>{_.value.getSource("stickyNodes").setData(I.value)});const S=M(()=>L.anchorMode),B=M(()=>S.value?a.anchorNodes:Ce),{map:_}=ze(t),N=y(null),v=y(null),G=y(null),z=M(()=>G.value!==null&&v.value!==null&&W.value),W=y(!1),q=y(!1),Q=y(!1),D=y({coordinates:[0,0],showed:!1,content:null}),F=y({coordinates:[0,0],showed:!1,actions:[],feature:null,type:null});function T(V){if(v.value!==null){const J=_.value.querySourceFeatures(v.value.layerId);N.value=J.filter(X=>X.id===v.value.id)[0],N.value!==null&&v.value.layerId==="editorLinks"&&(S.value?a.addNodeInline({selectedLink:N.value.properties,lngLat:V.mapboxEvent.lngLat,nodes:"anchorNodes"}):a.addNodeInline({selectedLink:N.value.properties,lngLat:V.mapboxEvent.lngLat,nodes:"editorNodes"}))}}function p(V){var J;if(D.value.showed&&((J=v.value)==null?void 0:J.layerId)==="editorNodes"){F.value.coordinates=[V.mapboxEvent.lngLat.lng,V.mapboxEvent.lngLat.lat],F.value.showed=!0,F.value.type="node";const X=_.value.querySourceFeatures(v.value.layerId);F.value.feature=X.filter(je=>je.id===v.value.id)[0];const ie=F.value.feature.properties.index;ie===a.firstNodeId||ie===a.lastNodeId?F.value.actions=[{name:"Edit Node Info",text:u("Edit Node Info")},{name:"Delete Stop",text:u("Delete Stop")}]:F.value.actions=[{name:"Edit Node Info",text:u("Edit Node Info")},{name:"Cut Before Node",text:u("Cut Before Node")},{name:"Cut After Node",text:u("Cut After Node")},{name:"Delete Stop",text:u("Delete Stop")}]}}function c(){var V;if(((V=v.value)==null?void 0:V.layerId)==="anchorNodes"){const J=_.value.querySourceFeatures(v.value.layerId);N.value=J.filter(X=>X.id===v.value.id),a.deleteAnchorNode({selectedNode:N.value[0].properties})}}function r(V){if(v.value.layerId==="editorLinks"){const J=_.value.querySourceFeatures(v.value.layerId);N.value=J.filter(ie=>ie.id===v.value.id)[0];const X={selectedFeature:N.value,action:"Edit Link Info",lngLat:V.mapboxEvent.lngLat,lingering:!0};n("clickFeature",X)}}function f(V){switch(console.log(V),V.action){case"Cut Before Node":a.cutLineAtNode({selectedNode:V.feature.properties});break;case"Cut After Node":a.cutLineFromNode({selectedNode:V.feature.properties});break;case"Delete Stop":a.deleteNode({selectedNode:V.feature.properties});break;default:n("clickFeature",{selectedFeature:V.feature,action:V.action,lngLat:V.coordinates});break}F.value.showed=!1,F.value.type=null}function k(V){(!v.value||v.value.layerId==="editorLinks")&&(_.value.getCanvas().style.cursor="pointer",v.value!==null&&_.value.setFeatureState({source:v.value.layerId,id:v.value.id},{hover:!1}),v.value={layerId:V.layerId,id:V.mapboxEvent.features[0].id},_.value.setFeatureState({source:v.value.layerId,id:v.value.id},{hover:!0}),!Q.value&&!S.value&&(D.value.coordinates=[V.mapboxEvent.lngLat.lng,V.mapboxEvent.lngLat.lat],D.value.content=v.value.id,D.value.showed=!0),n("onHover",{selectedId:v.value.id}))}function C(V){v.value&&(["editorNodes","anchorNodes"].includes(v.value.layerId)&&(V==null?void 0:V.layerId)==="editorLinks"||(W.value?(q.value=!0,F.value.showed=!1):(_.value.getCanvas().style.cursor="",D.value.showed=!1,_.value.setFeatureState({source:v.value.layerId,id:v.value.id},{hover:!1}),v.value=null,V&&n("offHover",V))))}function x(V){if(G.value={layerId:V.layerId,id:V.mapboxEvent.features[0].id},_.value.setFeatureState({source:G.value.layerId,id:G.value.id},{hover:!0}),q.value&&v.value.layerId==="editorNodes"){const J=V.mapboxEvent.features[0].id,X=I.value.features.filter(ie=>ie.properties.index===J)[0];q.value=!1,a.moveNode({selectedNode:N.value,lngLat:X.geometry.coordinates})}n("onHoverSticky",{selectedId:G.value.id,layerId:G.value.layerId})}function R(V){G.value&&(_.value.setFeatureState({source:G.value.layerId,id:G.value.id},{hover:!1}),G.value=null,n("offHover",V))}function P(V){if(V.mapboxEvent.originalEvent.button===0&["editorNodes","anchorNodes"].includes(v.value.layerId)){V.mapboxEvent.preventDefault(),_.value.getCanvas().style.cursor="grab",W.value=!0;const J=_.value.querySourceFeatures(v.value.layerId);N.value=J.filter(X=>X.id===v.value.id)[0],Q.value=!0,D.value.showed=!1,_.value.on("mousemove",K),_.value.on("mouseup",re)}}function K(V){q.value&&N.value&&(v.value.layerId==="anchorNodes"?a.moveAnchor({selectedNode:N.value,lngLat:Object.values(V.lngLat)}):a.moveNode({selectedNode:N.value,lngLat:Object.values(V.lngLat)}))}function re(){_.value.getCanvas().style.cursor="pointer",_.value.off("mousemove",K),W.value=!1,q.value=!1,Q.value=!1,C(),_.value.off("mouseup",re),G.value&&n("useStickyNode",{selectedNode:N.value.properties.index,stickyNode:G.value.id})}return(V,J)=>(O(),ee("section",null,[e(m(fe),j({"source-id":"editorLinks",source:{type:"geojson",data:w.value,buffer:0,promoteId:"index"},"layer-id":"editorLinks",layer:{type:"line",minzoom:2,paint:{"line-color":["case",["boolean",S.value,!1],V.$vuetify.theme.current.colors.linkssecondary,V.$vuetify.theme.current.colors.linksprimary],"line-width":["case",["boolean",["feature-state","hover"],!1],12,5],"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0]}}},Ae(S.value?{}:{contextmenu:r}),{onClick:T,onMouseover:k,onMouseleave:C}),null,16,["source","layer"]),e(m(vt),{"source-id":"editorLinks",type:"symbol",source:"editorLinks","layer-id":"arrow-layer",layer:{type:"symbol",minzoom:5,layout:{"symbol-placement":"line","symbol-spacing":30,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":.5,"icon-rotate":90},paint:{"icon-color":["case",["boolean",S.value,!1],V.$vuetify.theme.current.colors.linkssecondary,V.$vuetify.theme.current.colors.linksprimary]}}},null,8,["layer"]),e(m(fe),j({"source-id":"editorNodes",source:{type:"geojson",data:g.value,buffer:0,promoteId:"index"},"layer-id":"editorNodes",layer:{interactive:!0,type:"circle",minzoom:2,paint:{"circle-color":V.$vuetify.theme.current.colors.accent,"circle-radius":["case",["boolean",["feature-state","hover"],!1],["case",["boolean",z.value,!1],24,16],8],"circle-blur":["case",["boolean",["feature-state","hover"],!1],.3,0]}}},Ae(S.value?{}:{click:T,contextmenu:p}),{onMouseover:k,onMouseleave:C,onMousedown:P}),null,16,["source","layer"]),e(m(fe),{"source-id":"anchorNodes",source:{type:"geojson",data:B.value,buffer:0,promoteId:"index"},"layer-id":"anchorNodes",layer:{interactive:!0,type:"circle",minzoom:2,paint:{"circle-color":"#ffffff","circle-opacity":.5,"circle-radius":["case",["boolean",["feature-state","hover"],!1],10,5],"circle-blur":["case",["boolean",["feature-state","hover"],!1],.3,0],"circle-stroke-color":"#2C3E4E","circle-stroke-width":2}},onClick:T,onMouseover:k,onMouseleave:C,onMousedown:P,onContextmenu:c},null,8,["source"]),e(m(fe),{"source-id":"stickyNodes",reactive:!1,source:{type:"geojson",data:m(Ce),buffer:0,promoteId:"index"},"layer-id":"stickyNodes",layer:{interactive:!0,type:"circle",minzoom:2,paint:{"circle-color":V.$vuetify.theme.current.colors.accent,"circle-stroke-color":"#2C3E4E","circle-stroke-width":2,"circle-radius":["case",["boolean",["feature-state","hover"],!1],["case",["boolean",z.value,!1],24,10],8],"circle-blur":["case",["boolean",["feature-state","hover"],!1],0,0]}},onMouseover:x,onMouseleave:R},null,8,["source","layer"]),e(m(tt),{"close-button":!1,showed:D.value.showed,coordinates:D.value.coordinates,onClose:J[0]||(J[0]=X=>D.value.showed=!1)},{default:l(()=>{var X,ie;return[E("span",null,[E("h3",null,b(D.value.content),1),hl,$(" "+b(((X=v.value)==null?void 0:X.layerId)=="editorLinks"?m(u)("Left click to add a stop"):m(u)("Hold left click to drag"))+" ",1),gl,$(" "+b(((ie=v.value)==null?void 0:ie.layerId)=="editorLinks"?m(u)("Right click to edit properties"):m(u)("Right click for context menu")),1)])]}),_:1},8,["showed","coordinates"]),e(m(tt),{"close-button":!1,showed:F.value.showed,coordinates:F.value.coordinates,onClose:J[2]||(J[2]=X=>F.value.showed=!1)},{default:l(()=>[E("span",{onMouseleave:J[1]||(J[1]=X=>F.value.showed=!1)},[e(he,{density:"compact"},{default:l(()=>[(O(!0),ee(ge,null,ke(F.value.actions,X=>(O(),te(oe,{key:X.id,width:"300"},{default:l(()=>[e(A,{variant:"outlined",size:"small",block:"",onClick:ie=>f({action:X.name,feature:F.value.feature,coordinates:F.value.coordinates})},{default:l(()=>[$(b(m(u)(X.text)),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})],32)]),_:1},8,["showed","coordinates"])]))}},bl={__name:"ODMap",props:["map","isODMode","isEditorMode"],emits:["[clickFeature]"],setup(i,{emit:o}){const{$gettext:u}=Me(),t=i,n=o,L=Ce,a=Ge(),w=M(()=>a.visibleLayer),g=M(()=>a.nodes(w.value)),{isODMode:s,map:d}=ze(t);Z(s,p=>{p?d.value.on("click",G):(d.value.off("click",G),d.value.off("mousemove",Q),d.value.off("mouseup",D),S.value=!1,B.value=!1,I.value=null,_.value=!1)}),ft(()=>{d.value.off("click",G)});const I=y(null),S=y(!1),B=y(!1),_=y(!1),N=y(null),v=y({coordinates:[0,0],showed:!1,actions:[],feature:null});function G(p){if(s.value)if(_.value)_.value=!1,D(p);else{const c="OD_"+dt.generate();a.createNewLink({lngLat:Object.values(p.lngLat),index:c}),B.value=!0,N.value={properties:{linkIndex:c,coordinatedIndex:1}},_.value=!0,d.value.on("mousemove",Q)}}function z(p){if(s.value&&I.value===null){d.value.getCanvas().style.cursor="pointer";const c=[...new Set(p.mapboxEvent.features.map(r=>r.id))];I.value={layerId:p.layerId,id:c},d.value.setFeatureState({source:I.value.layerId,id:I.value.id[0]},{hover:!0})}}function W(){s.value&&I.value!==null&&(S.value?B.value=!0:(d.value.getCanvas().style.cursor="",d.value.setFeatureState({source:I.value.layerId,id:I.value.id[0]},{hover:!1}),I.value=null))}function q(p){var c,r;if(s.value&&!_.value&&((c=I.value)==null?void 0:c.layerId)==="ODNodes"&&p.mapboxEvent.originalEvent.button===0){p.mapboxEvent.preventDefault(),d.value.getCanvas().style.cursor="grab",S.value=!0;const f=d.value.querySourceFeatures(I.value.layerId);N.value=f.filter(k=>k.id===I.value.id[0])[0],(r=N.value)!=null&&r.properties&&(d.value.on("mousemove",Q),d.value.on("mouseup",D))}}function Q(p){if(B.value&&N.value){const c={selectedFeature:N.value,lngLat:Object.values(p.lngLat)};a.moveNode(c)}}function D(p){s.value&&p.originalEvent.button===0&&(d.value.getCanvas().style.cursor="pointer",d.value.off("mousemove",Q),S.value=!1,B.value=!1,d.value.getCanvas().style.cursor="",I.value&&d.value.setFeatureState({source:I.value.layerId,id:I.value.id[0]},{hover:!1}),I.value=null,_.value=!1,d.value.off("mouseup",D))}function F(p){s.value&&!_.value&&(v.value.coordinates=[p.mapboxEvent.lngLat.lng,p.mapboxEvent.lngLat.lat],v.value.showed=!0,v.value.feature=I.value.id,v.value.actions=[{name:"Edit OD Info",text:u("Edit OD Info")},{name:"Delete OD",text:u("Delete OD")}])}function T(p){const c={selectedIndex:p.feature,action:p.action,lngLat:p.coordinates};n("clickFeature",c),v.value.showed=!1,v.value.type=null}return(p,c)=>(O(),ee("section",null,[e(m(fe),{"source-id":"od",source:{type:"geojson",data:w.value,buffer:0,promoteId:"index"},"layer-id":"od",layer:{interactive:!0,type:"line",minzoom:1,maxzoom:18,paint:{"line-color":["case",["has","route_color"],["concat","#",["get","route_color"]],p.$vuetify.theme.current.colors.linksprimary],"line-opacity":["case",["boolean",i.isEditorMode,!1],.3,1],"line-width":["*",["case",["boolean",["feature-state","hover"],!1],3,1],["case",["has","route_width"],["case",["to-boolean",["to-number",["get","route_width"]]],["to-number",["get","route_width"]],2],2]],"line-blur":["*",["case",["boolean",["feature-state","hover"],!1],1,0],["case",["has","route_width"],["case",["to-boolean",["to-number",["get","route_width"]]],["to-number",["get","route_width"]],2],2]]},layout:{"line-sort-key":["to-number",["get","route_width"]],"line-cap":"round"}},onContextmenu:F,onMouseover:z,onMouseleave:W},null,8,["source","layer"]),e(m(fe),{"source-id":"ODNodes",source:{type:"geojson",data:m(s)?g.value:m(L),buffer:0,promoteId:"index"},"layer-id":"ODNodes",layer:{interactive:!0,type:"circle",paint:{"circle-color":"#ffffff","circle-opacity":.5,"circle-radius":["case",["boolean",["feature-state","hover"],!1],10,5],"circle-blur":["case",["boolean",["feature-state","hover"],!1],.3,0],"circle-stroke-color":p.$vuetify.theme.current.colors.darkgrey,"circle-stroke-width":2}},onMouseover:z,onMouseleave:W,onMousedown:q},null,8,["source","layer"]),e(m(vt),{"source-id":"od",type:"symbol",source:"od","layer-id":"arrow-od",layer:{type:"symbol",layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.2,["case",["has","route_width"],["case",["to-boolean",["to-number",["get","route_width"]]],["to-number",["get","route_width"]],2],2]],"icon-rotate":90},paint:{"icon-color":["case",["has","route_color"],["concat","#",["get","route_color"]],p.$vuetify.theme.current.colors.linksprimary]}}},null,8,["layer"]),e(m(tt),{"close-button":!1,showed:v.value.showed,coordinates:v.value.coordinates,onClose:c[1]||(c[1]=r=>v.value.showed=!1)},{default:l(()=>[E("span",{onMouseleave:c[0]||(c[0]=r=>v.value.showed=!1)},[e(he,{density:"compact"},{default:l(()=>[(O(!0),ee(ge,null,ke(v.value.actions,r=>(O(),te(oe,{key:r.id},{default:l(()=>[e(A,{variant:"outlined",size:"small",onClick:f=>T({action:r.name,feature:v.value.feature,coordinates:v.value.coordinates})},{default:l(()=>[$(b(m(u)(r.text)),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})],32)]),_:1},8,["showed","coordinates"])]))}},kl={key:0,style:{display:"flex"}},wl={__name:"Map",props:{mode:{type:String,default:"pt"}},emits:["clickFeature"],setup(i,{emit:o}){const u="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",{$gettext:t}=Me(),n=Je(()=>Ze(()=>import("./LayerSelector-zBNtFyAn.js"),__vite__mapDeps([0,1,2,3]))),L=Je(()=>Ze(()=>import("./StaticLayer-n_pza96f.js").then(h=>h.a),__vite__mapDeps([4,1,2,5]))),a=Je(()=>Ze(()=>import("./RoadLinks-BmRZWHJZ.js"),__vite__mapDeps([6,7,1,2,8,9,10]))),w=i,g=o,s=ue(),d=pe(),I=Oe(),S=St(null),B=y(!1);function _(h){S.value&&(B.value=!1);const H=new et.LngLatBounds;d.links.features.length>0?d.links.features.forEach(U=>{H.extend([U.geometry.coordinates[0],U.geometry.coordinates[U.geometry.coordinates.length-1]])}):I.rlinks.features.forEach(U=>{H.extend([U.geometry.coordinates[0],U.geometry.coordinates[U.geometry.coordinates.length-1]])}),Object.keys(H).length!==0&&h.map.fitBounds(H,{padding:100}),h.map.loadImage(Mt,function(U,Ke){if(U){console.error("err image",U);return}h.map.addImage("arrow",Ke,{sdf:!0})}),S.value=h.map,h.map.dragRotate.disable(),B.value=!0}const N=M(()=>s.showLeftPanel);Z(N,()=>{setTimeout(()=>S.value.resize(),250)});const v=M(()=>s.mapStyle);Z(v,()=>{G()}),Lt(()=>{G()});function G(){try{const h=S.value.getCenter();s.saveMapPosition({mapCenter:[h.lng,h.lat],mapZoom:S.value.getZoom()})}catch{}}const z=M(()=>s.visibleRasters),W=M(()=>s.styles),q=M(()=>s.availableLayers),{mode:Q}=ze(w),D=M(()=>d.editorNodes),F=M(()=>s.anchorMode),T=M(()=>I.rlinksIsEmpty),p=M(()=>d.editorTrip),c=M(()=>p.value!==null),r=y(Nt([])),f=y(!1),k=y(!1);function C(h){if(Object.keys(h).includes("mapboxEvent")&&!k.value&&f.value&&!F.value){const H=[r.value.geometry.coordinates[0],Object.values(h.mapboxEvent.lngLat)];r.value.geometry.coordinates=H}}function x(h){f.value&&h==="out"&&S.value.setLayoutProperty("drawLink","visibility","none"),f.value&&h==="in"&&S.value.setLayoutProperty("drawLink","visibility","visible")}function R(h){var H;((H=h.mapboxEvent)==null?void 0:H.originalEvent.button)===2&&!K.value&&(f.value=!1)}Z(p,h=>{if(s.setStickyMode(!1),k.value=!1,h){if(s.setAnchorMode(!1),d.changeBounds){const H=new et.LngLatBounds;D.value.features.forEach(U=>{H.extend(U.geometry.coordinates)}),S.value.fitBounds(H,{padding:200})}}else f.value=!1}),Z(c,h=>{h&&D.value.features.length>0&&!F.value&&B.value?f.value=!0:(f.value=!1,r.value.geometry.coordinates=[]),!h&&f.value&&(f.value=!1,r.value.geometry.coordinates=[])}),Z(F,h=>{h?(f.value=!1,s.changeNotification({text:t("Left click to add an anchor point, right click to delete"),autoClose:!1})):s.changeNotification({text:"",autoClose:!0})}),Z(Q,h=>{h==="pt"&&(f.value=!1)}),Z(f,h=>{h?S.value.setLayoutProperty("drawLink","visibility","visible"):S.value.setLayoutProperty("drawLink","visibility","none")});const P=y({id:null,layerId:null}),K=y(null),re=y(null),V=M(()=>d.firstNode),J=M(()=>d.lastNode);Z(V,h=>{var H;p.value&&h&&(r.value.geometry.coordinates=[h.geometry.coordinates,h.geometry.coordinates],P.value.layerId="nodes",P.value.id=(H=V.value)==null?void 0:H.properties.index)},{deep:!0}),Z(J,h=>{var H;p.value&&h&&(r.value.geometry.coordinates=[h.geometry.coordinates,h.geometry.coordinates],P.value.layerId="nodes",P.value.id=(H=J.value)==null?void 0:H.properties.index)},{deep:!0});function X(h){Object.keys(h).includes("mapboxEvent")&&(h.mapboxEvent.originalEvent.stopPropagation(),f.value?P.value.layerId==="rnodes"?je(h):ie(h):D.value.features.length===0&&p.value&&(d.createNewNode(Object.values(h.mapboxEvent.lngLat)),s.changeNotification({text:"",autoClose:!0})))}function ie(h){const H=P.value.id===d.lastNodeId?"Extend Line Upward":"Extend Line Downward",U=Object.values(h.mapboxEvent.lngLat);if(f.value&&!F.value&&!K.value)d.applyNewLink({nodeId:P.value.id,geom:U,action:H});else if(k.value&&re.value==="stickyNodes"&&K.value){d.applyNewLink({nodeId:P.value.id,geom:U,action:H});const Ke=d.newNode.features[0].properties.index;it({stickyNode:K.value,selectedNode:Ke})}}function je(h){const H=Object.values(h.mapboxEvent.lngLat),U={nodeIdA:P.value.id,nodeIdB:K.value,geom:H,layerId:re.value};I.createrLink(U),f.value=!1,nt({layerId:"rnodes",selectedId:[U.nodeIdB]}),Ue()}function Se(h){["Move rNode","Delete rLink"].includes(h.action)&&(f.value=!1,k.value=!1),h.action==="Add Road Node Inline"&&f.value||g("clickFeature",h)}function pt(h){K.value=h.selectedId,f.value&&S.value.setLayoutProperty("drawLink","visibility","none"),K.value===d.firstNodeId?(r.value.geometry.coordinates=[V.value.geometry.coordinates,V.value.geometry.coordinates],P.value.id=K.value,P.value.layerId=h.layerId,f.value=!0):K.value===d.lastNodeId&&(r.value.geometry.coordinates=[J.value.geometry.coordinates,J.value.geometry.coordinates],P.value.id=K.value,P.value.layerId=h.layerId,f.value=!0)}function nt(h){if((h==null?void 0:h.layerId)==="rnodes")if(re.value=h.layerId,K.value=h.selectedId[0],f.value)k.value=!0;else{const H=I.renderedrNodes.features.filter(U=>U.properties.index===K.value)[0];r.value.geometry.coordinates=[H.geometry.coordinates,H.geometry.coordinates],f.value=!0,k.value=!1,P.value.id=K.value,P.value.layerId=re.value}else(h==null?void 0:h.layerId)==="rlinks"&&(re.value=h.layerId,K.value=h.selectedId)}function mt(h){K.value=h.selectedId,re.value=h.layerId,k.value=!0}function Ue(){K.value=null,re.value=null,f.value&&(S.value.setLayoutProperty("drawLink","visibility","visible"),k.value=!1)}const qe=y(!1),Le=y(""),Re=y("");function it(h){Le.value=h.stickyNode,Re.value=h.selectedNode,Le.value!==Re.value&&(qe.value=!0)}function ht(){D.value.features.map(H=>H.properties.index).includes(Le.value)?s.changeNotification({text:t("Node already in use by the trip. Cannot replace"),autoClose:!0,color:"error"}):d.applyStickyNode({selectedNodeId:Re.value,stickyNodeId:Le.value})}return(h,H)=>(O(),ee(ge,null,[e(Et,{modelValue:qe.value,"onUpdate:modelValue":H[0]||(H[0]=U=>qe.value=U),title:m(t)("Replace %{index}",{index:Re.value}),body:m(t)("with %{index}?",{index:Le.value}),onConfirm:ht},null,8,["modelValue","title","body"]),(O(),te(m(Pt),{key:v.value,style:{width:"100%"},"access-token":m(u),"map-style":v.value,center:m(s).mapCenter,zoom:m(s).mapZoom,onLoad:_,onMousemove:C,onMouseout:H[3]||(H[3]=U=>x("out")),onMouseenter:H[4]||(H[4]=U=>x("in")),onClick:X,onMousedown:R},{default:l(()=>[B.value?(O(),ee("div",kl,[e(pl),e(At),W.value.length>0?(O(),te(m(n),{key:0,choices:W.value,"available-layers":q.value,map:S.value},null,8,["choices","available-layers","map"])):de("",!0)])):de("",!0),e(m(Vt),{position:"bottom-right"}),e(m(Ft),{position:"bottom-right","visualize-pitch":!0}),(O(!0),ee(ge,null,ke(W.value,U=>(O(),ee("div",{key:U.name},[B.value&&z.value.includes(U.name)&&q.value.includes(U.layer)?(O(),te(m(L),{key:U.name,map:S.value,preset:U,order:z.value.indexOf(U.name),"visible-rasters":z.value},null,8,["map","preset","order","visible-rasters"])):de("",!0)]))),128)),B.value&&!T.value?(O(),te(m(a),j({key:1,ref:"roadref",map:S.value,"is-editor-mode":c.value,"is-road-mode":m(Q)==="road",onSelect:H[1]||(H[1]=U=>f.value=!1)},Ae(c.value?{}:F.value?{clickFeature:Se}:{onHover:nt,offHover:Ue,clickFeature:Se})),null,16,["map","is-editor-mode","is-road-mode"])):de("",!0),e(ml,{map:S.value,"is-editor-mode":c.value,mode:m(Q),onRightClick:H[2]||(H[2]=U=>g("clickFeature",U))},null,8,["map","is-editor-mode","mode"]),B.value?(O(),te(yl,j({key:2,map:S.value},Ae(F.value?{clickFeature:Se}:{onHover:pt,onHoverSticky:mt,offHover:Ue,clickFeature:Se,useStickyNode:it})),null,16,["map"])):de("",!0),e(bl,{map:S.value,"is-editor-mode":c.value,"is-o-d-mode":m(Q)==="od",onClickFeature:Se},null,8,["map","is-editor-mode","is-o-d-mode"]),Ne(e(m(fe),{"source-id":"drawLink",source:{type:"geojson",data:r.value,buffer:0,generateId:!0},"layer-id":"drawLink",layer:{type:"line",minzoom:2,paint:{"line-opacity":1,"line-color":h.$vuetify.theme.current.colors.linksprimary,"line-width":["case",["boolean",k.value,!1],5,3],"line-dasharray":["case",["boolean",k.value,!1],["literal",[]],["literal",[0,2,4]]]}}},null,8,["source","layer"]),[[Ee,f.value]])]),_:1},8,["access-token","map-style","center","zoom"]))],64))}},Cl=ve(wl,[["__scopeId","data-v-fc924478"]]),xl={name:"ColorPicker",props:["pcolor"],events:["update:pcolor"],data(){return{color:"#00BCD4",cmenu:!1,swatches:[],chart:{lightgreen:"#CDDC39",darkgreen:"#4CAF50",lightblue:"#00BCD4",darkblue:"#2196F3",purple:"#673AB7",pink:"#E91E63",orange:"#FF7B30",yellow:"#FFC107"}}},computed:{swatchStyle(){const{color:i,cmenu:o}=this;return{backgroundColor:i,"border-style":"solid","border-width":"1px","border-color":"#868686",cursor:"pointer",height:"20px",width:"20px",borderRadius:o?"50%":"4px",transition:"border-radius 200ms ease-in-out"}}},watch:{pcolor(){this.pcolor[0]!=="#"&&(this.color="#".concat(this.pcolor),this.$emit("update:pcolor",this.pcolor.slice(0,6))),this.pcolor[0]==="#"&&this.$emit("update:pcolor",this.pcolor.slice(1,7))}},mounted(){const i=Object.keys(this.chart);let o=[];i.map(u=>{o.push(this.chart[u]),o.length===2&&(this.swatches.push(o),o=[])}),[null,void 0,""].includes(this.pcolor)?this.color=this.chart.lightblue:this.pcolor[0]!=="#"?this.color="#".concat(this.pcolor):this.color=this.pcolor},methods:{updateColor(){this.$emit("update:pcolor",this.color),this.cmenu=!1},cancel(){this.color=this.pcolor,this.cmenu=!1}}};function Il(i,o,u,t,n,L){return O(),te(Ie,{modelValue:n.cmenu,"onUpdate:modelValue":o[1]||(o[1]=a=>n.cmenu=a),location:"top","close-on-content-click":!1},{activator:l(({props:a})=>[E("div",j({style:L.swatchStyle},a),null,16)]),default:l(()=>[e(se,null,{default:l(()=>[e(De,{class:"pa-0"},{default:l(()=>[e(_t,{modelValue:n.color,"onUpdate:modelValue":o[0]||(o[0]=a=>n.color=a),mode:"hexa",swatches:n.swatches,"show-swatches":""},null,8,["modelValue","swatches"])]),_:1}),e(Pe,null,{default:l(()=>[e(ae),e(A,{color:"grey",variant:"outlined",onClick:L.cancel},{default:l(()=>[$(b(i.$gettext("cancel")),1)]),_:1},8,["onClick"]),e(A,{color:"green-darken-1",variant:"outlined",onClick:L.updateColor},{default:l(()=>[$(b(i.$gettext("apply")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const Sl=ve(xl,[["render",Il]]),Ll={__name:"MenuSelector",props:{items:{type:Array,default:()=>[]},value:{default:()=>null}},emits:["update:value"],setup(i){const o=y(!1);return(u,t)=>(O(),te(Ie,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=n=>o.value=n),"close-delay":"100",location:"bottom",transition:"slide-y-transition"},{activator:l(({props:n})=>[e(A,j({variant:"text",icon:o.value?"fas fa-chevron-left":"fas fa-chevron-down",color:"regular",size:"x-small"},n),null,16,["icon"])]),default:l(()=>[e(he,{"max-height":"60vh"},{default:l(()=>[(O(!0),ee(ge,null,ke(i.items,(n,L)=>(O(),te(oe,{key:L,class:ot({"is-active":n===i.value}),onClick:()=>u.$emit("update:value",n)},{default:l(()=>[e(me,null,{default:l(()=>[$(b(n),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]))}},Nl=ve(Ll,[["__scopeId","data-v-12f598c5"]]),le=i=>i,El={agency_id:le("transit brand or transit agency"),direction_id:le(`direction of travel for a trip. used to separate trips by directions.
     ex: 0 - Travel in one direction. 1 - Travel in the opposite direction.`),drop_off_type:le(`0 - Regularly scheduled drop off.
    1 - No drop off available.
    2 - Must phone agency to arrange drop off.
    3 - Must coordinate with driver to arrange drop off.`),headway:le("Time between departures in seconds"),pickup_type:le(`0 - Regularly scheduled pickup.
    1 - No pickup available.
    2 - Must phone agency to arrange pickup.
    3 - Must coordinate with driver to arrange pickup`),route_color:le("color to display on the map (i.e. FFFFFF)"),route_id:le("Identifies a route. Often a string"),route_long_name:le("Full name of a route.This name is generally more descriptive than the route_short_name and often includes the roudefaultAttributeste's destination or stop"),route_short_name:le(`Short name of a route. This will often be a short,
     abstract identifier like "32", "100X", or "Green"`),route_type:le(`Indicates the type of transportation used on a route.
     subway, metro, rail, bus, ferry, tram, etc`),route_width:le("width to display on the map"),time:le("Travel time on the link. set as length / speed when a link is created or edited (seconds)"),trip_id:le(`Line (or trip) identifier (i.e. 100 Est).
     Links are group by trip_id in Quetzal-network-editor.`),length:le("links geometry linestring length (meters)"),highway:le("Main identifier or any kind of road, street or path. ex: (motorway, residential, primary)"),speed:le("speed on the link (Km/h)"),cycleway:le("if the road contain a bike path. either yes, no or shared"),cycleway_reverse:le("if the road contain a bike path in the opposite direction. either yes, no or shared. a road can be a oneway and have cycleway on both side.")},_l={headway:"secs",time:"secs",length:"m",speed:"(km/h)"},Dl={__name:"EditDialog",props:rt(["mode","action","linkDir"],{showDialog:{},showDialogModifiers:{},editorForm:{},editorFormModifiers:{}}),emits:rt(["applyAction","cancelAction"],["update:showDialog","update:editorForm"]),setup(i,{emit:o}){const{$gettext:u}=Me(),t=st(i,"showDialog"),n=st(i,"editorForm"),L=i,{mode:a,action:w}=ze(L),g=o,s=ue(),d=pe(),I=Oe(),S=Ge();Z(t,r=>{r&&s.changeNotification({text:"",autoClose:!0}),q.value=!1,v.value=!1});const B=M(()=>Array.isArray(n.value)?n.value.length:1);function _(r){let f=n.value;f.length>=1&&(f=f[r]);const k=Object.keys(f).filter(x=>!f[x].disabled).sort();return k.push(...Object.keys(f).filter(x=>f[x].disabled).sort()),k.reduce((x,R)=>(x[R]=f[R],x),{})}function N(r){if(a.value==="pt")switch(r){case"speed":n.value.speed.value=Number(n.value.speed.value).toFixed(6);const f=n.value.length.value/n.value.speed.value*3.6;n.value.time.placeholder||(n.value.time.value=Number(f.toFixed(0)));break;case"time":n.value.time.value=Number(n.value.time.value).toFixed(0);const k=n.value.length.value/n.value.time.value*3.6;n.value.speed.placeholder||(n.value.speed.value=Number(k.toFixed(6)));break;case"length":n.value.length.value=Number(n.value.length.value).toFixed(0);const C=n.value.length.value/n.value.speed.value*3.6;n.value.placeholder||(n.value.time.value=Number(C.toFixed(0)));break}}const v=y(!1);function G(){v.value=!v.value,v.value?s.changeNotification({text:u("This action will delete properties on every links (and reversed one for two-way roads)"),autoClose:!1,color:"warning"}):s.changeNotification({text:"",autoClose:!0})}const z=M(()=>["pt","road"].includes(a.value)?s.attributesChoices[a.value]:{});function W(r){return a.value==="pt"?d.defaultAttributesNames.includes(r):I.rundeletable.includes(r)}const q=y(!1),Q=El,D=_l,F={newField:[r=>!Object.keys(n.value).includes(r)||u("field already exist"),r=>r!==""||u("cannot add empty field"),r=>!(r!=null&&r.endsWith("_r"))||u("field cannot end with _r")]},T=y(null);function p(){var f;let r={};if(Array.isArray(n.value)?r=ce.cloneDeep(n.value[0]):r=ce.cloneDeep(n.value),Object.keys(r).includes(T.value)||T.value===""|!T.value||(f=T.value)!=null&&f.endsWith("_r"))T.value="";else{if(Array.isArray(n.value)){const k=ce.cloneDeep(n.value);k.forEach(C=>{Object.keys(C)[0].endsWith("_r")?I.rcstAttributes.includes(T.value)||(C[T.value+"_r"]={disabled:!1,placeholder:!1,value:void 0}):C[T.value]={disabled:!1,placeholder:!1,value:void 0}}),n.value=null,n.value=k}else r[T.value]={disabled:!1,placeholder:!1,value:void 0},n.value={},n.value=r;["Edit Line Info","Edit Link Info","Edit Group Info"].includes(w.value)?d.addPropertie({name:T.value,table:"links"}):["Edit rLink Info","Edit Road Group Info","Edit Visible Road Info"].includes(w.value)?I.addRoadPropertie({name:T.value,table:"rlinks"}):w.value==="Edit Node Info"?d.addPropertie({name:T.value,table:"nodes"}):w.value==="Edit rNode Info"?I.addRoadPropertie({name:T.value,table:"rnodes"}):["Edit OD Group Info","Edit Visible OD Info"].includes(w.value)&&S.addPropertie(T.value),T.value=null,s.changeNotification({text:u("Field added"),autoClose:!0,color:"success"})}}function c(r){let f=ce.cloneDeep(n.value);Array.isArray(n.value)?(r.endsWith("_r")&&(r=r.substr(0,r.length-2)),f=f.filter(k=>delete k[r]),f=f.filter(k=>delete k[r+"_r"])):delete f[r],n.value={},n.value=f,["Edit Line Info","Edit Link Info","Edit Group Info"].includes(w.value)?d.deletePropertie({name:r,table:"links"}):["Edit rLink Info","Edit Road Group Info","Edit Visible Road Info"].includes(w.value)?I.deleteRoadPropertie({name:r,table:"rlinks"}):w.value==="Edit Node Info"?d.deletePropertie({name:r,table:"nodes"}):w.value==="Edit rNode Info"?I.deleteRoadPropertie({name:r,table:"rnodes"}):["Edit OD Group Info","Edit Visible OD Info"].includes(w.value)&&S.deletePropertie({name:r}),s.changeNotification({text:u("Field deleted"),autoClose:!0,color:"success"})}return(r,f)=>(O(),te(Ye,{modelValue:t.value,"onUpdate:modelValue":f[6]||(f[6]=k=>t.value=k),scrollable:"",persistent:"","max-width":B.value>1?"40rem":"20rem"},{default:l(()=>[e(se,{"max-height":"55rem"},{default:l(()=>[e(at,{class:"text-h5"},{default:l(()=>[$(b(m(u)("Edit Properties")),1)]),_:1}),e(xe),e(De,null,{default:l(()=>[e(ut,null,{default:l(()=>[(O(!0),ee(ge,null,ke(B.value,(k,C)=>(O(),te(ct,{key:C},{default:l(()=>[e(he,null,{default:l(()=>[B.value>1?(O(),te(oe,{key:0},{default:l(()=>[e(Fe,{style:Te({"align-items":"center","justify-content":"center",transform:"rotate("+i.linkDir[C]+"deg)"})},{default:l(()=>[$(" fas fa-long-arrow-alt-up ")]),_:2},1032,["style"])]),_:2},1024)):de("",!0),(O(!0),ee(ge,null,ke(_(C),(x,R)=>(O(),te(be,{key:R,modelValue:x.value,"onUpdate:modelValue":P=>x.value=P,label:R,hint:q.value?m(Q)[R]:"","persistent-hint":q.value,variant:x.disabled?"underlined":"filled",type:m(d).attributeType(R),placeholder:x.placeholder?m(u)("multiple Values"):"","persistent-placeholder":!!x.placeholder,disabled:x.disabled,suffix:m(D)[R],"prepend-inner-icon":["length","speed","time"].includes(R)&&m(a)==="pt"?"fas fa-calculator":"",onWheel:f[0]||(f[0]=P=>P.target.blur()),onChange:P=>N(R)},Dt({_:2},[R==="route_color"?{name:"append-inner",fn:l(()=>[e(Sl,{pcolor:x.value,"onUpdate:pcolor":P=>x.value=P},null,8,["pcolor","onUpdate:pcolor"])]),key:"0"}:Object.keys(z.value).includes(R)?{name:"append-inner",fn:l(()=>[e(Nl,{value:x.value,"onUpdate:value":P=>x.value=P,items:z.value[R]},null,8,["value","onUpdate:value","items"])]),key:"1"}:void 0,v.value?{name:"prepend",fn:l(()=>[e(A,{variant:"text",icon:"fas fa-trash small",size:"x-small",disabled:W(R),color:"error",onClick:()=>c(R)},null,8,["disabled","onClick"])]),key:"2"}:void 0]),1032,["modelValue","onUpdate:modelValue","label","hint","persistent-hint","variant","type","placeholder","persistent-placeholder","disabled","suffix","prepend-inner-icon","onChange"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(ut,null,{default:l(()=>[e(be,{modelValue:T.value,"onUpdate:modelValue":f[1]||(f[1]=k=>T.value=k),label:m(u)("add field"),placeholder:m(u)("new field name"),variant:"filled",rules:F.newField,onKeydown:Xe(_e(p,["stop"]),["enter"]),onWheel:f[2]||(f[2]=k=>k.target.blur())},{"append-inner":l(()=>[e(A,{color:"primary",icon:"fas fa-plus",size:"x-small",onClick:p})]),_:1},8,["modelValue","label","placeholder","rules","onKeydown"])]),_:1})]),_:1}),e(xe),e(Pe,null,{default:l(()=>[e(A,{icon:"far fa-question-circle small",variant:"text",size:"x-small",onClick:f[3]||(f[3]=()=>q.value=!q.value)}),e(A,{icon:v.value?"fas fa-minus-circle fa-rotate-90":"fas fa-minus-circle",size:"x-small",variant:"text",onClick:G},null,8,["icon"]),e(ae),e(A,{color:"grey",variant:"text",onClick:f[4]||(f[4]=k=>g("cancelAction"))},{default:l(()=>[$(b(m(u)("Cancel")),1)]),_:1}),e(A,{color:"success",variant:"text",onClick:f[5]||(f[5]=k=>g("applyAction"))},{default:l(()=>[$(b(m(u)("Save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","max-width"]))}},He=i=>i,Vl={name:"Home",components:{Map:Cl,SidePanel:dl,EditDialog:Dl},setup(){const i=ue(),o=pe(),u=Oe(),t=Ge(),n=y({}),L=y("pt"),a=y(null),w=M(()=>o.editorTrip);ft(()=>{o.setEditorTrip({tripId:null,changeBounds:!1}),i.anchorMode&&i.changeAnchorMode(),i.cyclewayMode&&i.changeCyclewayMode()});const g=y(!1),s=y(null),d=y(null),I=y(null),S=y(!1),B=y(!1),_=y(null),N=y(""),v=y({trip:null,name:null,reverse:!0,nodes:!1}),G=y(null),z=y(!0),W=y([]),q=y([]);function Q(C){if(a.value=C.action,a.value==="Edit Line Info")n.value=ce.cloneDeep(o.editorLineInfo),z.value=C.lingering,g.value=!0;else if(a.value==="Edit Group Info"){W.value=new Set(C.tripIds);const x=["index","length","time","a","b","link_sequence","trip_id"],R=o.lineAttributes,P=o.links.features.filter(K=>W.value.has(K.properties.trip_id));n.value=ye(P,R,x),z.value=C.lingering,g.value=!0}else if(a.value==="Edit Link Info"){d.value=C.selectedFeature.properties;const x=["a","b","index","link_sequence","trip_id"],R=o.lineAttributes,P=o.editorLinks.features.filter(K=>K.properties.index===d.value.index);n.value=ye(P,R,x),z.value=C.lingering,g.value=!0}else if(a.value==="Edit rLink Info")d.value=C.selectedIndex,n.value=d.value.map(x=>u.rlinksForm(x)),q.value=u.rlinkDirection(d.value),C.selectedIndex.forEach(x=>{u.onewayIndex.has(x)&&(d.value.push(x),n.value.push(u.reversedrLinksForm(x)),q.value.push(u.rlinkDirection(d.value,!0)))}),g.value=!0;else if(a.value==="Edit OD Info")d.value=C.selectedIndex[0],n.value=t.linkForm(d.value),g.value=!0;else if(a.value==="Edit Road Group Info"){const x=u.grouprLinks(C.category,C.group);d.value=x;const R=u.rlineAttributes,P=["index","length","time","a","b"];n.value=ye(x,R,P),z.value=C.lingering,g.value=!0}else if(a.value==="Edit selected Info"){d.value=u.rlinks.features.filter(P=>C.selectedIndex.has(P.properties.index));const x=u.rlineAttributes,R=["index","length","time","a","b"];n.value=ye(d.value,x,R),z.value=C.lingering,g.value=!0}else if(a.value==="Edit Visible Road Info"){const x=u.visiblerLinks.features;d.value=x;const R=u.rlineAttributes,P=["index","length","time","a","b"];n.value=ye(x,R,P),z.value=C.lingering,g.value=!0}else if(a.value==="Edit OD Group Info"){const x=t.groupLayer(C.category,C.group);d.value=x;const R=t.layerAttributes,P=["index"];n.value=ye(x,R,P),z.value=C.lingering,g.value=!0}else if(a.value==="Edit Visible OD Info"){const x=t.visibleLayer.features;d.value=x;const R=t.layerAttributes,P=["index"];n.value=ye(x,R,P),z.value=C.lingering,g.value=!0}else if(["Edit Node Info","Edit rNode Info"].includes(a.value)){s.value=C.selectedFeature.properties,a.value==="Edit Node Info"?n.value=o.editorNodes.features.filter(P=>P.properties.index===s.value.index):a.value==="Edit rNode Info"&&(n.value=u.visiblerNodes.features.filter(P=>P.properties.index===s.value.index)),n.value=n.value[0].properties;const x=["index","route_width"],R=Object.keys(n.value).reduce((P,K)=>(P[K]={value:n.value[K],disabled:x.includes(K),placeholder:!1},P),{});n.value=R,g.value=!0}else a.value==="Delete OD"&&(I.value=C.selectedIndex,D())}function D(){switch(g.value=!1,B.value=!1,a.value){case"Edit Link Info":o.editLinkInfo({selectedLinkId:d.value.index,info:n.value});break;case"Edit Node Info":o.editNodeInfo({selectedNodeId:s.value.index,info:n.value});break;case"Edit Line Info":n.value.trip_id.value!==o.editorTrip&&o.tripId.includes(n.value.trip_id.value)&&(z.value=!0,o.setEditorTrip({tripId:null,changeBounds:!1}),a.value=null,i.changeNotification({text:He("Could not apply modification. Trip_id already exist"),autoClose:!0,color:"red darken-2"})),o.editLineInfo(n.value),o.editorNodes.features.length===0&&i.changeNotification({text:He("Click on the map to start drawing"),autoClose:!1});break;case"Edit Group Info":o.editGroupInfo({groupTripIds:W.value,info:n.value});break;case"Edit rLink Info":u.editrLinkInfo({selectedLinkId:d.value,info:n.value});break;case"Edit Road Group Info":u.editrGroupInfo({selectedLinks:d.value,info:n.value});break;case"Edit selected Info":u.editrGroupInfo({selectedLinks:d.value,info:n.value});break;case"Edit Visible Road Info":u.editrGroupInfo({selectedLinks:u.visiblerLinks.features,info:n.value});break;case"Edit OD Group Info":t.editGroupInfo({selectedLinks:d.value,info:n.value});break;case"Edit Visible OD Info":t.editGroupInfo({selectedLinks:t.visibleLayer.features,info:n.value});break;case"Edit rNode Info":u.editrNodeInfo({selectedNodeId:s.value.index,info:n.value});break;case"Edit OD Info":t.editLinkInfo({selectedLinkId:d.value,info:n.value});break;case"deleteTrip":o.deleteTrip(_.value);break;case"deleterGroup":u.deleterGroup(_.value);break;case"Delete OD":t.deleteOD({selectedIndex:I.value});break;case"deleteODGroup":t.deleteGroup(_.value);break}z.value||(T(),z.value=!0)}function F(){g.value=!1,B.value=!1,z.value||(p(),z.value=!0)}function T(){o.confirmChanges(),o.setEditorTrip({tripId:null,changeBounds:!1}),a.value=null,i.changeNotification({text:He("modification applied"),autoClose:!0,color:"success"})}function p(){o.setEditorTrip({tripId:null,changeBounds:!1}),a.value=null,i.changeNotification({text:He("modification aborted"),autoClose:!0})}function c(C){_.value=C.trip,N.value=C.message,a.value=C.action,B.value=!0}function r(){o.tripId.includes(v.value.name)?G.value="already exist":(o.cloneTrip({tripId:v.value.trip,name:v.value.name,cloneNodes:v.value.nodes,reverse:v.value.reverse}),G.value="",S.value=!1)}function f(C){v.value.trip=C.trip,N.value=C.message,v.value.name=C.trip+" copy",S.value=!0}function k(){G.value="",S.value=!1}return{actionClick:Q,applyAction:D,cancelAction:F,confirmChanges:T,abortChanges:p,deleteButton:c,duplicate:r,cloneButton:f,cancelClone:k,selectedNode:s,selectedLink:d,selectedIndex:I,showDialog:g,cloneDialog:S,deleteDialog:B,tripToDelete:_,cloneObj:v,message:N,errorMessage:G,lingering:z,groupTripIds:W,linkDir:q,store:i,linksStore:o,rlinksStore:u,ODStore:t,editorTrip:w,editorForm:n,mode:L,action:a}}},Fl={class:"map-view"},Pl={class:"text-h6"};function Al(i,o,u,t,n,L){const a=we("EditDialog"),w=we("SidePanel"),g=we("Map");return O(),ee("section",Fl,[e(a,{"show-dialog":t.showDialog,"onUpdate:showDialog":o[0]||(o[0]=s=>t.showDialog=s),"editor-form":t.editorForm,"onUpdate:editorForm":o[1]||(o[1]=s=>t.editorForm=s),mode:t.mode,action:t.action,"link-dir":t.linkDir,onApplyAction:t.applyAction,onCancelAction:t.cancelAction},null,8,["show-dialog","editor-form","mode","action","link-dir","onApplyAction","onCancelAction"]),e(Ye,{modelValue:t.deleteDialog,"onUpdate:modelValue":o[2]||(o[2]=s=>t.deleteDialog=s),scrollable:"",persistent:"","max-width":"20rem"},{default:l(()=>[e(se,{"max-height":"55rem"},{default:l(()=>[e(at,{class:"text-h5"},{default:l(()=>[$(b(i.$gettext("Delete")+" "+t.message+"?"),1)]),_:1}),e(xe),e(Pe,null,{default:l(()=>[e(ae),e(A,{color:"grey",variant:"text",onClick:t.cancelAction},{default:l(()=>[$(b(i.$gettext("Cancel")),1)]),_:1},8,["onClick"]),e(A,{color:"success",variant:"text",onClick:t.applyAction},{default:l(()=>[$(b(i.$gettext("Save")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Ye,{modelValue:t.cloneDialog,"onUpdate:modelValue":o[7]||(o[7]=s=>t.cloneDialog=s),"max-width":"20rem",persistent:""},{default:l(()=>[e(se,null,{default:l(()=>[e(De,null,{default:l(()=>[E("span",Pl,b(i.$gettext("Duplicate")+" "+t.message+" ?"),1)]),_:1}),e(De,null,{default:l(()=>[e(be,{modelValue:t.cloneObj.name,"onUpdate:modelValue":o[3]||(o[3]=s=>t.cloneObj.name=s),label:i.$gettext("New name")},null,8,["modelValue","label"]),e($e,{modelValue:t.cloneObj.reverse,"onUpdate:modelValue":o[4]||(o[4]=s=>t.cloneObj.reverse=s),label:i.$gettext("reverse")},null,8,["modelValue","label"]),e($e,{modelValue:t.cloneObj.nodes,"onUpdate:modelValue":o[5]||(o[5]=s=>t.cloneObj.nodes=s),label:i.$gettext("duplicate nodes")},null,8,["modelValue","label"])]),_:1}),e(De,{style:{textAlign:"center",color:"red"}},{default:l(()=>[$(b(t.errorMessage),1)]),_:1}),e(Pe,null,{default:l(()=>[e(ae),e(A,{color:"grey",variant:"text",onClick:t.cancelClone},{default:l(()=>[$(b(i.$gettext("Cancel")),1)]),_:1},8,["onClick"]),e(A,{color:"green-darken-1",variant:"text",onClick:o[6]||(o[6]=s=>t.duplicate())},{default:l(()=>[$(b(i.$gettext("Save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(w,{onConfirmChanges:t.confirmChanges,onAbortChanges:t.abortChanges,onDeleteButton:t.deleteButton,onCloneButton:t.cloneButton,onPropertiesButton:t.actionClick,onChangeMode:o[8]||(o[8]=s=>t.mode=s)},null,8,["onConfirmChanges","onAbortChanges","onDeleteButton","onCloneButton","onPropertiesButton"]),e(g,{mode:t.mode,onClickFeature:t.actionClick},null,8,["mode","onClickFeature"])])}const zl=ve(Vl,[["render",Al],["__scopeId","data-v-13a2e40c"]]);export{zl as default};
