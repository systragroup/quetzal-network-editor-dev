import{an as ge,c as I,f as W,l as Se,g as B,E as ie,A as E,H as _e,I as Le,C as G,_ as we,bb as Me,bc as ke,r as X,al as V,Z as se,bd as Ce,a as ne,be as qe,bf as z,bg as je,t as Fe,ab as Ae,ac as Xe,ad as Oe,d as Ne,o as $e,j as Re,m as ee}from"./index-B3varY1O.js";const ze={class:"gradient"},Ee={class:"domain-title"},Ie={class:"domain-min"},Pe={class:"domain-med"},De={class:"domain-max"},Ge=ge({__name:"MapLegend",props:{colorScale:{default:()=>[]},displaySettings:{},order:{default:0}},setup(v){const c=v,u=I(()=>50+180*c.order),h=I(()=>isFinite(c.displaySettings.maxVal)&&isFinite(c.displaySettings.minVal)),o=I(()=>{const x=(c.displaySettings.maxVal+c.displaySettings.minVal)/2;return x.toFixed(x>=10?0:1)});return(x,d)=>h.value?(B(),W("div",{key:0,class:"legend elevation-4",style:ie({left:`${u.value}px !important`})},[E("div",ze,[(B(!0),W(_e,null,Le(x.colorScale,(i,e)=>(B(),W("span",{key:e,class:"grad-step",style:ie({backgroundColor:i})},null,4))),128)),E("span",Ee,G(x.displaySettings.selectedFeature),1),E("span",Ie,G(Math.round(x.displaySettings.minVal)),1),E("span",Pe,G(o.value),1),E("span",De,G(Math.round(x.displaySettings.maxVal)),1)])],4)):Se("",!0)}}),We=we(Ge,[["__scopeId","data-v-24508f6a"]]);var T={exports:{}},Be=T.exports,le;function Te(){return le||(le=1,function(v){(function(c,u,h){function o(e){var n=this,a=i();n.next=function(){var t=2091639*n.s0+n.c*23283064365386963e-26;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=t|0)},n.c=1,n.s0=a(" "),n.s1=a(" "),n.s2=a(" "),n.s0-=a(e),n.s0<0&&(n.s0+=1),n.s1-=a(e),n.s1<0&&(n.s1+=1),n.s2-=a(e),n.s2<0&&(n.s2+=1),a=null}function x(e,n){return n.c=e.c,n.s0=e.s0,n.s1=e.s1,n.s2=e.s2,n}function d(e,n){var a=new o(e),t=n&&n.state,r=a.next;return r.int32=function(){return a.next()*4294967296|0},r.double=function(){return r()+(r()*2097152|0)*11102230246251565e-32},r.quick=r,t&&(typeof t=="object"&&x(t,a),r.state=function(){return x(a,{})}),r}function i(){var e=4022871197,n=function(a){a=String(a);for(var t=0;t<a.length;t++){e+=a.charCodeAt(t);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=r*4294967296}return(e>>>0)*23283064365386963e-26};return n}u&&u.exports?u.exports=d:this.alea=d})(Be,v)}(T)),T.exports}var H={exports:{}},He=H.exports,ue;function Ue(){return ue||(ue=1,function(v){(function(c,u,h){function o(i){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},i===(i|0)?e.x=i:n+=i;for(var a=0;a<n.length+64;a++)e.x^=n.charCodeAt(a)|0,e.next()}function x(i,e){return e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w,e}function d(i,e){var n=new o(i),a=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,s=(n.next()>>>0)/4294967296,y=(r+s)/(1<<21);while(y===0);return y},t.int32=n.next,t.quick=t,a&&(typeof a=="object"&&x(a,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.xor128=d})(He,v)}(H)),H.exports}var U={exports:{}},Ze=U.exports,ce;function Je(){return ce||(ce=1,function(v){(function(c,u,h){function o(i){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^(t^t<<1))|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,i===(i|0)?e.x=i:n+=i;for(var a=0;a<n.length+64;a++)e.x^=n.charCodeAt(a)|0,a==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function x(i,e){return e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w,e.v=i.v,e.d=i.d,e}function d(i,e){var n=new o(i),a=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,s=(n.next()>>>0)/4294967296,y=(r+s)/(1<<21);while(y===0);return y},t.int32=n.next,t.quick=t,a&&(typeof a=="object"&&x(a,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.xorwow=d})(Ze,v)}(U)),U.exports}var Z={exports:{}},Ke=Z.exports,fe;function Qe(){return fe||(fe=1,function(v){(function(c,u,h){function o(i){var e=this;e.next=function(){var a=e.x,t=e.i,r,s;return r=a[t],r^=r>>>7,s=r^r<<24,r=a[t+1&7],s^=r^r>>>10,r=a[t+3&7],s^=r^r>>>3,r=a[t+4&7],s^=r^r<<7,r=a[t+7&7],r=r^r<<13,s^=r^r<<9,a[t]=s,e.i=t+1&7,s};function n(a,t){var r,s=[];if(t===(t|0))s[0]=t;else for(t=""+t,r=0;r<t.length;++r)s[r&7]=s[r&7]<<15^t.charCodeAt(r)+s[r+1&7]<<13;for(;s.length<8;)s.push(0);for(r=0;r<8&&s[r]===0;++r);for(r==8?s[7]=-1:s[r],a.x=s,a.i=0,r=256;r>0;--r)a.next()}n(e,i)}function x(i,e){return e.x=i.x.slice(),e.i=i.i,e}function d(i,e){i==null&&(i=+new Date);var n=new o(i),a=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,s=(n.next()>>>0)/4294967296,y=(r+s)/(1<<21);while(y===0);return y},t.int32=n.next,t.quick=t,a&&(a.x&&x(a,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.xorshift7=d})(Ke,v)}(Z)),Z.exports}var J={exports:{}},Ye=J.exports,ve;function Ve(){return ve||(ve=1,function(v){(function(c,u,h){function o(i){var e=this;e.next=function(){var a=e.w,t=e.X,r=e.i,s,y;return e.w=a=a+1640531527|0,y=t[r+34&127],s=t[r=r+1&127],y^=y<<13,s^=s<<17,y^=y>>>15,s^=s>>>12,y=t[r]=y^s,e.i=r,y+(a^a>>>16)|0};function n(a,t){var r,s,y,L,F,M=[],O=128;for(t===(t|0)?(s=t,t=null):(t=t+"\0",s=0,O=Math.max(O,t.length)),y=0,L=-32;L<O;++L)t&&(s^=t.charCodeAt((L+32)%t.length)),L===0&&(F=s),s^=s<<10,s^=s>>>15,s^=s<<4,s^=s>>>13,L>=0&&(F=F+1640531527|0,r=M[L&127]^=s+F,y=r==0?y+1:0);for(y>=128&&(M[(t&&t.length||0)&127]=-1),y=127,L=4*128;L>0;--L)s=M[y+34&127],r=M[y=y+1&127],s^=s<<13,r^=r<<17,s^=s>>>15,r^=r>>>12,M[y]=s^r;a.w=F,a.X=M,a.i=y}n(e,i)}function x(i,e){return e.i=i.i,e.w=i.w,e.X=i.X.slice(),e}function d(i,e){i==null&&(i=+new Date);var n=new o(i),a=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,s=(n.next()>>>0)/4294967296,y=(r+s)/(1<<21);while(y===0);return y},t.int32=n.next,t.quick=t,a&&(a.X&&x(a,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.xor4096=d})(Ye,v)}(J)),J.exports}var K={exports:{}},et=K.exports,pe;function tt(){return pe||(pe=1,function(v){(function(c,u,h){function o(i){var e=this,n="";e.next=function(){var t=e.b,r=e.c,s=e.d,y=e.a;return t=t<<25^t>>>7^r,r=r-s|0,s=s<<24^s>>>8^y,y=y-t|0,e.b=t=t<<20^t>>>12^r,e.c=r=r-s|0,e.d=s<<16^r>>>16^y,e.a=y-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,i===Math.floor(i)?(e.a=i/4294967296|0,e.b=i|0):n+=i;for(var a=0;a<n.length+20;a++)e.b^=n.charCodeAt(a)|0,e.next()}function x(i,e){return e.a=i.a,e.b=i.b,e.c=i.c,e.d=i.d,e}function d(i,e){var n=new o(i),a=e&&e.state,t=function(){return(n.next()>>>0)/4294967296};return t.double=function(){do var r=n.next()>>>11,s=(n.next()>>>0)/4294967296,y=(r+s)/(1<<21);while(y===0);return y},t.int32=n.next,t.quick=t,a&&(typeof a=="object"&&x(a,n),t.state=function(){return x(n,{})}),t}u&&u.exports?u.exports=d:this.tychei=d})(et,v)}(K)),K.exports}var Q={exports:{}},rt=Q.exports,de;function nt(){return de||(de=1,function(v){(function(c,u,h){var o=256,x=6,d=52,i="random",e=h.pow(o,x),n=h.pow(2,d),a=n*2,t=o-1,r;function s(g,w,S){var _=[];w=w==!0?{entropy:!0}:w||{};var m=M(F(w.entropy?[g,$(u)]:g??O(),3),_),k=new y(_),A=function(){for(var C=k.g(x),p=e,l=0;C<n;)C=(C+l)*o,p*=o,l=k.g(1);for(;C>=a;)C/=2,p/=2,l>>>=1;return(C+l)/p};return A.int32=function(){return k.g(4)|0},A.quick=function(){return k.g(4)/4294967296},A.double=A,M($(k.S),u),(w.pass||S||function(C,p,l,f){return f&&(f.S&&L(f,k),C.state=function(){return L(k,{})}),l?(h[i]=C,p):C})(A,m,"global"in w?w.global:this==h,w.state)}function y(g){var w,S=g.length,_=this,m=0,k=_.i=_.j=0,A=_.S=[];for(S||(g=[S++]);m<o;)A[m]=m++;for(m=0;m<o;m++)A[m]=A[k=t&k+g[m%S]+(w=A[m])],A[k]=w;(_.g=function(C){for(var p,l=0,f=_.i,b=_.j,q=_.S;C--;)p=q[f=t&f+1],l=l*o+q[t&(q[f]=q[b=t&b+p])+(q[b]=p)];return _.i=f,_.j=b,l})(o)}function L(g,w){return w.i=g.i,w.j=g.j,w.S=g.S.slice(),w}function F(g,w){var S=[],_=typeof g,m;if(w&&_=="object")for(m in g)try{S.push(F(g[m],w-1))}catch{}return S.length?S:_=="string"?g:g+"\0"}function M(g,w){for(var S=g+"",_,m=0;m<S.length;)w[t&m]=t&(_^=w[t&m]*19)+S.charCodeAt(m++);return $(w)}function O(){try{var g;return r&&(g=r.randomBytes)?g=g(o):(g=new Uint8Array(o),(c.crypto||c.msCrypto).getRandomValues(g)),$(g)}catch{var w=c.navigator,S=w&&w.plugins;return[+new Date,c,S,c.screen,$(u)]}}function $(g){return String.fromCharCode.apply(0,g)}if(M(h.random(),u),v.exports){v.exports=s;try{r=Me}catch{}}else h["seed"+i]=s})(typeof self<"u"?self:rt,[],Math)}(Q)),Q.exports}var te,ye;function at(){if(ye)return te;ye=1;var v=Te(),c=Ue(),u=Je(),h=Qe(),o=Ve(),x=tt(),d=nt();return d.alea=v,d.xor128=c,d.xorwow=u,d.xorshift7=h,d.xor4096=o,d.tychei=x,te=d,te}var ot=at();const it=ke(ot),xe=v=>v,he={selectedFeature:"",maxWidth:10,minWidth:1,numStep:100,scale:"linear",fixScale:!1,minVal:0,maxVal:1,cmap:"OrRd",opacity:100,offset:!1,showNaN:!0,reverseColor:!1,extrusion:!1,padding:[0,100],labels:""};function st(v){return/^#([0-9A-Fa-f]{3}){1,2}$/i.test(v)}function re(v,c,u,h,o,x){if(typeof v=="string")return x?0:it(v)();if(x){if(v<c?v=c:v>u&&(v=u),v=Math.abs(v),c<0&&u>0)u=Math.max(Math.abs(c),Math.abs(u)),c=0;else if(c<0&&u<=0){const i=Math.abs(u);u=Math.max(Math.abs(c),i),c=Math.min(Math.abs(c),i)}}else{if(v<c)return h?1:0;if(v>u)return h?0:1;c<0&&(v=v-c,u=u-c,c=0)}let d=v;return o==="log"?(c<1&&(u+=1,v+=1,c+=1),c=c>0?Math.log10(c):0,u=u>0?Math.log10(u):0,d=v>0?Math.log10(v):0):o==="sqrt"?(c=Math.sqrt(c),u=Math.sqrt(u),d=Math.sqrt(v)):o==="exp"?(c=c/u,v=v/u,u=1,c=10**c,u=10**u,d=10**v):o==="quad"&&(c=c**2,u=u**2,d=v**2),h?d=(-d+u)/(u-c):d=(d-c)/(u-c),d}function lt(){const v=X(z()),c=X(z()),u=X(z()),h=X("LineString"),o=X(V.cloneDeep(he)),x=X([]),d=X(""),i=X([]),e=X(!1),n=X({}),a=X({}),t=X("");function r(){v.value=z(),c.value=z(),u.value=z(),h.value="LineString",o.value=V.cloneDeep(he),x.value=[],d.value="",i.value=[],e.value=!1,n.value={},a.value={},t.value=""}function s(p,l,f=null){var q;r(),v.value=p,h.value=(q=v.value.features[0])==null?void 0:q.geometry.type,h.value=h.value==="MultiPolygon"?"Polygon":h.value,h.value!=="Polygon"&&(o.value.extrusion=!1),e.value=typeof l=="object"&&l!==null,e.value&&F(l),_(),f!=null&&f.selectedFilter&&x.value.includes(f.selectedFilter)&&(m(f.selectedFilter),f!=null&&f.selectedCategory&&(i.value=f.selectedCategory));const b=f==null?void 0:f.displaySettings;b&&y(b),w(),S(),qe(v.value)||ne().changeNotification({text:xe("invalid or missing CRS. use CRS84 / EPSG:4326"),autoClose:!0,color:"warning"})}function y(p){const l=Object.keys(p);for(const f of l)o.value[f]=p[f]}const L=I(()=>Object.keys(n.value));function F(p){Object.keys(p).forEach(l=>{n.value[`${l} (Interactive)`]=p[l]}),v.value.features.forEach(l=>l.properties.index=String(l.properties.index)),L.value.forEach(l=>{a.value[l]=Object.keys(n.value[l]),v.value.features.forEach(f=>f.properties[l]=null)})}function M(p){const l=o.value.selectedFeature;return l&&L.value.includes(l)?a.value[l].includes(p):!1}function O(p){const l=o.value.selectedFeature;if(l&&L.value.includes(l)&&e.value){t.value=p;const f=n.value[l][t.value];v.value.features.forEach(b=>b.properties[l]=f?f[b.properties.index]:null)}w(),S()}function $(){const p=o.value.selectedFeature,l=o.value.labels;c.value.features=c.value.features.map(f=>{var b;return{type:"Feature",geometry:f.geometry,properties:{[p]:f.properties[p],[l]:f.properties[l],index:(b=f.properties)==null?void 0:b.index}}})}function g(){if(o.value.showNaN)u.value=z();else{const p=o.value.selectedFeature;u.value.features=c.value.features.filter(f=>!f.properties[p]),v.value.features.filter(f=>f.properties[p]).length===0&&e.value&&Object.keys(a.value).includes(p)||(c.value.features=c.value.features.filter(f=>f.properties[p]))}}function w(){const p=new Set(i.value),l=d.value;c.value.features=v.value.features.filter(f=>p.has(f.properties[l])),$(),h.value==="Polygon"&&g()}function S(){const p=o.value.selectedFeature,l=o.value.maxWidth,f=o.value.minWidth,b=o.value.scale,q=o.value.numStep,P=o.value.cmap,R=c.value.features.filter(j=>j.properties[p]).map(j=>j.properties[p]);if(!o.value.fixScale){const[j,N]=Ce(R);o.value.minVal=Math.round(j*100)/100,o.value.maxVal=Math.round(N*100)/100}const ae=o.value.minVal,oe=o.value.maxVal,me=o.value.reverseColor;c.value.features.forEach(j=>{let N=j.properties[p];N=re(N,ae,oe,!1,b,!0),j.properties.display_width=(l-f)*N+f});let D=V.cloneDeep(o.value.padding);D=[D[0]/100,1-D[1]/100],o.value.reverseColor&&D.reverse();const be=se.scale(P).padding(D).domain([0,1],0,b).classes(q);if(c.value.features.forEach(j=>{const N=j.properties[p];st(N)?j.properties.display_color=N:j.properties.display_color=be(re(N,ae,oe,me,b,!1)).hex()}),v.value.features.filter(j=>j.properties[p]).length===0&&e.value&&Object.keys(a.value).includes(p)){const j=new Set(a.value[p]);c.value.features.forEach(Y=>{j.has(Y.properties.index)&&(Y.properties.display_width=10,Y.properties.display_color="#4CAF50")}),ne().changeNotification({text:xe("Clickable element in green"),autoClose:!0,color:"success"})}}function _(){const p=new Set([]);v.value.features.forEach(l=>{Object.keys(l.properties).forEach(f=>p.add(f))}),x.value=Array.from(p),x.value=x.value.filter(l=>!["display_width","display_color"].includes(l)),d.value=p.has("route_type")?"route_type":p.has("highway")?"highway":x.value[0],i.value=Array.from(new Set(v.value.features.map(l=>l.properties[d.value])))}function m(p){d.value=p,i.value=Array.from(new Set(v.value.features.map(l=>l.properties[d.value])))}function k(p){i.value=p}const A=I(()=>{let p=Array.from(new Set(v.value.features.map(l=>l.properties[d.value])));return p=p.sort((l,f)=>l-f),p}),C=I(()=>{const p=[];let l=o.value.padding;l=[l[0]/100,1-l[1]/100],o.value.reverseColor&&l.reverse();const f=se.scale(o.value.cmap).padding(l).domain([0,1]).classes(o.value.numStep);for(let b=0;b<100;b++)p.push(f(re(b,0,100,o.value.reverseColor,o.value.scale,!1)));return p});return{layer:v,type:h,attributes:x,visibleLayer:c,nanLayer:u,displaySettings:o,selectedFilter:d,selectedCategory:i,hasOD:e,attributesWithOD:L,matAvailableIndex:a,matSelectedIndex:t,changeOD:O,isIndexAvailable:M,loadLayer:s,getLayerProperties:_,refreshVisibleLinks:w,updateSelectedFeature:S,changeSelectedFilter:m,changeSelectedCategory:k,applySettings:y,filteredCategory:A,colorScale:C}}const ut={class:"map-legend"},ct=ge({__name:"StaticLayer",props:{preset:{},map:{},order:{},visibleLayers:{}},setup(v){const c=je(),u=v,{preset:h,map:o,order:x,visibleLayers:d}=Fe(u),i=Ae(),e=Xe(),n=Oe(),a=ne(),t=h.value.name,r=t+"-source",s=t+"-layer",y=t+"-labels",{visibleLayer:L,type:F,loadLayer:M,displaySettings:O,colorScale:$,isIndexAvailable:g,changeOD:w}=lt(),S=h.value.displaySettings.opacity,_=h.value.displaySettings.offset?-1:1,m=h.value.displaySettings.labels;async function k(l,f=null){switch(l){case"links":M(i.links,null,f);break;case"rlinks":M(e.rlinks,null,f);break;case"nodes":M(i.nodes,null,f);break;case"rnodes":M(e.rnodes,null,f);break;case"od":M(n.layer,null,f);break;default:const b=await a.getOtherFile(l,"geojson"),q=await a.getOtherFile(l,"json");M(b,q,f);break}}Ne(async()=>{var l;await k(h.value.layer,h.value),(l=h.value)!=null&&l.selectedIndex&&g(h.value.selectedIndex)&&(w(h.value.selectedIndex),a.changeNotification({text:""})),L.value.features=L.value.features.map(f=>({type:"Feature",geometry:f.geometry,properties:{display_color:f.properties.display_color,display_width:f.properties.display_width,label:f.properties[m]}})),A(),C()});function A(){o.value.addSource(r,{type:"geojson",data:L.value}),F.value==="LineString"?o.value.addLayer({id:s,type:"line",minzoom:5,source:r,layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"},paint:{"line-color":["get","display_color"],"line-opacity":S/100,"line-offset":["*",_*.5,["to-number",["get","display_width"]]],"line-width":["get","display_width"]}}):F.value==="Point"?o.value.addLayer({id:s,type:"circle",minzoom:5,source:r,layout:{"circle-sort-key":["to-number",["get","display_width"]]},paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":S/100}}):["MultiPolygon","Polygon"].includes(F.value)&&!O.value.extrusion?o.value.addLayer({id:s,type:"fill",minzoom:5,source:r,paint:{"fill-color":["get","display_color"],"fill-opacity":S/100}}):["MultiPolygon","Polygon"].includes(F.value)&&O.value.extrusion&&o.value.addLayer({id:s,type:"fill-extrusion",minzoom:5,source:r,paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":S/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}}),m!==null&&o.value.addLayer({id:y,source:r,type:"symbol",layout:{"text-field":["get","label"],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":c.current.value.colors.black}})}function C(){const l=o.value.getStyle();if(!l)return;const f=l.layers.map(R=>R.id),b=d.value.indexOf(t);let q=d.value.map(R=>R+"-layer").splice(0,b);q=q.filter(R=>f.includes(R));const P=q.slice(-1)[0];P?o.value.moveLayer(s,P):p()}function p(){o.value.getLayer("results")?o.value.moveLayer(s,"results"):o.value.getLayer("rlinks")?o.value.moveLayer(s,"rlinks"):o.value.getLayer("links")&&o.value.moveLayer(s,"links")}return $e(()=>{o.value.getLayer(y)&&o.value.removeLayer(y),o.value.getLayer(s)&&(o.value.removeLayer(s),o.value.removeSource(r))}),(l,f)=>(B(),W("section",null,[E("div",ut,[Re(We,{"color-scale":ee($),"display-settings":ee(O),order:ee(x)},null,8,["color-scale","display-settings","order"])])]))}}),ft=we(ct,[["__scopeId","data-v-273db9f6"]]),dt=Object.freeze(Object.defineProperty({__proto__:null,default:ft},Symbol.toStringTag,{value:"Module"}));export{We as M,ft as S,dt as a,lt as u};
