import{_ as xe,u as ke,t as ge,a as Pe,r as b,s as Je,c as X,w as G,o as Qe,b as Ye,d,e as M,f as x,g as o,h as s,i as l,M as Xe,j as el,k as ll,l as re,m as O,n as al,p as tl,q as sl,v as nl,x as Ue,y as ze,z as g,A as k,B as h,V as ne,C as $e,D as De,E as Ne,F as oe,G as Me,H as Q,I as Y,J as D,K as We,L as Re,N as ce,O as je,P as pe,Q as ve,R as ol,S as ul,T as il,U as be,W as rl,X as dl,Y as ae,Z as qe,$ as ue,a0 as we,a1 as me,a2 as vl,a3 as cl,a4 as pl,a5 as ml,a6 as de,a7 as ye,a8 as he,a9 as fl,aa as yl,ab as hl,ac as Se,ad as Le,ae as gl,af as _e,ag as Be,ah as Oe,ai as bl,aj as se}from"./index-_xnBJvUt.js";import{c as Te,u as xl,M as kl,S as Vl}from"./StaticLayer-Dl9vXa8H.js";import Cl from"./LayerSelector-CmM8ewz5.js";const wl={__name:"MapResults",props:["selectedFeature","layerType","extrusion","labels","links","nanLinks","opacity","offset","selectedLayer"],emits:["selectClick"],setup(I,{expose:V,emit:n}){const{$gettext:q}=ke(),U="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",u=I,{selectedFeature:$,layerType:C,extrusion:P,labels:w,links:e,nanLinks:r,opacity:_,offset:z,selectedLayer:S}=ge(u),E=n,N=Pe(),L=b(!1),p=U,a=Je(null),t=b({nodes:14,links:2}),c=X(()=>N.mapStyle);G(c,()=>{a.value&&(a.value.getLayer("arrow")&&a.value.removeLayer("arrow"),a.value.getLayer("links")&&a.value.removeLayer("links"),a.value.getLayer("zones")&&a.value.removeLayer("zones"),a.value.getLayer("nodes")&&a.value.removeLayer("nodes"),L.value=!1,R())}),Qe(()=>{var i;a.value&&R(),(i=a.value)!=null&&i.getLayer("arrow")&&a.value.removeLayer("arrow")});function R(){const i=a.value.getCenter();N.saveMapPosition({mapCenter:[i.lng,i.lat],mapZoom:a.value.getZoom()})}function A(i){a.value&&(L.value=!1),a.value=i.map,fe(),a.value.loadImage(nl,function(v,F){if(v){console.error("err image",v);return}a.value.addImage("arrow",F,{sdf:!0})}),P.value&&N.changeNotification({text:q("Right click and drag to tilt the map"),autoClose:!0,color:"success"}),L.value=!0}function fe(){const i=new Ue.LngLatBounds;["Polygon"].includes(C.value)?e.value.features.forEach(v=>{try{v.geometry.type==="Polygon"?i.extend([v.geometry.coordinates[0][0],v.geometry.coordinates[0][v.geometry.coordinates.length-1]]):i.extend([v.geometry.coordinates[0][0][0],v.geometry.coordinates[0][0][v.geometry.coordinates.length-1]])}catch{}}):e.value.features.forEach(v=>{i.extend([v.geometry.coordinates[0],v.geometry.coordinates[v.geometry.coordinates.length-1]])}),Object.keys(i).length!==0&&a.value&&a.value.fitBounds(i,{padding:100})}const{canvasDiv:H}=Ye(a),j=b([]),ee=b(null);V({update:Ve});function Ve(){var i;L.value&&(a.value.getSource("results").setData(e.value),(i=a.value.getSource("NaNresults"))==null||i.setData(r.value),w.value||a.value.getLayer("labels")&&a.value.removeLayer("labels"))}G(S,()=>fe());const le=X(()=>z.value?-1:1);function ie(i){var v;if(i.map.getCanvas().style.cursor="pointer",j.value=i.mapboxEvent.features,(v=ee.value)!=null&&v.isOpen()&&ee.value.remove(),$.value&&C.value!=="Polygon"){const F=j.value[0].properties[$.value];F&&(ee.value=new Ue.Popup({closeButton:!1}).setLngLat([i.mapboxEvent.lngLat.lng,i.mapboxEvent.lngLat.lat]).setHTML(`${$.value}: <br> ${F}`).addTo(i.map))}}function Z(i){var v;j.value=[],(v=ee.value)!=null&&v.isOpen()&&ee.value.remove(),i.map.getCanvas().style.cursor=""}function T(i){var v;j.value=i.mapboxEvent.features,((v=j.value)==null?void 0:v.length)>0&&E("selectClick",{feature:j.value[0].properties,action:"featureClick"})}function W(i){var v;j.value=i.mapboxEvent.features,((v=j.value)==null?void 0:v.length)>0&&E("selectClick",{feature:j.value[0].properties,action:"zoneClick"})}function J(i){i.map.getCanvas().style.cursor="pointer"}function K(i){i.map.getCanvas().style.cursor=""}return(i,v)=>(d(),M("div",{ref_key:"canvasDiv",ref:H,class:"map"},[(d(),x(l(sl),{key:c.value,style:{width:"100%"},"access-token":l(p),"map-style":c.value,center:l(N).mapCenter,zoom:l(N).mapZoom,onLoad:A},{default:o(()=>[s(l(Xe),{position:"bottom-right"}),s(l(el),{position:"bottom-right","visualize-pitch":!0}),ll(i.$slots,"default",{map:a.value,mapIsLoaded:L.value},void 0,!0),l(C)=="LineString"?(d(),x(l(re),{key:0,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(e),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:t.value.links,paint:{"line-color":["get","display_color"],"line-offset":["*",le.value*.5,["to-number",["get","display_width"]]],"line-opacity":l(_)/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:ie,onMouseleave:Z,onClick:W,onContextmenu:T},null,8,["source","layer"])):O("",!0),l(C)=="Point"?(d(),x(l(re),{key:1,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(e),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:t.value.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":l(_)/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:ie,onMouseleave:Z,onClick:W,onContextmenu:T},null,8,["source","layer"])):O("",!0),l(C)=="LineString"?(d(),x(l(al),{key:2,"source-id":"results",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:t.value.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[le.value*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":l(_)/100}}},null,8,["layer"])):O("",!0),l(C)==="Polygon"&&l(P)?(d(),x(l(re),{key:3,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(e),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":l(_)/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:J,onMouseleave:K,onClick:W,onContextmenu:T},null,8,["source","layer"])):O("",!0),l(C)==="Polygon"&&!l(P)?(d(),x(l(re),{key:4,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(e),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":l(_)/100}},onMouseenter:J,onMouseleave:K,onClick:W,onContextmenu:T},null,8,["source","layer"])):O("",!0),l(C)==="Polygon"&&!l(P)?(d(),x(l(re),{key:5,reactive:!1,"source-id":"NaNresults",source:{type:"geojson",data:l(r),promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:J,onMouseleave:K,onClick:W,onContextmenu:T},null,8,["source"])):O("",!0),l(w)!==null?(d(),x(l(tl),{key:6,type:"symbol","source-id":"results",source:"links","layer-id":"labels",layer:{type:"symbol",layout:{"text-field":["get",l(w)],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":i.$vuetify.theme.current.colors.black}}},null,8,["layer"])):O("",!0)]),_:3},8,["access-token","map-style","center","zoom"]))],512))}},Sl=xe(wl,[["__scopeId","data-v-965f31d9"]]),Ll={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},_l={class:"preset"},Nl={class:"title-div"},Ml={class:"custom-title"},Pl={class:"crop"},$l={class:"layer"},Dl={class:"title-div"},Il={class:"custom-title"},Fl={class:"crop"},Ul={style:{"padding-top":"0.5rem"}},zl={class:"item"},Rl={__name:"ResultsSidePanel",props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],emits:["update-selectedCategory","select-layer","select-preset","delete-preset","update-selectedFilter"],setup(I,{emit:V}){const{$gettext:n}=ke(),q=I,U=V,u=Pe(),$=X(()=>u.isMobile),C=X(()=>u.showLeftPanel),P=b(!0),w=b(500);ze(()=>{w.value=$.value?window.innerWidth-100:350}),G(C,p=>{p?setTimeout(()=>{P.value=!0},500):P.value=!1});const e=b(!1),r=b(!1),{selectedCategory:_,filteredCat:z}=ge(q),S=b([]);G(_,(p,a)=>{p!==a&&(S.value=p)}),G(S,p=>{p!==_.value&&U("update-selectedCategory",p)});function E(){S.value.length===z.value.length?S.value=[]:S.value=z.value}const{selectedFilter:N}=ge(q),L=b("");return G(N,p=>{p!==L.value&&(L.value=p)}),G(L,p=>{p!==N.value&&(U("update-selectedFilter",p),S.value=_.value)}),ze(()=>{L.value=N.value,S.value=_.value,U("update-selectedFilter",N.value),U("update-selectedCategory",_.value)}),(p,a)=>(d(),M("section",{class:dl(C.value?"left-panel elevation-4":"left-panel-close"),style:be({width:C.value?w.value+"px":"0px"})},[g("div",{class:"left-panel-toggle-btn elevation-4",onClick:a[0]||(a[0]=t=>l(u).changeLeftPanel())},[s(ne,{size:"small",color:"secondarydark"},{default:o(()=>[k(h(C.value?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),s(rl,{name:"fade"},{default:o(()=>[$e(g("div",{class:"left-panel-content",style:be({width:C.value?w.value+"px":"0px"})},[g("div",null,[g("div",Ll,[g("div",_l,[s(ne,{style:{color:"white","padding-right":"2rem","padding-left":"1rem"}},{default:o(()=>a[7]||(a[7]=[k(" fas fa-sliders-h ")])),_:1}),s(Ne,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=t=>r.value=t),"close-delay":"100",location:"bottom center",transition:"slide-y-transition"},{activator:o(({props:t})=>[g("div",oe({class:"menu-container"},t),[g("div",Nl,[g("span",Ml,h(l(n)("Presets")),1),g("span",Pl,h(I.selectedPreset),1)]),s(ne,{variant:"text",style:{color:"white"}},{default:o(()=>[k(h(r.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)]),default:o(()=>[s(Me,null,{default:o(()=>[(d(!0),M(Q,null,Y(I.presetChoices,(t,c)=>(d(),x(ce,{key:c,link:"",onClick:()=>p.$emit("select-preset",t)},{append:o(()=>[s(D,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:We(()=>p.$emit("delete-preset",t),["stop"])},null,8,["onClick"])]),default:o(()=>[s(Re,null,{default:o(()=>[k(h(t.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(je,{location:"bottom","open-delay":"300"},{activator:o(({props:t})=>[s(D,oe({variant:"text"},t,{disabled:I.presetChoices.length===0,style:{color:"white"},icon:"fas fa-download",onClick:a[2]||(a[2]=c=>l(u).exportFile("styles.json"))}),null,16,["disabled"])]),default:o(()=>[g("span",null,h(l(n)("Dowload presets")),1)]),_:1})]),g("div",$l,[s(je,{location:"bottom","open-delay":"500"},{activator:o(({props:t})=>[s(D,oe({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:S.value.length==l(z).length?"fa-eye-slash fa":"fa-eye fa",variant:"text"},t,{onClick:a[3]||(a[3]=c=>E())}),null,16,["icon"])]),default:o(()=>[g("span",null,h(S.value.length==l(z).length?l(n)("Hide All"):l(n)("Show All")),1)]),_:1}),s(Ne,{modelValue:e.value,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value=t),"close-delay":"100",transition:"slide-y-transition"},{activator:o(({props:t})=>[g("div",oe({class:"title-div"},t),[g("div",oe({class:"menu-container"},t),[g("div",Dl,[g("span",Il,h(l(n)("Layer")),1),g("span",Fl,h(I.selectedLayer),1)]),s(ne,{variant:"text",style:{color:"white"}},{default:o(()=>[k(h(e.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)],16)]),default:o(()=>[s(Me,null,{default:o(()=>[(d(!0),M(Q,null,Y(I.layerChoices,(t,c)=>(d(),x(ce,{key:c,link:"",onClick:()=>p.$emit("select-layer",t)},{default:o(()=>[s(Re,null,{default:o(()=>[k(h(t),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(ne)]),s(pe,{"max-width":"100%","min-width":"100%",height:"calc(100vh - 250px)",class:"mx-auto scrollable"},{default:o(()=>[s(ce,null,{default:o(()=>[g("div",Ul,[s(ve,{modelValue:L.value,"onUpdate:modelValue":a[5]||(a[5]=t=>L.value=t),items:I.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:l(n)("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),s(ol,{items:l(z),"item-height":45,height:"calc(100vh - 330px)"},{default:o(({item:t})=>[(d(),M("div",{key:L.value.concat(t),class:"container"},[s(ul,null,{default:o(()=>[s(il,{modelValue:S.value,"onUpdate:modelValue":a[6]||(a[6]=c=>S.value=c),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:t},null,8,["modelValue","value"])]),_:2},1024),g("div",zl,h(t),1)]))]),_:1},8,["items"])]),_:1})])])],4),[[De,P.value]])]),_:1})],6))}},jl=xe(Rl,[["__scopeId","data-v-26cce869"]]),Bl={class:"setting"},Ol={class:"gradient-preview"},Tl={class:"preview-title"},Wl={class:"gradient"},ql={class:"domain-title"},El={__name:"ResultsSettings",props:["displaySettings","featureChoices","type"],emits:["submit","save-preset"],setup(I,{emit:V}){const{$gettext:n}=ke(),q=I,U=V,{displaySettings:u,featureChoices:$,type:C}=ge(q),P=X(()=>{const p=["OrRd","Spectral","RdYlGn","Viridis","YlGn","RdYlBu"],a=Object.keys(Te.brewer).slice(0,36).filter(t=>!p.includes(t));return[...p,...a]}),w=b(!1),e=b([{name:n("selectedFeature"),type:"String",value:u.value.selectedFeature,units:"",hint:n("selectedFeature")},{name:n("minWidth"),type:"Number",value:u.value.minWidth,units:"a.u.",hint:n("minWidth")},{name:n("maxWidth"),type:"Number",value:u.value.maxWidth,units:"a.u.",hint:n("maxWidth")},{name:n("numStep"),type:"Number",value:u.value.numStep,units:"int",hint:n("numStep")},{name:n("opacity"),type:"Number",value:u.value.opacity,units:"number",hint:n("opacity")},{name:n("scale"),type:"String",value:u.value.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:n("scale")},{name:n("color map"),type:"String",choices:P,value:u.value.cmap,units:"",hint:n("cmap to use")},{name:n("show NaN"),value:u.value.showNaN,hint:n("Hide NaN on map and color map")},{name:n("reverse color"),value:u.value.reverseColor,hint:n("reverse color scale")},{name:n("scale min"),type:"Number",value:u.value.minVal,units:"a.u.",hint:n("mininum value on the color Map")},{name:n("scale max"),type:"Number",value:u.value.maxVal,units:"a.u.",hint:n("maximum value on the color Map")},{name:n("custom scale"),value:u.value.fixScale,hint:n("customize to inputs values")},{name:n("Left side driving"),value:u.value.offset,hint:n("Select which side of the road the links are display")},{name:n("3D"),value:u.value.extrusion,hint:n("display zones as 3D extrusion")},{name:n("padding"),type:"Number",value:u.value.padding,units:"number",hint:n("range of colors")},{name:n("labels"),type:"String",value:u.value.labels,hint:n("show labels")}]),r=b(!1),_=b(!1);b(!1),G(w,()=>{E(),_.value=e.value[11].value}),G($,()=>E());function z(){e.value[11].value?(_.value=!0,e.value[9].value=u.value.minVal,e.value[10].value=u.value.maxVal):_.value=!1}function S(p){const a=[],t=e.value[8].value;let c=e.value[14].value;c=[c[0]/100,1-c[1]/100],c=t?c.reverse():c;const R=Te.scale(p).padding(c).domain([0,100]).classes(25);for(let A=0;A<100;A++)a.push(R(A).hex());return t?a.reverse():a}function E(){e.value[0].value=u.value.selectedFeature,e.value[1].value=u.value.minWidth,e.value[2].value=u.value.maxWidth,e.value[3].value=u.value.numStep,e.value[4].value=u.value.opacity,e.value[5].value=u.value.scale,e.value[6].value=u.value.cmap,e.value[7].value=u.value.showNaN,e.value[8].value=u.value.reverseColor,e.value[9].value=u.value.minVal,e.value[10].value=u.value.maxVal,e.value[11].value=u.value.fixScale,e.value[12].value=u.value.offset,e.value[13].value=u.value.extrusion,e.value[14].value=u.value.padding,e.value[15].value=u.value.labels}function N(p){{const a={selectedFeature:e.value[0].value,minWidth:Number(e.value[1].value),maxWidth:Number(e.value[2].value),numStep:Number(e.value[3].value),opacity:Number(e.value[4].value),scale:e.value[5].value,cmap:e.value[6].value,showNaN:e.value[7].value,reverseColor:e.value[8].value,minVal:Number(e.value[9].value),maxVal:Number(e.value[10].value),fixScale:e.value[11].value,offset:e.value[12].value,extrusion:e.value[13].value,padding:e.value[14].value,labels:e.value[15].value};p==="apply"?U("submit",a):p==="save"&&U("save-preset",a)}}function L(){w.value=!1}return(p,a)=>(d(),x(Ne,{modelValue:w.value,"onUpdate:modelValue":a[17]||(a[17]=t=>w.value=t),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:o(({props:t})=>[g("div",Bl,[s(D,oe({color:l(u).selectedFeature===null?"error":"white"},t,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:o(()=>[s(pe,{width:"20rem",class:"setting-card","max-height":"calc(100vh - 100px)",onKeydown:[a[16]||(a[16]=ae(t=>N("apply"),["enter"])),ae(L,["esc"])]},{default:o(()=>[s(ce,{class:"subtitle"},{append:o(()=>[s(D,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:a[0]||(a[0]=t=>r.value=!r.value)})]),default:o(()=>[k(h(l(n)("Settings"))+" ",1)]),_:1}),s(qe,{ref:"form","validate-on":"lazy"},{default:o(()=>[s(ue,null,{default:o(()=>[s(ve,{modelValue:e.value[0].value,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value[0].value=t),variant:"underlined",items:l($).sort(),label:l(n)(e.value[0].name),hint:r.value?l(n)(e.value[0].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),s(we,null,{default:o(()=>[(d(!0),M(Q,null,Y(e.value.slice(1,3),t=>(d(),x(ue,{key:t.name},{default:o(()=>[s(me,{modelValue:t.value,"onUpdate:modelValue":c=>t.value=c,variant:"underlined",density:"compact",type:t.type,label:l(n)(t.name),suffix:t.units,hint:r.value?l(n)(t.hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),s(we,null,{default:o(()=>[s(ue,null,{default:o(()=>[s(me,{modelValue:e.value[3].value,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value[3].value=t),variant:"underlined",density:"compact",type:e.value[3].type,label:l(n)(e.value[3].name),suffix:e.value[3].units,hint:r.value?l(n)(e.value[3].hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),s(ue,null,{default:o(()=>[s(ve,{modelValue:e.value[5].value,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value[5].value=t),density:"compact",variant:"underlined",items:e.value[5].choices,label:l(n)(e.value[5].name),hint:r.value?l(n)(e.value[5].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),s(ve,{modelValue:e.value[6].value,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value[6].value=t),density:"compact",items:e.value[6].choices,label:l(n)(e.value[6].name),hint:r.value?l(n)(e.value[6].hint):"","persistent-hint":r.value,required:"",variant:"solo"},{selection:o(({item:t})=>[g("div",Ol,[(d(!0),M(Q,null,Y(S(t.value),(c,R)=>(d(),M("span",{key:R,class:"grad-step-small",style:be({backgroundColor:c})},null,4))),128)),g("span",Tl,h(t.value),1)])]),item:o(({props:t,item:c})=>[s(ce,vl(cl(t)),{title:o(()=>[g("div",Wl,[(d(!0),M(Q,null,Y(S(c.value),(R,A)=>(d(),M("span",{key:A,class:"grad-step",style:be({backgroundColor:R})},null,4))),128)),g("span",ql,h(c.value),1)])]),_:2},1040)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),s(pl,{modelValue:e.value[14].value,"onUpdate:modelValue":a[5]||(a[5]=t=>e.value[14].value=t),step:"5",density:"compact",color:"primary",label:l(n)(e.value[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),s(ml,{modelValue:e.value[4].value,"onUpdate:modelValue":a[6]||(a[6]=t=>e.value[4].value=t),class:"align-center",color:"primary",label:l(n)(e.value[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":o(({modelValue:t})=>[k(h(Math.floor(t)+"%"),1)]),_:1},8,["modelValue","label"]),s(ve,{modelValue:e.value[15].value,"onUpdate:modelValue":a[7]||(a[7]=t=>e.value[15].value=t),variant:"underlined",items:[null,...l($).sort()],label:l(n)(e.value[15].name),hint:r.value?l(n)(e.value[15].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),(d(),x(de,{key:e.value[12].name,modelValue:e.value[12].value,"onUpdate:modelValue":a[8]||(a[8]=t=>e.value[12].value=t),density:"compact",color:"primary","hide-details":!r.value,label:l(n)(e.value[12].name),hint:r.value?l(n)(e.value[12].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(d(),x(de,{key:e.value[7].name,modelValue:e.value[7].value,"onUpdate:modelValue":a[9]||(a[9]=t=>e.value[7].value=t),density:"compact",color:"primary","hide-details":!r.value,label:l(n)(e.value[7].name),hint:r.value?l(n)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(d(),x(de,{key:e.value[8].name,modelValue:e.value[8].value,"onUpdate:modelValue":a[10]||(a[10]=t=>e.value[8].value=t),density:"compact",color:"primary","hide-details":!r.value,label:l(n)(e.value[8].name),hint:r.value?l(n)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(l(C))?(d(),x(de,{key:e.value[13].name,modelValue:e.value[13].value,"onUpdate:modelValue":a[11]||(a[11]=t=>e.value[13].value=t),density:"compact",color:"primary","hide-details":!r.value,label:l(n)(e.value[13].name),disabled:!["Polygon","extrusion"].includes(l(C)),hint:r.value?l(n)(e.value[13].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","disabled","hint","persistent-hint"])):O("",!0),(d(),x(de,{key:e.value[11].name,modelValue:e.value[11].value,"onUpdate:modelValue":[a[12]||(a[12]=t=>e.value[11].value=t),a[13]||(a[13]=t=>z(e.value[11].name))],density:"compact",variant:"underlined",color:"primary","hide-details":!r.value,label:l(n)(e.value[11].name),hint:r.value?l(n)(e.value[11].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),s(we,null,{default:o(()=>[(d(!0),M(Q,null,Y(e.value.slice(9,11),t=>(d(),x(ue,{key:t.name},{default:o(()=>[$e(s(me,{modelValue:t.value,"onUpdate:modelValue":c=>t.value=c,variant:"underlined",type:t.type,label:l(n)(t.name),suffix:t.units,hint:r.value?l(n)(t.hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"]),[[De,_.value]])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},512),s(ye,null,{default:o(()=>[s(D,{color:"grey",variant:"text",onClick:L},{default:o(()=>[k(h(l(n)("Cancel")),1)]),_:1}),s(D,{color:"green-darken-1",variant:"text",onClick:a[14]||(a[14]=t=>N("apply"))},{default:o(()=>[k(h(l(n)("Apply")),1)]),_:1}),s(he),s(D,{color:"grey",variant:"text",onClick:a[15]||(a[15]=t=>N("save"))},{default:o(()=>[s(ne,{size:"small",start:""},{default:o(()=>a[18]||(a[18]=[k(" fas fa-sliders-h ")])),_:1}),k(" "+h(l(n)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Al=xe(El,[["__scopeId","data-v-395d41c8"]]),Hl={class:"map-view"},Zl={class:"legend"},Kl={style:{display:"flex"}},Gl={__name:"ResultMap",setup(I){const{$gettext:V}=ke(),n=fl(),q=yl(),U=hl(),u=Pe(),{visibleLayer:$,NaNLayer:C,type:P,loadLayer:w,displaySettings:e,hasOD:r,ODfeatures:_,matSelectedIndex:z,changeOD:S,isIndexAvailable:E,selectedCategory:N,selectedFilter:L,attributes:p,applySettings:a,changeSelectedFilter:t,filteredCategory:c,updateSelectedFeature:R,changeSelectedCategory:A,colorScale:fe}=xl(),H=b();function j(f){a(f),Le(()=>H.value.update())}function ee(f){t(f),R(),Le(()=>H.value.update())}function Ve(f){A(f),R(),Le(()=>H.value.update())}const le=b("");async function ie(f,m=null){switch(f){case"links":await w(n.links,null,m);break;case"rlinks":await w(q.rlinks,null,m);break;case"nodes":await w(n.nodes,null,m);break;case"rnodes":await w(q.rnodes,null,m);break;case"od":await w(U.layer,null,m);break;default:const y=await u.getOtherFile(f,"geojson"),B=await u.getOtherFile(f,"json");await w(y,B,m);break}le.value=f,H.value.update()}const Z=b(null),T=X(()=>u.availableLayers),W=X(()=>u.visibleRasters),J=X(()=>u.styles),K=b(""),i=b(!1),v=b(!1),F=b(""),Ce=b({});async function Ee(f){Z.value=f.name,T.value.includes(f.layer)?await ie(f.layer,f):u.changeNotification({text:V("Preset Layer does not exist"),autoClose:!0,color:"error"}),Object.keys(f).includes("selectedIndex")&&E(f.selectedIndex)&&(S(f.selectedIndex),u.changeNotification({})),H.value.update()}function Ae(f){K.value=f.name,i.value=!0}function He(f){Ce.value=f,F.value=Z.value,v.value=!0}async function Ze(f){if((await f).valid){v.value=!1;const y={name:se.cloneDeep(F.value),layer:se.cloneDeep(le.value),displaySettings:se.cloneDeep(Ce.value),selectedFilter:se.cloneDeep(L.value)};N.value.filter(Ge=>c.value.includes(Ge)).length<c.value.length&&(y.selectedCategory=se.cloneDeep(N.value)),_.value.includes(Ce.value.selectedFeature)&&r.value&&(y.selectedIndex=z.value),u.addStyle(y),W.value.includes(F.value)?u.changeNotification({text:V("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):u.changeNotification({text:V("Preset Saved"),autoClose:!0,color:"success"}),Z.value=se.cloneDeep(F.value)}}function Ie(){u.deleteStyle(K.value),i.value=!1,K.value===Z.value&&(Z.value=null),u.changeNotification({text:V("Preset deleted"),autoClose:!0,color:"success"}),K.value=""}const te=b(!1),Fe=b([]);function Ke(f){f.action==="featureClick"?(Fe.value=f.feature,te.value=!0):(S(f.feature.index),H.value.update())}return(f,m)=>(d(),M("section",Hl,[s(jl,{"selected-category":l(N),"selected-filter":l(L),"layer-choices":T.value,"selected-layer":le.value,"filter-choices":l(p),"filtered-cat":l(c),"preset-choices":J.value,"selected-preset":Z.value,onUpdateSelectedCategory:Ve,onUpdateSelectedFilter:ee,onSelectLayer:ie,onSelectPreset:Ee,onDeletePreset:Ae},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset"]),l($).features?(d(),x(Sl,{ref_key:"mapRef",ref:H,key:l(P)+String(l(e).extrusion),"selected-layer":le.value,"layer-type":l(P),extrusion:l(e).extrusion,labels:l(e).labels,links:l($),"nan-links":l(C),"selected-feature":l(e).selectedFeature,opacity:l(e).opacity,offset:l(e).offset,onSelectClick:Ke},{default:o(y=>[g("div",Zl,[$e(s(kl,{key:"result",order:0,"color-scale":l(fe),"display-settings":l(e)},null,8,["color-scale","display-settings"]),[[De,l($).features.length>0]])]),g("div",Kl,[s(Al,{"display-settings":l(e),"feature-choices":l(p),type:l(P),onSubmit:j,onSavePreset:He},null,8,["display-settings","feature-choices","type"]),s(gl),J.value.length>0?(d(),x(Cl,{key:0,choices:J.value,map:y.map,"available-layers":T.value},null,8,["choices","map","available-layers"])):O("",!0)]),(d(!0),M(Q,null,Y(J.value,B=>(d(),M("div",{key:B.name},[W.value.includes(B.name)&&T.value.includes(B.layer)?(d(),x(Vl,{key:0,preset:B,map:y.map,order:W.value.indexOf(B.name)+1,"visible-rasters":W.value},null,8,["preset","map","order","visible-rasters"])):O("",!0)]))),128))]),_:1},8,["selected-layer","layer-type","extrusion","labels","links","nan-links","selected-feature","opacity","offset"])):O("",!0),s(Se,{modelValue:te.value,"onUpdate:modelValue":m[1]||(m[1]=y=>te.value=y),scrollable:"",persistent:"","max-width":"300",onKeydown:[m[2]||(m[2]=ae(y=>te.value=!1,["enter"])),m[3]||(m[3]=ae(y=>te.value=!1,["esc"]))]},{default:o(()=>[s(pe,{"max-height":"60rem"},{default:o(()=>[s(_e,{class:"text-h5"},{default:o(()=>[k(h(l(V)("link Properties")),1)]),_:1}),s(Be),s(Oe,null,{default:o(()=>[s(Me,null,{default:o(()=>[(d(!0),M(Q,null,Y(Fe.value,(y,B)=>(d(),x(me,{key:B,"model-value":y,label:B,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),s(Be),s(ye,null,{default:o(()=>[s(he),s(D,{color:"success",variant:"text",onClick:m[0]||(m[0]=y=>te.value=!1)},{default:o(()=>[k(h(l(V)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Se,{modelValue:v.value,"onUpdate:modelValue":m[6]||(m[6]=y=>v.value=y),persistent:"","max-width":"400",onKeydown:m[7]||(m[7]=ae(y=>v.value=!1,["esc"]))},{default:o(()=>[s(pe,null,{default:o(()=>[s(_e,{class:"text-h5"},{default:o(()=>[k(h(l(V)("Create or modify preset")),1)]),_:1}),s(qe,{"validate-on":"submit lazy",onSubmit:We(Ze,["prevent"])},{default:o(()=>[s(Oe,null,{default:o(()=>[s(bl,null,{default:o(()=>[s(ue,{cols:"12"},{default:o(()=>[s(me,{modelValue:F.value,"onUpdate:modelValue":m[4]||(m[4]=y=>F.value=y),autofocus:"",rules:[y=>!!y||"Required."],label:l(V)("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),s(ye,null,{default:o(()=>[s(he),s(D,{color:"grey",variant:"text",onClick:m[5]||(m[5]=y=>v.value=!1)},{default:o(()=>[k(h(l(V)("Cancel")),1)]),_:1}),s(D,{color:"green-darken-1",variant:"text",type:"submit"},{default:o(()=>[k(h(l(V)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Se,{modelValue:i.value,"onUpdate:modelValue":m[9]||(m[9]=y=>i.value=y),persistent:"","max-width":"400",onKeydown:[m[10]||(m[10]=ae(y=>i.value=!1,["esc"])),ae(Ie,["enter"])]},{default:o(()=>[s(pe,null,{default:o(()=>[s(_e,{class:"text-h5"},{default:o(()=>[k(h(l(V)("Delete")+" "+K.value+" ?"),1)]),_:1}),s(ye,null,{default:o(()=>[s(he),s(D,{color:"grey",variant:"text",onClick:m[8]||(m[8]=y=>i.value=!1)},{default:o(()=>[k(h(l(V)("Cancel")),1)]),_:1}),s(D,{color:"error",variant:"text",onClick:Ie},{default:o(()=>[k(h(l(V)("delete")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Xl=xe(Gl,[["__scopeId","data-v-490a5200"]]);export{Xl as default};
