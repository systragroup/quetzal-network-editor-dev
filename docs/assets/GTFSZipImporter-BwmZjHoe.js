import{_ as Z,h as T,g as S,i as o,j as s,bZ as q,a3 as J,O as X,F as ee,an as te,u as ae,b3 as se,ab as ne,a as le,r as b,c as g,o as oe,f as I,A as l,ag as P,B as m,C as n,m as r,az as z,a9 as A,L as k,H as re,I as ie,b_ as ue,V as de,Q as $,aa as ce,$ as E,aj as pe,aL as N,b$ as me,ao as fe}from"./index-BJx_ZQix.js";import{W as _e}from"./Warning-DhCwEIE9.js";import{T as ge}from"./TimeSeriesSelector-D8kzB_Ej.js";import"./form-B2uRhppC.js";const ve={name:"DatePicker",components:{},props:["date","from","to"],events:["update:date"],data(){return{isoDate:null,dateMax:null,dateMin:null,menu:!1}},computed:{textDate(){return this.isoDate?this.isoDate.toISOString().substring(0,10):""}},watch:{isoDate(u){this.$emit("update:date",this.parseOutput(u))}},mounted(){this.isoDate=this.parseInput(String(this.date)),this.dateMin=this.parseInput(String(this.from)),this.dateMax=this.parseInput(String(this.to))},methods:{parseInput(u){if(u)return new Date(u.substring(0,4)+"-"+u.substring(4,6)+"-"+u.substring(6,8))},parseOutput(u){return u.toISOString().substring(0,10).replaceAll("-","")}}};function he(u,a,d,y,i,p){return S(),T(ee,{modelValue:i.menu,"onUpdate:modelValue":a[1]||(a[1]=v=>i.menu=v),"close-on-content-click":!1,transition:"scale-transition","max-width":"290px","min-width":"auto"},{activator:o(({props:v})=>[s(J,X({"model-value":p.textDate,"persistent-hint":"",readonly:"",variant:"underlined"},v),null,16,["model-value"])]),default:o(()=>[s(q,{modelValue:i.isoDate,"onUpdate:modelValue":a[0]||(a[0]=v=>i.isoDate=v),max:i.dateMax,min:i.dateMin},null,8,["modelValue","max","min"])]),_:1},8,["modelValue"])}const Se=Z(ve,[["render",he],["__scopeId","data-v-1eb87a33"]]),Ve={class:"background"},De={class:"list"},xe={class:"list-row bold"},be={class:"list-item-large"},ke={class:"list-item-medium"},ye={class:"list-item-medium"},we={class:"list-item-medium"},Ie={class:"list-item-small"},Te={class:"list-item-small"},Fe={class:"list-item-large"},Ce={class:"list-item-medium"},Ge={class:"list-item-medium"},Ue={class:"list-item-medium"},Me={class:"list-item-small"},Be={class:"bottom-button"},Le=te({__name:"GTFSZipImporter",setup(u){const{$gettext:a}=ae(),d=se(),y=ne(),i=le(),p=b(!1),v=g(()=>y.linksIsEmpty),h=g(()=>d.uploadedGTFS),x=g(()=>d.running),R=g(()=>d.callID),W=g(()=>d.error),j=g(()=>d.errorMessage),F=g(()=>h.value.filter(c=>c.progress<100).length>0),C=g(()=>d.parameters),w=b(C.value.timeseries);function G(){const c=h.value.map(e=>e.name),t=h.value.map(e=>e.date);d.saveParams({files:c,timeseries:N(w.value),dates:t})}oe(()=>{G()});const U=b();function K(){U.value.click();const c=document.getElementById("zip-input");c&&(c.value="")}async function H(c){try{i.changeLoading(!0);const e=c.target.files;if(!(e!=null&&e.length)){i.changeLoading(!1);return}for(const f of Array.from(e)){const _=await me(f),O=_.reduce((V,D)=>D.start_date<V?D.start_date:V,_[0].start_date),Q=_.reduce((V,D)=>D.end_date>V?D.end_date:V,_[0].end_date),Y={content:f,info:{name:f.name,minDate:O,maxDate:Q,date:O,progress:0}};await d.addGTFS(Y)}i.changeLoading(!1)}catch(t){i.changeLoading(!1),i.changeAlert(t)}}const M=b();async function B(){var t;if(await M.value.validate())if(v.value){G();const e=N(C.value),f=fe(),_={scenario_path_S3:R.value,launcher_arg:{training_folder:"/tmp",params:e},metadata:{user_email:(t=f.cognitoInfo)==null?void 0:t.email}};d.start(_)}else p.value=!0}function L(){y.$reset(),p.value=!1,B()}return(c,t)=>(S(),I("div",Ve,[l("input",{id:"zip-input",ref_key:"zipInput",ref:U,type:"file",style:{display:"none"},accept:".zip",multiple:"",onChange:H},null,544),s($,{class:"card"},{default:o(()=>[s(P,{class:"subtitle"},{default:o(()=>[m(n(r(a)("GTFS importer")),1)]),_:1}),s(z,null,{default:o(()=>[m(n(r(a)("import GTFS from local computer")),1)]),_:1}),s(z,null,{default:o(()=>[m(n(r(a)("Add GTFS files. When its done uploading press Convert")),1)]),_:1}),s(A,null,{default:o(()=>[s(k,{variant:"elevated",disabled:x.value,"prepend-icon":"fa-solid fa-file-archive",onClick:K},{default:o(()=>[m(n(r(a)("upload GTFS")),1)]),_:1},8,["disabled"])]),_:1}),s(_e,{show:W.value,messages:j.value},null,8,["show","messages"]),s(ge,{ref_key:"formRef",ref:M,modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=e=>w.value=e)},null,8,["modelValue"]),l("div",De,[l("li",xe,[t[4]||(t[4]=l("span",{class:"list-item-small"},null,-1)),l("span",be,n(r(a)("name")),1),l("span",ke,n(r(a)("from")),1),l("span",ye,n(r(a)("to")),1),l("span",we,n(r(a)("selected date")),1),l("span",Ie,n(r(a)("Uploaded")),1)]),(S(!0),I(re,null,ie(h.value,(e,f)=>(S(),I("ul",{key:f,class:"list-row"},[l("span",Te,n(f),1),l("span",Fe,n(e.name),1),l("span",Ce,n(e.minDate),1),l("span",Ge,n(e.maxDate),1),l("span",Ue,[s(Se,{date:e.date,from:e.minDate,to:e.maxDate,"onUpdate:date":_=>e.date=_},null,8,["date","from","to","onUpdate:date"])]),l("span",Me,[e.progress<100?(S(),T(ue,{key:0,indeterminate:e.progress===0,absolute:"",color:"primary","model-value":e.progress},null,8,["indeterminate","model-value"])):(S(),T(de,{key:1},{default:o(()=>[...t[5]||(t[5]=[m("fas fa-check",-1)])]),_:1}))])]))),128))]),l("div",Be,[s(k,{loading:x.value,disabled:x.value||h.value.length==0||F.value,color:x.value||h.value.length==0||F.value?"regular":"success","prepend-icon":"fa-solid fa-play",onClick:B},{default:o(()=>[m(n(r(a)("convert")),1)]),_:1},8,["loading","disabled","color"])])]),_:1}),s(pe,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),persistent:"","max-width":"500",onKeydown:[E(L,["enter"]),t[3]||(t[3]=E(e=>p.value=!1,["esc"]))]},{default:o(()=>[s($,null,{default:o(()=>[s(P,{class:"text-h5"},{default:o(()=>[m(n(r(a)("Overwrite current PT network ?")),1)]),_:1}),s(A,null,{default:o(()=>[s(ce),s(k,{color:"regular",onClick:t[1]||(t[1]=e=>p.value=!p.value)},{default:o(()=>[m(n(r(a)("No")),1)]),_:1}),s(k,{color:"primary",onClick:L},{default:o(()=>[m(n(r(a)("Yes")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}}),$e=Z(Le,[["__scopeId","data-v-0855f022"]]);export{$e as default};
