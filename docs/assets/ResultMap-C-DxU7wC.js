import{u as be,t as ge,a as Pe,r as b,s as Je,c as Q,w as H,o as Qe,b as v,d as x,e as o,f as s,g as l,M as Ye,h as Xe,i as el,j as ie,k as T,l as ll,m as al,n as tl,p as sl,q as Ue,_ as Me,v as ze,x as $,y as g,z as V,A as h,V as se,B as $e,C as Fe,D as Le,E as ne,F as _e,G,H as J,I as D,J as We,K as Re,L as ve,N as je,O as ce,P as de,Q as nl,R as ol,S as ul,T as il,U as rl,W as Ne,X as ee,Y as qe,Z as oe,$ as Ve,a0 as me,a1 as dl,a2 as vl,a3 as cl,a4 as ml,a5 as re,a6 as ye,a7 as he,a8 as pl,a9 as fl,aa as yl,ab as Ce,ac as we,ad as hl,ae as Se,af as Oe,ag as Be,ah as gl,ai as te}from"./index-BR7Alesv.js";import{c as Te,u as bl,M as xl,S as kl}from"./StaticLayer-CiJqQqmi.js";import Vl from"./LayerSelector-DaW354S1.js";const Cl={__name:"MapResults",props:["selectedFeature","layerType","extrusion","labels","links","nanLinks","opacity","offset","selectedLayer"],emits:["selectClick"],setup(I,{expose:k,emit:n}){const{$gettext:E}=be(),R="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",u=I,{selectedFeature:F,layerType:S,extrusion:M,labels:L,links:e,nanLinks:r,opacity:_,offset:j,selectedLayer:C}=ge(u),A=n,N=Pe(),w=b(!1),m=R,t=Je(null),a=b({nodes:14,links:2}),p=Q(()=>N.mapStyle);H(p,()=>{t.value&&(t.value.getLayer("arrow")&&t.value.removeLayer("arrow"),t.value.getLayer("links")&&t.value.removeLayer("links"),t.value.getLayer("zones")&&t.value.removeLayer("zones"),t.value.getLayer("nodes")&&t.value.removeLayer("nodes"),w.value=!1,O())}),Qe(()=>{var i;t.value&&O(),(i=t.value)!=null&&i.getLayer("arrow")&&t.value.removeLayer("arrow")});function O(){const i=t.value.getCenter();N.saveMapPosition({mapCenter:[i.lng,i.lat],mapZoom:t.value.getZoom()})}function W(i){t.value&&(w.value=!1),t.value=i.map,pe(),t.value.loadImage(sl,function(c,z){if(c){console.error("err image",c);return}t.value.addImage("arrow",z,{sdf:!0})}),M.value&&N.changeNotification({text:E("Right click and drag to tilt the map"),autoClose:!0,color:"success"}),w.value=!0}function pe(){const i=new Ue.LngLatBounds;["Polygon"].includes(S.value)?e.value.features.forEach(c=>{try{c.geometry.type==="Polygon"?i.extend([c.geometry.coordinates[0][0],c.geometry.coordinates[0][c.geometry.coordinates.length-1]]):i.extend([c.geometry.coordinates[0][0][0],c.geometry.coordinates[0][0][c.geometry.coordinates.length-1]])}catch{}}):e.value.features.forEach(c=>{i.extend([c.geometry.coordinates[0],c.geometry.coordinates[c.geometry.coordinates.length-1]])}),Object.keys(i).length!==0&&t.value.fitBounds(i,{padding:100})}const P=b([]),Y=b(null);k({update:xe});function xe(){var i;w.value&&(t.value.getSource("results").setData(e.value),(i=t.value.getSource("NaNresults"))==null||i.setData(r.value),L.value||t.value.getLayer("labels")&&t.value.removeLayer("labels"))}H(C,()=>pe());const fe=Q(()=>j.value?-1:1);function X(i){var c;if(i.map.getCanvas().style.cursor="pointer",P.value=i.mapboxEvent.features,(c=Y.value)!=null&&c.isOpen()&&Y.value.remove(),F.value&&S.value!=="Polygon"){const z=P.value[0].properties[F.value];z&&(Y.value=new Ue.Popup({closeButton:!1}).setLngLat([i.mapboxEvent.lngLat.lng,i.mapboxEvent.lngLat.lat]).setHTML(`${F.value}: <br> ${z}`).addTo(i.map))}}function ue(i){var c;P.value=[],(c=Y.value)!=null&&c.isOpen()&&Y.value.remove(),i.map.getCanvas().style.cursor=""}function U(i){var c;P.value=i.mapboxEvent.features,((c=P.value)==null?void 0:c.length)>0&&A("selectClick",{feature:P.value[0].properties,action:"featureClick"})}function q(i){var c;P.value=i.mapboxEvent.features,((c=P.value)==null?void 0:c.length)>0&&A("selectClick",{feature:P.value[0].properties,action:"zoneClick"})}function Z(i){i.map.getCanvas().style.cursor="pointer"}function K(i){i.map.getCanvas().style.cursor=""}return(i,c)=>(v(),x(l(tl),{key:p.value,style:{width:"100%"},"access-token":l(m),"map-style":p.value,center:l(N).mapCenter,zoom:l(N).mapZoom,onLoad:W},{default:o(()=>[s(l(Ye),{position:"bottom-right"}),s(l(Xe),{position:"bottom-right","visualize-pitch":!0}),el(i.$slots,"default",{map:t.value,mapIsLoaded:w.value}),l(S)=="LineString"?(v(),x(l(ie),{key:0,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(e),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:a.value.links,paint:{"line-color":["get","display_color"],"line-offset":["*",fe.value*.5,["to-number",["get","display_width"]]],"line-opacity":l(_)/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:X,onMouseleave:ue,onClick:q,onContextmenu:U},null,8,["source","layer"])):T("",!0),l(S)=="Point"?(v(),x(l(ie),{key:1,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(e),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:a.value.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":l(_)/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:X,onMouseleave:ue,onClick:q,onContextmenu:U},null,8,["source","layer"])):T("",!0),l(S)=="LineString"?(v(),x(l(ll),{key:2,"source-id":"results",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:a.value.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[fe.value*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":l(_)/100}}},null,8,["layer"])):T("",!0),l(S)==="Polygon"&&l(M)?(v(),x(l(ie),{key:3,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(e),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":l(_)/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:Z,onMouseleave:K,onClick:q,onContextmenu:U},null,8,["source","layer"])):T("",!0),l(S)==="Polygon"&&!l(M)?(v(),x(l(ie),{key:4,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(e),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":l(_)/100}},onMouseenter:Z,onMouseleave:K,onClick:q,onContextmenu:U},null,8,["source","layer"])):T("",!0),l(S)==="Polygon"&&!l(M)?(v(),x(l(ie),{key:5,reactive:!1,"source-id":"NaNresults",source:{type:"geojson",data:l(r),promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:Z,onMouseleave:K,onClick:q,onContextmenu:U},null,8,["source"])):T("",!0),l(L)!==null?(v(),x(l(al),{key:6,type:"symbol","source-id":"results",source:"links","layer-id":"labels",layer:{type:"symbol",layout:{"text-field":["get",l(L)],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":i.$vuetify.theme.current.colors.black}}},null,8,["layer"])):T("",!0)]),_:3},8,["access-token","map-style","center","zoom"]))}},wl={class:"left-panel-content"},Sl={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},Ll={class:"preset"},_l={class:"title-div"},Nl={class:"custom-title"},Pl={class:"crop"},Ml={class:"layer"},$l={class:"title-div"},Fl={class:"custom-title"},Dl={class:"crop"},Il={style:{"padding-top":"0.5rem"}},Ul={class:"item"},zl={__name:"ResultsSidePanel",props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],emits:["update-selectedCategory","select-layer","select-preset","delete-preset","update-selectedFilter"],setup(I,{emit:k}){const{$gettext:n}=be(),E=I,R=k,u=Pe(),F=Q(()=>u.isMobile),S=Q(()=>u.showLeftPanel),M=b(!0),L=b(350);ze(()=>{L.value=F.value?window.innerWidth-100:350}),H(S,m=>{m?setTimeout(()=>{M.value=!0},500):M.value=!1});const e=b(!1),r=b(!1),{selectedCategory:_,filteredCat:j}=ge(E),C=b([]);H(_,(m,t)=>{m!==t&&(C.value=m)}),H(C,m=>{m!==_.value&&R("update-selectedCategory",m)});function A(){C.value.length===j.value.length?C.value=[]:C.value=j.value}const{selectedFilter:N}=ge(E),w=b("");return H(N,m=>{m!==w.value&&(w.value=m)}),H(w,m=>{m!==N.value&&(R("update-selectedFilter",m),C.value=_.value)}),ze(()=>{w.value=N.value,C.value=_.value,R("update-selectedFilter",N.value),R("update-selectedCategory",_.value)}),(m,t)=>(v(),$("section",{class:rl(S.value?"left-panel elevation-4":"left-panel-close"),style:Ne({width:S.value?L.value+"px":"0px"})},[g("div",{class:"left-panel-toggle-btn elevation-4",onClick:t[0]||(t[0]=a=>l(u).changeLeftPanel())},[s(se,{size:"small",color:"secondarydark"},{default:o(()=>[V(h(S.value?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),s(il,{name:"fade"},{default:o(()=>[$e(g("div",wl,[g("div",null,[g("div",Sl,[g("div",Ll,[s(se,{style:{color:"white","padding-right":"2rem","padding-left":"1rem"}},{default:o(()=>t[7]||(t[7]=[V(" fas fa-sliders-h ")])),_:1}),s(Le,{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=a=>r.value=a),"close-delay":"100",location:"bottom center",transition:"slide-y-transition"},{activator:o(({props:a})=>[g("div",ne({class:"menu-container"},a),[g("div",_l,[g("span",Nl,h(l(n)("Presets")),1),g("span",Pl,h(I.selectedPreset),1)]),s(se,{variant:"text",style:{color:"white"}},{default:o(()=>[V(h(r.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)]),default:o(()=>[s(_e,null,{default:o(()=>[(v(!0),$(G,null,J(I.presetChoices,(a,p)=>(v(),x(ve,{key:p,link:"",onClick:()=>m.$emit("select-preset",a)},{append:o(()=>[s(D,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:We(()=>m.$emit("delete-preset",a),["stop"])},null,8,["onClick"])]),default:o(()=>[s(Re,null,{default:o(()=>[V(h(a.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(je,{location:"bottom","open-delay":"300"},{activator:o(({props:a})=>[s(D,ne({variant:"text"},a,{disabled:I.presetChoices.length===0,style:{color:"white"},icon:"fas fa-download",onClick:t[2]||(t[2]=p=>l(u).exportFile("styles.json"))}),null,16,["disabled"])]),default:o(()=>[g("span",null,h(l(n)("Dowload presets")),1)]),_:1})]),g("div",Ml,[s(je,{location:"bottom","open-delay":"500"},{activator:o(({props:a})=>[s(D,ne({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:C.value.length==l(j).length?"fa-eye-slash fa":"fa-eye fa",variant:"text"},a,{onClick:t[3]||(t[3]=p=>A())}),null,16,["icon"])]),default:o(()=>[g("span",null,h(C.value.length==l(j).length?l(n)("Hide All"):l(n)("Show All")),1)]),_:1}),s(Le,{modelValue:e.value,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value=a),"close-delay":"100",transition:"slide-y-transition"},{activator:o(({props:a})=>[g("div",ne({class:"title-div"},a),[g("div",ne({class:"menu-container"},a),[g("div",$l,[g("span",Fl,h(l(n)("Layer")),1),g("span",Dl,h(I.selectedLayer),1)]),s(se,{variant:"text",style:{color:"white"}},{default:o(()=>[V(h(e.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)],16)]),default:o(()=>[s(_e,null,{default:o(()=>[(v(!0),$(G,null,J(I.layerChoices,(a,p)=>(v(),x(ve,{key:p,link:"",onClick:()=>m.$emit("select-layer",a)},{default:o(()=>[s(Re,null,{default:o(()=>[V(h(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(se)]),s(ce,{"max-width":"100%","min-width":"100%",height:"calc(100vh - 250px)",class:"mx-auto scrollable"},{default:o(()=>[s(ve,null,{default:o(()=>[g("div",Il,[s(de,{modelValue:w.value,"onUpdate:modelValue":t[5]||(t[5]=a=>w.value=a),items:I.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:l(n)("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),s(nl,{items:l(j),"item-height":45,height:"calc(100vh - 330px)"},{default:o(({item:a})=>[(v(),$("div",{key:w.value.concat(a),class:"container"},[s(ol,null,{default:o(()=>[s(ul,{modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=p=>C.value=p),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:a},null,8,["modelValue","value"])]),_:2},1024),g("div",Ul,h(a),1)]))]),_:1},8,["items"])]),_:1})])])],512),[[Fe,M.value]])]),_:1})],6))}},Rl=Me(zl,[["__scopeId","data-v-bd021224"]]),jl={class:"setting"},Ol={class:"gradient-preview"},Bl={class:"preview-title"},Tl={class:"gradient"},Wl={class:"domain-title"},ql={__name:"ResultsSettings",props:["displaySettings","featureChoices","type"],emits:["submit","save-preset"],setup(I,{emit:k}){const{$gettext:n}=be(),E=I,R=k,{displaySettings:u,featureChoices:F,type:S}=ge(E),M=Q(()=>{const m=["OrRd","Spectral","RdYlGn","Viridis","YlGn","RdYlBu"],t=Object.keys(Te.brewer).slice(0,36).filter(a=>!m.includes(a));return[...m,...t]}),L=b(!1),e=b([{name:n("selectedFeature"),type:"String",value:u.value.selectedFeature,units:"",hint:n("selectedFeature")},{name:n("minWidth"),type:"Number",value:u.value.minWidth,units:"a.u.",hint:n("minWidth")},{name:n("maxWidth"),type:"Number",value:u.value.maxWidth,units:"a.u.",hint:n("maxWidth")},{name:n("numStep"),type:"Number",value:u.value.numStep,units:"int",hint:n("numStep")},{name:n("opacity"),type:"Number",value:u.value.opacity,units:"number",hint:n("opacity")},{name:n("scale"),type:"String",value:u.value.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:n("scale")},{name:n("color map"),type:"String",choices:M,value:u.value.cmap,units:"",hint:n("cmap to use")},{name:n("show NaN"),value:u.value.showNaN,hint:n("Hide NaN on map and color map")},{name:n("reverse color"),value:u.value.reverseColor,hint:n("reverse color scale")},{name:n("scale min"),type:"Number",value:u.value.minVal,units:"a.u.",hint:n("mininum value on the color Map")},{name:n("scale max"),type:"Number",value:u.value.maxVal,units:"a.u.",hint:n("maximum value on the color Map")},{name:n("custom scale"),value:u.value.fixScale,hint:n("customize to inputs values")},{name:n("Left side driving"),value:u.value.offset,hint:n("Select which side of the road the links are display")},{name:n("3D"),value:u.value.extrusion,hint:n("display zones as 3D extrusion")},{name:n("padding"),type:"Number",value:u.value.padding,units:"number",hint:n("range of colors")},{name:n("labels"),type:"String",value:u.value.labels,hint:n("show labels")}]),r=b(!1),_=b(!1);b(!1),H(L,()=>{A(),_.value=e.value[11].value}),H(F,()=>A());function j(){e.value[11].value?(_.value=!0,e.value[9].value=u.value.minVal,e.value[10].value=u.value.maxVal):_.value=!1}function C(m){const t=[],a=e.value[8].value;let p=e.value[14].value;p=[p[0]/100,1-p[1]/100],p=a?p.reverse():p;const O=Te.scale(m).padding(p).domain([0,100]).classes(25);for(let W=0;W<100;W++)t.push(O(W).hex());return a?t.reverse():t}function A(){e.value[0].value=u.value.selectedFeature,e.value[1].value=u.value.minWidth,e.value[2].value=u.value.maxWidth,e.value[3].value=u.value.numStep,e.value[4].value=u.value.opacity,e.value[5].value=u.value.scale,e.value[6].value=u.value.cmap,e.value[7].value=u.value.showNaN,e.value[8].value=u.value.reverseColor,e.value[9].value=u.value.minVal,e.value[10].value=u.value.maxVal,e.value[11].value=u.value.fixScale,e.value[12].value=u.value.offset,e.value[13].value=u.value.extrusion,e.value[14].value=u.value.padding,e.value[15].value=u.value.labels}function N(m){{const t={selectedFeature:e.value[0].value,minWidth:Number(e.value[1].value),maxWidth:Number(e.value[2].value),numStep:Number(e.value[3].value),opacity:Number(e.value[4].value),scale:e.value[5].value,cmap:e.value[6].value,showNaN:e.value[7].value,reverseColor:e.value[8].value,minVal:Number(e.value[9].value),maxVal:Number(e.value[10].value),fixScale:e.value[11].value,offset:e.value[12].value,extrusion:e.value[13].value,padding:e.value[14].value,labels:e.value[15].value};m==="apply"?R("submit",t):m==="save"&&R("save-preset",t)}}function w(){L.value=!1}return(m,t)=>(v(),x(Le,{modelValue:L.value,"onUpdate:modelValue":t[17]||(t[17]=a=>L.value=a),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:o(({props:a})=>[g("div",jl,[s(D,ne({color:l(u).selectedFeature===null?"error":"regular"},a,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:o(()=>[s(ce,{width:"20rem",class:"setting-card","max-height":"calc(100vh - 100px)",onKeydown:[t[16]||(t[16]=ee(a=>N("apply"),["enter"])),ee(w,["esc"])]},{default:o(()=>[s(ve,{class:"subtitle"},{append:o(()=>[s(D,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:t[0]||(t[0]=a=>r.value=!r.value)})]),default:o(()=>[V(h(l(n)("Settings"))+" ",1)]),_:1}),s(qe,{ref:"form","lazy-validation":""},{default:o(()=>[s(oe,null,{default:o(()=>[s(de,{modelValue:e.value[0].value,"onUpdate:modelValue":t[1]||(t[1]=a=>e.value[0].value=a),variant:"underlined",items:l(F).sort(),label:l(n)(e.value[0].name),hint:r.value?l(n)(e.value[0].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),s(Ve,null,{default:o(()=>[(v(!0),$(G,null,J(e.value.slice(1,3),a=>(v(),x(oe,{key:a.name},{default:o(()=>[s(me,{modelValue:a.value,"onUpdate:modelValue":p=>a.value=p,variant:"underlined",density:"compact",type:a.type,label:l(n)(a.name),suffix:a.units,hint:r.value?l(n)(a.hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),s(Ve,null,{default:o(()=>[s(oe,null,{default:o(()=>[s(me,{modelValue:e.value[3].value,"onUpdate:modelValue":t[2]||(t[2]=a=>e.value[3].value=a),variant:"underlined",density:"compact",type:e.value[3].type,label:l(n)(e.value[3].name),suffix:e.value[3].units,hint:r.value?l(n)(e.value[3].hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),s(oe,null,{default:o(()=>[s(de,{modelValue:e.value[5].value,"onUpdate:modelValue":t[3]||(t[3]=a=>e.value[5].value=a),density:"compact",variant:"underlined",items:e.value[5].choices,label:l(n)(e.value[5].name),hint:r.value?l(n)(e.value[5].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),s(de,{modelValue:e.value[6].value,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value[6].value=a),density:"compact",items:e.value[6].choices,label:l(n)(e.value[6].name),hint:r.value?l(n)(e.value[6].hint):"","persistent-hint":r.value,required:"",variant:"solo"},{selection:o(({item:a})=>[g("div",Ol,[(v(!0),$(G,null,J(C(a.value),(p,O)=>(v(),$("span",{key:O,class:"grad-step-small",style:Ne({backgroundColor:p})},null,4))),128)),g("span",Bl,h(a.value),1)])]),item:o(({props:a,item:p})=>[s(ve,dl(vl(a)),{title:o(()=>[g("div",Tl,[(v(!0),$(G,null,J(C(p.value),(O,W)=>(v(),$("span",{key:W,class:"grad-step",style:Ne({backgroundColor:O})},null,4))),128)),g("span",Wl,h(p.value),1)])]),_:2},1040)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),s(cl,{modelValue:e.value[14].value,"onUpdate:modelValue":t[5]||(t[5]=a=>e.value[14].value=a),step:"5",density:"compact",color:"primary",label:l(n)(e.value[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),s(ml,{modelValue:e.value[4].value,"onUpdate:modelValue":t[6]||(t[6]=a=>e.value[4].value=a),class:"align-center",color:"primary",label:l(n)(e.value[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":o(({modelValue:a})=>[V(h(Math.floor(a)+"%"),1)]),_:1},8,["modelValue","label"]),s(de,{modelValue:e.value[15].value,"onUpdate:modelValue":t[7]||(t[7]=a=>e.value[15].value=a),variant:"underlined",items:[null,...l(F).sort()],label:l(n)(e.value[15].name),hint:r.value?l(n)(e.value[15].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),(v(),x(re,{key:e.value[12].name,modelValue:e.value[12].value,"onUpdate:modelValue":t[8]||(t[8]=a=>e.value[12].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(n)(e.value[12].name),hint:r.value?l(n)(e.value[12].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(v(),x(re,{key:e.value[7].name,modelValue:e.value[7].value,"onUpdate:modelValue":t[9]||(t[9]=a=>e.value[7].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(n)(e.value[7].name),hint:r.value?l(n)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(v(),x(re,{key:e.value[8].name,modelValue:e.value[8].value,"onUpdate:modelValue":t[10]||(t[10]=a=>e.value[8].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(n)(e.value[8].name),hint:r.value?l(n)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(l(S))?(v(),x(re,{key:e.value[13].name,modelValue:e.value[13].value,"onUpdate:modelValue":t[11]||(t[11]=a=>e.value[13].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(n)(e.value[13].name),disabled:!["Polygon","extrusion"].includes(l(S)),hint:r.value?l(n)(e.value[13].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","disabled","hint","persistent-hint"])):T("",!0),(v(),x(re,{key:e.value[11].name,modelValue:e.value[11].value,"onUpdate:modelValue":[t[12]||(t[12]=a=>e.value[11].value=a),t[13]||(t[13]=a=>j(e.value[11].name))],density:"compact",variant:"underlined",color:"primary","hide-details":!r.value,label:l(n)(e.value[11].name),hint:r.value?l(n)(e.value[11].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),s(Ve,null,{default:o(()=>[(v(!0),$(G,null,J(e.value.slice(9,11),a=>(v(),x(oe,{key:a.name},{default:o(()=>[$e(s(me,{modelValue:a.value,"onUpdate:modelValue":p=>a.value=p,variant:"underlined",type:a.type,label:l(n)(a.name),suffix:a.units,hint:r.value?l(n)(a.hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"]),[[Fe,_.value]])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},512),s(ye,null,{default:o(()=>[s(D,{color:"grey",variant:"text",onClick:w},{default:o(()=>[V(h(l(n)("Cancel")),1)]),_:1}),s(D,{color:"green-darken-1",variant:"text",onClick:t[14]||(t[14]=a=>N("apply"))},{default:o(()=>[V(h(l(n)("Apply")),1)]),_:1}),s(he),s(D,{color:"grey",variant:"text",onClick:t[15]||(t[15]=a=>N("save"))},{default:o(()=>[s(se,{size:"small",start:""},{default:o(()=>t[18]||(t[18]=[V(" fas fa-sliders-h ")])),_:1}),V(" "+h(l(n)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},El=Me(ql,[["__scopeId","data-v-c23cb2e1"]]),Al={class:"map-view"},Hl={class:"left-panel"},Zl={style:{display:"flex"}},Kl={__name:"ResultMap",setup(I){const{$gettext:k}=be(),n=pl(),E=fl(),R=yl(),u=Pe(),{visibleLayer:F,NaNLayer:S,type:M,loadLayer:L,displaySettings:e,hasOD:r,ODfeatures:_,matSelectedIndex:j,changeOD:C,isIndexAvailable:A,selectedCategory:N,selectedFilter:w,attributes:m,applySettings:t,changeSelectedFilter:a,filteredCategory:p,updateSelectedFeature:O,changeSelectedCategory:W,colorScale:pe}=bl(),P=b();function Y(d){t(d),we(()=>P.value.update())}function xe(d){a(d),O(),we(()=>P.value.update())}function fe(d){W(d),O(),we(()=>P.value.update())}const X=b("");async function ue(d,f=null){switch(X.value=d,d){case"links":await L(n.links,null,f);break;case"rlinks":await L(E.rlinks,null,f);break;case"nodes":await L(n.nodes,null,f);break;case"rnodes":await L(E.rnodes,null,f);break;case"od":await L(R.layer,null,f);break;default:const y=await u.getOtherFile(d,"geojson"),B=await u.getOtherFile(d,"json");await L(y,B,f);break}P.value.update()}const U=b(null),q=Q(()=>u.availableLayers),Z=Q(()=>u.visibleRasters),K=Q(()=>u.styles),i=b(""),c=b(!1),z=b(!1),le=b(""),ke=b({});async function Ee(d){U.value=d.name,q.value.includes(d.layer)?(await ue(d.layer,d.displaySettings),m.value.includes(d==null?void 0:d.selectedFilter)?(a(d.selectedFilter),Object.keys(d).includes("selectedCategory")&&W(d.selectedCategory)):Object.keys(d).includes("selectedFilter")&&u.changeNotification({text:d.selectedFilter+" "+k("filter does not exist. use default one"),autoClose:!0,color:"error"})):u.changeNotification({text:k("Preset Layer does not exist"),autoClose:!0,color:"error"}),Object.keys(d).includes("selectedIndex")&&A(d.selectedIndex)&&(C(d.selectedIndex),u.changeNotification({})),P.value.update()}function Ae(d){i.value=d.name,c.value=!0}function He(d){ke.value=d,le.value=U.value,z.value=!0}async function Ze(d){if((await d).valid){z.value=!1;const y={name:te.cloneDeep(le.value),layer:te.cloneDeep(X.value),displaySettings:te.cloneDeep(ke.value),selectedFilter:te.cloneDeep(w.value)};N.value.filter(Ge=>p.value.includes(Ge)).length<p.value.length&&(y.selectedCategory=te.cloneDeep(N.value)),_.value.includes(ke.value.selectedFeature)&&r.value&&(y.selectedIndex=j.value),u.addStyle(y),Z.value.includes(le.value)?u.changeNotification({text:k("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):u.changeNotification({text:k("Preset Saved"),autoClose:!0,color:"success"}),U.value=te.cloneDeep(le.value)}}function De(){u.deleteStyle(i.value),c.value=!1,i.value===U.value&&(U.value=null),u.changeNotification({text:k("Preset deleted"),autoClose:!0,color:"success"}),i.value=""}const ae=b(!1),Ie=b([]);function Ke(d){d.action==="featureClick"?(Ie.value=d.feature,ae.value=!0):(C(d.feature.index),P.value.update())}return(d,f)=>(v(),$("section",Al,[s(Rl,{"selected-category":l(N),"selected-filter":l(w),"layer-choices":q.value,"selected-layer":X.value,"filter-choices":l(m),"filtered-cat":l(p),"preset-choices":K.value,"selected-preset":U.value,onUpdateSelectedCategory:fe,onUpdateSelectedFilter:xe,onSelectLayer:ue,onSelectPreset:Ee,onDeletePreset:Ae},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset"]),g("div",Hl,[$e(s(xl,{key:"result",order:0,"color-scale":l(pe),"display-settings":l(e)},null,8,["color-scale","display-settings"]),[[Fe,l(F).features.length>0]])]),l(F).features?(v(),x(Cl,{ref_key:"mapRef",ref:P,key:l(M)+String(l(e).extrusion),"selected-layer":X.value,"layer-type":l(M),extrusion:l(e).extrusion,labels:l(e).labels,links:l(F),"nan-links":l(S),"selected-feature":l(e).selectedFeature,opacity:l(e).opacity,offset:l(e).offset,onSelectClick:Ke},{default:o(y=>[g("div",Zl,[s(El,{"display-settings":l(e),"feature-choices":l(m),type:l(M),onSubmit:Y,onSavePreset:He},null,8,["display-settings","feature-choices","type"]),s(hl),K.value.length>0?(v(),x(Vl,{key:0,choices:K.value,map:y.map,"available-layers":q.value},null,8,["choices","map","available-layers"])):T("",!0)]),(v(!0),$(G,null,J(K.value,B=>(v(),$("div",{key:B.name},[Z.value.includes(B.name)&&q.value.includes(B.layer)?(v(),x(kl,{key:0,preset:B,map:y.map,order:Z.value.indexOf(B.name)+1,"visible-rasters":Z.value},null,8,["preset","map","order","visible-rasters"])):T("",!0)]))),128))]),_:1},8,["selected-layer","layer-type","extrusion","labels","links","nan-links","selected-feature","opacity","offset"])):T("",!0),s(Ce,{modelValue:ae.value,"onUpdate:modelValue":f[1]||(f[1]=y=>ae.value=y),scrollable:"",persistent:"","max-width":"300",onKeydown:[f[2]||(f[2]=ee(y=>ae.value=!1,["enter"])),f[3]||(f[3]=ee(y=>ae.value=!1,["esc"]))]},{default:o(()=>[s(ce,{"max-height":"60rem"},{default:o(()=>[s(Se,{class:"text-h5"},{default:o(()=>[V(h(l(k)("link Properties")),1)]),_:1}),s(Oe),s(Be,null,{default:o(()=>[s(_e,null,{default:o(()=>[(v(!0),$(G,null,J(Ie.value,(y,B)=>(v(),x(me,{key:B,"model-value":y,label:B,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),s(Oe),s(ye,null,{default:o(()=>[s(he),s(D,{color:"success",variant:"text",onClick:f[0]||(f[0]=y=>ae.value=!1)},{default:o(()=>[V(h(l(k)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Ce,{modelValue:z.value,"onUpdate:modelValue":f[6]||(f[6]=y=>z.value=y),persistent:"","max-width":"400",onKeydown:f[7]||(f[7]=ee(y=>z.value=!1,["esc"]))},{default:o(()=>[s(ce,null,{default:o(()=>[s(Se,{class:"text-h5"},{default:o(()=>[V(h(l(k)("Create or modify preset")),1)]),_:1}),s(qe,{"validate-on":"submit lazy",onSubmit:We(Ze,["prevent"])},{default:o(()=>[s(Be,null,{default:o(()=>[s(gl,null,{default:o(()=>[s(oe,{cols:"12"},{default:o(()=>[s(me,{modelValue:le.value,"onUpdate:modelValue":f[4]||(f[4]=y=>le.value=y),autofocus:"",rules:[y=>!!y||"Required."],label:l(k)("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),s(ye,null,{default:o(()=>[s(he),s(D,{color:"grey",variant:"text",onClick:f[5]||(f[5]=y=>z.value=!1)},{default:o(()=>[V(h(l(k)("Cancel")),1)]),_:1}),s(D,{color:"green-darken-1",variant:"text",type:"submit"},{default:o(()=>[V(h(l(k)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Ce,{modelValue:c.value,"onUpdate:modelValue":f[9]||(f[9]=y=>c.value=y),persistent:"","max-width":"400",onKeydown:[f[10]||(f[10]=ee(y=>c.value=!1,["esc"])),ee(De,["enter"])]},{default:o(()=>[s(ce,null,{default:o(()=>[s(Se,{class:"text-h5"},{default:o(()=>[V(h(l(k)("Delete")+" "+i.value+" ?"),1)]),_:1}),s(ye,null,{default:o(()=>[s(he),s(D,{color:"grey",variant:"text",onClick:f[8]||(f[8]=y=>c.value=!1)},{default:o(()=>[V(h(l(k)("Cancel")),1)]),_:1}),s(D,{color:"error",variant:"text",onClick:De},{default:o(()=>[V(h(l(k)("delete")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Yl=Me(Kl,[["__scopeId","data-v-75cf031e"]]);export{Yl as default};
