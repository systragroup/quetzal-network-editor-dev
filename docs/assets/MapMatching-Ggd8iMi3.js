import{al as G,u as H,bX as K,ab as Q,aa as X,c as a,r as E,d as z,o as Y,f as Z,g as ee,j as n,i as r,m as d,af as te,a8 as ae,D as N,L as C,B as _,C as h,W as V,ag as se,Q as ne,am as oe,aC as v,a as re,_ as ie}from"./index-Byf-vw9r.js";import{S as le}from"./SimpleForm-Bbop7UQ8.js";import{W as A}from"./Warning-DzlELRyA.js";import{M as ue}from"./Markdown-CF9QRc-x.js";import"./form-B2uRhppC.js";const ce={class:"background"},de=`
# Match PT network on road network
$Probability = Emission + Transmission$ , or
 
$Probability = \\frac{1}{2} (\\frac{d_{proj}}{\\sigma} )^{power} + \\frac{1}{\\beta} |d_{dijkstra} - d_{acf}^{*}|$ 
 
\\* $d_{acf} = 0$ if use difference is false 
 

*Hidden Markov Map Matching Through Noise and Sparseness* 

*Paul Newson and John Krumm 2009*
`,me=G({__name:"MapMatching",setup(pe){const{$gettext:i}=H(),e=K(),b=Q(),l=X(),k=a(()=>b.rlinksIsEmpty),w=a(()=>l.linksIsEmpty),m=a(()=>e.running),O=a(()=>e.status),D=a(()=>e.error),$=a(()=>e.errorMessage),M=a(()=>e.timer),u=a(()=>e.callID),p=a(()=>e.bucket),g=a(()=>e.parameters),S=a(()=>Array.from(new Set(l.links.features.map(t=>t.properties.route_type)))),c=E([{key:"exclusions",label:"route_type exclusion",value:null,items:S.value,type:"select",multiple:!0,hint:"routes type to not mapmatch (ex subway are not on roads)"},{key:"SIGMA",label:"Sigma",value:null,type:"number",units:"meters",rules:["required"],hint:"emission probablity constant. the bigger it     is the further away a stops can be from roads."},{key:"BETA",label:"beta",value:null,type:"number",units:"meters",rules:["required"],hint:"transition probablity constant. The smaller the smaller      the difference between the as-the-crow and routing distance can be (if use difference is true)"},{key:"POWER",label:"power",value:null,type:"number",rules:["required"],hint:"Power used in the Emission Probability"},{key:"DIFF",label:"Use difference",value:null,type:"boolean",units:"bool",rules:["required"],hint:"If False, act_dist is ignore in the transition probability. This change the emission to only     consider the shortest path between nodes. "},{key:"ptMetrics",label:"Add indicators on road links",value:null,type:"boolean",units:"bool",hint:"Add PT metrics to road links (ex: number of trips & number of lines)"},{key:"keepTime",label:"keep time",value:!0,type:"boolean",units:"bool",hint:"if true. keep time and calculate speed. if false. keep speed and calcule time"}]);z(()=>{g.value.exclusions=g.value.exclusions.filter(t=>S.value.includes(t)),c.value.forEach(t=>t.value=g.value[t.key])}),Y(()=>{e.saveParams(c.value)});const x=E();async function B(){var f;if(!await x.value.validate())return;const s=oe();e.saveParams(c.value),e.running=!0,e.setCallID(),F(),await J();const o=e.parameters,y={scenario_path_S3:u.value,launcher_arg:{training_folder:"/tmp",params:o},metadata:{user_email:(f=s.cognitoInfo)==null?void 0:f.email}};e.start(y)}function F(){let s=l.tripList.length/6;function o(f,U=20,W=[12,8,4,2,1]){let q=Math.floor(f/U),I=100,P=12;for(let T of W){let j=Math.abs(q-T);j<I&&(I=j,P=T)}return P}const y=o(s,20,[12,8,4,2,1]);e.timer=s/y+20+20+10}async function J(){const t=[];t.push(v.putObject(p.value,u.value.concat("/road_links.geojson"),JSON.stringify(b.rlinks))),t.push(v.putObject(p.value,u.value.concat("/road_nodes.geojson"),JSON.stringify(b.rnodes))),t.push(v.putObject(p.value,u.value.concat("/links.geojson"),JSON.stringify(l.links))),t.push(v.putObject(p.value,u.value.concat("/nodes.geojson"),JSON.stringify(l.nodes)));try{await Promise.all(t)}catch(s){console.log("err"),re().changeAlert(s)}}function L(){e.stopExecution()}const R=a(()=>k.value||w.value);return(t,s)=>(ee(),Z("section",ce,[n(ne,{class:"card"},{default:r(()=>[n(ue,{source:de}),n(A,{show:R.value,title:d(i)("need a road and a PT network"),type:"warning"},null,8,["show","title"]),n(A,{show:D.value,messages:$.value},null,8,["show","messages"]),n(te),n(le,{ref_key:"formRef",ref:x,modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=o=>c.value=o)},{default:r(()=>[n(ae,null,{default:r(()=>[n(C,{variant:"outlined",color:"success",loading:m.value,disabled:m.value||k.value||w.value,onClick:B},{default:r(()=>[_(h(d(i)("Process")),1)]),_:1},8,["loading","disabled"]),N(n(C,{color:"grey",variant:"text",onClick:s[0]||(s[0]=o=>L())},{default:r(()=>[_(h(d(i)("Abort")),1)]),_:1},512),[[V,m.value&&O.value==="RUNNING"]]),N(n(se,null,{default:r(()=>[_(" ~ "+h(M.value>0?Math.ceil(M.value/60):d(i)("less than 1"))+h(d(i)(" minutes remaining")),1)]),_:1},512),[[V,m.value]])]),_:1})]),_:1},8,["modelValue"])]),_:1})]))}}),ye=ie(me,[["__scopeId","data-v-af467f6a"]]);export{ye as default};
