import{_ as he,u as ge,t as me,a as Se,b as qe,r as g,s as Ee,c as Q,w as q,o as Ae,d as He,e as c,f as N,g as b,h as u,i as n,j as l,M as Ze,k as Ge,l as Ke,m as oe,n as O,p as Ye,q as Je,v as Qe,x as Xe,y as De,z as Pe,A as f,B as P,C as x,V as te,D as we,E as Le,F as Ve,G as se,H as Ce,I as Y,J,K as E,L as el,N as $e,O as de,P as Fe,Q as _e,R as re,S as ll,T as al,U as tl,W as fe,X as sl,Y as nl,Z as ye,$ as ol,a0 as ue,a1 as xe,a2 as ce,a3 as ul,a4 as il,a5 as rl,a6 as dl,a7 as ie,a8 as Re,a9 as We,aa as cl,ab as vl,ac as pl,ad as ml,ae as Ie,af as ke,ag as fl,ah as yl,ai as Ue,aj as hl,ak as ee}from"./index-DFbiUPpr.js";import{c as ze,u as gl,M as bl,S as xl}from"./StaticLayer-DIUfHays.js";import kl from"./LayerSelector-DuZXTg8a.js";const Vl={__name:"MapResults",props:["selectedFeature","layerType","extrusion","labels","links","nanLinks","opacity","offset","selectedLayer"],emits:["selectClick"],setup(U,{expose:L,emit:t}){const{$gettext:B}=ge(),z=U,{selectedFeature:o,layerType:S,extrusion:_,labels:$,links:h,nanLinks:e,opacity:r,offset:M,selectedLayer:R}=me(z),k=t,A=Se(),V=qe(),C=g(!1),i=Ee(null),s=g({nodes:14,links:2}),a=Q(()=>V.mapStyle);q(a,()=>{i.value&&(i.value.getLayer("arrow")&&i.value.removeLayer("arrow"),i.value.getLayer("results")&&i.value.removeLayer("results"),i.value.getLayer("labels")&&i.value.removeLayer("labels"),i.value.getLayer("NaNresults")&&i.value.removeLayer("NaNresults"),C.value=!1,v())}),Ae(()=>{var d;i.value&&v(),(d=i.value)!=null&&d.getLayer("arrow")&&i.value.removeLayer("arrow")});function v(){const d=i.value.getCenter();V.saveMapPosition({mapCenter:[d.lng,d.lat],mapZoom:i.value.getZoom()})}function W(d){i.value&&(C.value=!1),i.value=d.map,i.value.loadImage(Xe,function(p,K){if(p){console.error("err image",p);return}i.value.addImage("arrow",K,{sdf:!0})}),_.value&&A.changeNotification({text:B("Right click and drag to tilt the map"),autoClose:!0,color:"success"}),C.value=!0}function T(){const d=new De.LngLatBounds;["Polygon"].includes(S.value)?h.value.features.forEach(p=>{try{p.geometry.type==="Polygon"?d.extend([p.geometry.coordinates[0][0],p.geometry.coordinates[0][p.geometry.coordinates.length-1]]):d.extend([p.geometry.coordinates[0][0][0],p.geometry.coordinates[0][0][p.geometry.coordinates.length-1]])}catch{}}):h.value.features.forEach(p=>{d.extend([p.geometry.coordinates[0],p.geometry.coordinates[p.geometry.coordinates.length-1]])}),V.getZoomAndCenter(d,ne.value.clientWidth,ne.value.clientHeight)}const{canvasDiv:ne}=He(i),j=g([]),F=g(null);L({update:be});function be(){var d;C.value&&(i.value.getSource("results").setData(h.value),(d=i.value.getSource("NaNresults"))==null||d.setData(e.value),$.value!==""&&i.value.getLayer("labels")&&i.value.removeLayer("labels"))}q(R,()=>T());const ve=Q(()=>M.value?-1:1);function pe(d){var p;if(d.map.getCanvas().style.cursor="pointer",j.value=d.mapboxEvent.features,(p=F.value)!=null&&p.isOpen()&&F.value.remove(),o.value&&S.value!=="Polygon"){const K=j.value[0].properties[o.value];K&&(F.value=new De.Popup({closeButton:!1}).setLngLat([d.mapboxEvent.lngLat.lng,d.mapboxEvent.lngLat.lat]).setHTML(`${o.value}: <br> ${K}`).addTo(d.map))}}function X(d){var p;j.value=[],(p=F.value)!=null&&p.isOpen()&&F.value.remove(),d.map.getCanvas().style.cursor=""}function H(d){var p;j.value=d.mapboxEvent.features,((p=j.value)==null?void 0:p.length)>0&&k("selectClick",{feature:j.value[0].properties,action:"featureClick"})}function I(d){var p;j.value=d.mapboxEvent.features,((p=j.value)==null?void 0:p.length)>0&&k("selectClick",{feature:j.value[0].properties,action:"zoneClick"})}function Z(d){d.map.getCanvas().style.cursor="pointer"}function G(d){d.map.getCanvas().style.cursor=""}return(d,p)=>(c(),N("div",{ref_key:"canvasDiv",ref:ne,class:"map"},[(c(),b(l(Qe),{key:a.value,style:{width:"100%"},"access-token":l(V).key,"map-style":a.value,center:l(V).mapCenter,zoom:l(V).mapZoom,onLoad:W},{default:u(()=>[n(l(Ze),{position:"bottom-right"}),n(l(Ge),{position:"bottom-right","visualize-pitch":!0}),Ke(d.$slots,"default",{map:i.value,mapIsLoaded:C.value},void 0,!0),l(S)=="LineString"?(c(),b(l(oe),{key:0,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(h),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:s.value.links,paint:{"line-color":["get","display_color"],"line-offset":["*",ve.value*.5,["to-number",["get","display_width"]]],"line-opacity":l(r)/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:pe,onMouseleave:X,onClick:I,onContextmenu:H},null,8,["source","layer"])):O("",!0),l(S)=="Point"?(c(),b(l(oe),{key:1,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(h),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:s.value.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":l(r)/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:pe,onMouseleave:X,onClick:I,onContextmenu:H},null,8,["source","layer"])):O("",!0),l(S)=="LineString"?(c(),b(l(Ye),{key:2,"source-id":"results",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:s.value.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[ve.value*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":l(r)/100}}},null,8,["layer"])):O("",!0),l(S)==="Polygon"&&l(_)?(c(),b(l(oe),{key:3,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(h),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":l(r)/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:Z,onMouseleave:G,onClick:I,onContextmenu:H},null,8,["source","layer"])):O("",!0),l(S)==="Polygon"&&!l(_)?(c(),b(l(oe),{key:4,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(h),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":l(r)/100}},onMouseenter:Z,onMouseleave:G,onClick:I,onContextmenu:H},null,8,["source","layer"])):O("",!0),l(S)==="Polygon"&&!l(_)?(c(),b(l(oe),{key:5,reactive:!1,"source-id":"NaNresults",source:{type:"geojson",data:l(e),promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:Z,onMouseleave:G,onClick:I,onContextmenu:H},null,8,["source"])):O("",!0),l($)!==""?(c(),b(l(Je),{key:6,type:"symbol","source-id":"results",source:"links","layer-id":"labels",layer:{type:"symbol",layout:{"text-field":["get",l($)],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":d.$vuetify.theme.current.colors.black}}},null,8,["layer"])):O("",!0)]),_:3},8,["access-token","map-style","center","zoom"]))],512))}},Cl=he(Vl,[["__scopeId","data-v-c02d6d53"]]),Sl={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},wl={class:"preset"},Ll={class:"title-div"},_l={class:"custom-title"},Nl={class:"crop"},Ml={class:"layer"},Dl={class:"title-div"},Pl={class:"custom-title"},$l={class:"crop"},Fl={style:{"padding-top":"0.5rem"}},Il={class:"item"},Ul={__name:"ResultsSidePanel",props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],emits:["update-selectedCategory","select-layer","select-preset","delete-preset","update-selectedFilter"],setup(U,{emit:L}){const{$gettext:t}=ge(),B=U,z=L,o=Se(),S=Q(()=>o.isMobile),_=Q(()=>o.showLeftPanel),$=g(!0),h=g(500);Pe(()=>{h.value=S.value?window.innerWidth-100:350}),q(_,i=>{i?setTimeout(()=>{$.value=!0},500):$.value=!1});const e=g(!1),r=g(!1),{selectedCategory:M,filteredCat:R}=me(B),k=g([]);q(M,(i,s)=>{i!==s&&(k.value=i)}),q(k,i=>{i!==M.value&&z("update-selectedCategory",i)});function A(){k.value.length===R.value.length?k.value=[]:k.value=R.value}const{selectedFilter:V}=me(B),C=g("");return q(V,i=>{i!==C.value&&(C.value=i)}),q(C,i=>{i!==V.value&&(z("update-selectedFilter",i),k.value=M.value)}),Pe(()=>{C.value=V.value,k.value=M.value,z("update-selectedFilter",V.value),z("update-selectedCategory",M.value)}),(i,s)=>(c(),N("section",{class:nl(_.value?"left-panel elevation-4":"left-panel-close"),style:fe({width:_.value?h.value+"px":"0px"})},[f("div",{class:"left-panel-toggle-btn elevation-4",onClick:s[0]||(s[0]=a=>l(o).changeLeftPanel())},[n(te,{size:"small",color:"secondarydark"},{default:u(()=>[P(x(_.value?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),n(sl,{name:"fade"},{default:u(()=>[we(f("div",{class:"left-panel-content",style:fe({width:_.value?h.value+"px":"0px"})},[f("div",null,[f("div",Sl,[f("div",wl,[n(te,{style:{color:"white","padding-right":"2rem","padding-left":"1rem"}},{default:u(()=>s[7]||(s[7]=[P(" fas fa-sliders-h ")])),_:1}),n(Ve,{modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=a=>r.value=a),"close-delay":"100",location:"bottom center",transition:"slide-y-transition"},{activator:u(({props:a})=>[f("div",se({class:"menu-container"},a),[f("div",Ll,[f("span",_l,x(l(t)("Presets")),1),f("span",Nl,x(U.selectedPreset),1)]),n(te,{variant:"text",style:{color:"white"}},{default:u(()=>[P(x(r.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)]),default:u(()=>[n(Ce,null,{default:u(()=>[(c(!0),N(Y,null,J(U.presetChoices,(a,v)=>(c(),b(de,{key:v,link:"",onClick:()=>i.$emit("select-preset",a)},{append:u(()=>[n(E,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:el(()=>i.$emit("delete-preset",a),["stop"])},null,8,["onClick"])]),default:u(()=>[n($e,null,{default:u(()=>[P(x(a.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),n(Fe,{location:"bottom","open-delay":"300"},{activator:u(({props:a})=>[n(E,se({variant:"text"},a,{disabled:U.presetChoices.length===0,style:{color:"white"},icon:"fas fa-download",onClick:s[2]||(s[2]=v=>l(o).exportFile("styles.json"))}),null,16,["disabled"])]),default:u(()=>[f("span",null,x(l(t)("Dowload presets")),1)]),_:1})]),f("div",Ml,[n(Fe,{location:"bottom","open-delay":"500"},{activator:u(({props:a})=>[n(E,se({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:k.value.length==l(R).length?"fa-eye-slash fa":"fa-eye fa",variant:"text"},a,{onClick:s[3]||(s[3]=v=>A())}),null,16,["icon"])]),default:u(()=>[f("span",null,x(k.value.length==l(R).length?l(t)("Hide All"):l(t)("Show All")),1)]),_:1}),n(Ve,{modelValue:e.value,"onUpdate:modelValue":s[4]||(s[4]=a=>e.value=a),"close-delay":"100",transition:"slide-y-transition"},{activator:u(({props:a})=>[f("div",se({class:"title-div"},a),[f("div",se({class:"menu-container"},a),[f("div",Dl,[f("span",Pl,x(l(t)("Layer")),1),f("span",$l,x(U.selectedLayer),1)]),n(te,{variant:"text",style:{color:"white"}},{default:u(()=>[P(x(e.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)],16)]),default:u(()=>[n(Ce,null,{default:u(()=>[(c(!0),N(Y,null,J(U.layerChoices,(a,v)=>(c(),b(de,{key:v,link:"",onClick:()=>i.$emit("select-layer",a)},{default:u(()=>[n($e,null,{default:u(()=>[P(x(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),n(te)]),n(_e,{"max-width":"100%","min-width":"100%",height:"calc(100vh - 250px)",class:"mx-auto scrollable"},{default:u(()=>[n(de,null,{default:u(()=>[f("div",Fl,[n(re,{modelValue:C.value,"onUpdate:modelValue":s[5]||(s[5]=a=>C.value=a),items:U.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:l(t)("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),n(ll,{items:l(R),"item-height":45,height:"calc(100vh - 330px)"},{default:u(({item:a})=>[(c(),N("div",{key:C.value.concat(a),class:"container"},[n(al,null,{default:u(()=>[n(tl,{modelValue:k.value,"onUpdate:modelValue":s[6]||(s[6]=v=>k.value=v),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:a},null,8,["modelValue","value"])]),_:2},1024),f("div",Il,x(a),1)]))]),_:1},8,["items"])]),_:1})])])],4),[[Le,$.value]])]),_:1})],6))}},zl=he(Ul,[["__scopeId","data-v-26cce869"]]),Rl={class:"setting"},Wl={class:"gradient-preview"},Tl={class:"preview-title"},jl={class:"gradient"},Ol={class:"domain-title"},Bl={__name:"ResultsSettings",props:["displaySettings","featureChoices","type"],emits:["submit","save-preset"],setup(U,{emit:L}){const{$gettext:t}=ge(),B=U,z=L,{displaySettings:o,featureChoices:S,type:_}=me(B),$=Q(()=>{const i=["OrRd","Spectral","RdYlGn","Viridis","YlGn","RdYlBu"],s=Object.keys(ze.brewer).slice(0,36).filter(a=>!i.includes(a));return[...i,...s]}),h=g(!1),e=g([{name:t("selectedFeature"),type:"String",value:o.value.selectedFeature,units:"",hint:t("selectedFeature")},{name:t("minWidth"),type:"Number",value:o.value.minWidth,units:"a.u.",hint:t("minWidth")},{name:t("maxWidth"),type:"Number",value:o.value.maxWidth,units:"a.u.",hint:t("maxWidth")},{name:t("numStep"),type:"Number",value:o.value.numStep,units:"int",hint:t("numStep")},{name:t("opacity"),type:"Number",value:o.value.opacity,units:"number",hint:t("opacity")},{name:t("scale"),type:"String",value:o.value.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:t("scale")},{name:t("color map"),type:"String",choices:$,value:o.value.cmap,units:"",hint:t("cmap to use")},{name:t("show NaN"),value:o.value.showNaN,hint:t("Hide NaN on map and color map")},{name:t("reverse color"),value:o.value.reverseColor,hint:t("reverse color scale")},{name:t("scale min"),type:"Number",value:o.value.minVal,units:"a.u.",hint:t("mininum value on the color Map")},{name:t("scale max"),type:"Number",value:o.value.maxVal,units:"a.u.",hint:t("maximum value on the color Map")},{name:t("custom scale"),value:o.value.fixScale,hint:t("customize to inputs values")},{name:t("Left side driving"),value:o.value.offset,hint:t("Select which side of the road the links are display")},{name:t("3D"),value:o.value.extrusion,hint:t("display zones as 3D extrusion")},{name:t("padding"),type:"Number",value:o.value.padding,units:"number",hint:t("range of colors")},{name:t("labels"),type:"String",value:o.value.labels,hint:t("show labels")}]),r=g(!1),M=g(!1);g(!1),q(h,()=>{A(),M.value=e.value[11].value}),q(S,()=>A());function R(){e.value[11].value?(M.value=!0,e.value[9].value=o.value.minVal,e.value[10].value=o.value.maxVal):M.value=!1}function k(i){const s=[],a=e.value[8].value;let v=e.value[14].value;v=[v[0]/100,1-v[1]/100],v=a?v.reverse():v;const W=ze.scale(i).padding(v).domain([0,100]).classes(25);for(let T=0;T<100;T++)s.push(W(T).hex());return a?s.reverse():s}function A(){e.value[0].value=o.value.selectedFeature,e.value[1].value=o.value.minWidth,e.value[2].value=o.value.maxWidth,e.value[3].value=o.value.numStep,e.value[4].value=o.value.opacity,e.value[5].value=o.value.scale,e.value[6].value=o.value.cmap,e.value[7].value=o.value.showNaN,e.value[8].value=o.value.reverseColor,e.value[9].value=o.value.minVal,e.value[10].value=o.value.maxVal,e.value[11].value=o.value.fixScale,e.value[12].value=o.value.offset,e.value[13].value=o.value.extrusion,e.value[14].value=o.value.padding,e.value[15].value=o.value.labels}function V(i){{const s={selectedFeature:e.value[0].value,minWidth:Number(e.value[1].value),maxWidth:Number(e.value[2].value),numStep:Number(e.value[3].value),opacity:Number(e.value[4].value),scale:e.value[5].value,cmap:e.value[6].value,showNaN:e.value[7].value,reverseColor:e.value[8].value,minVal:Number(e.value[9].value),maxVal:Number(e.value[10].value),fixScale:e.value[11].value,offset:e.value[12].value,extrusion:e.value[13].value,padding:e.value[14].value,labels:e.value[15].value};i==="apply"?z("submit",s):i==="save"&&z("save-preset",s)}}function C(){h.value=!1}return(i,s)=>(c(),b(Ve,{modelValue:h.value,"onUpdate:modelValue":s[17]||(s[17]=a=>h.value=a),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:u(({props:a})=>[f("div",Rl,[n(E,se({color:l(o).selectedFeature===null?"error":"white"},a,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:u(()=>[n(_e,{width:"20rem",class:"setting-card","max-height":"calc(100vh - 100px)",onKeydown:[s[16]||(s[16]=ye(a=>V("apply"),["enter"])),ye(C,["esc"])]},{default:u(()=>[n(de,{class:"subtitle"},{append:u(()=>[n(E,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:s[0]||(s[0]=a=>r.value=!r.value)})]),default:u(()=>[P(x(l(t)("Settings"))+" ",1)]),_:1}),n(ol,{ref:"form","validate-on":"lazy"},{default:u(()=>[n(ue,null,{default:u(()=>[n(re,{modelValue:e.value[0].value,"onUpdate:modelValue":s[1]||(s[1]=a=>e.value[0].value=a),variant:"underlined",items:l(S).sort(),label:l(t)(e.value[0].name),hint:r.value?l(t)(e.value[0].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),n(xe,null,{default:u(()=>[(c(!0),N(Y,null,J(e.value.slice(1,3),a=>(c(),b(ue,{key:a.name},{default:u(()=>[n(ce,{modelValue:a.value,"onUpdate:modelValue":v=>a.value=v,variant:"underlined",density:"compact",type:a.type,label:l(t)(a.name),suffix:a.units,hint:r.value?l(t)(a.hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),n(xe,null,{default:u(()=>[n(ue,null,{default:u(()=>[n(ce,{modelValue:e.value[3].value,"onUpdate:modelValue":s[2]||(s[2]=a=>e.value[3].value=a),variant:"underlined",density:"compact",type:e.value[3].type,label:l(t)(e.value[3].name),suffix:e.value[3].units,hint:r.value?l(t)(e.value[3].hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),n(ue,null,{default:u(()=>[n(re,{modelValue:e.value[5].value,"onUpdate:modelValue":s[3]||(s[3]=a=>e.value[5].value=a),density:"compact",variant:"underlined",items:e.value[5].choices,label:l(t)(e.value[5].name),hint:r.value?l(t)(e.value[5].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),n(re,{modelValue:e.value[6].value,"onUpdate:modelValue":s[4]||(s[4]=a=>e.value[6].value=a),density:"compact",items:e.value[6].choices,label:l(t)(e.value[6].name),hint:r.value?l(t)(e.value[6].hint):"","persistent-hint":r.value,required:"",variant:"solo"},{selection:u(({item:a})=>[f("div",Wl,[(c(!0),N(Y,null,J(k(a.value),(v,W)=>(c(),N("span",{key:W,class:"grad-step-small",style:fe({backgroundColor:v})},null,4))),128)),f("span",Tl,x(a.value),1)])]),item:u(({props:a,item:v})=>[n(de,ul(il(a)),{title:u(()=>[f("div",jl,[(c(!0),N(Y,null,J(k(v.value),(W,T)=>(c(),N("span",{key:T,class:"grad-step",style:fe({backgroundColor:W})},null,4))),128)),f("span",Ol,x(v.value),1)])]),_:2},1040)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),n(rl,{modelValue:e.value[14].value,"onUpdate:modelValue":s[5]||(s[5]=a=>e.value[14].value=a),step:"5",density:"compact",color:"primary",label:l(t)(e.value[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),n(dl,{modelValue:e.value[4].value,"onUpdate:modelValue":s[6]||(s[6]=a=>e.value[4].value=a),class:"align-center",color:"primary",label:l(t)(e.value[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":u(({modelValue:a})=>[P(x(Math.floor(a)+"%"),1)]),_:1},8,["modelValue","label"]),n(re,{modelValue:e.value[15].value,"onUpdate:modelValue":s[7]||(s[7]=a=>e.value[15].value=a),variant:"underlined",items:[null,...l(S).sort()],label:l(t)(e.value[15].name),hint:r.value?l(t)(e.value[15].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),(c(),b(ie,{key:e.value[12].name,modelValue:e.value[12].value,"onUpdate:modelValue":s[8]||(s[8]=a=>e.value[12].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(t)(e.value[12].name),hint:r.value?l(t)(e.value[12].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(c(),b(ie,{key:e.value[7].name,modelValue:e.value[7].value,"onUpdate:modelValue":s[9]||(s[9]=a=>e.value[7].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(t)(e.value[7].name),hint:r.value?l(t)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(c(),b(ie,{key:e.value[8].name,modelValue:e.value[8].value,"onUpdate:modelValue":s[10]||(s[10]=a=>e.value[8].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(t)(e.value[8].name),hint:r.value?l(t)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(l(_))?(c(),b(ie,{key:e.value[13].name,modelValue:e.value[13].value,"onUpdate:modelValue":s[11]||(s[11]=a=>e.value[13].value=a),density:"compact",color:"primary","hide-details":!r.value,label:l(t)(e.value[13].name),disabled:!["Polygon","extrusion"].includes(l(_)),hint:r.value?l(t)(e.value[13].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","disabled","hint","persistent-hint"])):O("",!0),(c(),b(ie,{key:e.value[11].name,modelValue:e.value[11].value,"onUpdate:modelValue":[s[12]||(s[12]=a=>e.value[11].value=a),s[13]||(s[13]=a=>R(e.value[11].name))],density:"compact",variant:"underlined",color:"primary","hide-details":!r.value,label:l(t)(e.value[11].name),hint:r.value?l(t)(e.value[11].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),n(xe,null,{default:u(()=>[(c(!0),N(Y,null,J(e.value.slice(9,11),a=>(c(),b(ue,{key:a.name},{default:u(()=>[we(n(ce,{modelValue:a.value,"onUpdate:modelValue":v=>a.value=v,variant:"underlined",type:a.type,label:l(t)(a.name),suffix:a.units,hint:r.value?l(t)(a.hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"]),[[Le,M.value]])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},512),n(Re,null,{default:u(()=>[n(E,{color:"grey",variant:"text",onClick:C},{default:u(()=>[P(x(l(t)("Cancel")),1)]),_:1}),n(E,{color:"green-darken-1",variant:"text",onClick:s[14]||(s[14]=a=>V("apply"))},{default:u(()=>[P(x(l(t)("Apply")),1)]),_:1}),n(We),n(E,{color:"grey",variant:"text",onClick:s[15]||(s[15]=a=>V("save"))},{default:u(()=>[n(te,{size:"small",start:""},{default:u(()=>s[18]||(s[18]=[P(" fas fa-sliders-h ")])),_:1}),P(" "+x(l(t)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ql=he(Bl,[["__scopeId","data-v-395d41c8"]]),El={class:"map-view"},Al={class:"legend"},Hl={style:{display:"flex"}},Zl={__name:"ResultMap",setup(U){const{$gettext:L}=ge(),t=cl(),B=vl(),z=pl(),o=Se(),{visibleLayer:S,nanLayer:_,type:$,loadLayer:h,displaySettings:e,hasOD:r,attributesWithOD:M,matSelectedIndex:R,changeOD:k,isIndexAvailable:A,selectedCategory:V,selectedFilter:C,attributes:i,applySettings:s,changeSelectedFilter:a,refreshVisibleLinks:v,filteredCategory:W,updateSelectedFeature:T,changeSelectedCategory:ne,colorScale:j}=gl(),F=g();function be(m){s(m),v(),T(),ke(()=>F.value.update())}function ve(m){a(m),v(),T(),ke(()=>F.value.update())}function pe(m){ne(m),v(),T(),ke(()=>F.value.update())}const X=g("");async function H(m,y=null){switch(m){case"links":h(t.links,null,y);break;case"rlinks":h(B.rlinks,null,y);break;case"nodes":h(t.nodes,null,y);break;case"rnodes":h(B.rnodes,null,y);break;case"od":h(z.layer,null,y);break;default:const w=await o.getOtherFile(m,"geojson"),D=await o.getOtherFile(m,"json");h(w,D,y);break}X.value=m,F.value.update()}const I=g(null),Z=Q(()=>o.availableLayers),G=Q(()=>o.visibleRasters),d=Q(()=>o.styles);async function p(m){I.value=m.name,Z.value.includes(m.layer)?await H(m.layer,m):o.changeNotification({text:L("Preset Layer does not exist"),autoClose:!0,color:"error"}),Object.keys(m).includes("selectedIndex")&&A(m.selectedIndex)&&(k(m.selectedIndex),o.changeNotification({})),F.value.update()}const K=g(),le=g("");async function Te(m){const y=m;if(le.value=I.value,await K.value.openDialog()){const D={name:ee.cloneDeep(le.value),layer:ee.cloneDeep(X.value),displaySettings:ee.cloneDeep(y),selectedFilter:ee.cloneDeep(C.value)};V.value.filter(Be=>W.value.includes(Be)).length<W.value.length&&(D.selectedCategory=ee.cloneDeep(V.value)),M.value.includes(y.selectedFeature)&&r.value&&(D.selectedIndex=ee.cloneDeep(R.value)),o.addStyle(D),G.value.includes(le.value)?o.changeNotification({text:L("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):o.changeNotification({text:L("Preset Saved"),autoClose:!0,color:"success"}),I.value=ee.cloneDeep(le.value)}}const Ne=g();async function je(m){const y=m.name;await Ne.value.openDialog()&&(o.deleteStyle(y),y===I.value&&(I.value=null),o.changeNotification({text:L("Preset deleted"),autoClose:!0,color:"success"}),y.value="")}const ae=g(!1),Me=g([]);function Oe(m){m.action==="featureClick"?(Me.value=m.feature,ae.value=!0):(k(m.feature.index),F.value.update())}return(m,y)=>(c(),N("section",El,[n(zl,{"selected-category":l(V),"selected-filter":l(C),"layer-choices":Z.value,"selected-layer":X.value,"filter-choices":l(i),"filtered-cat":l(W),"preset-choices":d.value,"selected-preset":I.value,onUpdateSelectedCategory:pe,onUpdateSelectedFilter:ve,onSelectLayer:H,onSelectPreset:p,onDeletePreset:je},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset"]),l(S).features?(c(),b(Cl,{ref_key:"mapRef",ref:F,key:l($)+String(l(e).extrusion),"selected-layer":X.value,"layer-type":l($),extrusion:l(e).extrusion,labels:l(e).labels,links:l(S),"nan-links":l(_),"selected-feature":l(e).selectedFeature,opacity:l(e).opacity,offset:l(e).offset,onSelectClick:Oe},{default:u(w=>[f("div",Al,[we(n(bl,{key:"result",order:0,"color-scale":l(j),"display-settings":l(e)},null,8,["color-scale","display-settings"]),[[Le,l(S).features.length>0]])]),f("div",Hl,[n(ql,{"display-settings":l(e),"feature-choices":l(i),type:l($),onSubmit:be,onSavePreset:Te},null,8,["display-settings","feature-choices","type"]),n(fl),d.value.length>0?(c(),b(kl,{key:0,choices:d.value,map:w.map,"available-layers":Z.value},null,8,["choices","map","available-layers"])):O("",!0)]),(c(!0),N(Y,null,J(d.value,D=>(c(),N("div",{key:D.name},[G.value.includes(D.name)&&Z.value.includes(D.layer)?(c(),b(xl,{key:0,preset:D,map:w.map,order:G.value.indexOf(D.name)+1,"visible-rasters":G.value},null,8,["preset","map","order","visible-rasters"])):O("",!0)]))),128))]),_:1},8,["selected-layer","layer-type","extrusion","labels","links","nan-links","selected-feature","opacity","offset"])):O("",!0),n(ml,{modelValue:ae.value,"onUpdate:modelValue":y[1]||(y[1]=w=>ae.value=w),scrollable:"",persistent:"","max-width":"300",onKeydown:[y[2]||(y[2]=ye(w=>ae.value=!1,["enter"])),y[3]||(y[3]=ye(w=>ae.value=!1,["esc"]))]},{default:u(()=>[n(_e,{"max-height":"60rem"},{default:u(()=>[n(yl,{class:"text-h5"},{default:u(()=>[P(x(l(L)("link Properties")),1)]),_:1}),n(Ue),n(hl,null,{default:u(()=>[n(Ce,null,{default:u(()=>[(c(!0),N(Y,null,J(Me.value,(w,D)=>(c(),b(ce,{key:D,"model-value":w,label:D,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),n(Ue),n(Re,null,{default:u(()=>[n(We),n(E,{color:"success",variant:"text",onClick:y[0]||(y[0]=w=>ae.value=!1)},{default:u(()=>[P(x(l(L)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(Ie,{ref_key:"presetDialog",ref:K,title:l(L)("Create or modify preset")},{default:u(()=>[n(ce,{modelValue:le.value,"onUpdate:modelValue":y[4]||(y[4]=w=>le.value=w),autofocus:"",rules:[w=>!!w||"Required."],label:l(L)("name")},null,8,["modelValue","rules","label"])]),_:1},8,["title"]),n(Ie,{ref_key:"deleteDialog",ref:Ne,title:l(L)("Delete %{name}?",{name:I.value}),"confirm-button":l(L)("Delete"),"confirm-color":"error"},null,8,["title","confirm-button"])]))}},Ql=he(Zl,[["__scopeId","data-v-56fac663"]]);export{Ql as default};
