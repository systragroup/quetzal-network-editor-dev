import{_ as H,ae as ee,af as K,ag as j,e as y,p as ae,r as A,ah as se,w as O,f as oe,g as s,h as V,i as a,j as o,ab as te,x as m,y as r,ai as v,q as f,l as R,v as E,U as ue,aj as re,F as P,E as N,ak as ie,al as de,am as ce,a1 as le,Z as pe,N as ve,an as fe,z as Y,a4 as me,ao as ye,a2 as ge,G as q,a3 as Ve,V as G,L as Z,ap as _e,t as he,C as be,A as ne,D as xe,J as X,B as Se,a9 as ke,u as we,Y as Le,X as Q,aq as Ce,ar as $e,as as Ue,at as M,au as W}from"./index-2mtIoOaI.js";const Ee={key:0,class:"info-div"},Fe={class:"expansion"},Re={key:0,class:"categorie-info"},Te={key:0,class:"custom-hint"},Ae=["onDblclick"],Pe=["onUpdate:modelValue"],Ie={__name:"ParamForm",setup(z){const{$gettext:u}=ee(),_=K(),n=j();function C(e,l){return Array.isArray(e)?e.includes(l):e===l}const I=y(()=>_.selectedStepFunction),p=y(()=>_.parameters.filter(e=>Object.keys(e).includes("category")&&C(e.model,I.value))),w=y(()=>{var l;let e=_.parameters.filter(k=>k==null?void 0:k.info);return e=e.filter(k=>C(k.model,I.value)),(l=e[0])==null?void 0:l.info}),L=y(()=>n.scenariosList),h=y(()=>n.scenario);function x(){for(const e of p.value)for(const l of e.params)if(l.items==="$scenarios"){const k=L.value.map(b=>b.scenario);Array.isArray(l.value)?l.value=l.value.filter(b=>k.includes(b)):l.value=k.includes(l.value)?l.value:""}}ae(()=>{x()});function S(e){return e.items==="$scenarios"?L.value.map(l=>l.scenario).filter(l=>l!==h.value):e.items}function B(){_.getParameters()}const $=A([...Array(p.value.length).keys()].map((e,l)=>l));function U(){$.value.length<p.value.length?$.value=[...Array(p.value.length).keys()].map((e,l)=>l):$.value=[]}const F={required:e=>e!=null||u("Required"),largerThanZero:e=>e>0||u("should be larger than 0"),nonNegative:e=>e>=0||u("should be larger or equal to 0")},T=A(!1),g=A(!1),c=se("editRef");function i(e,l){g.value=!0;const b=p.value.slice(0,e).map(D=>D.params.length).reduce((D,t)=>D+t,0)+l;_e(()=>c.value[b].focus())}return O(T,e=>{e||(g.value=!1)}),(e,l)=>{const k=oe("v-number-input");return s(),V(Z,{class:"card"},{default:a(()=>[o(te,{class:"subtitle"},{default:a(()=>[m(r(v(u)("Scenario Settings")),1)]),_:1}),w.value?(s(),f("div",Ee,r(w.value),1)):R("",!0),E("div",Fe,[o(ue,{ref:"form","lazy-validation":""},{default:a(()=>[o(re,{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=b=>$.value=b),multiple:""},{default:a(()=>[(s(!0),f(P,null,N(p.value,(b,D)=>(s(),V(ie,{key:D},{default:a(()=>[o(de,{class:"categorie"},{default:a(()=>[m(r(b.category),1)]),_:2},1024),o(ce,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:a(()=>[b.info?(s(),f("div",Re,r(b.info),1)):R("",!0),(s(!0),f(P,null,N(b.params,(t,J)=>(s(),f("li",{key:J,class:"param-list"},[typeof t.items>"u"&&typeof t.value=="boolean"?(s(),V(le,{key:0,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,color:"primary",density:"compact",class:"pl-2","hide-details":"",label:v(u)(t.text),"persistent-hint":T.value},null,8,["modelValue","onUpdate:modelValue","label","persistent-hint"])):t.type=="Number"?(s(),V(k,{key:1,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,variant:"outlined","control-variant":"stacked",type:t.type,label:v(u)(t.text),suffix:t.units,"hide-details":"",rules:t.rules.map(d=>F[d]),onKeydown:l[0]||(l[0]=d=>console.log(d))},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):typeof t.items>"u"?(s(),V(pe,{key:2,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,variant:"outlined","hide-details":"",type:t.type,label:v(u)(t.text),suffix:t.units,rules:t.rules.map(d=>F[d])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):(s(),V(ve,{key:3,modelValue:t.value,"onUpdate:modelValue":[d=>t.value=d,d=>x(t)],variant:"outlined","hide-details":"",type:t.type,multiple:t==null?void 0:t.multiple,items:S(t),label:v(u)(t.text),suffix:t.units,rules:t.rules.map(d=>F[d])},null,8,["modelValue","onUpdate:modelValue","type","multiple","items","label","suffix","rules"])),o(fe,null,{default:a(()=>[T.value?(s(),f("div",Te,[g.value?Y((s(),f("textarea",{key:1,ref_for:!0,ref:"editRef","onUpdate:modelValue":d=>t.hint=d,rows:"1",class:"edition",onKeydown:l[1]||(l[1]=me(d=>g.value=!1,["enter"]))},null,40,Pe)),[[ye,t.hint]]):(s(),f("div",{key:0,onDblclick:d=>i(D,J)},r(t.hint),41,Ae))])):R("",!0)]),_:2},1024)]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),o(ge,null,{default:a(()=>[o(q,{color:"grey",variant:"text",onClick:B},{default:a(()=>[m(r(v(u)("back to default")),1)]),_:1}),o(Ve),o(q,{variant:"text",onClick:U},{default:a(()=>[m(r($.value.length!=p.value.length?v(u)("Expand all"):v(u)("Collapse all")),1)]),_:1}),o(q,{icon:"",size:"small",onClick:l[3]||(l[3]=b=>T.value=!T.value)},{default:a(()=>[o(G,null,{default:a(()=>l[4]||(l[4]=[m("far fa-question-circle small")])),_:1})]),_:1})]),_:1})]),_:1})}}},De=H(Ie,[["__scopeId","data-v-7b8e7fdf"]]),Ne={style:{"white-space":"pre-line"}},qe={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(z){const u=z,{disabled:_}=he(u),n=K(),C=A(!1),I=y(()=>n.hasLogs),p=A([]);async function w(){await n.getLogs(),p.value=n.logs,p.value.sort((h,x)=>String(h.time).localeCompare(String(x.time),void 0,{sensitivity:"base"})),C.value=!0}async function L(){await n.downloadLogs()}return(h,x)=>(s(),f(P,null,[o(Se,{"close-delay":"100",transition:"slide-y-transition"},{activator:a(({props:S})=>[Y(o(q,be({disabled:v(_),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},S),{default:a(()=>x[1]||(x[1]=[m(" logs ")])),_:2},1040,["disabled"]),[[ne,I.value]])]),default:a(()=>[o(xe,null,{default:a(()=>[o(X,{onClick:w},{prepend:a(()=>[o(G,{icon:"fas fa-eye"})]),default:a(()=>[m(r(h.$gettext("show"))+" ",1)]),_:1}),o(X,{onClick:L},{prepend:a(()=>[o(G,{icon:"fas fa-download"})]),default:a(()=>[m(r(h.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),o(ke,{modelValue:C.value,"onUpdate:modelValue":x[0]||(x[0]=S=>C.value=S),width:"90%"},{default:a(()=>[o(Z,{style:{"overflow-y":"auto"}},{default:a(()=>[(s(!0),f(P,null,N(p.value,(S,B)=>(s(),f("div",{key:B,class:"log-container"},[E("h1",null,r(S.name),1),E("h3",null,[E("b",null,r(S.time),1)]),E("span",Ne,r(S.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},Be=H(qe,[["__scopeId","data-v-c531ebb9"]]),Oe={class:"title-container"},ze={class:"buttons-row ma-2"},Me={key:4},je={__name:"Run",setup(z){const{$gettext:u}=ee(),_=we(),n=K(),C=j(),I=y(()=>n.steps),p=y(()=>{const g=n.availableModels;return n.avalaibleStepFunctions.filter(c=>g.has(c))}),w=A(n.selectedStepFunction),L=y(()=>n.running),h=y(()=>n.currentStep),x=y(()=>n.error),S=y(()=>n.errorMessage),B=y(()=>n.synchronized),$=y(()=>C.protected),U=y(()=>C.model!==null),F=A(n.endSignal);O(F,()=>n.changeEndSignal(F.value)),ae(async()=>{U.value&&(await n.getSteps(),await n.GetRunningExecution())}),O(p,g=>{U.value&&(g.includes(w.value)||(n.setSelectedStepFunction(g[0]),n.getSteps()))},{once:!0}),O(w,async g=>{U.value&&(p.value.includes(g)?(n.setSelectedStepFunction(g),n.getSteps()):(w.value=p.value[0],n.setSelectedStepFunction(p.value[0]),n.getSteps()))});async function T(){if(await n.GetRunningExecution()){_.changeNotification({text:u("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const c=j();n.initExecution(),await _.exportToS3("inputs"),await _.deleteOutputsOnS3(),await _.deleteLogsOnS3(),_.deleteOutputs(),n.startExecution({scenario:c.scenario})}catch(c){n.terminateExecution(),console.log(c),_.changeAlert(c)}}return(g,c)=>(s(),V(Le,{class:"background"},{default:a(()=>[o(Q,{order:"1"},{default:a(()=>[o(De)]),_:1}),o(Q,{order:"2"},{default:a(()=>[o(Z,{class:"card"},{default:a(()=>[E("div",Oe,[o(te,{class:"subtitle"},{default:a(()=>[m(r(v(u)("Scenario Simulation")),1)]),_:1}),o(Be,{disabled:L.value||!U.value},null,8,["disabled"])]),o(Ce,{modelValue:h.value,"onUpdate:modelValue":c[4]||(c[4]=i=>h.value=i),class:"stepper"},{default:a(()=>[p.value.length>1?(s(),V($e,{key:0,modelValue:w.value,"onUpdate:modelValue":c[0]||(c[0]=i=>w.value=i),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:a(()=>[(s(!0),f(P,null,N(p.value,i=>(s(),V(Ue,{key:i,value:i,disabled:L.value||!U.value},{default:a(()=>[m(r(i),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):R("",!0),B.value?R("",!0):(s(),V(M,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:a(()=>[m(r(v(u)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),x.value?(s(),V(M,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[m(r(v(u)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(s(!0),f(P,null,N(Object.keys(S.value),i=>(s(),f("p",{key:i},[E("b",null,r(i)+": ",1),m(r(S.value[i]),1)]))),128))]),_:1})):R("",!0),$.value?(s(),V(M,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[m(r(v(u)("This scenario is protected. You can not run simulation.")),1)]),_:1})):R("",!0),E("div",ze,[o(q,{loading:L.value,disabled:L.value||$.value||!U.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:c[1]||(c[1]=i=>T())},{default:a(()=>[m(r(v(u)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),Y(o(q,{color:"grey",variant:"text",onClick:c[2]||(c[2]=i=>v(n).stopExecution())},{default:a(()=>[m(r(v(u)("Abort")),1)]),_:1},512),[[ne,L.value&&h.value!==1]]),o(le,{modelValue:F.value,"onUpdate:modelValue":c[3]||(c[3]=i=>F.value=i),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:a(()=>[E("span",null,r(v(u)("End signal")),1)]),_:1},8,["modelValue"])]),U.value?(s(),f("div",Me,[(s(!0),f(P,null,N(I.value,(i,e)=>(s(),f("div",{key:e+1},[x.value?(s(),V(W,{key:1,complete:h.value>e+1,title:i.name,value:e+1,step:e+1},null,8,["complete","title","value","step"])):(s(),V(W,{key:0,complete:h.value>e+1,color:h.value>=e+1?"primary":"regular",title:i.name,value:e+1,compact:"",step:e+1},null,8,["complete","color","title","value","step"]))]))),128))])):R("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},He=H(je,[["__scopeId","data-v-bdf210d1"]]);export{He as default};
