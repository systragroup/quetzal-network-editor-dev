import{_ as Y,ae as te,af as Z,ag as H,e as g,p as ae,r as A,w as O,f as oe,g as s,h as _,i as e,j as o,ab as le,x as m,y as i,ah as v,q as f,l as T,v as F,U as ue,ai as re,F as I,E as N,aj as ie,ak as de,al as ce,a1 as ne,Z as pe,N as ve,am as fe,z as J,a4 as me,an as ge,a2 as ye,G as q,a3 as Ve,V as K,L as X,ao as _e,t as he,C as Se,A as se,D as be,J as Q,B as xe,a9 as ke,u as we,Y as Ce,X as W,ap as $e,aq as Le,ar as Ue,as as G,at as ee}from"./index-DsDJomMW.js";const Ee={key:0,class:"info-div"},Fe={class:"expansion"},Re={key:0,class:"categorie-info"},Te={key:0,class:"custom-hint"},Ae=["onDblclick"],Pe=["onUpdate:modelValue"],Ie={__name:"ParamForm",setup(z){const{$gettext:u}=te(),h=Z(),l=H();function L(n,t){return Array.isArray(n)?n.includes(t):n===t}const D=g(()=>h.selectedStepFunction),p=g(()=>h.parameters.filter(n=>Object.keys(n).includes("category")&&L(n.model,D.value))),w=g(()=>{var t;let n=h.parameters.filter(V=>V==null?void 0:V.info);return n=n.filter(V=>L(V.model,D.value)),(t=n[0])==null?void 0:t.info}),C=g(()=>l.scenariosList),S=g(()=>l.scenario);function x(){for(const n of p.value)for(const t of n.params)if(t.items==="$scenarios"){const V=C.value.map(b=>b.scenario);Array.isArray(t.value)?t.value=t.value.filter(b=>V.includes(b)):t.value=V.includes(t.value)?t.value:""}}ae(()=>{x()});function k(n){return n.items==="$scenarios"?C.value.map(t=>t.scenario).filter(t=>t!==S.value):n.items}function B(){h.getParameters()}const U=A([...Array(p.value.length).keys()].map((n,t)=>t));function E(){U.value.length<p.value.length?U.value=[...Array(p.value.length).keys()].map((n,t)=>t):U.value=[]}const R={required:n=>n!=null||u("Required"),largerThanZero:n=>n>0||u("should be larger than 0"),nonNegative:n=>n>=0||u("should be larger or equal to 0")},P=A(!1),y=A(!1),d=A({}),c=(n,t,V)=>{if(n){const b=String(t)+String(V);d.value[b]=n}};function $(n,t){y.value=!0;const V=String(n)+String(t);_e(()=>d.value[V].focus())}return O(P,n=>{n||(y.value=!1)}),(n,t)=>{const V=oe("v-number-input");return s(),_(X,{class:"card"},{default:e(()=>[o(le,{class:"subtitle"},{default:e(()=>[m(i(v(u)("Scenario Settings")),1)]),_:1}),w.value?(s(),f("div",Ee,i(w.value),1)):T("",!0),F("div",Fe,[o(ue,{ref:"form","lazy-validation":""},{default:e(()=>[o(re,{modelValue:U.value,"onUpdate:modelValue":t[2]||(t[2]=b=>U.value=b),multiple:""},{default:e(()=>[(s(!0),f(I,null,N(p.value,(b,M)=>(s(),_(ie,{key:M},{default:e(()=>[o(de,{class:"categorie"},{default:e(()=>[m(i(b.category),1)]),_:2},1024),o(ce,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:e(()=>[b.info?(s(),f("div",Re,i(b.info),1)):T("",!0),(s(!0),f(I,null,N(b.params,(a,j)=>(s(),f("li",{key:j,class:"param-list"},[typeof a.items>"u"&&typeof a.value=="boolean"?(s(),_(ne,{key:0,modelValue:a.value,"onUpdate:modelValue":r=>a.value=r,color:"primary",density:"compact",class:"pl-2","hide-details":"",label:v(u)(a.text),"persistent-hint":P.value},null,8,["modelValue","onUpdate:modelValue","label","persistent-hint"])):a.type=="Number"?(s(),_(V,{key:1,modelValue:a.value,"onUpdate:modelValue":r=>a.value=r,variant:"outlined","control-variant":"stacked",type:a.type,label:v(u)(a.text),suffix:a.units,"hide-details":"",rules:a.rules.map(r=>R[r]),onKeydown:t[0]||(t[0]=r=>console.log(r))},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):typeof a.items>"u"?(s(),_(pe,{key:2,modelValue:a.value,"onUpdate:modelValue":r=>a.value=r,variant:"outlined","hide-details":"",type:a.type,label:v(u)(a.text),suffix:a.units,rules:a.rules.map(r=>R[r])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):(s(),_(ve,{key:3,modelValue:a.value,"onUpdate:modelValue":[r=>a.value=r,r=>x(a)],variant:"outlined","hide-details":"",type:a.type,multiple:a==null?void 0:a.multiple,items:k(a),label:v(u)(a.text),suffix:a.units,rules:a.rules.map(r=>R[r])},null,8,["modelValue","onUpdate:modelValue","type","multiple","items","label","suffix","rules"])),o(fe,null,{default:e(()=>[P.value?(s(),f("div",Te,[y.value?J((s(),f("textarea",{key:1,ref_for:!0,ref:r=>c(r,M,j),"onUpdate:modelValue":r=>a.hint=r,rows:"1",class:"edition",onKeydown:t[1]||(t[1]=me(r=>y.value=!1,["enter"]))},null,40,Pe)),[[ge,a.hint]]):(s(),f("div",{key:0,onDblclick:r=>$(M,j)},i(a.hint),41,Ae))])):T("",!0)]),_:2},1024)]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),o(ye,null,{default:e(()=>[o(q,{color:"grey",variant:"text",onClick:B},{default:e(()=>[m(i(v(u)("back to default")),1)]),_:1}),o(Ve),o(q,{variant:"text",onClick:E},{default:e(()=>[m(i(U.value.length!=p.value.length?v(u)("Expand all"):v(u)("Collapse all")),1)]),_:1}),o(q,{icon:"",size:"small",onClick:t[3]||(t[3]=b=>P.value=!P.value)},{default:e(()=>[o(K,null,{default:e(()=>t[4]||(t[4]=[m("far fa-question-circle small")])),_:1})]),_:1})]),_:1})]),_:1})}}},De=Y(Ie,[["__scopeId","data-v-5d579405"]]),Ne={style:{"white-space":"pre-line"}},qe={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(z){const u=z,{disabled:h}=he(u),l=Z(),L=A(!1),D=g(()=>l.hasLogs),p=A([]);async function w(){await l.getLogs(),p.value=l.logs,p.value.sort((S,x)=>String(S.time).localeCompare(String(x.time),void 0,{sensitivity:"base"})),L.value=!0}async function C(){await l.downloadLogs()}return(S,x)=>(s(),f(I,null,[o(xe,{"close-delay":"100",transition:"slide-y-transition"},{activator:e(({props:k})=>[J(o(q,Se({disabled:v(h),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},k),{default:e(()=>x[1]||(x[1]=[m(" logs ")])),_:2},1040,["disabled"]),[[se,D.value]])]),default:e(()=>[o(be,null,{default:e(()=>[o(Q,{onClick:w},{prepend:e(()=>[o(K,{icon:"fas fa-eye"})]),default:e(()=>[m(i(S.$gettext("show"))+" ",1)]),_:1}),o(Q,{onClick:C},{prepend:e(()=>[o(K,{icon:"fas fa-download"})]),default:e(()=>[m(i(S.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),o(ke,{modelValue:L.value,"onUpdate:modelValue":x[0]||(x[0]=k=>L.value=k),width:"90%"},{default:e(()=>[o(X,{style:{"overflow-y":"auto"}},{default:e(()=>[(s(!0),f(I,null,N(p.value,(k,B)=>(s(),f("div",{key:B,class:"log-container"},[F("h1",null,i(k.name),1),F("h3",null,[F("b",null,i(k.time),1)]),F("span",Ne,i(k.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},Be=Y(qe,[["__scopeId","data-v-c531ebb9"]]),Oe={class:"title-container"},ze={class:"buttons-row ma-2"},Me={key:4},je={__name:"Run",setup(z){const{$gettext:u}=te(),h=we(),l=Z(),L=H(),D=g(()=>l.steps),p=g(()=>{const y=l.availableModels;return l.avalaibleStepFunctions.filter(d=>y.has(d))}),w=A(l.selectedStepFunction),C=g(()=>l.running),S=g(()=>l.currentStep),x=g(()=>l.error),k=g(()=>l.errorMessage),B=g(()=>l.synchronized),U=g(()=>L.protected),E=g(()=>L.model!==null),R=A(l.endSignal);O(R,()=>l.changeEndSignal(R.value)),ae(async()=>{E.value&&(await l.getSteps(),await l.GetRunningExecution())}),O(p,y=>{E.value&&(y.includes(w.value)||(l.setSelectedStepFunction(y[0]),l.getSteps()))},{once:!0}),O(w,async y=>{E.value&&(p.value.includes(y)?(l.setSelectedStepFunction(y),l.getSteps()):(w.value=p.value[0],l.setSelectedStepFunction(p.value[0]),l.getSteps()))});async function P(){if(await l.GetRunningExecution()){h.changeNotification({text:u("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const d=H();l.initExecution(),await h.exportToS3("inputs"),await h.deleteOutputsOnS3(),await h.deleteLogsOnS3(),h.deleteOutputs(),l.startExecution({scenario:d.scenario})}catch(d){l.terminateExecution(),console.log(d),h.changeAlert(d)}}return(y,d)=>(s(),_(Ce,{class:"background"},{default:e(()=>[o(W,{order:"1"},{default:e(()=>[o(De)]),_:1}),o(W,{order:"2"},{default:e(()=>[o(X,{class:"card"},{default:e(()=>[F("div",Oe,[o(le,{class:"subtitle"},{default:e(()=>[m(i(v(u)("Scenario Simulation")),1)]),_:1}),o(Be,{disabled:C.value||!E.value},null,8,["disabled"])]),o($e,{modelValue:S.value,"onUpdate:modelValue":d[4]||(d[4]=c=>S.value=c),class:"stepper"},{default:e(()=>[p.value.length>1?(s(),_(Le,{key:0,modelValue:w.value,"onUpdate:modelValue":d[0]||(d[0]=c=>w.value=c),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:e(()=>[(s(!0),f(I,null,N(p.value,c=>(s(),_(Ue,{key:c,value:c,disabled:C.value||!E.value},{default:e(()=>[m(i(c),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):T("",!0),B.value?T("",!0):(s(),_(G,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:e(()=>[m(i(v(u)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),x.value?(s(),_(G,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:e(()=>[m(i(v(u)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(s(!0),f(I,null,N(Object.keys(k.value),c=>(s(),f("p",{key:c},[F("b",null,i(c)+": ",1),m(i(k.value[c]),1)]))),128))]),_:1})):T("",!0),U.value?(s(),_(G,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:e(()=>[m(i(v(u)("This scenario is protected. You can not run simulation.")),1)]),_:1})):T("",!0),F("div",ze,[o(q,{loading:C.value,disabled:C.value||U.value||!E.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:d[1]||(d[1]=c=>P())},{default:e(()=>[m(i(v(u)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),J(o(q,{color:"grey",variant:"text",onClick:d[2]||(d[2]=c=>v(l).stopExecution())},{default:e(()=>[m(i(v(u)("Abort")),1)]),_:1},512),[[se,C.value&&S.value!==1]]),o(ne,{modelValue:R.value,"onUpdate:modelValue":d[3]||(d[3]=c=>R.value=c),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:e(()=>[F("span",null,i(v(u)("End signal")),1)]),_:1},8,["modelValue"])]),E.value?(s(),f("div",Me,[(s(!0),f(I,null,N(D.value,(c,$)=>(s(),f("div",{key:$+1},[x.value?(s(),_(ee,{key:1,complete:S.value>$+1,title:c.name,value:$+1,step:$+1},null,8,["complete","title","value","step"])):(s(),_(ee,{key:0,complete:S.value>$+1,color:S.value>=$+1?"primary":"regular",title:c.name,value:$+1,compact:"",step:$+1},null,8,["complete","color","title","value","step"]))]))),128))])):T("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},He=Y(je,[["__scopeId","data-v-bdf210d1"]]);export{He as default};
