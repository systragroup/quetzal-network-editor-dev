import{_ as L,ae as M,af as B,j as c,a7 as F,a8 as I,o,f,w as l,g as u,n as p,t as m,ab as j,ad as D,i as V,l as q,ag as Y,k as S,z as b,ah as Z,ai as G,aj as Q,F as k,X,S as J,G as R,O as K,A as w,Z as W,V as N,Y as $,E as O,u as ee,ak as te,al as ne,r as ae,R as le,Q as A,am as re,an as oe,ao as se,ap as H,p as ie,v as ue,P as de,aq as z}from"./index-37a7d13b.js";const T=a=>a,ce={name:"Settings",setup(){const a=M(),n=B(),g=c(()=>a.selectedStepFunction),e=c(()=>a.parameters),y=c(()=>e.value.filter(r=>Object.keys(r).includes("category")&&r.model===g.value)),h=c(()=>{var r;return(r=e.value.filter(v=>((v==null?void 0:v.info)&&(v==null?void 0:v.model))===g.value)[0])==null?void 0:r.info}),d=F([]);I(()=>{d.value=[...Array(y.value.length).keys()].map((r,v)=>v)});const s=c(()=>n.scenariosList),t=c(()=>n.scenario);function x(){a.getParameters({model:n.model,path:n.scenario+"/inputs/params.json"})}function i(){d.value.length<y.value.length?d.value=[...Array(y.value.length).keys()].map((r,v)=>v):d.value=[]}const C=F(null),P=F(!1),_={required:r=>r!=null||T("Required"),largerThanZero:r=>r>0||T("should be larger than 0"),nonNegative:r=>r>=0||T("should be larger or equal to 0")};function U(r){const v=s.value.map(E=>E.scenario);r.value=r.value.filter(E=>v.includes(E))}return{selectedStepFunction:g,paramsBrute:e,errorMessage:C,showHint:P,panel:d,parameters:y,info:h,rules:_,scenariosList:s,activeScenario:t,reset:x,expandAll:i,removeDeletedScenarios:U}}},fe={class:"expansion"};function pe(a,n,g,e,y,h){return o(),f(O,{class:"card"},{default:l(()=>[u(j,{class:"subtitle"},{default:l(()=>[p(m(a.$gettext("Scenario Settings")),1)]),_:1}),e.info?(o(),f(D,{key:0,class:"info-div"},{default:l(()=>[p(m(e.info),1)]),_:1})):V("",!0),q("div",fe,[u(K,{ref:"form","lazy-validation":""},{default:l(()=>[u(Y,{modelValue:e.panel,"onUpdate:modelValue":n[0]||(n[0]=d=>e.panel=d),multiple:""},{default:l(()=>[(o(!0),S(k,null,b(e.parameters,(d,s)=>(o(),f(Z,{key:s},{default:l(()=>[u(G,{class:"categorie"},{default:l(()=>[p(m(d.category),1)]),_:2},1024),u(Q,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:l(()=>[(o(!0),S(k,null,b(d.params,(t,x)=>(o(),S("li",{key:x},[typeof t.items>"u"&&typeof t.value=="boolean"?(o(),f(X,{key:0,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,label:a.$gettext(t.text),hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint"])):typeof t.items>"u"?(o(),f(J,{key:1,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,variant:"underlined",type:t.type,label:a.$gettext(t.text),suffix:t.units,hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint,rules:t.rules.map(i=>e.rules[i])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint","rules"])):t.items==="$scenarios"?(o(),f(R,{key:2,modelValue:t.value,"onUpdate:modelValue":[i=>t.value=i,i=>e.removeDeletedScenarios(t)],variant:"underlined",type:t.type,items:e.scenariosList.map(i=>i.scenario).filter(i=>i!==e.activeScenario),multiple:"",label:a.$gettext(t.text),suffix:t.units,hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint,rules:t.rules.map(i=>e.rules[i])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"])):(o(),f(R,{key:3,modelValue:t.value,"onUpdate:modelValue":i=>t.value=i,variant:"underlined",type:t.type,items:t.items,label:a.$gettext(t.text),suffix:t.units,hint:e.showHint?a.$gettext(t.hint):"","persistent-hint":e.showHint,rules:t.rules.map(i=>e.rules[i])},null,8,["modelValue","onUpdate:modelValue","type","items","label","suffix","hint","persistent-hint","rules"]))]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),u($,null,{default:l(()=>[u(w,{color:"grey",variant:"text",onClick:e.reset},{default:l(()=>[p(m(a.$gettext("back to default")),1)]),_:1},8,["onClick"]),u(W),u(w,{variant:"text",onClick:e.expandAll},{default:l(()=>[p(m(e.panel.length!=e.parameters.length?a.$gettext("Expand all"):a.$gettext("Collapse all")),1)]),_:1},8,["onClick"]),u(w,{icon:"",size:"small",onClick:n[1]||(n[1]=d=>e.showHint=!e.showHint)},{default:l(()=>[u(N,null,{default:l(()=>[p("far fa-question-circle small")]),_:1})]),_:1})]),_:1})]),_:1})}const ve=L(ce,[["render",pe],["__scopeId","data-v-8781a814"]]);const me={name:"Run",components:{ParamForm:ve},setup(){const a=ee(),n=M(),g=B(),e=F(""),y=c(()=>n.steps),h=c(()=>{const r=n.availableModels;return n.avalaibleStepFunctions.filter(v=>r.has(v))}),d=c(()=>n.selectedStepFunction),s=c(()=>n.running),t=c(()=>n.currentStep),x=c(()=>n.error),i=c(()=>n.errorMessage),C=c(()=>n.synchronized),P=c(()=>g.protected),_=c(()=>g.model!==null);I(()=>{e.value=te(d.value)}),I(async()=>{_.value&&await n.getSteps()}),ne(e,async r=>{_.value&&(h.value.includes(r)?(console.log(r),n.setSelectedStepFunction(r),n.getSteps()):(e.value=h.value[0],n.setSelectedStepFunction(h.value[0]),n.getSteps()))});async function U(){try{n.initExecution(),await a.exportToS3("inputs"),await a.deleteOutputsOnS3(),n.startExecution({scenario:g.scenario})}catch(r){n.terminateExecution(),console.log(r),a.changeAlert(r)}}return{stepFunction:e,store:a,runStore:n,userStore:g,steps:y,avalaibleStepFunctions:h,selectedStepFunction:d,running:s,currentStep:t,error:x,errorMessage:i,synchronized:C,isProtected:P,modelIsLoaded:_,run:U}}},ge={key:4};function ye(a,n,g,e,y,h){const d=ae("ParamForm");return o(),f(le,{class:"background"},{default:l(()=>[u(A,{order:"1"},{default:l(()=>[u(d)]),_:1}),u(A,{order:"2"},{default:l(()=>[u(O,{class:"card"},{default:l(()=>[u(j,{class:"subtitle"},{default:l(()=>[p(m(a.$gettext("Scenario Simulation")),1)]),_:1}),u(re,{modelValue:e.currentStep,"onUpdate:modelValue":n[3]||(n[3]=s=>e.currentStep=s),class:"stepper"},{default:l(()=>[e.avalaibleStepFunctions.length>1?(o(),f(oe,{key:0,modelValue:e.stepFunction,"onUpdate:modelValue":n[0]||(n[0]=s=>e.stepFunction=s),"show-arrows":"","fixed-tabs":""},{default:l(()=>[(o(!0),S(k,null,b(e.avalaibleStepFunctions,s=>(o(),f(se,{key:s,value:s,disabled:e.running||!e.modelIsLoaded},{default:l(()=>[p(m(s),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):V("",!0),e.synchronized?V("",!0):(o(),f(H,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:l(()=>[p(m(a.$gettext("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),e.error?(o(),f(H,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:l(()=>[p(m(a.$gettext("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(o(!0),S(k,null,b(Object.keys(e.errorMessage),s=>(o(),S("p",{key:s},[q("b",null,m(s)+": ",1),p(m(e.errorMessage[s]),1)]))),128))]),_:1})):V("",!0),e.isProtected?(o(),f(H,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:l(()=>[p(m(a.$gettext("This scenario is protected. You can not run simulation.")),1)]),_:1})):V("",!0),u(w,{loading:e.running,disabled:e.running||e.isProtected||!e.modelIsLoaded,color:"success",onClick:n[1]||(n[1]=s=>e.run())},{default:l(()=>[u(N,{size:"small",style:{"margin-right":"10px"}},{default:l(()=>[p(" fa-solid fa-play ")]),_:1}),p(" "+m(a.$gettext("Run Simulation")),1)]),_:1},8,["loading","disabled"]),ie(u(w,{color:"grey",variant:"text",onClick:n[2]||(n[2]=s=>e.runStore.stopExecution())},{default:l(()=>[p(m(a.$gettext("Abort Simulation")),1)]),_:1},512),[[ue,e.running&&e.currentStep!==1]]),e.modelIsLoaded?(o(),S("div",ge,[(o(!0),S(k,null,b(e.steps,(s,t)=>(o(),f(de,{key:t+1},{default:l(()=>[e.error?(o(),f(z,{key:1,complete:e.currentStep>t+1,title:s.name,value:t+1,step:t+1},null,8,["complete","title","value","step"])):(o(),f(z,{key:0,complete:e.currentStep>t+1,color:e.currentStep>=t+1?"primary":"regular",title:s.name,value:t+1,step:t+1},null,8,["complete","color","title","value","step"]))]),_:2},1024))),128))])):V("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const Se=L(me,[["render",ye],["__scopeId","data-v-70fbfecf"]]);export{Se as default};
