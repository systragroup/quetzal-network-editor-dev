import{_ as ie,M as Ee,a as Ke,b as Ae,c as Ge,d as Je,u as re,r as V,s as Qe,e as U,w as T,o as Xe,t as ge,f as _,g as r,h as k,i as o,j as s,k as Ye,l as F,m as Me,n as $e,p as et,q as L,v as h,x as w,y as v,V as B,z as Ce,A as we,B as be,C as j,D as Se,F as z,E as I,G as M,H as ze,I as Pe,J as ae,K as De,L as $,N as se,O as tt,P as lt,Q as at,T as st,R as nt,S as ke,U as Ie,W as Ue,X as Y,Y as Ne,Z as ee,$ as ot,a0 as it,a1 as Q,a2 as ne,a3 as oe,a4 as O,a5 as rt,a6 as ut,a7 as dt,a8 as fe,a9 as q,aa as he,ab as _e,ac as Fe}from"./index-PvOg4A-m.js";import{c as He,M as ct,S as mt,u as yt}from"./StaticLayer-FpTkDqeG.js";import pt from"./LayerSelector-atGLg9j0.js";const vt="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",ft=n=>n,ht={name:"ResultMap",components:{MglMap:Ee,MglNavigationControl:Ke,MglScaleControl:Ae,MglGeojsonLayer:Ge,MglImageLayer:Je},props:["selectedFeature","layerType","extrusion","links","nanLinks","opacity","offset"],emits:["selectClick"],setup(n,l){const y=re(),e=V(!1),t=vt,i=Qe(null),a=V({nodes:14,links:2}),m=U(()=>y.mapStyle);T(m,u=>{i.value&&(i.value.getLayer("arrow")&&i.value.removeLayer("arrow"),i.value.getLayer("links")&&i.value.removeLayer("links"),i.value.getLayer("zones")&&i.value.removeLayer("zones"),i.value.getLayer("nodes")&&i.value.removeLayer("nodes"),e.value=!1,S())}),Xe(()=>{var u;i.value&&S(),(u=i.value)!=null&&u.getLayer("arrow")&&i.value.removeLayer("arrow")});function S(){const u=i.value.getCenter();y.saveMapPosition({mapCenter:[u.lng,u.lat],mapZoom:i.value.getZoom()})}function P(u){i.value&&(e.value=!1);const b=new Me.LngLatBounds;["Polygon"].includes(x.value)?g.value.features.forEach(C=>{try{C.geometry.type==="Polygon"?b.extend([C.geometry.coordinates[0][0],C.geometry.coordinates[0][C.geometry.coordinates.length-1]]):b.extend([C.geometry.coordinates[0][0][0],C.geometry.coordinates[0][0][C.geometry.coordinates.length-1]])}catch{}}):g.value.features.forEach(C=>{b.extend([C.geometry.coordinates[0],C.geometry.coordinates[C.geometry.coordinates.length-1]])}),Object.keys(b).length!==0&&u.map.fitBounds(b,{padding:100}),u.map.loadImage($e,function(C,K){if(C){console.error("err image",C);return}u.map.addImage("arrow",K,{sdf:!0})}),i.value=u.map,D.value?y.changeNotification({text:ft("Right click and drag to tilt the map"),autoClose:!0,color:"success"}):u.map.dragRotate.disable(),e.value=!0}const f=V([]),N=V(null),{selectedFeature:p,layerType:x,extrusion:D,links:g,nanLinks:H,opacity:ue,offset:W}=ge(n);T(g,()=>{var u;e.value&&(i.value.getSource("results").setData(g.value),(u=i.value.getSource("NaNresults"))==null||u.setData(H.value))},{deep:!0});const Z=U(()=>W.value?-1:1);function te(u){var b;if(u.map.getCanvas().style.cursor="pointer",f.value=u.mapboxEvent.features,(b=N.value)!=null&&b.isOpen()&&N.value.remove(),p.value&&x.value!=="Polygon"){const C=f.value[0].properties[p.value];C&&(N.value=new Me.Popup({closeButton:!1}).setLngLat([u.mapboxEvent.lngLat.lng,u.mapboxEvent.lngLat.lat]).setHTML(`${p.value}: <br> ${C}`).addTo(u.map))}}function le(u){var b;f.value=[],(b=N.value)!=null&&b.isOpen()&&N.value.remove(),u.map.getCanvas().style.cursor=""}function de(u){var b;f.value=u.mapboxEvent.features,((b=f.value)==null?void 0:b.length)>0&&l.emit("selectClick",{feature:f.value[0].properties,action:"featureClick"})}function ce(u){var b;f.value=u.mapboxEvent.features,((b=f.value)==null?void 0:b.length)>0&&l.emit("selectClick",{feature:f.value[0].properties,action:"zoneClick"})}function me(u){u.map.getCanvas().style.cursor="pointer"}function E(u){u.map.getCanvas().style.cursor=""}return{store:y,mapIsLoaded:e,mapboxPublicKey:t,minZoom:a,map:i,mapStyle:m,onMapLoaded:P,layerType:x,extrusion:D,links:g,nanLinks:H,opacity:ue,offset:W,offsetValue:Z,enterLink:te,leaveLink:le,selectClick:de,zoneClick:ce,zoneHover:me,zoneLeave:E}}};function gt(n,l,y,e,t,i){const a=_("MglScaleControl"),m=_("MglNavigationControl"),S=_("MglGeojsonLayer"),P=_("MglImageLayer"),f=_("MglMap");return r(),k(f,{key:e.mapStyle,style:{width:"100%"},"access-token":e.mapboxPublicKey,"map-style":e.mapStyle,center:e.store.mapCenter,zoom:e.store.mapZoom,onLoad:e.onMapLoaded},{default:o(()=>[s(a,{position:"bottom-right"}),s(m,{position:"bottom-right"}),Ye(n.$slots,"default",{map:e.map,mapIsLoaded:e.mapIsLoaded}),e.layerType=="LineString"?(r(),k(S,{key:0,"source-id":"results",reactive:!1,source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:e.minZoom.links,paint:{"line-color":["get","display_color"],"line-offset":["*",e.offsetValue*.5,["to-number",["get","display_width"]]],"line-opacity":e.opacity/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:e.enterLink,onMouseleave:e.leaveLink,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):F("",!0),e.layerType=="Point"?(r(),k(S,{key:1,reactive:!1,"source-id":"results",source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:e.minZoom.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":e.opacity/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:e.enterLink,onMouseleave:e.leaveLink,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):F("",!0),e.layerType=="LineString"?(r(),k(P,{key:2,"source-id":"results",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:e.minZoom.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[e.offsetValue*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":e.opacity/100}}},null,8,["layer"])):F("",!0),e.layerType==="Polygon"&&e.extrusion?(r(),k(S,{key:3,"source-id":"results",reactive:!1,source:{type:"geojson",data:e.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":e.opacity/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):F("",!0),e.layerType==="Polygon"&&!e.extrusion?(r(),k(S,{key:4,reactive:!1,"source-id":"results",source:{type:"geojson",data:e.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":e.opacity/100}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):F("",!0),e.layerType==="Polygon"&&!e.extrusion?(r(),k(S,{key:5,reactive:!1,"source-id":"NaNresults",source:{type:"geojson",data:e.nanLinks,promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):F("",!0)]),_:3},8,["access-token","map-style","center","zoom","onLoad"])}const bt=ie(ht,[["render",gt]]),St={name:"SidePanel",components:{},props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],emits:["update-selectedCategory","select-layer","select-preset","delete-preset","update-selectedFilter"],setup(n,l){const y=re(),e=U(()=>y.windowHeight),t=U(()=>y.showLeftPanel),i=V(!0);T(t,g=>{g?setTimeout(()=>{i.value=!0},500):i.value=!1});const a=V(!1),m=V(!1),{selectedCategory:S,filteredCat:P}=ge(n),f=V([]);T(S,(g,H)=>{g!==H&&(f.value=g)}),T(f,g=>{g!==S.value&&l.emit("update-selectedCategory",g)});function N(g){f.value=g.selectedCategory}function p(){f.value.length===P.value.length?f.value=[]:f.value=P.value}const{selectedFilter:x}=ge(n),D=V("");return T(x,g=>{g!==D.value&&(D.value=g)}),T(D,(g,H)=>{g!==x.value&&(l.emit("update-selectedFilter",g),f.value=S.value)}),et(()=>{D.value=x.value,f.value=S.value,l.emit("update-selectedFilter",x.value),l.emit("update-selectedCategory",S.value)}),{store:y,showLeftPanel:t,showLeftPanelContent:i,windowHeight:e,openMenu:a,presetsMenu:m,selectedCat:f,vmodelSelectedFilter:D,init:N,showAll:p}}},kt={class:"left-panel-content"},Ct={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},wt={class:"preset"},xt={class:"title-div"},Vt={class:"custom-title"},Lt={class:"crop"},Mt={class:"layer"},Pt={class:"title-div"},Dt={class:"custom-title"},Nt={class:"crop"},_t={class:"item"};function Ft(n,l,y,e,t,i){return r(),L("section",{class:nt(e.showLeftPanel?"left-panel elevation-4":"left-panel-close"),style:ke({width:e.showLeftPanel?"350px":"0px"})},[h("div",{class:"left-panel-toggle-btn elevation-4",onClick:l[0]||(l[0]=a=>e.store.changeLeftPanel())},[s(B,{size:"small",color:"secondarydark"},{default:o(()=>[w(v(e.showLeftPanel?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),s(st,{name:"fade"},{default:o(()=>[Ce(h("div",kt,[h("div",null,[h("div",Ct,[h("div",wt,[s(B,{style:{color:"white","padding-right":"2rem","padding-left":"1rem"}},{default:o(()=>[w(" fas fa-sliders-h ")]),_:1}),s(be,{modelValue:e.presetsMenu,"onUpdate:modelValue":l[1]||(l[1]=a=>e.presetsMenu=a),"close-delay":"100",location:"bottom center",transition:"slide-y-transition"},{activator:o(({props:a})=>[h("div",j({class:"menu-container"},a),[h("div",xt,[h("span",Vt,v(n.$gettext("Presets")),1),h("span",Lt,v(y.selectedPreset),1)]),s(B,{variant:"text",style:{color:"white"}},{default:o(()=>[w(v(e.presetsMenu?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)]),default:o(()=>[s(Se,null,{default:o(()=>[(r(!0),L(z,null,I(y.presetChoices,(a,m)=>(r(),k(ae,{key:m,link:"",onClick:()=>n.$emit("select-preset",a)},{append:o(()=>[s(M,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:ze(()=>n.$emit("delete-preset",a),["stop"])},null,8,["onClick"])]),default:o(()=>[s(Pe,null,{default:o(()=>[w(v(a.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(De,{location:"bottom","open-delay":"300"},{activator:o(({props:a})=>[s(M,j({variant:"text"},a,{disabled:y.presetChoices.length===0,style:{color:"white"},icon:"fas fa-download",onClick:l[2]||(l[2]=m=>e.store.exportFile("styles.json"))}),null,16,["disabled"])]),default:o(()=>[h("span",null,v(n.$gettext("Dowload presets")),1)]),_:1})]),h("div",Mt,[s(De,{location:"bottom","open-delay":"500"},{activator:o(({props:a})=>[s(M,j({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:e.selectedCat.length==y.filteredCat.length?"fa-eye-slash fa":"fa-eye fa",variant:"text"},a,{onClick:l[3]||(l[3]=m=>e.showAll())}),null,16,["icon"])]),default:o(()=>[h("span",null,v(e.selectedCat.length==y.filteredCat.length?n.$gettext("Hide All"):n.$gettext("Show All")),1)]),_:1}),s(be,{modelValue:e.openMenu,"onUpdate:modelValue":l[4]||(l[4]=a=>e.openMenu=a),"close-delay":"100",transition:"slide-y-transition"},{activator:o(({props:a})=>[h("div",j({class:"title-div"},a),[h("div",j({class:"menu-container"},a),[h("div",Pt,[h("span",Dt,v(n.$gettext("Layer")),1),h("span",Nt,v(y.selectedLayer),1)]),s(B,{variant:"text",style:{color:"white"}},{default:o(()=>[w(v(e.openMenu?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)],16)]),default:o(()=>[s(Se,null,{default:o(()=>[(r(!0),L(z,null,I(y.layerChoices,(a,m)=>(r(),k(ae,{key:m,link:"",onClick:()=>n.$emit("select-layer",a)},{default:o(()=>[s(Pe,null,{default:o(()=>[w(v(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),s(B)]),s($,{"max-width":"100%","min-width":"100%",height:e.windowHeight-180,class:"mx-auto scrollable"},{default:o(()=>[s(ae,null,{default:o(()=>[s(se,{modelValue:e.vmodelSelectedFilter,"onUpdate:modelValue":l[5]||(l[5]=a=>e.vmodelSelectedFilter=a),items:y.filterChoices,variant:"underlined","prepend-icon":"fas fa-filter",label:n.$gettext("filter"),color:"secondarydark"},null,8,["modelValue","items","label"])]),_:1}),s(tt,{items:y.filteredCat,"item-height":45,height:e.windowHeight-270},{default:o(({item:a})=>[(r(),L("div",{key:e.vmodelSelectedFilter.concat(a),class:"container"},[s(lt,null,{default:o(()=>[s(at,{modelValue:e.selectedCat,"onUpdate:modelValue":l[6]||(l[6]=m=>e.selectedCat=m),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:a},null,8,["modelValue","value"])]),_:2},1024),h("div",_t,v(a),1)]))]),_:1},8,["items","height"])]),_:1},8,["height"])])])],512),[[we,e.showLeftPanelContent]])]),_:1})],6)}const Ht=ie(St,[["render",Ft],["__scopeId","data-v-45d920b7"]]),c=n=>n,zt={name:"ResultsSettings",props:["displaySettings","featureChoices","type"],emits:["submit","save-preset"],setup(){const n=re();return{windowHeight:U(()=>n.windowHeight-100)}},data(){return{showDialog:!1,parameters:[{name:c("selectedFeature"),type:"String",value:this.displaySettings.selectedFeature,units:"",hint:c("selectedFeature")},{name:c("minWidth"),type:"Number",value:this.displaySettings.minWidth,units:"a.u.",hint:c("minWidth")},{name:c("maxWidth"),type:"Number",value:this.displaySettings.maxWidth,units:"a.u.",hint:c("maxWidth")},{name:c("numStep"),type:"Number",value:this.displaySettings.numStep,units:"int",hint:c("numStep")},{name:c("opacity"),type:"Number",value:this.displaySettings.opacity,units:"number",hint:c("opacity")},{name:c("scale"),type:"String",value:this.displaySettings.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:c("scale")},{name:c("color map"),type:"String",choices:Object.keys(He.brewer).slice(0,36),value:this.displaySettings.cmap,units:"",hint:c("cmap to use")},{name:c("show NaN"),value:this.displaySettings.showNaN,hint:c("Hide NaN on map and color map")},{name:c("reverse color"),value:this.displaySettings.reverseColor,hint:c("reverse color scale")},{name:c("scale min"),type:"Number",value:this.displaySettings.minVal,units:"a.u.",hint:c("mininum value on the color Map")},{name:c("scale max"),type:"Number",value:this.displaySettings.maxVal,units:"a.u.",hint:c("maximum value on the color Map")},{name:c("custom scale"),value:this.displaySettings.fixScale,hint:c("customize to inputs values")},{name:c("Left side driving"),value:this.displaySettings.offset,hint:c("Select which side of the road the links are display")},{name:c("3D"),value:this.displaySettings.extrusion,hint:c("display zones as 3D extrusion")},{name:c("padding"),type:"Number",value:this.displaySettings.padding,units:"number",hint:c("range of colors")}],showHint:!1,showFixScale:!1,shake:!1,rules:{required:n=>!!n||c("Required"),largerThanZero:n=>n>0||c("should be larger than 0"),nonNegative:n=>n>=0||c("should be larger or equal to 0")}}},watch:{showDialog(n){this.refresh(),this.showFixScale=this.parameters[11].value},featureChoices(){this.refresh()}},methods:{toggleFixScale(){this.parameters[11].value?(this.showFixScale=!0,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal):this.showFixScale=!1},getColor(n){const l=[],y=this.parameters[8].value;let e=this.parameters[14].value;e=[e[0]/100,1-e[1]/100],e=y?e.reverse():e;const t=He.scale(n).padding(e).domain([0,100]).classes(25);for(let i=0;i<100;i++)l.push(t(i).hex());return y?l.reverse():l},refresh(){this.parameters[0].value=this.displaySettings.selectedFeature,this.parameters[1].value=this.displaySettings.minWidth,this.parameters[2].value=this.displaySettings.maxWidth,this.parameters[3].value=this.displaySettings.numStep,this.parameters[4].value=this.displaySettings.opacity,this.parameters[5].value=this.displaySettings.scale,this.parameters[6].value=this.displaySettings.cmap,this.parameters[7].value=this.displaySettings.showNaN,this.parameters[8].value=this.displaySettings.reverseColor,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal,this.parameters[11].value=this.displaySettings.fixScale,this.parameters[12].value=this.displaySettings.offset,this.parameters[13].value=this.displaySettings.extrusion,this.parameters[14].value=this.displaySettings.padding},submit(n){if(this.$refs.form.validate()){const l={selectedFeature:this.parameters[0].value,minWidth:Number(this.parameters[1].value),maxWidth:Number(this.parameters[2].value),numStep:Number(this.parameters[3].value),opacity:Number(this.parameters[4].value),scale:this.parameters[5].value,cmap:this.parameters[6].value,showNaN:this.parameters[7].value,reverseColor:this.parameters[8].value,minVal:Number(this.parameters[9].value),maxVal:Number(this.parameters[10].value),fixScale:this.parameters[11].value,offset:this.parameters[12].value,extrusion:this.parameters[13].value,padding:this.parameters[14].value};n==="apply"?this.$emit("submit",l):n==="save"&&this.$emit("save-preset",l)}else this.shake=!0,setTimeout(()=>{this.shake=!1},500)},cancel(){this.showDialog=!1}}},It={class:"setting"},Ut={class:"gradient"},Rt={class:"domain-title-small"},Tt={class:"domain-title"};function jt(n,l,y,e,t,i){return r(),k(be,{modelValue:t.showDialog,"onUpdate:modelValue":l[16]||(l[16]=a=>t.showDialog=a),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:o(({props:a})=>[h("div",It,[s(M,j({color:y.displaySettings.selectedFeature===null?"error":"regular"},a,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:o(()=>[s($,{width:"20rem",class:"setting-card","max-height":e.windowHeight,onKeydown:[l[15]||(l[15]=O(a=>i.submit("apply"),["enter"])),O(i.cancel,["esc"])]},{default:o(()=>[s(ae,{class:"subtitle"},{append:o(()=>[s(M,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:l[0]||(l[0]=a=>t.showHint=!t.showHint)})]),default:o(()=>[w(v(n.$gettext("Settings"))+" ",1)]),_:1}),s(Ie,{ref:"form","lazy-validation":""},{default:o(()=>[s(Ue,null,{default:o(()=>[s(Y,null,{default:o(()=>[s(se,{modelValue:t.parameters[0].value,"onUpdate:modelValue":l[1]||(l[1]=a=>t.parameters[0].value=a),variant:"underlined",items:y.featureChoices,label:n.$gettext(t.parameters[0].name),hint:t.showHint?n.$gettext(t.parameters[0].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),s(Ne,null,{default:o(()=>[(r(!0),L(z,null,I(t.parameters.slice(1,3),a=>(r(),k(Y,{key:a.name},{default:o(()=>[s(ee,{modelValue:a.value,"onUpdate:modelValue":m=>a.value=m,variant:"underlined",density:"compact",type:a.type,label:n.$gettext(a.name),suffix:a.units,hint:t.showHint?n.$gettext(a.hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),s(Ne,null,{default:o(()=>[s(Y,null,{default:o(()=>[s(ee,{modelValue:t.parameters[3].value,"onUpdate:modelValue":l[2]||(l[2]=a=>t.parameters[3].value=a),variant:"underlined",density:"compact",type:t.parameters[3].type,label:n.$gettext(t.parameters[3].name),suffix:t.parameters[3].units,hint:t.showHint?n.$gettext(t.parameters[3].hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),s(Y,null,{default:o(()=>[s(se,{modelValue:t.parameters[5].value,"onUpdate:modelValue":l[3]||(l[3]=a=>t.parameters[5].value=a),density:"compact",variant:"underlined",items:t.parameters[5].choices,label:n.$gettext(t.parameters[5].name),hint:t.showHint?n.$gettext(t.parameters[5].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),s(se,{modelValue:t.parameters[6].value,"onUpdate:modelValue":l[4]||(l[4]=a=>t.parameters[6].value=a),density:"compact",items:t.parameters[6].choices,label:n.$gettext(t.parameters[6].name),hint:t.showHint?n.$gettext(t.parameters[6].hint):"","persistent-hint":t.showHint,required:"",variant:"solo"},{selection:o(({item:a})=>[h("div",Ut,[(r(!0),L(z,null,I(i.getColor(a.value),(m,S)=>(r(),L("span",{key:S,class:"grad-step-small",style:ke({backgroundColor:m})},null,4))),128)),h("span",Rt,v(a.value),1)])]),item:o(({props:a,item:m})=>[h("div",j({class:"gradient"},a),[(r(!0),L(z,null,I(i.getColor(m.value),(S,P)=>(r(),L("span",{key:P,class:"grad-step",style:ke({backgroundColor:S})},null,4))),128)),h("span",Tt,v(m.value),1)],16)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),s(ot,{modelValue:t.parameters[14].value,"onUpdate:modelValue":l[5]||(l[5]=a=>t.parameters[14].value=a),step:"5",density:"compact",color:"primary",label:n.$gettext(t.parameters[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),s(it,{modelValue:t.parameters[4].value,"onUpdate:modelValue":l[6]||(l[6]=a=>t.parameters[4].value=a),class:"align-center",color:"primary",label:n.$gettext(t.parameters[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":o(({modelValue:a})=>[w(v(Math.floor(a)+"%"),1)]),_:1},8,["modelValue","label"]),(r(),k(Q,{key:t.parameters[12].name,modelValue:t.parameters[12].value,"onUpdate:modelValue":l[7]||(l[7]=a=>t.parameters[12].value=a),density:"compact",color:"primary",label:n.$gettext(t.parameters[12].name),hint:t.showHint?n.$gettext(t.parameters[12].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(r(),k(Q,{key:t.parameters[7].name,modelValue:t.parameters[7].value,"onUpdate:modelValue":l[8]||(l[8]=a=>t.parameters[7].value=a),density:"compact",color:"primary",label:n.$gettext(t.parameters[7].name),hint:t.showHint?n.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(r(),k(Q,{key:t.parameters[8].name,modelValue:t.parameters[8].value,"onUpdate:modelValue":l[9]||(l[9]=a=>t.parameters[8].value=a),density:"compact",color:"primary",label:n.$gettext(t.parameters[8].name),hint:t.showHint?n.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(y.type)?(r(),k(Q,{key:t.parameters[13].name,modelValue:t.parameters[13].value,"onUpdate:modelValue":l[10]||(l[10]=a=>t.parameters[13].value=a),density:"compact",color:"primary",label:n.$gettext(t.parameters[13].name),disabled:!["Polygon","extrusion"].includes(y.type),hint:t.showHint?n.$gettext(t.parameters[13].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","disabled","hint","persistent-hint"])):F("",!0),(r(),k(Q,{key:t.parameters[11].name,modelValue:t.parameters[11].value,"onUpdate:modelValue":[l[11]||(l[11]=a=>t.parameters[11].value=a),l[12]||(l[12]=a=>i.toggleFixScale(t.parameters[11].name))],density:"compact",variant:"underlined",color:"primary",label:n.$gettext(t.parameters[11].name),hint:t.showHint?n.$gettext(t.parameters[11].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(r(!0),L(z,null,I(t.parameters.slice(9,11),a=>Ce((r(),k(ee,{key:a.name,modelValue:a.value,"onUpdate:modelValue":m=>a.value=m,variant:"underlined",type:a.type,label:n.$gettext(a.name),suffix:a.units,hint:t.showHint?n.$gettext(a.hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])),[[we,t.showFixScale]])),128))]),_:1})]),_:1})]),_:1},512),s(ne,null,{default:o(()=>[s(M,{color:"grey",variant:"text",onClick:i.cancel},{default:o(()=>[w(v(n.$gettext("Cancel")),1)]),_:1},8,["onClick"]),s(M,{color:"green-darken-1",variant:"text",onClick:l[13]||(l[13]=a=>i.submit("apply"))},{default:o(()=>[w(v(n.$gettext("Apply")),1)]),_:1}),s(oe),s(M,{color:"grey",variant:"text",onClick:l[14]||(l[14]=a=>i.submit("save"))},{default:o(()=>[s(B,{size:"small",start:""},{default:o(()=>[w(" fas fa-sliders-h ")]),_:1}),w(" "+v(n.$gettext("save")),1)]),_:1})]),_:1})]),_:1},8,["max-height","onKeydown"])]),_:1},8,["modelValue"])}const Ot=ie(zt,[["render",jt],["__scopeId","data-v-edc0aabd"]]),X=n=>n,qt={name:"ResultMap",components:{MapResults:bt,ResultsSidePanel:Ht,ResultsSettings:Ot,MapLegend:ct,LayerSelector:pt,StaticLayer:mt},setup(){const n=rt(),l=ut(),y=dt(),e=re(),{visibleLayer:t,NaNLayer:i,type:a,loadLayer:m,displaySettings:S,hasOD:P,ODfeatures:f,matSelectedIndex:N,changeOD:p,isIndexAvailable:x,selectedCategory:D,selectedFilter:g,attributes:H,applySettings:ue,changeSelectedFilter:W,filteredCategory:Z,updateSelectedFeature:te,changeSelectedCategory:le,colorScale:de}=yt();function ce(d){W(d),te()}function me(d){le(d),te()}const E=V("");async function u(d,R=null){switch(E.value=d,d){case"links":m(n.links,null,R);break;case"rlinks":m(l.rlinks,null,R);break;case"nodes":m(n.nodes,null,R);break;case"rnodes":m(l.rnodes,null,R);break;case"od":m(y.layer,null,R);break;default:const J=await e.getOtherFile(d,"geojson"),Le=await e.getOtherFile(d,"json");m(J,Le,R);break}}const b=V(null),C=U(()=>e.availableLayers),K=U(()=>e.visibleRasters),Re=U(()=>e.styles),A=V(""),ye=V(!1),pe=V(!1),G=V(""),ve=V({});async function Te(d){b.value=d.name,C.value.includes(d.layer)?(await u(d.layer,d.displaySettings),H.value.includes(d==null?void 0:d.selectedFilter)?(W(d.selectedFilter),Object.keys(d).includes("selectedCategory")&&le(d.selectedCategory)):Object.keys(d).includes("selectedFilter")&&e.changeNotification({text:d.selectedFilter+" "+X("filter does not exist. use default one"),autoClose:!0,color:"error"})):e.changeNotification({text:X("Preset Layer does not exist"),autoClose:!0,color:"error"}),Object.keys(d).includes("selectedIndex")&&x(d.selectedIndex)&&(p(d.selectedIndex),e.changeNotification({}))}function je(d){A.value=d.name,ye.value=!0}function Oe(d){ve.value=d,G.value=b.value,pe.value=!0}async function qe(d){if((await d).valid){pe.value=!1;const J={name:q.cloneDeep(G.value),layer:q.cloneDeep(E.value),displaySettings:q.cloneDeep(ve.value),selectedFilter:q.cloneDeep(g.value)};D.value.filter(Ze=>Z.value.includes(Ze)).length<Z.value.length&&(J.selectedCategory=q.cloneDeep(D)),f.value.includes(ve.value.selectedFeature)&&P.value&&(J.selectedIndex=N.value),e.addStyle(J),K.value.includes(G.value)?e.changeNotification({text:X("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):e.changeNotification({text:X("Preset Saved"),autoClose:!0,color:"success"}),b.value=q.cloneDeep(G.value)}}function Be(){e.deleteStyle(A.value),ye.value=!1,A.value===b.value&&(b.value=null),e.changeNotification({text:X("Preset deleted"),autoClose:!0,color:"success"}),A.value=""}const xe=V(!1),Ve=V([]);function We(d){d.action==="featureClick"?(Ve.value=d.feature,xe.value=!0):p(d.feature.index)}return{store:e,selectedLayer:E,selectedPreset:b,availableLayers:C,visibleLayer:t,NaNLayer:i,type:a,displaySettings:S,selectedCategory:D,selectedFilter:g,attributes:H,filteredCategory:Z,applySettings:ue,colorScale:de,updateSelectedFilter:ce,updateSelectedCategory:me,changeLayer:u,changePreset:Te,showDeleteDialog:ye,presetToDelete:A,clickDeletePreset:je,deletePreset:Be,showPresetDialog:pe,inputName:G,clickSavePreset:Oe,createPreset:qe,featureClicked:We,availableStyles:Re,visibleRasters:K,showDialog:xe,formData:Ve}}},Bt={class:"map-view"},Wt={class:"left-panel"},Zt={style:{display:"flex"}};function Et(n,l,y,e,t,i){const a=_("ResultsSidePanel"),m=_("MapLegend"),S=_("ResultsSettings"),P=_("LayerSelector"),f=_("StaticLayer"),N=_("MapResults");return r(),L("section",Bt,[s(a,{ref:"sidePanel","selected-category":e.selectedCategory,"selected-filter":e.selectedFilter,"layer-choices":e.availableLayers,"selected-layer":e.selectedLayer,"filter-choices":e.attributes,"filtered-cat":e.filteredCategory,"preset-choices":e.availableStyles,"selected-preset":e.selectedPreset,onUpdateSelectedCategory:e.updateSelectedCategory,onUpdateSelectedFilter:e.updateSelectedFilter,onSelectLayer:e.changeLayer,onSelectPreset:e.changePreset,onDeletePreset:e.clickDeletePreset},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset","onUpdateSelectedCategory","onUpdateSelectedFilter","onSelectLayer","onSelectPreset","onDeletePreset"]),h("div",Wt,[Ce(s(m,{key:"result",order:0,"color-scale":e.colorScale,"display-settings":e.displaySettings},null,8,["color-scale","display-settings"]),[[we,e.visibleLayer.features.length>0]])]),e.visibleLayer.features?(r(),k(N,{key:e.type+String(e.displaySettings.extrusion),"layer-type":e.type,extrusion:e.displaySettings.extrusion,links:e.visibleLayer,"nan-links":e.NaNLayer,"selected-feature":e.displaySettings.selectedFeature,opacity:e.displaySettings.opacity,offset:e.displaySettings.offset,onSelectClick:e.featureClicked},{default:o(p=>[h("div",Zt,[s(S,{"display-settings":e.displaySettings,"feature-choices":e.attributes,type:e.type,onSubmit:e.applySettings,onSavePreset:e.clickSavePreset},null,8,["display-settings","feature-choices","type","onSubmit","onSavePreset"]),e.availableStyles.length>0?(r(),k(P,{key:0,choices:e.availableStyles,"available-layers":e.availableLayers},null,8,["choices","available-layers"])):F("",!0)]),(r(!0),L(z,null,I(e.availableStyles,x=>(r(),L("div",{key:x.name},[e.visibleRasters.includes(x.name)&&e.availableLayers.includes(x.layer)?(r(),k(f,{key:0,preset:x,map:p.map,order:e.visibleRasters.indexOf(x.name)+1},null,8,["preset","map","order"])):F("",!0)]))),128))]),_:1},8,["layer-type","extrusion","links","nan-links","selected-feature","opacity","offset","onSelectClick"])):F("",!0),s(fe,{modelValue:e.showDialog,"onUpdate:modelValue":l[1]||(l[1]=p=>e.showDialog=p),scrollable:"",persistent:"","max-width":"300",onKeydown:[l[2]||(l[2]=O(p=>e.showDialog=!1,["enter"])),l[3]||(l[3]=O(p=>e.showDialog=!1,["esc"]))]},{default:o(()=>[s($,{"max-height":"60rem"},{default:o(()=>[s(he,{class:"text-h5"},{default:o(()=>[w(v(n.$gettext("link Properties")),1)]),_:1}),s(_e),s(Fe,null,{default:o(()=>[s(Se,null,{default:o(()=>[(r(!0),L(z,null,I(e.formData,(p,x)=>(r(),k(ee,{key:x,"model-value":p,label:x,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),s(_e),s(ne,null,{default:o(()=>[s(oe),s(M,{color:"success",variant:"text",onClick:l[0]||(l[0]=p=>e.showDialog=!1)},{default:o(()=>[w(v(n.$gettext("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(fe,{modelValue:e.showPresetDialog,"onUpdate:modelValue":l[6]||(l[6]=p=>e.showPresetDialog=p),persistent:"","max-width":"400",onKeydown:l[7]||(l[7]=O(p=>e.showPresetDialog=!1,["esc"]))},{default:o(()=>[s($,null,{default:o(()=>[s(he,{class:"text-h5"},{default:o(()=>[w(v(n.$gettext("Create or modify preset")),1)]),_:1}),s(Ie,{"validate-on":"submit lazy",onSubmit:ze(e.createPreset,["prevent"])},{default:o(()=>[s(Fe,null,{default:o(()=>[s(Ue,null,{default:o(()=>[s(Y,{cols:"12"},{default:o(()=>[s(ee,{modelValue:e.inputName,"onUpdate:modelValue":l[4]||(l[4]=p=>e.inputName=p),autofocus:"",rules:[p=>!!p||"Required."],label:n.$gettext("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),s(ne,null,{default:o(()=>[s(oe),s(M,{color:"grey",variant:"text",onClick:l[5]||(l[5]=p=>e.showPresetDialog=!1)},{default:o(()=>[w(v(n.$gettext("Cancel")),1)]),_:1}),s(M,{color:"green-darken-1",variant:"text",type:"submit"},{default:o(()=>[w(v(n.$gettext("ok")),1)]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),s(fe,{modelValue:e.showDeleteDialog,"onUpdate:modelValue":l[9]||(l[9]=p=>e.showDeleteDialog=p),persistent:"","max-width":"400",onKeydown:[l[10]||(l[10]=O(p=>e.showDeleteDialog=!1,["esc"])),O(e.deletePreset,["enter"])]},{default:o(()=>[s($,null,{default:o(()=>[s(he,{class:"text-h5"},{default:o(()=>[w(v(n.$gettext("Delete")+" "+e.presetToDelete+" ?"),1)]),_:1}),s(ne,null,{default:o(()=>[s(oe),s(M,{color:"grey",variant:"text",onClick:l[8]||(l[8]=p=>e.showDeleteDialog=!1)},{default:o(()=>[w(v(n.$gettext("Cancel")),1)]),_:1}),s(M,{color:"error",variant:"text",onClick:e.deletePreset},{default:o(()=>[w(v(n.$gettext("delete")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const Jt=ie(qt,[["render",Et],["__scopeId","data-v-5724216d"]]);export{Jt as default};
