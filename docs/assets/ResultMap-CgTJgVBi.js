import{_ as xe,u as ke,t as he,a as Le,b as We,r as g,s as He,c as Z,w as E,o as Ze,d as ge,e as Ge,f as P,g as v,h as k,i as u,j as t,k as Ke,l as O,m as l,M as Ye,n as Je,p as ie,q as Qe,v as Xe,x as el,y as ll,z as al,A as f,B as z,C as V,V as se,D as _e,E as ce,F as Se,G as we,H as J,I as Q,J as pe,K as Fe,L as H,N as tl,O as ne,P as ze,Q as Ne,R as ve,S as sl,T as nl,U as ol,W as Me,X as ul,Y as il,Z as Ie,$ as be,a0 as rl,a1 as re,a2 as oe,a3 as Ce,a4 as dl,a5 as vl,a6 as cl,a7 as pl,a8 as de,a9 as Te,aa as je,ab as ml,ac as fl,ad as yl,ae as hl,af as gl,ag as bl,ah as Ue,ai as xl,aj as kl,ak as Re,al as ee,am as ye}from"./index-CSaCtFbf.js";import{u as Vl,M as Cl,S as Sl}from"./StaticLayer-B36ZGQ_-.js";import wl from"./LayerSelector-LI_e0muz.js";const Ll={__name:"MapResults",props:["selectedFeature","layerType","extrusion","labels","links","nanLinks","opacity","offset","selectedLayer"],emits:["selectClick"],setup(R,{expose:L,emit:a}){const{$gettext:q}=ke(),T=R,{selectedFeature:o,layerType:D,extrusion:_,labels:A,links:N,nanLinks:S,opacity:e,offset:d,selectedLayer:$}=he(T),w=a,G=Le(),M=We(),C=g(!1),i=He(null),m=g({nodes:14,links:2}),r=Z(()=>M.mapStyle);E(r,()=>{i.value&&(i.value.getLayer("arrow")&&i.value.removeLayer("arrow"),i.value.getLayer("results")&&i.value.removeLayer("results"),i.value.getLayer("labels")&&i.value.removeLayer("labels"),i.value.getLayer("NaNresults")&&i.value.removeLayer("NaNresults"),C.value=!1,n())}),Ze(()=>{var c;i.value&&n(),(c=i.value)!=null&&c.getLayer("arrow")&&i.value.removeLayer("arrow")}),ge(()=>{I(N.value)});function n(){const c=i.value.getCenter();M.saveMapPosition({mapCenter:[c.lng,c.lat],mapZoom:i.value.getZoom()})}function s(c){i.value&&(C.value=!1),i.value=c.map,i.value.loadImage(al,function(x,le){if(x){console.error("err image",x);return}i.value.addImage("arrow",le,{sdf:!0})}),_.value&&G.changeNotification({text:q("Right click and drag to tilt the map"),autoClose:!0,color:"success"}),C.value=!0,["mapbox://styles/mapbox/light-v11","mapbox://styles/mapbox/dark-v11"].includes(r.value)||b()}function b(){i.value.addSource("srtm-dem",{type:"raster-dem",tiles:["https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"],tileSize:256,encoding:"terrarium",maxzoom:15}),i.value.setTerrain({source:"srtm-dem",exaggeration:2})}function I(c){const x=M.getBounds(c);M.getZoomAndCenter(x,W.value.clientWidth,W.value.clientHeight)}const W=g();Ge(i,W);const j=g([]),F=g(null);L({update:Ve,fitBounds:I});function Ve(){var c;C.value&&(i.value.getSource("results").setData(N.value),(c=i.value.getSource("NaNresults"))==null||c.setData(S.value))}E($,()=>I(N.value));const me=Z(()=>d.value?-1:1);function fe(c){var x;if(c.map.getCanvas().style.cursor="pointer",j.value=c.mapboxEvent.features,(x=F.value)!=null&&x.isOpen()&&F.value.remove(),o.value&&D.value!=="Polygon"){const le=j.value[0].properties[o.value];le&&(F.value=new ll.Popup({closeButton:!1}).setLngLat([c.mapboxEvent.lngLat.lng,c.mapboxEvent.lngLat.lat]).setHTML(`${o.value}: <br> ${le}`).addTo(c.map))}}function X(c){var x;j.value=[],(x=F.value)!=null&&x.isOpen()&&F.value.remove(),c.map.getCanvas().style.cursor=""}function K(c){var x;j.value=c.mapboxEvent.features,((x=j.value)==null?void 0:x.length)>0&&w("selectClick",{feature:j.value[0].properties,action:"featureClick"})}function U(c){var x;j.value=c.mapboxEvent.features,((x=j.value)==null?void 0:x.length)>0&&w("selectClick",{feature:j.value[0].properties,action:"zoneClick"})}function Y(c){c.map.getCanvas().style.cursor="pointer"}function ue(c){c.map.getCanvas().style.cursor=""}return(c,x)=>(v(),P("div",{ref_key:"canvasDiv",ref:W,class:"map"},[(v(),k(l(el),{key:r.value,style:{width:"100%"},"access-token":l(M).key,"map-style":r.value,center:l(M).mapCenter,zoom:l(M).mapZoom,onLoad:s},{default:u(()=>[t(l(Ye),{position:"bottom-right"}),t(l(Je),{position:"bottom-right","visualize-pitch":!0}),Ke(c.$slots,"default",{map:i.value,mapIsLoaded:C.value},void 0,!0),l(D)=="LineString"?(v(),k(l(ie),{key:0,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(N),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:m.value.links,paint:{"line-color":["get","display_color"],"line-offset":["*",me.value*.5,["to-number",["get","display_width"]]],"line-opacity":l(e)/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:fe,onMouseleave:X,onClick:U,onContextmenu:K},null,8,["source","layer"])):O("",!0),l(D)=="Point"?(v(),k(l(ie),{key:1,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(N),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:m.value.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":l(e)/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:fe,onMouseleave:X,onClick:U,onContextmenu:K},null,8,["source","layer"])):O("",!0),l(D)=="LineString"?(v(),k(l(Qe),{key:2,"source-id":"results",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:m.value.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[me.value*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":l(e)/100}}},null,8,["layer"])):O("",!0),l(D)==="Polygon"&&l(_)?(v(),k(l(ie),{key:3,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(N),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":l(e)/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:Y,onMouseleave:ue,onClick:U,onContextmenu:K},null,8,["source","layer"])):O("",!0),l(D)==="Polygon"&&!l(_)?(v(),k(l(ie),{key:4,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(N),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":l(e)/100}},onMouseenter:Y,onMouseleave:ue,onClick:U,onContextmenu:K},null,8,["source","layer"])):O("",!0),l(D)==="Polygon"&&!l(_)?(v(),k(l(ie),{key:5,reactive:!1,"source-id":"NaNresults",source:{type:"geojson",data:l(S),promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:Y,onMouseleave:ue,onClick:U,onContextmenu:K},null,8,["source"])):O("",!0),t(l(Xe),{type:"symbol","source-id":"results",source:"links","layer-id":"labels",layer:{type:"symbol",layout:{"text-field":["get",l(A)],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":c.$vuetify.theme.current.colors.black}}},null,8,["layer"])]),_:3},8,["access-token","map-style","center","zoom"]))],512))}},_l=xe(Ll,[["__scopeId","data-v-36f5fed9"]]),Nl={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},Ml={class:"preset"},Dl={class:"title-div"},Pl={class:"custom-title"},$l={class:"crop"},Fl={class:"layer"},zl={class:"title-div"},Il={class:"custom-title"},Ul={class:"crop"},Rl={style:{"padding-top":"0.5rem"}},Wl={class:"item"},Tl={__name:"ResultsSidePanel",props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],emits:["update-selectedCategory","select-layer","select-preset","delete-preset","update-selectedFilter"],setup(R,{emit:L}){const{$gettext:a}=ke(),q=R,T=L,o=Le(),D=Z(()=>o.isMobile),_=Z(()=>o.showLeftPanel),A=g(!0),N=g(500);ge(()=>{N.value=D.value?window.innerWidth-100:350}),E(_,i=>{i?setTimeout(()=>{A.value=!0},500):A.value=!1});const S=g(!1),e=g(!1),{selectedCategory:d,filteredCat:$}=he(q),w=g([]);E(d,(i,m)=>{i!==m&&(w.value=i)}),E(w,i=>{i!==d.value&&T("update-selectedCategory",i)});function G(){w.value.length===$.value.length?w.value=[]:w.value=$.value}const{selectedFilter:M}=he(q),C=g("");return E(M,i=>{i!==C.value&&(C.value=i)}),E(C,i=>{i!==M.value&&(T("update-selectedFilter",i),w.value=d.value)}),ge(()=>{C.value=M.value,w.value=d.value,T("update-selectedFilter",M.value),T("update-selectedCategory",d.value)}),(i,m)=>(v(),P("section",{class:il(_.value?"left-panel elevation-4":"left-panel-close"),style:ce({width:_.value?N.value+"px":"0px"})},[f("div",{class:"left-panel-toggle-btn elevation-4",onClick:m[0]||(m[0]=r=>l(o).changeLeftPanel())},[t(se,{size:"small",color:"secondarydark"},{default:u(()=>[z(V(_.value?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),t(ul,{name:"fade"},{default:u(()=>[_e(f("div",{class:"left-panel-content",style:ce({width:_.value?N.value+"px":"0px"})},[f("div",null,[f("div",Nl,[f("div",Ml,[t(se,{style:{color:"white","padding-right":"2rem","padding-left":"1rem"}},{default:u(()=>[...m[7]||(m[7]=[z(" fas fa-sliders-h ",-1)])]),_:1}),t(Se,{modelValue:e.value,"onUpdate:modelValue":m[1]||(m[1]=r=>e.value=r),"close-delay":"100",location:"bottom center",transition:"slide-y-transition"},{activator:u(({props:r})=>[f("div",ne({class:"menu-container"},r),[f("div",Dl,[f("span",Pl,V(l(a)("Presets")),1),f("span",$l,V(R.selectedPreset),1)]),t(se,{variant:"text",style:{color:"white"}},{default:u(()=>[z(V(e.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)]),default:u(()=>[t(we,null,{default:u(()=>[(v(!0),P(J,null,Q(R.presetChoices,(r,n)=>(v(),k(pe,{key:n,link:"",onClick:()=>i.$emit("select-preset",r)},{append:u(()=>[t(H,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:tl(()=>i.$emit("delete-preset",r),["stop"])},null,8,["onClick"])]),default:u(()=>[t(Fe,null,{default:u(()=>[z(V(r.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),t(ze,{location:"bottom","open-delay":"300"},{activator:u(({props:r})=>[t(H,ne({variant:"text"},r,{disabled:R.presetChoices.length===0,style:{color:"white"},icon:"fas fa-download",onClick:m[2]||(m[2]=n=>l(o).exportFile("styles.json"))}),null,16,["disabled"])]),default:u(()=>[f("span",null,V(l(a)("Dowload presets")),1)]),_:1})]),f("div",Fl,[t(ze,{location:"bottom","open-delay":"500"},{activator:u(({props:r})=>[t(H,ne({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:w.value.length==l($).length?"fa-eye-slash fa":"fa-eye fa",variant:"text"},r,{onClick:m[3]||(m[3]=n=>G())}),null,16,["icon"])]),default:u(()=>[f("span",null,V(w.value.length==l($).length?l(a)("Hide All"):l(a)("Show All")),1)]),_:1}),t(Se,{modelValue:S.value,"onUpdate:modelValue":m[4]||(m[4]=r=>S.value=r),"close-delay":"100",transition:"slide-y-transition"},{activator:u(({props:r})=>[f("div",ne({class:"title-div"},r),[f("div",ne({class:"menu-container"},r),[f("div",zl,[f("span",Il,V(l(a)("Layer")),1),f("span",Ul,V(R.selectedLayer),1)]),t(se,{variant:"text",style:{color:"white"}},{default:u(()=>[z(V(S.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)],16)]),default:u(()=>[t(we,null,{default:u(()=>[(v(!0),P(J,null,Q(R.layerChoices,(r,n)=>(v(),k(pe,{key:n,link:"",onClick:()=>i.$emit("select-layer",r)},{default:u(()=>[t(Fe,null,{default:u(()=>[z(V(r),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),t(se)]),t(Ne,{"max-width":"100%","min-width":"100%",height:"calc(100vh - 250px)",class:"mx-auto scrollable"},{default:u(()=>[t(pe,null,{default:u(()=>[f("div",Rl,[t(ve,{modelValue:C.value,"onUpdate:modelValue":m[5]||(m[5]=r=>C.value=r),items:R.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:l(a)("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),t(sl,{items:l($),"item-height":45,height:"calc(100vh - 330px)"},{default:u(({item:r})=>[(v(),P("div",{key:C.value.concat(r),class:"container"},[t(nl,null,{default:u(()=>[t(ol,{modelValue:w.value,"onUpdate:modelValue":m[6]||(m[6]=n=>w.value=n),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:r},null,8,["modelValue","value"])]),_:2},1024),f("div",Wl,V(r),1)]))]),_:1},8,["items"])]),_:1})])])],4),[[Me,A.value]])]),_:1})],6))}},jl=xe(Tl,[["__scopeId","data-v-26cce869"]]),Bl={class:"gradient-preview"},Ol={class:"preview-title"},ql={class:"gradient"},Al={class:"domain-title"},El={__name:"ResultsSettings",props:["displaySettings","featureChoices","type","order"],emits:["submit","save-preset"],setup(R,{emit:L}){const{$gettext:a}=ke(),q=R,T=L,{displaySettings:o,featureChoices:D,type:_,order:A}=he(q),N=Z(()=>{const r=["OrRd","Spectral","RdYlGn","Viridis","YlGn","RdYlBu"],n=Object.keys(Ie.brewer).slice(0,36).filter(s=>!r.includes(s));return[...r,...n]}),S=g(!1),e=g([{name:a("selectedFeature"),type:"String",value:o.value.selectedFeature,units:"",hint:a("selectedFeature")},{name:a("minWidth"),type:"Number",value:o.value.minWidth,units:"a.u.",hint:a("minWidth")},{name:a("maxWidth"),type:"Number",value:o.value.maxWidth,units:"a.u.",hint:a("maxWidth")},{name:a("numStep"),type:"Number",value:o.value.numStep,units:"int",hint:a("numStep")},{name:a("opacity"),type:"Number",value:o.value.opacity,units:"number",hint:a("opacity")},{name:a("scale"),type:"String",value:o.value.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:a("scale")},{name:a("color map"),type:"String",choices:N,value:o.value.cmap,units:"",hint:a("cmap to use")},{name:a("show NaN"),value:o.value.showNaN,hint:a("Hide NaN on map and color map")},{name:a("reverse color"),value:o.value.reverseColor,hint:a("reverse color scale")},{name:a("scale min"),type:"Number",value:o.value.minVal,units:"a.u.",hint:a("mininum value on the color Map")},{name:a("scale max"),type:"Number",value:o.value.maxVal,units:"a.u.",hint:a("maximum value on the color Map")},{name:a("custom scale"),value:o.value.fixScale,hint:a("customize to inputs values")},{name:a("Left side driving"),value:o.value.offset,hint:a("Select which side of the road the links are display")},{name:a("3D"),value:o.value.extrusion,hint:a("display zones as 3D extrusion")},{name:a("padding"),type:"Number",value:o.value.padding,units:"number",hint:a("range of colors")},{name:a("labels"),type:"String",value:o.value.labels,hint:a("show labels")},{name:a("legend title"),type:"String",value:o.value.legendName,units:"",hint:a("Legend title")}]),d=g(!1),$=g(!1);E(S,()=>{C(),$.value=e.value[11].value}),E(D,()=>C());function w(r){e.value[16].value=r}function G(){e.value[11].value?($.value=!0,e.value[9].value=o.value.minVal,e.value[10].value=o.value.maxVal):$.value=!1}function M(r){const n=[],s=e.value[8].value;let b=e.value[14].value;b=[b[0]/100,1-b[1]/100],b=s?b.reverse():b;const I=Ie.scale(r).padding(b).domain([0,100]).classes(25);for(let W=0;W<100;W++)n.push(I(W).hex());return s?n.reverse():n}function C(){e.value[0].value=o.value.selectedFeature,e.value[1].value=o.value.minWidth,e.value[2].value=o.value.maxWidth,e.value[3].value=o.value.numStep,e.value[4].value=o.value.opacity,e.value[5].value=o.value.scale,e.value[6].value=o.value.cmap,e.value[7].value=o.value.showNaN,e.value[8].value=o.value.reverseColor,e.value[9].value=o.value.minVal,e.value[10].value=o.value.maxVal,e.value[11].value=o.value.fixScale,e.value[12].value=o.value.offset,e.value[13].value=o.value.extrusion,e.value[14].value=o.value.padding,e.value[15].value=o.value.labels,e.value[16].value=o.value.legendName}function i(r){{const n={selectedFeature:e.value[0].value,minWidth:Number(e.value[1].value),maxWidth:Number(e.value[2].value),numStep:Number(e.value[3].value),opacity:Number(e.value[4].value),scale:e.value[5].value,cmap:e.value[6].value,showNaN:e.value[7].value,reverseColor:e.value[8].value,minVal:Number(e.value[9].value),maxVal:Number(e.value[10].value),fixScale:e.value[11].value,offset:e.value[12].value,extrusion:e.value[13].value,padding:e.value[14].value,labels:e.value[15].value,legendName:e.value[16].value};r==="apply"?T("submit",n):r==="save"&&T("save-preset",n)}}function m(){S.value=!1}return(r,n)=>(v(),k(Se,{modelValue:S.value,"onUpdate:modelValue":n[18]||(n[18]=s=>S.value=s),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:u(({props:s})=>[f("div",{class:"layer-button",style:ce({"--n":l(A)})},[t(H,ne({color:l(o).selectedFeature===null?"error":"white"},s,{icon:"fa-solid fa-cog"}),null,16,["color"])],4)]),default:u(()=>[t(Ne,{width:"20rem",class:"setting-card","max-height":"calc(100vh - 100px)",onKeydown:[n[17]||(n[17]=be(s=>i("apply"),["enter"])),be(m,["esc"])]},{default:u(()=>[t(pe,{class:"subtitle"},{append:u(()=>[t(H,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:n[0]||(n[0]=s=>d.value=!d.value)})]),default:u(()=>[z(V(l(a)("Settings"))+" ",1)]),_:1}),t(rl,{ref:"form","validate-on":"lazy"},{default:u(()=>[t(re,null,{default:u(()=>[t(ve,{modelValue:e.value[0].value,"onUpdate:modelValue":[n[1]||(n[1]=s=>e.value[0].value=s),w],variant:"underlined",items:l(D).sort(),label:l(a)(e.value[0].name),hint:d.value?l(a)(e.value[0].hint):"","persistent-hint":d.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),t(oe,{modelValue:e.value[16].value,"onUpdate:modelValue":n[2]||(n[2]=s=>e.value[16].value=s),variant:"underlined",density:"compact",label:l(a)(e.value[16].name),hint:d.value?l(a)(e.value[16].hint):"","persistent-hint":d.value,onWheel:()=>{}},null,8,["modelValue","label","hint","persistent-hint"]),t(Ce,null,{default:u(()=>[(v(!0),P(J,null,Q(e.value.slice(1,3),s=>(v(),k(re,{key:s.name},{default:u(()=>[t(oe,{modelValue:s.value,"onUpdate:modelValue":b=>s.value=b,variant:"underlined",density:"compact",type:s.type,label:l(a)(s.name),suffix:s.units,hint:d.value?l(a)(s.hint):"","persistent-hint":d.value,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),t(Ce,null,{default:u(()=>[t(re,null,{default:u(()=>[t(oe,{modelValue:e.value[3].value,"onUpdate:modelValue":n[3]||(n[3]=s=>e.value[3].value=s),variant:"underlined",density:"compact",type:e.value[3].type,label:l(a)(e.value[3].name),suffix:e.value[3].units,hint:d.value?l(a)(e.value[3].hint):"","persistent-hint":d.value,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),t(re,null,{default:u(()=>[t(ve,{modelValue:e.value[5].value,"onUpdate:modelValue":n[4]||(n[4]=s=>e.value[5].value=s),density:"compact",variant:"underlined",items:e.value[5].choices,label:l(a)(e.value[5].name),hint:d.value?l(a)(e.value[5].hint):"","persistent-hint":d.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),t(ve,{modelValue:e.value[6].value,"onUpdate:modelValue":n[5]||(n[5]=s=>e.value[6].value=s),density:"compact",items:e.value[6].choices,label:l(a)(e.value[6].name),hint:d.value?l(a)(e.value[6].hint):"","persistent-hint":d.value,required:"",variant:"solo"},{selection:u(({item:s})=>[f("div",Bl,[(v(!0),P(J,null,Q(M(s.value),(b,I)=>(v(),P("span",{key:I,class:"grad-step-small",style:ce({backgroundColor:b})},null,4))),128)),f("span",Ol,V(s.value),1)])]),item:u(({props:s,item:b})=>[t(pe,dl(vl(s)),{title:u(()=>[f("div",ql,[(v(!0),P(J,null,Q(M(b.value),(I,W)=>(v(),P("span",{key:W,class:"grad-step",style:ce({backgroundColor:I})},null,4))),128)),f("span",Al,V(b.value),1)])]),_:2},1040)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),t(cl,{modelValue:e.value[14].value,"onUpdate:modelValue":n[6]||(n[6]=s=>e.value[14].value=s),step:"5",density:"compact",color:"primary",label:l(a)(e.value[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),t(pl,{modelValue:e.value[4].value,"onUpdate:modelValue":n[7]||(n[7]=s=>e.value[4].value=s),class:"align-center",color:"primary",label:l(a)(e.value[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":u(({modelValue:s})=>[z(V(Math.floor(s)+"%"),1)]),_:1},8,["modelValue","label"]),t(ve,{modelValue:e.value[15].value,"onUpdate:modelValue":n[8]||(n[8]=s=>e.value[15].value=s),variant:"underlined",items:["",...l(D).sort()],label:l(a)(e.value[15].name),hint:d.value?l(a)(e.value[15].hint):"","persistent-hint":d.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),(v(),k(de,{key:e.value[12].name,modelValue:e.value[12].value,"onUpdate:modelValue":n[9]||(n[9]=s=>e.value[12].value=s),density:"compact",color:"primary","hide-details":!d.value,label:l(a)(e.value[12].name),hint:d.value?l(a)(e.value[12].hint):"","persistent-hint":d.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(v(),k(de,{key:e.value[7].name,modelValue:e.value[7].value,"onUpdate:modelValue":n[10]||(n[10]=s=>e.value[7].value=s),density:"compact",color:"primary","hide-details":!d.value,label:l(a)(e.value[7].name),hint:d.value?l(a)(e.value[7].hint):"","persistent-hint":d.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(v(),k(de,{key:e.value[8].name,modelValue:e.value[8].value,"onUpdate:modelValue":n[11]||(n[11]=s=>e.value[8].value=s),density:"compact",color:"primary","hide-details":!d.value,label:l(a)(e.value[8].name),hint:d.value?l(a)(e.value[7].hint):"","persistent-hint":d.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(l(_))?(v(),k(de,{key:e.value[13].name,modelValue:e.value[13].value,"onUpdate:modelValue":n[12]||(n[12]=s=>e.value[13].value=s),density:"compact",color:"primary","hide-details":!d.value,label:l(a)(e.value[13].name),disabled:!["Polygon","extrusion"].includes(l(_)),hint:d.value?l(a)(e.value[13].hint):"","persistent-hint":d.value},null,8,["modelValue","hide-details","label","disabled","hint","persistent-hint"])):O("",!0),(v(),k(de,{key:e.value[11].name,modelValue:e.value[11].value,"onUpdate:modelValue":[n[13]||(n[13]=s=>e.value[11].value=s),n[14]||(n[14]=s=>G(e.value[11].name))],density:"compact",variant:"underlined",color:"primary","hide-details":!d.value,label:l(a)(e.value[11].name),hint:d.value?l(a)(e.value[11].hint):"","persistent-hint":d.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),t(Ce,null,{default:u(()=>[(v(!0),P(J,null,Q(e.value.slice(9,11),s=>(v(),k(re,{key:s.name},{default:u(()=>[_e(t(oe,{modelValue:s.value,"onUpdate:modelValue":b=>s.value=b,variant:"underlined",type:s.type,label:l(a)(s.name),suffix:s.units,hint:d.value?l(a)(s.hint):"","persistent-hint":d.value,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"]),[[Me,$.value]])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},512),t(Te,null,{default:u(()=>[t(H,{color:"grey",variant:"text",onClick:m},{default:u(()=>[z(V(l(a)("Cancel")),1)]),_:1}),t(H,{color:"green-darken-1",variant:"text",onClick:n[15]||(n[15]=s=>i("apply"))},{default:u(()=>[z(V(l(a)("Apply")),1)]),_:1}),t(je),t(H,{color:"grey",variant:"text",onClick:n[16]||(n[16]=s=>i("save"))},{default:u(()=>[t(se,{size:"small",start:""},{default:u(()=>[...n[19]||(n[19]=[z(" fas fa-sliders-h ",-1)])]),_:1}),z(" "+V(l(a)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Hl=xe(El,[["__scopeId","data-v-b09543c2"]]),Zl={class:"map-view"},Gl={class:"legend"},Kl={__name:"ResultMap",setup(R){const{$gettext:L}=ke(),a=ml(),q=fl(),T=yl(),o=Le(),{layer:D,visibleLayer:_,nanLayer:A,type:N,loadLayer:S,displaySettings:e,hasOD:d,attributesWithOD:$,matSelectedIndex:w,changeOD:G,isIndexAvailable:M,selectedCategory:C,selectedFilter:i,attributes:m,applySettings:r,changeSelectedFilter:n,refreshVisibleLinks:s,filteredCategory:b,updateSelectedFeature:I,changeSelectedCategory:W,colorScale:j}=Vl(),F=g();function Ve(p){r(p),s(),I(),ye(()=>F.value.update())}function me(p){n(p),s(),I(),ye(()=>F.value.update())}function fe(p){W(p),s(),I(),ye(()=>F.value.update())}const X=g("");async function K(p,y=null){switch(p){case"links":S(a.links,null,y);break;case"rlinks":S(q.rlinks,null,y);break;case"nodes":S(a.nodes,null,y);break;case"rnodes":S(q.rnodes,null,y);break;case"od":S(T.layer,null,y);break;default:const h=await o.getOtherFile(p,"geojson"),B=await o.getOtherFile(p,"json");S(h,B,y);break}X.value=p,ye(()=>F.value.update())}const U=g(null),Y=Z(()=>o.availableLayers),ue=Z(()=>o.availableRasters),c=Z(()=>o.visibleLayers),x=Z(()=>o.styles);async function le(p){U.value=p.name,Y.value.includes(p.layer)?await K(p.layer,p):o.changeNotification({text:L("Preset Layer does not exist"),autoClose:!0,color:"error"}),Object.keys(p).includes("selectedIndex")&&M(p.selectedIndex)&&(G(p.selectedIndex),o.changeNotification({})),F.value.update()}const De=g(),ae=g("");async function Be(p){if(ae.value=U.value,await De.value.openDialog()){const h={version:1,name:ee.cloneDeep(ae.value),layer:ee.cloneDeep(X.value),displaySettings:ee.cloneDeep(p),selectedFilter:ee.cloneDeep(i.value)};C.value.filter(Ee=>b.value.includes(Ee)).length<b.value.length&&(h.selectedCategory=ee.cloneDeep(C.value)),$.value.includes(p.selectedFeature)&&d.value&&(h.selectedIndex=ee.cloneDeep(w.value)),o.addStyle(h),c.value.includes(ae.value)?o.changeNotification({text:L("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):o.changeNotification({text:L("Preset Saved"),autoClose:!0,color:"success"}),U.value=ee.cloneDeep(ae.value)}}const Pe=g();async function Oe(p){const y=p.name;await Pe.value.openDialog()&&(o.deleteStyle(y),y===U.value&&(U.value=null),o.changeNotification({text:L("Preset deleted"),autoClose:!0,color:"success"}),y.value="")}const te=g(!1),$e=g([]);function qe(p){if(p.action==="featureClick"){const y=p.feature.index;y?($e.value=D.value.features.filter(h=>h.properties.index===y)[0].properties,te.value=!0):o.changeNotification({text:L("Layer have no index. Cannot show properties"),autoClose:!0,color:"warning"})}else G(p.feature.index),F.value.update()}const Ae=We();return ge(()=>{if(Ae.initalPosition){const p=a.linksIsEmpty?q.rlinks:a.links;F.value.fitBounds(p)}}),(p,y)=>(v(),P("section",Zl,[t(jl,{"selected-category":l(C),"selected-filter":l(i),"layer-choices":Y.value,"selected-layer":X.value,"filter-choices":l(m),"filtered-cat":l(b),"preset-choices":x.value,"selected-preset":U.value,onUpdateSelectedCategory:fe,onUpdateSelectedFilter:me,onSelectLayer:K,onSelectPreset:le,onDeletePreset:Oe},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset"]),l(_).features?(v(),k(_l,{ref_key:"mapRef",ref:F,key:l(N)+String(l(e).extrusion),"selected-layer":X.value,"layer-type":l(N),extrusion:l(e).extrusion,labels:l(e).labels,links:l(_),"nan-links":l(A),"selected-feature":l(e).selectedFeature,opacity:l(e).opacity,offset:l(e).offset,onSelectClick:qe},{default:u(h=>[f("div",Gl,[_e(t(Cl,{key:"result",order:0,"color-scale":l(j),"display-settings":l(e)},null,8,["color-scale","display-settings"]),[[Me,l(_).features.length>0]])]),f("div",null,[t(Hl,{order:0,"display-settings":l(e),"feature-choices":l(m),type:l(N),onSubmit:Ve,onSavePreset:Be},null,8,["display-settings","feature-choices","type"]),t(hl,{order:1}),x.value.length>0?(v(),k(wl,{key:0,order:"2",choices:x.value,map:h.map,"available-layers":Y.value},null,8,["choices","map","available-layers"])):O("",!0),ue.value.length>0?(v(),k(gl,{key:1,order:3,map:h.map},null,8,["map"])):O("",!0)]),(v(!0),P(J,null,Q(x.value,B=>(v(),P("div",{key:B.name},[c.value.includes(B.name)&&Y.value.includes(B.layer)?(v(),k(Sl,{key:0,preset:B,map:h.map,order:c.value.indexOf(B.name)+1,"visible-layers":c.value},null,8,["preset","map","order","visible-layers"])):O("",!0)]))),128))]),_:1},8,["selected-layer","layer-type","extrusion","labels","links","nan-links","selected-feature","opacity","offset"])):O("",!0),t(kl,{modelValue:te.value,"onUpdate:modelValue":y[1]||(y[1]=h=>te.value=h),scrollable:"",persistent:"","max-width":"300",onKeydown:[y[2]||(y[2]=be(h=>te.value=!1,["enter"])),y[3]||(y[3]=be(h=>te.value=!1,["esc"]))]},{default:u(()=>[t(Ne,{"max-height":"60rem"},{default:u(()=>[t(bl,{class:"text-h5"},{default:u(()=>[z(V(l(L)("link Properties")),1)]),_:1}),t(Ue),t(xl,null,{default:u(()=>[t(we,null,{default:u(()=>[(v(!0),P(J,null,Q($e.value,(h,B)=>(v(),k(oe,{key:B,"model-value":h,label:B,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),t(Ue),t(Te,null,{default:u(()=>[t(je),t(H,{color:"success",variant:"text",onClick:y[0]||(y[0]=h=>te.value=!1)},{default:u(()=>[z(V(l(L)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Re,{ref_key:"presetDialog",ref:De,title:l(L)("Create or modify preset")},{default:u(()=>[t(oe,{modelValue:ae.value,"onUpdate:modelValue":y[4]||(y[4]=h=>ae.value=h),autofocus:"",rules:[h=>!!h||"Required."],label:l(L)("name")},null,8,["modelValue","rules","label"])]),_:1},8,["title"]),t(Re,{ref_key:"deleteDialog",ref:Pe,title:l(L)("Delete %{name}?",{name:U.value}),"confirm-button":l(L)("Delete"),"confirm-color":"error"},null,8,["title","confirm-button"])]))}},Xl=xe(Kl,[["__scopeId","data-v-0b3f83ab"]]);export{Xl as default};
