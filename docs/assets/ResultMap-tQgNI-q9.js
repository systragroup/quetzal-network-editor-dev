import{_ as ne,M as We,a as Ze,b as Ee,c as Ke,d as Ae,u as oe,r as x,o as Ne,e as z,w as Ge,f as Je,t as Qe,g as M,h as r,i as v,j as o,k as n,l as Xe,m as P,n as xe,p as Ye,q as V,s as C,v as S,x as g,V as he,y as Ce,z as Se,A as Ve,B as j,C as ge,D as fe,F as N,E as H,G as L,H as He,I as Le,J as te,K as J,L as le,N as $e,O as et,P as tt,T as lt,Q as at,R as ve,S as ze,U as Ie,W as G,X as Me,Y as Q,Z as st,$ as nt,a0 as K,a1 as ae,a2 as se,a3 as _,a4 as ot,a5 as it,a6 as rt,a7 as pe,a8 as T,a9 as ye,aa as Pe,ab as De}from"./index-hl9Cvg4H.js";import{c as Fe,M as ut,S as dt,u as ct}from"./StaticLayer-yZwTsKPj.js";import mt from"./LayerSelector-J51AytXE.js";const pt="pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",yt=l=>l,ht={name:"ResultMap",components:{MglMap:We,MglNavigationControl:Ze,MglScaleControl:Ee,MglGeojsonLayer:Ke,MglImageLayer:Ae},props:["selectedFeature","layerType","extrusion","links","nanLinks","opacity","offset"],events:["selectClick"],setup(l,a){const y=oe(),e=x(!1),t=pt,i=x(null),s=x({nodes:14,links:2});Ne(()=>{console.log(w.value)});const m=z(()=>y.mapStyle);Ge(m,c=>{i.value&&(i.value.getLayer("arrow")&&i.value.removeLayer("arrow"),i.value.getLayer("links")&&i.value.removeLayer("links"),i.value.getLayer("zones")&&i.value.removeLayer("zones"),i.value.getLayer("nodes")&&i.value.removeLayer("nodes"),e.value=!1,b())}),Je(()=>{var c;i.value&&b(),(c=i.value)!=null&&c.getLayer("arrow")&&i.value.removeLayer("arrow")});function b(){const c=i.value.getCenter();y.saveMapPosition({mapCenter:[c.lng,c.lat],mapZoom:i.value.getZoom()})}function D(c){i.value&&(e.value=!1);const h=new xe.LngLatBounds;["Polygon"].includes(w.value)?R.value.features.forEach(f=>{try{f.geometry.type==="Polygon"?h.extend([f.geometry.coordinates[0][0],f.geometry.coordinates[0][f.geometry.coordinates.length-1]]):h.extend([f.geometry.coordinates[0][0][0],f.geometry.coordinates[0][0][f.geometry.coordinates.length-1]])}catch{}}):R.value.features.forEach(f=>{h.extend([f.geometry.coordinates[0],f.geometry.coordinates[f.geometry.coordinates.length-1]])}),Object.keys(h).length!==0&&c.map.fitBounds(h,{padding:100}),c.map.loadImage(Ye,function(f,B){if(f){console.error("err image",f);return}c.map.addImage("arrow",B,{sdf:!0})}),i.value=c.map,U.value?y.changeNotification({text:yt("Right click and drag to tilt the map"),autoClose:!0,color:"success"}):c.map.dragRotate.disable(),e.value=!0}const k=x([]),F=x(null),{selectedFeature:p,layerType:w,extrusion:U,links:R,nanLinks:X,opacity:Y,offset:O}=Qe(l),q=z(()=>O.value?-1:1);function $(c){var h;if(c.map.getCanvas().style.cursor="pointer",k.value=c.mapboxEvent.features,(h=F.value)!=null&&h.isOpen()&&F.value.remove(),p.value&&w.value!=="Polygon"){const f=k.value[0].properties[p.value];f&&(F.value=new xe.Popup({closeButton:!1}).setLngLat([c.mapboxEvent.lngLat.lng,c.mapboxEvent.lngLat.lat]).setHTML(`${p.value}: <br> ${f}`).addTo(c.map))}}function ee(c){var h;k.value=[],(h=F.value)!=null&&h.isOpen()&&F.value.remove(),c.map.getCanvas().style.cursor=""}function ie(c){var h;k.value=c.mapboxEvent.features,((h=k.value)==null?void 0:h.length)>0&&a.emit("selectClick",{feature:k.value[0].properties,action:"featureClick"})}function re(c){var h;k.value=c.mapboxEvent.features,((h=k.value)==null?void 0:h.length)>0&&a.emit("selectClick",{feature:k.value[0].properties,action:"zoneClick"})}function ue(c){c.map.getCanvas().style.cursor="pointer"}function I(c){c.map.getCanvas().style.cursor=""}return{store:y,mapIsLoaded:e,mapboxPublicKey:t,minZoom:s,map:i,mapStyle:m,onMapLoaded:D,layerType:w,extrusion:U,links:R,nanLinks:X,opacity:Y,offset:O,offsetValue:q,enterLink:$,leaveLink:ee,selectClick:ie,zoneClick:re,zoneHover:ue,zoneLeave:I}}};function gt(l,a,y,e,t,i){const s=M("MglScaleControl"),m=M("MglNavigationControl"),b=M("MglGeojsonLayer"),D=M("MglImageLayer"),k=M("MglMap");return r(),v(k,{key:e.mapStyle,style:{width:"100%"},"access-token":e.mapboxPublicKey,"map-style":e.mapStyle,center:e.store.mapCenter,zoom:e.store.mapZoom,onLoad:e.onMapLoaded},{default:o(()=>[n(s,{position:"bottom-right"}),n(m,{position:"bottom-right"}),Xe(l.$slots,"default",{map:e.map,mapIsLoaded:e.mapIsLoaded}),e.layerType=="LineString"?(r(),v(b,{key:0,"source-id":"links",source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:e.minZoom.links,paint:{"line-color":["get","display_color"],"line-offset":["*",e.offsetValue*.5,["to-number",["get","display_width"]]],"line-opacity":e.opacity/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:e.enterLink,onMouseleave:e.leaveLink,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):P("",!0),e.layerType=="Point"?(r(),v(b,{key:1,"source-id":"nodes",source:{type:"geojson",data:e.links,buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:e.minZoom.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":e.opacity/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:e.enterLink,onMouseleave:e.leaveLink,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):P("",!0),e.layerType=="LineString"?(r(),v(D,{key:2,"source-id":"links",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:e.minZoom.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[e.offsetValue*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":e.opacity/100}}},null,8,["layer"])):P("",!0),e.layerType==="Polygon"&&e.extrusion?(r(),v(b,{key:3,"source-id":"polygon",source:{type:"geojson",data:e.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":e.opacity/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):P("",!0),e.layerType==="Polygon"&&!e.extrusion?(r(),v(b,{key:4,"source-id":"polygon",source:{type:"geojson",data:e.links,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":e.opacity/100}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):P("",!0),e.layerType==="Polygon"&&!e.extrusion?(r(),v(b,{key:5,"source-id":"NaNPolygon",source:{type:"geojson",data:e.nanLinks,promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:e.zoneHover,onMouseleave:e.zoneLeave,onClick:e.zoneClick,onContextmenu:e.selectClick},null,8,["source","layer","onMouseenter","onMouseleave","onClick","onContextmenu"])):P("",!0)]),_:3},8,["access-token","map-style","center","zoom","onLoad"])}const ft=ne(ht,[["render",gt]]),vt={name:"SidePanel",components:{},props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],events:["update-selectedCategory","select-layer","update-selected-filter","select-preset","delete-preset"],setup(){const l=oe(),a=z(()=>l.showLeftPanel),y=z(()=>l.windowHeight);return{store:l,showLeftPanel:a,windowHeight:y}},data(){return{showLeftPanelContent:!0,openMenu:!1,presetsMenu:!1,selectedCat:[],vmodelSelectedFilter:""}},watch:{showLeftPanel(l){l?setTimeout(()=>{this.showLeftPanelContent=!0},500):this.showLeftPanelContent=!1},selectedCategory(l,a){l!==a&&(this.selectedCat=l)},selectedFilter(l){l!==this.vmodelSelectedFilter&&(this.vmodelSelectedFilter=l)},selectedCat(l){l!==this.selectedCategory&&this.$emit("update-selectedCategory",l)},vmodelSelectedFilter(l,a){l!==this.selectedFilter&&(this.$emit("update-selectedFilter",l),this.selectedCat=this.selectedCategory)}},created(){this.vmodelSelectedFilter=this.selectedFilter,this.selectedCat=this.selectedCategory,this.$emit("update-selectedFilter",this.selectedFilter),this.$emit("update-selectedCategory",this.selectedCategory)},methods:{init(l){this.selectedCat=l.selectedCategory},showAll(){this.selectedCat.length===this.filteredCat.length?this.selectedCat=[]:this.selectedCat=this.filteredCat}}},Ct={class:"left-panel-content"},St={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},bt={class:"preset"},kt={class:"layer"},wt={class:"item"};function xt(l,a,y,e,t,i){return r(),V("section",{class:at(e.showLeftPanel?"left-panel elevation-4":"left-panel-close"),style:ve({width:e.showLeftPanel?"350px":"0px"})},[C("div",{class:"left-panel-toggle-btn elevation-4",onClick:a[0]||(a[0]=s=>e.store.changeLeftPanel())},[n(he,{size:"small",color:"secondarydark"},{default:o(()=>[S(g(e.showLeftPanel?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),n(lt,{name:"fade"},{default:o(()=>[Ce(C("div",Ct,[C("div",null,[C("div",St,[C("div",bt,[n(Ve,{location:"bottom","open-delay":"500"},{activator:o(({props:s})=>[n(he,j({style:{color:"white","padding-right":"2rem"}},s),{default:o(()=>[S(" fas fa-sliders-h ")]),_:2},1040)]),default:o(()=>[C("span",null,g(l.$gettext("Presets")),1)]),_:1}),n(ge,{modelValue:t.presetsMenu,"onUpdate:modelValue":a[1]||(a[1]=s=>t.presetsMenu=s),"close-delay":"100",transition:"slide-y-transition"},{activator:o(({props:s})=>[C("span",j({class:"custom-title crop"},s),g(y.selectedPreset||l.$gettext("Presets")),17)]),default:o(()=>[n(fe,null,{default:o(()=>[(r(!0),V(N,null,H(y.presetChoices,(s,m)=>(r(),v(te,{key:m,link:"",onClick:()=>l.$emit("select-preset",s)},{append:o(()=>[n(L,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:He(()=>l.$emit("delete-preset",s),["stop"])},null,8,["onClick"])]),default:o(()=>[n(Le,null,{default:o(()=>[S(g(s.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),n(L,{variant:"text",style:{color:"white"},icon:t.presetsMenu?"fas fa-chevron-left":"fas fa-chevron-down",onClick:a[2]||(a[2]=s=>t.presetsMenu=!t.presetsMenu)},null,8,["icon"])]),C("div",kt,[n(Ve,{location:"bottom","open-delay":"500"},{activator:o(({props:s})=>[n(L,j({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:t.selectedCat.length>0?"fa-eye fa":"fa-eye-slash fa",variant:"text"},s,{onClick:a[3]||(a[3]=m=>i.showAll())}),null,16,["icon"])]),default:o(()=>[C("span",null,g(t.selectedCat.length>0?l.$gettext("Hide All"):l.$gettext("Show All")),1)]),_:1}),n(ge,{modelValue:t.openMenu,"onUpdate:modelValue":a[4]||(a[4]=s=>t.openMenu=s),"close-delay":"100",transition:"slide-y-transition"},{activator:o(({props:s})=>[C("span",j({class:"custom-title crop"},s),g(y.selectedLayer),17)]),default:o(()=>[n(fe,null,{default:o(()=>[(r(!0),V(N,null,H(y.layerChoices,(s,m)=>(r(),v(te,{key:m,link:"",onClick:()=>l.$emit("select-layer",s)},{default:o(()=>[n(Le,null,{default:o(()=>[S(g(s),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),n(L,{style:{color:"white"},variant:"text",icon:t.openMenu?"fas fa-chevron-left":"fas fa-chevron-down",onClick:a[5]||(a[5]=s=>t.openMenu=!t.openMenu)},null,8,["icon"])]),n(J,{"max-width":"100%","min-width":"100%",height:e.windowHeight-180,class:"mx-auto"},{default:o(()=>[n(te,null,{default:o(()=>[n(le,{modelValue:t.vmodelSelectedFilter,"onUpdate:modelValue":a[6]||(a[6]=s=>t.vmodelSelectedFilter=s),items:y.filterChoices,"prepend-icon":"fas fa-filter",label:l.$gettext("filter"),"item-props.color":"secondarydark",color:"secondarydark"},null,8,["modelValue","items","label"])]),_:1}),n($e,{items:y.filteredCat,"item-height":45,height:e.windowHeight-80},{default:o(({item:s})=>[(r(),V("div",{key:t.vmodelSelectedFilter.concat(s),class:"container"},[n(et,null,{default:o(()=>[n(tt,{modelValue:t.selectedCat,"onUpdate:modelValue":a[7]||(a[7]=m=>t.selectedCat=m),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:s},null,8,["modelValue","value"])]),_:2},1024),C("div",wt,g(s),1)]))]),_:1},8,["items","height"])]),_:1},8,["height"])])])],512),[[Se,t.showLeftPanelContent]])]),_:1})],6)}const Vt=ne(vt,[["render",xt],["__scopeId","data-v-39eebd91"]]),d=l=>l,Lt={name:"ResultsSettings",props:["displaySettings","featureChoices","type"],events:["submit","save-preset"],setup(){const l=oe();return{windowHeight:z(()=>l.windowHeight-100)}},data(){return{showDialog:!1,parameters:[{name:d("selectedFeature"),type:"String",value:this.displaySettings.selectedFeature,units:"",hint:d("selectedFeature")},{name:d("minWidth"),type:"Number",value:this.displaySettings.minWidth,units:"a.u.",hint:d("minWidth")},{name:d("maxWidth"),type:"Number",value:this.displaySettings.maxWidth,units:"a.u.",hint:d("maxWidth")},{name:d("numStep"),type:"Number",value:this.displaySettings.numStep,units:"int",hint:d("numStep")},{name:d("opacity"),type:"Number",value:this.displaySettings.opacity,units:"number",hint:d("opacity")},{name:d("scale"),type:"String",value:this.displaySettings.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:d("scale")},{name:d("color map"),type:"String",choices:Object.keys(Fe.brewer).slice(0,36),value:this.displaySettings.cmap,units:"",hint:d("cmap to use")},{name:d("show NaN"),value:this.displaySettings.showNaN,hint:d("Hide NaN on map and color map")},{name:d("reverse color"),value:this.displaySettings.reverseColor,hint:d("reverse color scale")},{name:d("scale min"),type:"Number",value:this.displaySettings.minVal,units:"a.u.",hint:d("mininum value on the color Map")},{name:d("scale max"),type:"Number",value:this.displaySettings.maxVal,units:"a.u.",hint:d("maximum value on the color Map")},{name:d("custom scale"),value:this.displaySettings.fixScale,hint:d("customize to inputs values")},{name:d("Left side driving"),value:this.displaySettings.offset,hint:d("Select which side of the road the links are display")},{name:d("3D"),value:this.displaySettings.extrusion,hint:d("display zones as 3D extrusion")},{name:d("padding"),type:"Number",value:this.displaySettings.padding,units:"number",hint:d("range of colors")}],showHint:!1,showFixScale:!1,shake:!1,rules:{required:l=>!!l||d("Required"),largerThanZero:l=>l>0||d("should be larger than 0"),nonNegative:l=>l>=0||d("should be larger or equal to 0")}}},watch:{showDialog(l){this.refresh(),this.showFixScale=this.parameters[11].value},featureChoices(){this.refresh()}},methods:{toggleFixScale(){this.parameters[11].value?(this.showFixScale=!0,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal):this.showFixScale=!1},getColor(l){const a=[],y=this.parameters[8].value;let e=this.parameters[14].value;e=[e[0]/100,1-e[1]/100],e=y?e.reverse():e;const t=Fe.scale(l).padding(e).domain([0,100]).classes(25);for(let i=0;i<100;i++)a.push(t(i).hex());return y?a.reverse():a},refresh(){this.parameters[0].value=this.displaySettings.selectedFeature,this.parameters[1].value=this.displaySettings.minWidth,this.parameters[2].value=this.displaySettings.maxWidth,this.parameters[3].value=this.displaySettings.numStep,this.parameters[4].value=this.displaySettings.opacity,this.parameters[5].value=this.displaySettings.scale,this.parameters[6].value=this.displaySettings.cmap,this.parameters[7].value=this.displaySettings.showNaN,this.parameters[8].value=this.displaySettings.reverseColor,this.parameters[9].value=this.displaySettings.minVal,this.parameters[10].value=this.displaySettings.maxVal,this.parameters[11].value=this.displaySettings.fixScale,this.parameters[12].value=this.displaySettings.offset,this.parameters[13].value=this.displaySettings.extrusion,this.parameters[14].value=this.displaySettings.padding},submit(l){if(this.$refs.form.validate()){const a={selectedFeature:this.parameters[0].value,minWidth:Number(this.parameters[1].value),maxWidth:Number(this.parameters[2].value),numStep:Number(this.parameters[3].value),opacity:Number(this.parameters[4].value),scale:this.parameters[5].value,cmap:this.parameters[6].value,showNaN:this.parameters[7].value,reverseColor:this.parameters[8].value,minVal:Number(this.parameters[9].value),maxVal:Number(this.parameters[10].value),fixScale:this.parameters[11].value,offset:this.parameters[12].value,extrusion:this.parameters[13].value,padding:this.parameters[14].value};l==="apply"?this.$emit("submit",a):l==="save"&&this.$emit("save-preset",a)}else this.shake=!0,setTimeout(()=>{this.shake=!1},500)},cancel(){this.showDialog=!1}}},Mt={class:"setting"},Pt={class:"gradient"},Dt={class:"domain-title-small"},Ft={class:"domain-title"};function Nt(l,a,y,e,t,i){return r(),v(ge,{modelValue:t.showDialog,"onUpdate:modelValue":a[16]||(a[16]=s=>t.showDialog=s),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:o(({props:s})=>[C("div",Mt,[n(L,j({color:y.displaySettings.selectedFeature===null?"error":"regular"},s,{icon:"fa-solid fa-cog"}),null,16,["color"])])]),default:o(()=>[n(J,{width:"20rem",class:"setting-card","max-height":e.windowHeight,onKeydown:[a[15]||(a[15]=_(s=>i.submit("apply"),["enter"])),_(i.cancel,["esc"])]},{default:o(()=>[n(te,{class:"subtitle"},{append:o(()=>[n(L,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:a[0]||(a[0]=s=>t.showHint=!t.showHint)})]),default:o(()=>[S(g(l.$gettext("Settings"))+" ",1)]),_:1}),n(ze,{ref:"form","lazy-validation":""},{default:o(()=>[n(Ie,null,{default:o(()=>[n(G,null,{default:o(()=>[n(le,{modelValue:t.parameters[0].value,"onUpdate:modelValue":a[1]||(a[1]=s=>t.parameters[0].value=s),variant:"underlined",items:y.featureChoices,label:l.$gettext(t.parameters[0].name),hint:t.showHint?l.$gettext(t.parameters[0].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),n(Me,null,{default:o(()=>[(r(!0),V(N,null,H(t.parameters.slice(1,3),s=>(r(),v(G,{key:s.name},{default:o(()=>[n(Q,{modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,variant:"underlined",density:"compact",type:s.type,label:l.$gettext(s.name),suffix:s.units,hint:t.showHint?l.$gettext(s.hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),n(Me,null,{default:o(()=>[n(G,null,{default:o(()=>[n(Q,{modelValue:t.parameters[3].value,"onUpdate:modelValue":a[2]||(a[2]=s=>t.parameters[3].value=s),variant:"underlined",density:"compact",type:t.parameters[3].type,label:l.$gettext(t.parameters[3].name),suffix:t.parameters[3].units,hint:t.showHint?l.$gettext(t.parameters[3].hint):"","persistent-hint":t.showHint,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),n(G,null,{default:o(()=>[n(le,{modelValue:t.parameters[5].value,"onUpdate:modelValue":a[3]||(a[3]=s=>t.parameters[5].value=s),density:"compact",variant:"underlined",items:t.parameters[5].choices,label:l.$gettext(t.parameters[5].name),hint:t.showHint?l.$gettext(t.parameters[5].hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),n(le,{modelValue:t.parameters[6].value,"onUpdate:modelValue":a[4]||(a[4]=s=>t.parameters[6].value=s),density:"compact",items:t.parameters[6].choices,label:l.$gettext(t.parameters[6].name),hint:t.showHint?l.$gettext(t.parameters[6].hint):"","persistent-hint":t.showHint,required:"",variant:"solo"},{selection:o(({item:s})=>[C("div",Pt,[(r(!0),V(N,null,H(i.getColor(s.value),(m,b)=>(r(),V("span",{key:b,class:"grad-step-small",style:ve({backgroundColor:m})},null,4))),128)),C("span",Dt,g(s.value),1)])]),item:o(({props:s,item:m})=>[C("div",j({class:"gradient"},s),[(r(!0),V(N,null,H(i.getColor(m.value),(b,D)=>(r(),V("span",{key:D,class:"grad-step",style:ve({backgroundColor:b})},null,4))),128)),C("span",Ft,g(m.value),1)],16)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),n(st,{modelValue:t.parameters[14].value,"onUpdate:modelValue":a[5]||(a[5]=s=>t.parameters[14].value=s),step:"5",density:"compact",color:"primary",label:l.$gettext(t.parameters[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),n(nt,{modelValue:t.parameters[4].value,"onUpdate:modelValue":a[6]||(a[6]=s=>t.parameters[4].value=s),class:"align-center",color:"primary",label:l.$gettext(t.parameters[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":o(({modelValue:s})=>[S(g(Math.floor(s)+"%"),1)]),_:1},8,["modelValue","label"]),(r(),v(K,{key:t.parameters[12].name,modelValue:t.parameters[12].value,"onUpdate:modelValue":a[7]||(a[7]=s=>t.parameters[12].value=s),density:"compact",color:"primary",label:l.$gettext(t.parameters[12].name),hint:t.showHint?l.$gettext(t.parameters[12].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(r(),v(K,{key:t.parameters[7].name,modelValue:t.parameters[7].value,"onUpdate:modelValue":a[8]||(a[8]=s=>t.parameters[7].value=s),density:"compact",color:"primary",label:l.$gettext(t.parameters[7].name),hint:t.showHint?l.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(r(),v(K,{key:t.parameters[8].name,modelValue:t.parameters[8].value,"onUpdate:modelValue":a[9]||(a[9]=s=>t.parameters[8].value=s),density:"compact",color:"primary",label:l.$gettext(t.parameters[8].name),hint:t.showHint?l.$gettext(t.parameters[7].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(y.type)?(r(),v(K,{key:t.parameters[13].name,modelValue:t.parameters[13].value,"onUpdate:modelValue":a[10]||(a[10]=s=>t.parameters[13].value=s),density:"compact",color:"primary",label:l.$gettext(t.parameters[13].name),disabled:!["Polygon","extrusion"].includes(y.type),hint:t.showHint?l.$gettext(t.parameters[13].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","disabled","hint","persistent-hint"])):P("",!0),(r(),v(K,{key:t.parameters[11].name,modelValue:t.parameters[11].value,"onUpdate:modelValue":[a[11]||(a[11]=s=>t.parameters[11].value=s),a[12]||(a[12]=s=>i.toggleFixScale(t.parameters[11].name))],density:"compact",variant:"underlined",color:"primary",label:l.$gettext(t.parameters[11].name),hint:t.showHint?l.$gettext(t.parameters[11].hint):"","persistent-hint":t.showHint},null,8,["modelValue","label","hint","persistent-hint"])),(r(!0),V(N,null,H(t.parameters.slice(9,11),s=>Ce((r(),v(Q,{key:s.name,modelValue:s.value,"onUpdate:modelValue":m=>s.value=m,variant:"underlined",type:s.type,label:l.$gettext(s.name),suffix:s.units,hint:t.showHint?l.$gettext(s.hint):"","persistent-hint":t.showHint,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])),[[Se,t.showFixScale]])),128))]),_:1})]),_:1})]),_:1},512),n(ae,null,{default:o(()=>[n(L,{color:"grey",variant:"text",onClick:i.cancel},{default:o(()=>[S(g(l.$gettext("Cancel")),1)]),_:1},8,["onClick"]),n(L,{color:"green-darken-1",variant:"text",onClick:a[13]||(a[13]=s=>i.submit("apply"))},{default:o(()=>[S(g(l.$gettext("Apply")),1)]),_:1}),n(se),n(L,{color:"grey",variant:"text",onClick:a[14]||(a[14]=s=>i.submit("save"))},{default:o(()=>[n(he,{size:"small",start:""},{default:o(()=>[S(" fas fa-sliders-h ")]),_:1}),S(" "+g(l.$gettext("save")),1)]),_:1})]),_:1})]),_:1},8,["max-height","onKeydown"])]),_:1},8,["modelValue"])}const Ht=ne(Lt,[["render",Nt],["__scopeId","data-v-91477368"]]),A=l=>l,zt={name:"ResultMap",components:{MapResults:ft,ResultsSidePanel:Vt,ResultsSettings:Ht,MapLegend:ut,LayerSelector:mt,StaticLayer:dt},setup(){const l=ot(),a=it(),y=rt(),e=oe(),{visibleLayer:t,NaNLayer:i,type:s,loadLayer:m,displaySettings:b,hasOD:D,ODfeatures:k,matSelectedIndex:F,changeOD:p,isIndexAvailable:w,selectedCategory:U,selectedFilter:R,attributes:X,applySettings:Y,changeSelectedFilter:O,filteredCategory:q,updateSelectedFeature:$,changeSelectedCategory:ee,colorScale:ie}=ct();function re(u){O(u),$()}function ue(u){ee(u),$()}const I=x("links");async function c(u){switch(I.value=u,u){case"links":m(l.links,null,null,"headway");break;case"rlinks":m(a.rlinks,null,null,"speed");break;case"nodes":m(l.nodes,null,null,"boardings");break;case"rnodes":m(a.rnodes,null,null,"boardings");break;case"od":m(y.layer,null,null,"name");break;default:const we=await e.getOtherFile(u,"geojson"),E=await e.getOtherFile(u,"json");m(we,E,null,"");break}}const h=x(null),f=z(()=>e.availableLayers);Ne(async()=>{f.value.lenght>0&&(I.value=f.value[0]),await c(I.value)});const B=z(()=>e.visibleRasters),_e=z(()=>e.styles),W=x(""),de=x(!1),ce=x(!1),Z=x(""),me=x({});async function Ue(u){h.value=u.name,f.value.includes(u.layer)?(await c(u.layer),X.value.includes(u==null?void 0:u.selectedFilter)?(O(u.selectedFilter),Object.keys(u).includes("selectedCategory")&&ee(u.selectedCategory)):Object.keys(u).includes("selectedFilter")&&e.changeNotification({text:u.selectedFilter+" "+A("filter does not exist. use default one"),autoClose:!0,color:"error"})):e.changeNotification({text:A("Preset Layer does not exist"),autoClose:!0,color:"error"}),Y(u.displaySettings),Object.keys(u).includes("selectedIndex")&&w(u.selectedIndex)&&(p(u.selectedIndex),e.changeNotification({}))}function Re(u){W.value=u.name,de.value=!0}function Te(u){me.value=u,Z.value=h.value,ce.value=!0}async function je(u){if((await u).valid){ce.value=!1;const E={name:T.cloneDeep(Z.value),layer:T.cloneDeep(I.value),displaySettings:T.cloneDeep(me.value),selectedFilter:T.cloneDeep(R.value)};U.value.filter(Be=>q.value.includes(Be)).length<q.value.length&&(E.selectedCategory=T.cloneDeep(U)),k.value.includes(me.value.selectedFeature)&&D.value&&(E.selectedIndex=F.value),e.addStyle(E),B.value.includes(Z.value)?e.changeNotification({text:A("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):e.changeNotification({text:A("Preset Saved"),autoClose:!0,color:"success"}),h.value=T.cloneDeep(Z.value)}}function Oe(){e.deleteStyle(W.value),de.value=!1,W.value===h.value&&(h.value=null),e.changeNotification({text:A("Preset deleted"),autoClose:!0,color:"success"}),W.value=""}const be=x(!1),ke=x([]);function qe(u){u.action==="featureClick"?(ke.value=u.feature,be.value=!0):p(u.feature.index)}return{store:e,selectedLayer:I,selectedPreset:h,availableLayers:f,visibleLayer:t,NaNLayer:i,type:s,displaySettings:b,selectedCategory:U,selectedFilter:R,attributes:X,filteredCategory:q,applySettings:Y,colorScale:ie,updateSelectedFilter:re,updateSelectedCategory:ue,changeLayer:c,changePreset:Ue,showDeleteDialog:de,presetToDelete:W,clickDeletePreset:Re,deletePreset:Oe,showPresetDialog:ce,inputName:Z,clickSavePreset:Te,createPreset:je,featureClicked:qe,availableStyles:_e,visibleRasters:B,showDialog:be,formData:ke}}},It={class:"map-view"},_t={class:"left-panel"},Ut={style:{display:"flex"}};function Rt(l,a,y,e,t,i){const s=M("ResultsSidePanel"),m=M("MapLegend"),b=M("ResultsSettings"),D=M("LayerSelector"),k=M("StaticLayer"),F=M("MapResults");return r(),V("section",It,[n(s,{ref:"sidePanel","selected-category":e.selectedCategory,"selected-filter":e.selectedFilter,"layer-choices":e.availableLayers,"selected-layer":e.selectedLayer,"filter-choices":e.attributes,"filtered-cat":e.filteredCategory,"preset-choices":e.availableStyles,"selected-preset":e.selectedPreset,onUpdateSelectedCategory:e.updateSelectedCategory,onUpdateSelectedFilter:e.updateSelectedFilter,onSelectLayer:e.changeLayer,onSelectPreset:e.changePreset,onDeletePreset:e.clickDeletePreset},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset","onUpdateSelectedCategory","onUpdateSelectedFilter","onSelectLayer","onSelectPreset","onDeletePreset"]),C("div",_t,[Ce(n(m,{key:"result",order:0,"color-scale":e.colorScale,"display-settings":e.displaySettings},null,8,["color-scale","display-settings"]),[[Se,e.visibleLayer.features.length>0]])]),e.visibleLayer.features?(r(),v(F,{key:e.type+String(e.displaySettings.extrusion),"layer-type":e.type,extrusion:e.displaySettings.extrusion,links:e.visibleLayer,"nan-links":e.NaNLayer,"selected-feature":e.displaySettings.selectedFeature,opacity:e.displaySettings.opacity,offset:e.displaySettings.offset,onSelectClick:e.featureClicked},{default:o(p=>[C("div",Ut,[n(b,{"display-settings":e.displaySettings,"feature-choices":e.attributes,type:e.type,onSubmit:e.applySettings,onSavePreset:e.clickSavePreset},null,8,["display-settings","feature-choices","type","onSubmit","onSavePreset"]),e.availableStyles.length>0?(r(),v(D,{key:0,choices:e.availableStyles,"available-layers":e.availableLayers},null,8,["choices","available-layers"])):P("",!0)]),(r(!0),V(N,null,H(e.availableStyles,w=>(r(),V("div",{key:w.name},[e.visibleRasters.includes(w.name)&&e.availableLayers.includes(w.layer)?(r(),v(k,{key:0,preset:w,map:p.map,order:e.visibleRasters.indexOf(w.name)+1},null,8,["preset","map","order"])):P("",!0)]))),128))]),_:1},8,["layer-type","extrusion","links","nan-links","selected-feature","opacity","offset","onSelectClick"])):P("",!0),n(pe,{modelValue:e.showDialog,"onUpdate:modelValue":a[1]||(a[1]=p=>e.showDialog=p),scrollable:"",persistent:"","max-width":"300",onKeydown:[a[2]||(a[2]=_(p=>e.showDialog=!1,["enter"])),a[3]||(a[3]=_(p=>e.showDialog=!1,["esc"]))]},{default:o(()=>[n(J,{"max-height":"60rem"},{default:o(()=>[n(ye,{class:"text-h5"},{default:o(()=>[S(g(l.$gettext("link Properties")),1)]),_:1}),n(Pe),n(De,null,{default:o(()=>[n(fe,null,{default:o(()=>[(r(!0),V(N,null,H(e.formData,(p,w)=>(r(),v(Q,{key:w,"model-value":p,label:w,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),n(Pe),n(ae,null,{default:o(()=>[n(se),n(L,{color:"success",variant:"text",onClick:a[0]||(a[0]=p=>e.showDialog=!1)},{default:o(()=>[S(g(l.$gettext("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(pe,{modelValue:e.showPresetDialog,"onUpdate:modelValue":a[6]||(a[6]=p=>e.showPresetDialog=p),persistent:"","max-width":"400",onKeydown:a[7]||(a[7]=_(p=>e.showPresetDialog=!1,["esc"]))},{default:o(()=>[n(J,null,{default:o(()=>[n(ye,{class:"text-h5"},{default:o(()=>[S(g(l.$gettext("Create or modify preset")),1)]),_:1}),n(ze,{"validate-on":"submit lazy",onSubmit:He(e.createPreset,["prevent"])},{default:o(()=>[n(De,null,{default:o(()=>[n(Ie,null,{default:o(()=>[n(G,{cols:"12"},{default:o(()=>[n(Q,{modelValue:e.inputName,"onUpdate:modelValue":a[4]||(a[4]=p=>e.inputName=p),autofocus:"",rules:[p=>!!p||"Required."],label:l.$gettext("name")},null,8,["modelValue","rules","label"])]),_:1})]),_:1})]),_:1}),n(ae,null,{default:o(()=>[n(se),n(L,{color:"grey",variant:"text",onClick:a[5]||(a[5]=p=>e.showPresetDialog=!1)},{default:o(()=>[S(g(l.$gettext("Cancel")),1)]),_:1}),n(L,{color:"green-darken-1",variant:"text",type:"submit"},{default:o(()=>[S(g(l.$gettext("ok")),1)]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),n(pe,{modelValue:e.showDeleteDialog,"onUpdate:modelValue":a[9]||(a[9]=p=>e.showDeleteDialog=p),persistent:"","max-width":"400",onKeydown:[a[10]||(a[10]=_(p=>e.showDeleteDialog=!1,["esc"])),_(e.deletePreset,["enter"])]},{default:o(()=>[n(J,null,{default:o(()=>[n(ye,{class:"text-h5"},{default:o(()=>[S(g(l.$gettext("Delete")+" "+e.presetToDelete+" ?"),1)]),_:1}),n(ae,null,{default:o(()=>[n(se),n(L,{color:"grey",variant:"text",onClick:a[8]||(a[8]=p=>e.showDeleteDialog=!1)},{default:o(()=>[S(g(l.$gettext("Cancel")),1)]),_:1}),n(L,{color:"error",variant:"text",onClick:e.deletePreset},{default:o(()=>[S(g(l.$gettext("delete")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"])])}const Bt=ne(zt,[["render",Rt],["__scopeId","data-v-019a1f86"]]);export{Bt as default};
