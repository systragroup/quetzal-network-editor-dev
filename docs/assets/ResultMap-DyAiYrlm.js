import{_ as xe,u as ke,t as he,a as we,b as ze,r as y,s as He,c as K,w as Z,o as Ze,d as ge,e as Ge,f as D,g as d,h as b,i as u,j as n,k as Ke,l as j,m as l,M as Ye,n as Je,p as oe,q as Qe,v as Xe,x as el,y as ll,z as al,A as f,B as F,C as k,V as se,D as Le,E as de,F as Ce,G as Se,H as Q,I as X,J as ve,K as $e,L as G,N as tl,O as ne,P as Fe,Q as _e,R as re,S as sl,T as nl,U as ol,W as Ne,X as ul,Y as il,Z as Ie,$ as be,a0 as rl,a1 as ue,a2 as Ve,a3 as ce,a4 as dl,a5 as vl,a6 as cl,a7 as pl,a8 as ie,a9 as We,aa as Te,ab as ml,ac as fl,ad as yl,ae as hl,af as gl,ag as bl,ah as Ue,ai as xl,aj as kl,ak as Re,al as le,am as ye}from"./index-DxwmzM9S.js";import{u as Vl,M as Cl,S as Sl}from"./StaticLayer-CvKYVCaF.js";import wl from"./LayerSelector-BPmezeh2.js";const Ll={__name:"MapResults",props:["selectedFeature","layerType","extrusion","labels","links","nanLinks","opacity","offset","selectedLayer"],emits:["selectClick"],setup(R,{expose:w,emit:t}){const{$gettext:B}=ke(),z=R,{selectedFeature:o,layerType:M,extrusion:L,labels:A,links:_,nanLinks:C,opacity:e,offset:r,selectedLayer:P}=he(z),S=t,E=we(),N=ze(),x=y(!1),i=He(null),v=y({nodes:14,links:2}),a=K(()=>N.mapStyle);Z(a,()=>{i.value&&(i.value.getLayer("arrow")&&i.value.removeLayer("arrow"),i.value.getLayer("results")&&i.value.removeLayer("results"),i.value.getLayer("labels")&&i.value.removeLayer("labels"),i.value.getLayer("NaNresults")&&i.value.removeLayer("NaNresults"),x.value=!1,s())}),Ze(()=>{var c;i.value&&s(),(c=i.value)!=null&&c.getLayer("arrow")&&i.value.removeLayer("arrow")}),ge(()=>{I(_.value)});function s(){const c=i.value.getCenter();N.saveMapPosition({mapCenter:[c.lng,c.lat],mapZoom:i.value.getZoom()})}function h(c){i.value&&(x.value=!1),i.value=c.map,i.value.loadImage(al,function(g,H){if(g){console.error("err image",g);return}i.value.addImage("arrow",H,{sdf:!0})}),L.value&&E.changeNotification({text:B("Right click and drag to tilt the map"),autoClose:!0,color:"success"}),x.value=!0}function I(c){const g=N.getBounds(c);N.getZoomAndCenter(g,U.value.clientWidth,U.value.clientHeight)}const{canvasDiv:U}=Ge(i),W=y([]),ee=y(null);w({update:O,fitBounds:I});function O(){var c;x.value&&(i.value.getSource("results").setData(_.value),(c=i.value.getSource("NaNresults"))==null||c.setData(C.value))}Z(P,()=>I(_.value));const pe=K(()=>r.value?-1:1);function me(c){var g;if(c.map.getCanvas().style.cursor="pointer",W.value=c.mapboxEvent.features,(g=ee.value)!=null&&g.isOpen()&&ee.value.remove(),o.value&&M.value!=="Polygon"){const H=W.value[0].properties[o.value];H&&(ee.value=new ll.Popup({closeButton:!1}).setLngLat([c.mapboxEvent.lngLat.lng,c.mapboxEvent.lngLat.lat]).setHTML(`${o.value}: <br> ${H}`).addTo(c.map))}}function fe(c){var g;W.value=[],(g=ee.value)!=null&&g.isOpen()&&ee.value.remove(),c.map.getCanvas().style.cursor=""}function q(c){var g;W.value=c.mapboxEvent.features,((g=W.value)==null?void 0:g.length)>0&&S("selectClick",{feature:W.value[0].properties,action:"featureClick"})}function Y(c){var g;W.value=c.mapboxEvent.features,((g=W.value)==null?void 0:g.length)>0&&S("selectClick",{feature:W.value[0].properties,action:"zoneClick"})}function T(c){c.map.getCanvas().style.cursor="pointer"}function J(c){c.map.getCanvas().style.cursor=""}return(c,g)=>(d(),D("div",{ref_key:"canvasDiv",ref:U,class:"map"},[(d(),b(l(el),{key:a.value,style:{width:"100%"},"access-token":l(N).key,"map-style":a.value,center:l(N).mapCenter,zoom:l(N).mapZoom,onLoad:h},{default:u(()=>[n(l(Ye),{position:"bottom-right"}),n(l(Je),{position:"bottom-right","visualize-pitch":!0}),Ke(c.$slots,"default",{map:i.value,mapIsLoaded:x.value},void 0,!0),l(M)=="LineString"?(d(),b(l(oe),{key:0,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(_),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"line",minzoom:v.value.links,paint:{"line-color":["get","display_color"],"line-offset":["*",pe.value*.5,["to-number",["get","display_width"]]],"line-opacity":l(e)/100,"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0],"line-width":["get","display_width"]},layout:{"line-sort-key":["to-number",["get","display_width"]],"line-cap":"round"}},onMouseenter:me,onMouseleave:fe,onClick:Y,onContextmenu:q},null,8,["source","layer"])):j("",!0),l(M)=="Point"?(d(),b(l(oe),{key:1,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(_),buffer:0,promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"circle",minzoom:v.value.links,paint:{"circle-color":["get","display_color"],"circle-radius":["get","display_width"],"circle-opacity":l(e)/100},layout:{"circle-sort-key":["to-number",["get","display_width"]]}},onMouseenter:me,onMouseleave:fe,onClick:Y,onContextmenu:q},null,8,["source","layer"])):j("",!0),l(M)=="LineString"?(d(),b(l(Qe),{key:2,"source-id":"results",type:"symbol",source:"links","layer-id":"arrow",layer:{type:"symbol",minzoom:v.value.nodes,layout:{"symbol-placement":"line","symbol-spacing":200,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":["*",.1,["to-number",["get","display_width"]]],"icon-rotate":90,"icon-offset":[pe.value*5,5]},paint:{"icon-color":["get","display_color"],"icon-opacity":l(e)/100}}},null,8,["layer"])):j("",!0),l(M)==="Polygon"&&l(L)?(d(),b(l(oe),{key:3,"source-id":"results",reactive:!1,source:{type:"geojson",data:l(_),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill-extrusion",paint:{"fill-extrusion-color":["get","display_color"],"fill-extrusion-opacity":l(e)/100,"fill-extrusion-height":["*",1e3,["to-number",["get","display_width"]]]}},onMouseenter:T,onMouseleave:J,onClick:Y,onContextmenu:q},null,8,["source","layer"])):j("",!0),l(M)==="Polygon"&&!l(L)?(d(),b(l(oe),{key:4,reactive:!1,"source-id":"results",source:{type:"geojson",data:l(_),promoteId:"index"},"layer-id":"results",layer:{interactive:!0,type:"fill",paint:{"fill-color":["get","display_color"],"fill-opacity":l(e)/100}},onMouseenter:T,onMouseleave:J,onClick:Y,onContextmenu:q},null,8,["source","layer"])):j("",!0),l(M)==="Polygon"&&!l(L)?(d(),b(l(oe),{key:5,reactive:!1,"source-id":"NaNresults",source:{type:"geojson",data:l(C),promoteId:"index"},"layer-id":"NaNresults",layer:{interactive:!0,type:"fill",paint:{"fill-outline-color":"#cccccc","fill-color":"rgba(0, 0, 0, 0)"}},onMouseenter:T,onMouseleave:J,onClick:Y,onContextmenu:q},null,8,["source"])):j("",!0),n(l(Xe),{type:"symbol","source-id":"results",source:"links","layer-id":"labels",layer:{type:"symbol",layout:{"text-field":["get",l(A)],"text-variable-anchor":["top"],"text-radial-offset":.6,"text-justify":"auto"},paint:{"text-color":c.$vuetify.theme.current.colors.black}}},null,8,["layer"])]),_:3},8,["access-token","map-style","center","zoom"]))],512))}},_l=xe(Ll,[["__scopeId","data-v-1ee9b317"]]),Nl={style:{"margin-top":"20px","margin-bottom":"20px","margin-right":"20px"}},Ml={class:"preset"},Dl={class:"title-div"},Pl={class:"custom-title"},$l={class:"crop"},Fl={class:"layer"},Il={class:"title-div"},Ul={class:"custom-title"},Rl={class:"crop"},zl={style:{"padding-top":"0.5rem"}},Wl={class:"item"},Tl={__name:"ResultsSidePanel",props:["selectedCategory","selectedFilter","filterChoices","filteredCat","layerChoices","selectedLayer","presetChoices","selectedPreset"],emits:["update-selectedCategory","select-layer","select-preset","delete-preset","update-selectedFilter"],setup(R,{emit:w}){const{$gettext:t}=ke(),B=R,z=w,o=we(),M=K(()=>o.isMobile),L=K(()=>o.showLeftPanel),A=y(!0),_=y(500);ge(()=>{_.value=M.value?window.innerWidth-100:350}),Z(L,i=>{i?setTimeout(()=>{A.value=!0},500):A.value=!1});const C=y(!1),e=y(!1),{selectedCategory:r,filteredCat:P}=he(B),S=y([]);Z(r,(i,v)=>{i!==v&&(S.value=i)}),Z(S,i=>{i!==r.value&&z("update-selectedCategory",i)});function E(){S.value.length===P.value.length?S.value=[]:S.value=P.value}const{selectedFilter:N}=he(B),x=y("");return Z(N,i=>{i!==x.value&&(x.value=i)}),Z(x,i=>{i!==N.value&&(z("update-selectedFilter",i),S.value=r.value)}),ge(()=>{x.value=N.value,S.value=r.value,z("update-selectedFilter",N.value),z("update-selectedCategory",r.value)}),(i,v)=>(d(),D("section",{class:il(L.value?"left-panel elevation-4":"left-panel-close"),style:de({width:L.value?_.value+"px":"0px"})},[f("div",{class:"left-panel-toggle-btn elevation-4",onClick:v[0]||(v[0]=a=>l(o).changeLeftPanel())},[n(se,{size:"small",color:"secondarydark"},{default:u(()=>[F(k(L.value?"fas fa-chevron-left":"fas fa-chevron-right"),1)]),_:1})]),n(ul,{name:"fade"},{default:u(()=>[Le(f("div",{class:"left-panel-content",style:de({width:L.value?_.value+"px":"0px"})},[f("div",null,[f("div",Nl,[f("div",Ml,[n(se,{style:{color:"white","padding-right":"2rem","padding-left":"1rem"}},{default:u(()=>[...v[7]||(v[7]=[F(" fas fa-sliders-h ",-1)])]),_:1}),n(Ce,{modelValue:e.value,"onUpdate:modelValue":v[1]||(v[1]=a=>e.value=a),"close-delay":"100",location:"bottom center",transition:"slide-y-transition"},{activator:u(({props:a})=>[f("div",ne({class:"menu-container"},a),[f("div",Dl,[f("span",Pl,k(l(t)("Presets")),1),f("span",$l,k(R.selectedPreset),1)]),n(se,{variant:"text",style:{color:"white"}},{default:u(()=>[F(k(e.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)]),default:u(()=>[n(Se,null,{default:u(()=>[(d(!0),D(Q,null,X(R.presetChoices,(a,s)=>(d(),b(ve,{key:s,link:"",onClick:()=>i.$emit("select-preset",a)},{append:u(()=>[n(G,{variant:"text",icon:"fas fa-trash",size:"small",color:"grey",class:"ml-10",onClick:tl(()=>i.$emit("delete-preset",a),["stop"])},null,8,["onClick"])]),default:u(()=>[n($e,null,{default:u(()=>[F(k(a.name),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),n(Fe,{location:"bottom","open-delay":"300"},{activator:u(({props:a})=>[n(G,ne({variant:"text"},a,{disabled:R.presetChoices.length===0,style:{color:"white"},icon:"fas fa-download",onClick:v[2]||(v[2]=s=>l(o).exportFile("styles.json"))}),null,16,["disabled"])]),default:u(()=>[f("span",null,k(l(t)("Dowload presets")),1)]),_:1})]),f("div",Fl,[n(Fe,{location:"bottom","open-delay":"500"},{activator:u(({props:a})=>[n(G,ne({style:{color:"white",flex:0,"padding-left":"1.1rem","padding-right":"1.5rem"},class:"eye-button",icon:S.value.length==l(P).length?"fa-eye-slash fa":"fa-eye fa",variant:"text"},a,{onClick:v[3]||(v[3]=s=>E())}),null,16,["icon"])]),default:u(()=>[f("span",null,k(S.value.length==l(P).length?l(t)("Hide All"):l(t)("Show All")),1)]),_:1}),n(Ce,{modelValue:C.value,"onUpdate:modelValue":v[4]||(v[4]=a=>C.value=a),"close-delay":"100",transition:"slide-y-transition"},{activator:u(({props:a})=>[f("div",ne({class:"title-div"},a),[f("div",ne({class:"menu-container"},a),[f("div",Il,[f("span",Ul,k(l(t)("Layer")),1),f("span",Rl,k(R.selectedLayer),1)]),n(se,{variant:"text",style:{color:"white"}},{default:u(()=>[F(k(C.value?"fas fa-chevron-left":"fas fa-chevron-down"),1)]),_:1})],16)],16)]),default:u(()=>[n(Se,null,{default:u(()=>[(d(!0),D(Q,null,X(R.layerChoices,(a,s)=>(d(),b(ve,{key:s,link:"",onClick:()=>i.$emit("select-layer",a)},{default:u(()=>[n($e,null,{default:u(()=>[F(k(a),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),n(se)]),n(_e,{"max-width":"100%","min-width":"100%",height:"calc(100vh - 250px)",class:"mx-auto scrollable"},{default:u(()=>[n(ve,null,{default:u(()=>[f("div",zl,[n(re,{modelValue:x.value,"onUpdate:modelValue":v[5]||(v[5]=a=>x.value=a),items:R.filterChoices.sort(),"prepend-inner-icon":"fas fa-filter",label:l(t)("filter"),variant:"outlined","hide-details":"",density:"compact",color:"secondarydark"},null,8,["modelValue","items","label"])])]),_:1}),n(sl,{items:l(P),"item-height":45,height:"calc(100vh - 330px)"},{default:u(({item:a})=>[(d(),D("div",{key:x.value.concat(a),class:"container"},[n(nl,null,{default:u(()=>[n(ol,{modelValue:S.value,"onUpdate:modelValue":v[6]||(v[6]=s=>S.value=s),class:"ma-2 pl-2","true-icon":"fa-eye fa","false-icon":"fa-eye-slash fa",color:"primary",value:a},null,8,["modelValue","value"])]),_:2},1024),f("div",Wl,k(a),1)]))]),_:1},8,["items"])]),_:1})])])],4),[[Ne,A.value]])]),_:1})],6))}},jl=xe(Tl,[["__scopeId","data-v-26cce869"]]),Bl={class:"gradient-preview"},Ol={class:"preview-title"},ql={class:"gradient"},Al={class:"domain-title"},El={__name:"ResultsSettings",props:["displaySettings","featureChoices","type","order"],emits:["submit","save-preset"],setup(R,{emit:w}){const{$gettext:t}=ke(),B=R,z=w,{displaySettings:o,featureChoices:M,type:L,order:A}=he(B),_=K(()=>{const v=["OrRd","Spectral","RdYlGn","Viridis","YlGn","RdYlBu"],a=Object.keys(Ie.brewer).slice(0,36).filter(s=>!v.includes(s));return[...v,...a]}),C=y(!1),e=y([{name:t("selectedFeature"),type:"String",value:o.value.selectedFeature,units:"",hint:t("selectedFeature")},{name:t("minWidth"),type:"Number",value:o.value.minWidth,units:"a.u.",hint:t("minWidth")},{name:t("maxWidth"),type:"Number",value:o.value.maxWidth,units:"a.u.",hint:t("maxWidth")},{name:t("numStep"),type:"Number",value:o.value.numStep,units:"int",hint:t("numStep")},{name:t("opacity"),type:"Number",value:o.value.opacity,units:"number",hint:t("opacity")},{name:t("scale"),type:"String",value:o.value.scale,choices:["linear","sqrt","log","exp","quad"],units:"",hint:t("scale")},{name:t("color map"),type:"String",choices:_,value:o.value.cmap,units:"",hint:t("cmap to use")},{name:t("show NaN"),value:o.value.showNaN,hint:t("Hide NaN on map and color map")},{name:t("reverse color"),value:o.value.reverseColor,hint:t("reverse color scale")},{name:t("scale min"),type:"Number",value:o.value.minVal,units:"a.u.",hint:t("mininum value on the color Map")},{name:t("scale max"),type:"Number",value:o.value.maxVal,units:"a.u.",hint:t("maximum value on the color Map")},{name:t("custom scale"),value:o.value.fixScale,hint:t("customize to inputs values")},{name:t("Left side driving"),value:o.value.offset,hint:t("Select which side of the road the links are display")},{name:t("3D"),value:o.value.extrusion,hint:t("display zones as 3D extrusion")},{name:t("padding"),type:"Number",value:o.value.padding,units:"number",hint:t("range of colors")},{name:t("labels"),type:"String",value:o.value.labels,hint:t("show labels")}]),r=y(!1),P=y(!1);y(!1),Z(C,()=>{N(),P.value=e.value[11].value}),Z(M,()=>N());function S(){e.value[11].value?(P.value=!0,e.value[9].value=o.value.minVal,e.value[10].value=o.value.maxVal):P.value=!1}function E(v){const a=[],s=e.value[8].value;let h=e.value[14].value;h=[h[0]/100,1-h[1]/100],h=s?h.reverse():h;const I=Ie.scale(v).padding(h).domain([0,100]).classes(25);for(let U=0;U<100;U++)a.push(I(U).hex());return s?a.reverse():a}function N(){e.value[0].value=o.value.selectedFeature,e.value[1].value=o.value.minWidth,e.value[2].value=o.value.maxWidth,e.value[3].value=o.value.numStep,e.value[4].value=o.value.opacity,e.value[5].value=o.value.scale,e.value[6].value=o.value.cmap,e.value[7].value=o.value.showNaN,e.value[8].value=o.value.reverseColor,e.value[9].value=o.value.minVal,e.value[10].value=o.value.maxVal,e.value[11].value=o.value.fixScale,e.value[12].value=o.value.offset,e.value[13].value=o.value.extrusion,e.value[14].value=o.value.padding,e.value[15].value=o.value.labels}function x(v){{const a={selectedFeature:e.value[0].value,minWidth:Number(e.value[1].value),maxWidth:Number(e.value[2].value),numStep:Number(e.value[3].value),opacity:Number(e.value[4].value),scale:e.value[5].value,cmap:e.value[6].value,showNaN:e.value[7].value,reverseColor:e.value[8].value,minVal:Number(e.value[9].value),maxVal:Number(e.value[10].value),fixScale:e.value[11].value,offset:e.value[12].value,extrusion:e.value[13].value,padding:e.value[14].value,labels:e.value[15].value};v==="apply"?z("submit",a):v==="save"&&z("save-preset",a)}}function i(){C.value=!1}return(v,a)=>(d(),b(Ce,{modelValue:C.value,"onUpdate:modelValue":a[17]||(a[17]=s=>C.value=s),"close-on-content-click":!1,persistent:"","no-click-animation":"",location:"bottom end",offset:"5",transition:"scale-transition"},{activator:u(({props:s})=>[f("div",{class:"layer-button",style:de({"--n":l(A)})},[n(G,ne({color:l(o).selectedFeature===null?"error":"white"},s,{icon:"fa-solid fa-cog"}),null,16,["color"])],4)]),default:u(()=>[n(_e,{width:"20rem",class:"setting-card","max-height":"calc(100vh - 100px)",onKeydown:[a[16]||(a[16]=be(s=>x("apply"),["enter"])),be(i,["esc"])]},{default:u(()=>[n(ve,{class:"subtitle"},{append:u(()=>[n(G,{variant:"text",icon:"far fa-question-circle small",size:"small",onClick:a[0]||(a[0]=s=>r.value=!r.value)})]),default:u(()=>[F(k(l(t)("Settings"))+" ",1)]),_:1}),n(rl,{ref:"form","validate-on":"lazy"},{default:u(()=>[n(ue,null,{default:u(()=>[n(re,{modelValue:e.value[0].value,"onUpdate:modelValue":a[1]||(a[1]=s=>e.value[0].value=s),variant:"underlined",items:l(M).sort(),label:l(t)(e.value[0].name),hint:r.value?l(t)(e.value[0].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),n(Ve,null,{default:u(()=>[(d(!0),D(Q,null,X(e.value.slice(1,3),s=>(d(),b(ue,{key:s.name},{default:u(()=>[n(ce,{modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,variant:"underlined",density:"compact",type:s.type,label:l(t)(s.name),suffix:s.units,hint:r.value?l(t)(s.hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"])]),_:2},1024))),128))]),_:1}),n(Ve,null,{default:u(()=>[n(ue,null,{default:u(()=>[n(ce,{modelValue:e.value[3].value,"onUpdate:modelValue":a[2]||(a[2]=s=>e.value[3].value=s),variant:"underlined",density:"compact",type:e.value[3].type,label:l(t)(e.value[3].name),suffix:e.value[3].units,hint:r.value?l(t)(e.value[3].hint):"","persistent-hint":r.value,required:"",onWheel:()=>{}},null,8,["modelValue","type","label","suffix","hint","persistent-hint"])]),_:1}),n(ue,null,{default:u(()=>[n(re,{modelValue:e.value[5].value,"onUpdate:modelValue":a[3]||(a[3]=s=>e.value[5].value=s),density:"compact",variant:"underlined",items:e.value[5].choices,label:l(t)(e.value[5].name),hint:r.value?l(t)(e.value[5].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"])]),_:1})]),_:1}),n(re,{modelValue:e.value[6].value,"onUpdate:modelValue":a[4]||(a[4]=s=>e.value[6].value=s),density:"compact",items:e.value[6].choices,label:l(t)(e.value[6].name),hint:r.value?l(t)(e.value[6].hint):"","persistent-hint":r.value,required:"",variant:"solo"},{selection:u(({item:s})=>[f("div",Bl,[(d(!0),D(Q,null,X(E(s.value),(h,I)=>(d(),D("span",{key:I,class:"grad-step-small",style:de({backgroundColor:h})},null,4))),128)),f("span",Ol,k(s.value),1)])]),item:u(({props:s,item:h})=>[n(ve,dl(vl(s)),{title:u(()=>[f("div",ql,[(d(!0),D(Q,null,X(E(h.value),(I,U)=>(d(),D("span",{key:U,class:"grad-step",style:de({backgroundColor:I})},null,4))),128)),f("span",Al,k(h.value),1)])]),_:2},1040)]),_:1},8,["modelValue","items","label","hint","persistent-hint"]),n(cl,{modelValue:e.value[14].value,"onUpdate:modelValue":a[5]||(a[5]=s=>e.value[14].value=s),step:"5",density:"compact",color:"primary",label:l(t)(e.value[14].name),min:"0",max:"100","thumb-size":16,"hide-details":"",class:"align-center"},null,8,["modelValue","label"]),n(pl,{modelValue:e.value[4].value,"onUpdate:modelValue":a[6]||(a[6]=s=>e.value[4].value=s),class:"align-center",color:"primary",label:l(t)(e.value[4].name),"track-color":"secondary",max:100,"thumb-size":16,"thumb-label":"",min:0,"hide-details":""},{"thumb-label":u(({modelValue:s})=>[F(k(Math.floor(s)+"%"),1)]),_:1},8,["modelValue","label"]),n(re,{modelValue:e.value[15].value,"onUpdate:modelValue":a[7]||(a[7]=s=>e.value[15].value=s),variant:"underlined",items:["",...l(M).sort()],label:l(t)(e.value[15].name),hint:r.value?l(t)(e.value[15].hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","items","label","hint","persistent-hint"]),(d(),b(ie,{key:e.value[12].name,modelValue:e.value[12].value,"onUpdate:modelValue":a[8]||(a[8]=s=>e.value[12].value=s),density:"compact",color:"primary","hide-details":!r.value,label:l(t)(e.value[12].name),hint:r.value?l(t)(e.value[12].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(d(),b(ie,{key:e.value[7].name,modelValue:e.value[7].value,"onUpdate:modelValue":a[9]||(a[9]=s=>e.value[7].value=s),density:"compact",color:"primary","hide-details":!r.value,label:l(t)(e.value[7].name),hint:r.value?l(t)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),(d(),b(ie,{key:e.value[8].name,modelValue:e.value[8].value,"onUpdate:modelValue":a[10]||(a[10]=s=>e.value[8].value=s),density:"compact",color:"primary","hide-details":!r.value,label:l(t)(e.value[8].name),hint:r.value?l(t)(e.value[7].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),["Polygon","extrusion"].includes(l(L))?(d(),b(ie,{key:e.value[13].name,modelValue:e.value[13].value,"onUpdate:modelValue":a[11]||(a[11]=s=>e.value[13].value=s),density:"compact",color:"primary","hide-details":!r.value,label:l(t)(e.value[13].name),disabled:!["Polygon","extrusion"].includes(l(L)),hint:r.value?l(t)(e.value[13].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","disabled","hint","persistent-hint"])):j("",!0),(d(),b(ie,{key:e.value[11].name,modelValue:e.value[11].value,"onUpdate:modelValue":[a[12]||(a[12]=s=>e.value[11].value=s),a[13]||(a[13]=s=>S(e.value[11].name))],density:"compact",variant:"underlined",color:"primary","hide-details":!r.value,label:l(t)(e.value[11].name),hint:r.value?l(t)(e.value[11].hint):"","persistent-hint":r.value},null,8,["modelValue","hide-details","label","hint","persistent-hint"])),n(Ve,null,{default:u(()=>[(d(!0),D(Q,null,X(e.value.slice(9,11),s=>(d(),b(ue,{key:s.name},{default:u(()=>[Le(n(ce,{modelValue:s.value,"onUpdate:modelValue":h=>s.value=h,variant:"underlined",type:s.type,label:l(t)(s.name),suffix:s.units,hint:r.value?l(t)(s.hint):"","persistent-hint":r.value,required:""},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","hint","persistent-hint"]),[[Ne,P.value]])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},512),n(We,null,{default:u(()=>[n(G,{color:"grey",variant:"text",onClick:i},{default:u(()=>[F(k(l(t)("Cancel")),1)]),_:1}),n(G,{color:"green-darken-1",variant:"text",onClick:a[14]||(a[14]=s=>x("apply"))},{default:u(()=>[F(k(l(t)("Apply")),1)]),_:1}),n(Te),n(G,{color:"grey",variant:"text",onClick:a[15]||(a[15]=s=>x("save"))},{default:u(()=>[n(se,{size:"small",start:""},{default:u(()=>[...a[18]||(a[18]=[F(" fas fa-sliders-h ",-1)])]),_:1}),F(" "+k(l(t)("save")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Hl=xe(El,[["__scopeId","data-v-ac369516"]]),Zl={class:"map-view"},Gl={class:"legend"},Kl={__name:"ResultMap",setup(R){const{$gettext:w}=ke(),t=ml(),B=fl(),z=yl(),o=we(),{layer:M,visibleLayer:L,nanLayer:A,type:_,loadLayer:C,displaySettings:e,hasOD:r,attributesWithOD:P,matSelectedIndex:S,changeOD:E,isIndexAvailable:N,selectedCategory:x,selectedFilter:i,attributes:v,applySettings:a,changeSelectedFilter:s,refreshVisibleLinks:h,filteredCategory:I,updateSelectedFeature:U,changeSelectedCategory:W,colorScale:ee}=Vl(),O=y();function pe(p){a(p),h(),U(),ye(()=>O.value.update())}function me(p){s(p),h(),U(),ye(()=>O.value.update())}function fe(p){W(p),h(),U(),ye(()=>O.value.update())}const q=y("");async function Y(p,m=null){switch(p){case"links":C(t.links,null,m);break;case"rlinks":C(B.rlinks,null,m);break;case"nodes":C(t.nodes,null,m);break;case"rnodes":C(B.rnodes,null,m);break;case"od":C(z.layer,null,m);break;default:const V=await o.getOtherFile(p,"geojson"),$=await o.getOtherFile(p,"json");C(V,$,m);break}q.value=p,ye(()=>O.value.update())}const T=y(null),J=K(()=>o.availableLayers),c=K(()=>o.availableRasters),g=K(()=>o.visibleLayers),H=K(()=>o.styles);async function je(p){T.value=p.name,J.value.includes(p.layer)?await Y(p.layer,p):o.changeNotification({text:w("Preset Layer does not exist"),autoClose:!0,color:"error"}),Object.keys(p).includes("selectedIndex")&&N(p.selectedIndex)&&(E(p.selectedIndex),o.changeNotification({})),O.value.update()}const Me=y(),ae=y("");async function Be(p){const m=p;if(ae.value=T.value,await Me.value.openDialog()){const $={name:le.cloneDeep(ae.value),layer:le.cloneDeep(q.value),displaySettings:le.cloneDeep(m),selectedFilter:le.cloneDeep(i.value)};x.value.filter(Ee=>I.value.includes(Ee)).length<I.value.length&&($.selectedCategory=le.cloneDeep(x.value)),P.value.includes(m.selectedFeature)&&r.value&&($.selectedIndex=le.cloneDeep(S.value)),o.addStyle($),g.value.includes(ae.value)?o.changeNotification({text:w("Preset changed. Please reload the active layer on the map"),autoClose:!0,color:"warning"}):o.changeNotification({text:w("Preset Saved"),autoClose:!0,color:"success"}),T.value=le.cloneDeep(ae.value)}}const De=y();async function Oe(p){const m=p.name;await De.value.openDialog()&&(o.deleteStyle(m),m===T.value&&(T.value=null),o.changeNotification({text:w("Preset deleted"),autoClose:!0,color:"success"}),m.value="")}const te=y(!1),Pe=y([]);function qe(p){if(p.action==="featureClick"){const m=p.feature.index;m?(Pe.value=M.value.features.filter(V=>V.properties.index===m)[0].properties,te.value=!0):o.changeNotification({text:w("Layer have no index. Cannot show properties"),autoClose:!0,color:"warning"})}else E(p.feature.index),O.value.update()}const Ae=ze();return ge(()=>{if(Ae.initalPosition){const p=t.linksIsEmpty?B.rlinks:t.links;O.value.fitBounds(p)}}),(p,m)=>(d(),D("section",Zl,[n(jl,{"selected-category":l(x),"selected-filter":l(i),"layer-choices":J.value,"selected-layer":q.value,"filter-choices":l(v),"filtered-cat":l(I),"preset-choices":H.value,"selected-preset":T.value,onUpdateSelectedCategory:fe,onUpdateSelectedFilter:me,onSelectLayer:Y,onSelectPreset:je,onDeletePreset:Oe},null,8,["selected-category","selected-filter","layer-choices","selected-layer","filter-choices","filtered-cat","preset-choices","selected-preset"]),l(L).features?(d(),b(_l,{ref_key:"mapRef",ref:O,key:l(_)+String(l(e).extrusion),"selected-layer":q.value,"layer-type":l(_),extrusion:l(e).extrusion,labels:l(e).labels,links:l(L),"nan-links":l(A),"selected-feature":l(e).selectedFeature,opacity:l(e).opacity,offset:l(e).offset,onSelectClick:qe},{default:u(V=>[f("div",Gl,[Le(n(Cl,{key:"result",order:0,"color-scale":l(ee),"display-settings":l(e)},null,8,["color-scale","display-settings"]),[[Ne,l(L).features.length>0]])]),f("div",null,[n(Hl,{order:0,"display-settings":l(e),"feature-choices":l(v),type:l(_),onSubmit:pe,onSavePreset:Be},null,8,["display-settings","feature-choices","type"]),n(hl,{order:1}),H.value.length>0?(d(),b(wl,{key:0,order:"2",choices:H.value,map:V.map,"available-layers":J.value},null,8,["choices","map","available-layers"])):j("",!0),c.value.length>0?(d(),b(gl,{key:1,order:3,map:V.map},null,8,["map"])):j("",!0)]),(d(!0),D(Q,null,X(H.value,$=>(d(),D("div",{key:$.name},[g.value.includes($.name)&&J.value.includes($.layer)?(d(),b(Sl,{key:0,preset:$,map:V.map,order:g.value.indexOf($.name)+1,"visible-layers":g.value},null,8,["preset","map","order","visible-layers"])):j("",!0)]))),128))]),_:1},8,["selected-layer","layer-type","extrusion","labels","links","nan-links","selected-feature","opacity","offset"])):j("",!0),n(kl,{modelValue:te.value,"onUpdate:modelValue":m[1]||(m[1]=V=>te.value=V),scrollable:"",persistent:"","max-width":"300",onKeydown:[m[2]||(m[2]=be(V=>te.value=!1,["enter"])),m[3]||(m[3]=be(V=>te.value=!1,["esc"]))]},{default:u(()=>[n(_e,{"max-height":"60rem"},{default:u(()=>[n(bl,{class:"text-h5"},{default:u(()=>[F(k(l(w)("link Properties")),1)]),_:1}),n(Ue),n(xl,null,{default:u(()=>[n(Se,null,{default:u(()=>[(d(!0),D(Q,null,X(Pe.value,(V,$)=>(d(),b(ce,{key:$,"model-value":V,label:$,variant:"filled",readonly:""},null,8,["model-value","label"]))),128))]),_:1})]),_:1}),n(Ue),n(We,null,{default:u(()=>[n(Te),n(G,{color:"success",variant:"text",onClick:m[0]||(m[0]=V=>te.value=!1)},{default:u(()=>[F(k(l(w)("ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(Re,{ref_key:"presetDialog",ref:Me,title:l(w)("Create or modify preset")},{default:u(()=>[n(ce,{modelValue:ae.value,"onUpdate:modelValue":m[4]||(m[4]=V=>ae.value=V),autofocus:"",rules:[V=>!!V||"Required."],label:l(w)("name")},null,8,["modelValue","rules","label"])]),_:1},8,["title"]),n(Re,{ref_key:"deleteDialog",ref:De,title:l(w)("Delete %{name}?",{name:T.value}),"confirm-button":l(w)("Delete"),"confirm-color":"error"},null,8,["title","confirm-button"])]))}},ea=xe(Kl,[["__scopeId","data-v-265bdf71"]]);export{ea as default};
