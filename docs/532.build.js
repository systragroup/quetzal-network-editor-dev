(self.webpackChunkquetzal_network_editor=self.webpackChunkquetzal_network_editor||[]).push([[532],{30074:(t,e,n)=>{"use strict";n.d(e,{Z:()=>o});var i=n(87537),r=n.n(i),s=n(23645),a=n.n(s)()(r());a.push([t.id,".card[data-v-1884303d]{height:90%;padding:2.5rem}.card2[data-v-1884303d]{height:90%;padding:2.5rem 0rem 2.5rem 2rem;margin-right:3rem}.row[data-v-1884303d]{height:100%}.col[data-v-1884303d]{max-height:100%}.card button[data-v-1884303d]{margin-top:0px}.title[data-v-1884303d]{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:3.5em;color:#b5e0d6 !important;font-weight:bold}.subtitle[data-v-1884303d]{font-size:2em;color:var(--v-secondary-dark);font-weight:bold;margin:10px;margin-left:0px}.card button[data-v-1884303d]{margin-top:0px}.background[data-v-1884303d]{background-color:var(--v-background-base)}.params-row[data-v-1884303d]{display:flex;align-items:center;margin-right:1rem;padding-top:.5rem;justify-content:flex-start;gap:1rem}.list[data-v-1884303d]{height:80%;margin-top:1rem;overflow-y:auto;overflow-x:hidden;border-top:1px solid var(--v-background-lighten3)}.list-row[data-v-1884303d]{display:flex;padding-left:0;align-items:center;justify-content:flex-start;border-bottom:1px solid var(--v-background-lighten3)}.list-item-small[data-v-1884303d]{flex:0 0 8%;margin:4px}.list-item-medium[data-v-1884303d]{flex:0 0 18%;margin-right:2px}.list-item-large[data-v-1884303d]{flex:0 0 26%;margin:4px}","",{version:3,sources:["webpack://./src/components/microservices/GTFSWebImporter.vue"],names:[],mappings:"AAGA,uBACE,UAAA,CACA,cAAA,CAEF,wBACE,UAAA,CACA,+BAAA,CACA,iBAAA,CAGF,sBACE,WAAA,CAEF,sBACE,eAAA,CAEF,8BACE,cAAA,CAEF,wBACE,YAAA,CACA,qBAAA,CACA,kBAAA,CACA,sBAAA,CACA,eAAA,CACA,wBAAA,CACA,gBAAA,CAEF,2BACE,aAAA,CACA,6BAAA,CACA,gBAAA,CACA,WAAA,CACA,eAAA,CAEF,8BACE,cAAA,CAEF,6BACE,yCAAA,CAGF,6BAEE,YAAA,CACA,kBAAA,CACA,iBAAA,CACA,iBAAA,CACA,0BAAA,CACA,QAAA,CAIF,uBACE,UAAA,CAEA,eAAA,CACA,eAAA,CACA,iBAAA,CACA,iDAAA,CAGF,2BAEE,YAAA,CACA,cAAA,CACA,kBAAA,CACA,0BAAA,CACA,oDAAA,CAGF,kCAEE,WAAA,CACA,UAAA,CAGF,mCAEE,YAAA,CACA,gBAAA,CAGF,kCAEE,YAAA,CACA,UAAA",sourcesContent:['@import "@scss/variables.scss";\n\n\n.card {\n  height: 90%;\n  padding: 2.5rem;\n}\n.card2 {\n  height: 90%;\n  padding: 2.5rem 0rem 2.5rem 2.0rem;\n  margin-right: 3rem;\n\n}\n.row {\n  height: 100%\n}\n.col {\n  max-height: 100%;\n}\n.card button {\n  margin-top: 0px;\n}\n.title {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  font-size: 3.5em;\n  color: $primary !important;\n  font-weight: bold;\n}\n.subtitle {\n  font-size: 2em;\n  color:var(--v-secondary-dark);\n  font-weight: bold;\n  margin: 10px;\n  margin-left: 0px;\n}\n.card button {\n  margin-top: 0px;\n}\n.background {\n  background-color:var(--v-background-base);\n}\n\n.params-row {\n  /* Add individual list item styles here */\n  display: flex; /* Use flexbox layout for each list item */\n  align-items: center;\n  margin-right:1rem;\n  padding-top: 0.5rem;\n  justify-content:flex-start;\n  gap: 1rem;\n\n}\n\n.list {\n  height:80%;\n  //border: 1px solid red;\n  margin-top:1rem;\n  overflow-y: auto;\n  overflow-x: hidden;\n  border-top: 1px solid var(--v-background-lighten3);\n\n}\n.list-row {\n  /* Add individual list item styles here */\n  display: flex; /* Use flexbox layout for each list item */\n  padding-left:0;\n  align-items: center;\n  justify-content:flex-start;\n  border-bottom: 1px solid var(--v-background-lighten3);\n}\n\n.list-item-small {\n  /* Add individual list item styles here */\n  flex: 0 0 8%;\n  margin:4px;\n}\n\n.list-item-medium {\n  /* Add individual list item styles here */\n  flex: 0 0 18%;\n  margin-right:2px;\n}\n\n.list-item-large {\n  /* Add individual list item styles here */\n  flex: 0 0 26%;\n  margin:4px;\n}\n'],sourceRoot:""}]);const o=a},21042:t=>{t.exports=function(t,e){if(null===t)throw new Error("No coordinates passed");for(var n=0;n<t.length;n++)for(var i=t[n],r=0;r<i[i.length-1].length;r++){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1][r]!==i[0][r])throw new Error("First and last Position are not equivalent.")}var s={type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:e};return s.properties||(s.properties={}),s}},49532:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>Z});var i=function(){var t=this,e=t._self._c;return e("v-row",{staticClass:"ma-0 pa-2 background"},[e("v-col",[e("v-card",{staticClass:"card"},[e("v-card-title",{staticClass:"subtitle"},[t._v("\n        "+t._s(t.$gettext("GTFS importer"))+"\n      ")]),t._v(" "),e("MapSelector",{on:{change:t.getBBOX}})],1)],1),t._v(" "),e("v-col",[e("v-card",{staticClass:"card2"},[e("v-card-title",{staticClass:"subtitle"},[t._v("\n        "+t._s(t.$gettext("Available GTFS"))+"\n      ")]),t._v(" "),e("v-card-subtitle",[t._v("\n        "+t._s(t.$gettext("Data fetch from")+" https://database.mobilitydata.org/")+"\n      ")]),t._v(" "),e("v-btn",{attrs:{disabled:t.running},on:{click:t.getAvaileGTFS}},[e("v-icon",{staticStyle:{"margin-right":"10px"},attrs:{small:""}},[t._v("\n          fa-solid fa-sync\n        ")]),t._v("\n        "+t._s(t.$gettext("fetch available GTFS"))+"\n      ")],1),t._v(" "),e("v-btn",{attrs:{loading:t.running,disabled:t.running||0===t.selectedGTFS.length,color:"success"},on:{click:t.importGTFS}},[e("v-icon",{staticStyle:{"margin-right":"10px"},attrs:{small:""}},[t._v("\n          fa-solid fa-play\n        ")]),t._v("\n        "+t._s(t.$gettext("Download"))+"\n      ")],1),t._v(" "),e("v-card-subtitle",[t.error?e("v-alert",{attrs:{dense:"",outlined:"",text:"",type:"error"}},[t._v("\n          "+t._s(t.$gettext("There as been an error while importing OSM network.           Please try again. If the problem persist, contact us."))+"\n          "),t._l(Object.keys(t.errorMessage),(function(n){return e("p",{key:n},[e("b",[t._v(t._s(n)+": ")]),t._v(t._s(t.errorMessage[n])+"\n          ")])}))],2):t._e()],1),t._v(" "),e("div",{staticClass:"params-row"},t._l(t.parameters,(function(n,i){return e("div",{key:i},[void 0===n.items?e("v-text-field",{attrs:{type:n.type,label:t.$gettext(n.text),suffix:n.units,hint:t.showHint?t.$gettext(n.hint):"","persistent-hint":t.showHint,rules:n.rules.map((e=>t.rules[e])),required:""},on:{wheel:()=>{}},model:{value:n.value,callback:function(e){t.$set(n,"value",e)},expression:"item.value"}}):e("v-select",{attrs:{type:n.type,items:n.items,label:t.$gettext(n.text),suffix:n.units,hint:t.showHint?t.$gettext(n.hint):"","persistent-hint":t.showHint,rules:n.rules.map((e=>t.rules[e])),required:""},on:{wheel:()=>{}},model:{value:n.value,callback:function(e){t.$set(n,"value",e)},expression:"item.value"}})],1)})),0),t._v(" "),e("div",{staticClass:"list"},[e("ul",{staticClass:"list-row"},[e("span",{staticClass:"list-item-small"},[e("v-checkbox",{attrs:{disabled:!0}})],1),t._v(" "),e("span",{staticClass:"list-item-small"},[t._v("All in polygon")]),t._v(" "),e("span",{staticClass:"list-item-small"},[t._v("Code")]),t._v(" "),e("span",{staticClass:"list-item-medium"},[t._v("Name")]),t._v(" "),e("span",{staticClass:"list-item-large"},[t._v("City")]),t._v(" "),e("span",{staticClass:"list-item-large"},[t._v("Agency")])]),t._v(" "),t._l(t.availableGTFS,(function(n,i){return e("ul",{key:n.index,staticClass:"list-row"},[e("span",{staticClass:"list-item-small"},[e("v-checkbox",{attrs:{value:n.index,label:String(i)},model:{value:t.selectedGTFS,callback:function(e){t.selectedGTFS=e},expression:"selectedGTFS"}})],1),t._v(" "),e("span",{staticClass:"list-item-small"},[t._v(t._s(n.allInPolygon)+" ")]),t._v(" "),e("span",{staticClass:"list-item-small"},[t._v(t._s(n["location.country_code"])+" ")]),t._v(" "),e("span",{staticClass:"list-item-medium"},[t._v(t._s(n["location.subdivision_name"]))]),t._v(" "),e("span",{staticClass:"list-item-large"},[t._v(t._s(n["location.municipality"]))]),t._v(" "),e("span",{staticClass:"list-item-large"},[t._v(t._s(n.provider))])])}))],2)],1)],1)],1)};i._withStripped=!0;var r=n(95),s=n(75997),a=n(34221),o=n(98013),l=n(82037),c=n(30022),d=n(39034),A=n(39428);function u(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(g(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function m(t,e){for(var n=0,i=e.coordinates;n<i.length;n++){var r=i[n];if((0,l.Z)(r,t))return!0}return(0,c.Z)(e,(0,A.ZP)(t)).features.length>0}function g(t,e,n){var i=n[0]-t[0],r=n[1]-t[1],s=e[0]-t[0],a=e[1]-t[1];return 0==i*a-r*s&&(Math.abs(s)>=Math.abs(a)?s>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:a>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1])}var h=n(21042),v=n.n(h),p=n(76955);const f={name:"GTFSWebImporter",components:{MapSelector:n(26914).Z},data(){return{showOverwriteDialog:!1,poly:null,nodes:{},gtfsList:[],availableGTFS:[],selectedGTFS:[],checkall:!1,showHint:!1,parameters:[{name:"start_time",text:"start time",value:"6:00:00",type:"String",units:"",hint:"Start Time to restrict the GTFS in a period",rules:["required","timeRule"]},{name:"end_time",text:"end time",value:"8:59:00",type:"String",units:"",hint:"End Time to restrict the GTFS in a period",rules:["required","timeRule"]},{name:"day",text:"day",value:"tuesday",type:"String",items:["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],units:"",hint:"restrict each GTFS to this day.",rules:["required"]}],re:/^(0?[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/,rules:{required:t=>!!t||"Required",timeRule:t=>this.re.test(t)||"invalid date time"}}},computed:{linksIsEmpty(){return this.$store.getters.linksIsEmpty},callID(){return this.$store.getters["runGTFS/callID"]},running(){return this.$store.getters["runGTFS/running"]},error(){return this.$store.getters["runGTFS/error"]},errorMessage(){return this.$store.getters["runGTFS/errorMessage"]}},async created(){this.gtfsList=await this.fetchCSV(),this.gtfsList.forEach(((t,e)=>{try{t.bbox=(0,r.Z)([t["location.bounding_box.minimum_longitude"],t["location.bounding_box.minimum_latitude"],t["location.bounding_box.maximum_longitude"],t["location.bounding_box.maximum_latitude"]])}catch{t.bbox=null}t.index=e})),this.gtfsList=this.gtfsList.filter((t=>t.bbox)),this.gtfsList=this.gtfsList.filter((t=>t["urls.latest"].length>0)),this.gtfsList.sort(((t,e)=>t["location.country_code"]<e["location.country_code"]?-1:t["location.country_code"]>e["location.country_code"]?1:0))},methods:{async fetchCSV(){try{const t=await fetch("https://storage.googleapis.com/storage/v1/b/mdb-csv/o/sources.csv?alt=media",{});t.ok||this.$store.commit("changeAlert",{name:"Network error",message:"cannot fetch GTFS list"});const e=await t.arrayBuffer();return(0,p.JO)(e)}catch(t){this.$store.commit("changeAlert",t)}},getBBOX(t){this.poly?this.poly=t:(this.poly=t,this.getAvaileGTFS())},getAvaileGTFS(){let t=null;if("bbox"===this.poly.style){const e=this.poly.geometry;t=(0,r.Z)([e[1],e[0],e[3],e[2]])}else t=v()([this.poly.geometry]);this.availableGTFS=this.gtfsList.filter((e=>{return(0,o.ZP)(t,e.bbox)||(n=t,i=e.bbox,r=!1,(0,d.nG)(n,(function(t){(0,d.nG)(i,(function(e){if(!0===r)return!0;r=!function(t,e){var n=!0;return(0,d.nG)(t,(function(t){(0,d.nG)(e,(function(e){if(!1===n)return!1;n=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return r=t.coordinates,s=e.coordinates,!(r[0]===s[0]&&r[1]===s[1]);case"LineString":return!u(e,t);case"Polygon":return!(0,l.Z)(t,e)}break;case"LineString":switch(e.type){case"Point":return!u(t,e);case"LineString":return n=t,i=e,!((0,c.Z)(n,i).features.length>0);case"Polygon":return!m(e,t)}break;case"Polygon":switch(e.type){case"Point":return!(0,l.Z)(e,t);case"LineString":return!m(t,e);case"Polygon":return!function(t,e){for(var n=0,i=t.coordinates[0];n<i.length;n++){var r=i[n];if((0,l.Z)(r,e))return!0}for(var s=0,a=e.coordinates[0];s<a.length;s++){var o=a[s];if((0,l.Z)(o,t))return!0}return(0,c.Z)((0,A.ZP)(t),(0,A.ZP)(e)).features.length>0}(e,t)}}var n,i,r,s;return!1}(t.geometry,e.geometry)}))})),n}(t.geometry,e.geometry)}))})),r);var n,i,r})),this.availableGTFS.forEach((e=>e.allInPolygon=(0,o.ZP)(t,e.bbox)));const e=new Set(this.availableGTFS.map((t=>t.index)));this.selectedGTFS=this.selectedGTFS.filter((t=>e.has(t)))},importGTFS(){if(this.linksIsEmpty){this.$store.commit("runGTFS/setCallID");const t={files:this.availableGTFS.filter((t=>this.selectedGTFS.includes(t.index))).map((t=>t["urls.latest"]))};this.parameters.forEach((e=>{t[e.name]=e.value})),this.$store.dispatch("runGTFS/startExecution",t)}else this.showOverwriteDialog=!0},applyOverwriteDialog(){this.$store.commit("loadLinks",s.Z),this.$store.commit("loadNodes",a.Z),this.showOverwriteDialog=!1,this.importGTFS()}}};var C=n(93379),y=n.n(C),b=n(7795),x=n.n(b),_=n(90569),w=n.n(_),S=n(3565),F=n.n(S),k=n(19216),G=n.n(k),E=n(44589),T=n.n(E),B=n(30074),$={};$.styleTagTransform=T(),$.setAttributes=F(),$.insert=w().bind(null,"head"),$.domAPI=x(),$.insertStyleElement=G(),y()(B.Z,$),B.Z&&B.Z.locals&&B.Z.locals;const Z=(0,n(51900).Z)(f,i,[],!1,null,"1884303d",null).exports}}]);
//# sourceMappingURL=532.build.js.map