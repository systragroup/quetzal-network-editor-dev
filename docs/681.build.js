"use strict";(self.webpackChunkquetzal_network_editor=self.webpackChunkquetzal_network_editor||[]).push([[681],{8681:(e,t,o)=>{o.r(t),o.d(t,{default:()=>a});var r=function(){var e=this,t=e._self._c;return t("section",[t("MglGeojsonLayer",e._g({attrs:{"source-id":"editorLinks",source:{type:"geojson",data:e.$store.getters.editorLinks,buffer:0,promoteId:"index"},"layer-id":"editorLinks",layer:{type:"line",minzoom:2,paint:{"line-color":["case",["boolean",e.anchorMode,!1],"#B5E0D6","#7EBAAC"],"line-width":["case",["boolean",["feature-state","hover"],!1],12,5],"line-blur":["case",["boolean",["feature-state","hover"],!1],6,0]}}},on:{click:e.selectClick,mouseover:e.onCursor,mouseleave:e.offCursor}},e.anchorMode?{}:{contextmenu:e.linkRightClick})),e._v(" "),t("MglImageLayer",{attrs:{"source-id":"editorLinks",type:"symbol",source:"editorLinks","layer-id":"arrow-layer",layer:{type:"symbol",minzoom:5,layout:{"symbol-placement":"line","symbol-spacing":30,"icon-ignore-placement":!0,"icon-image":"arrow","icon-size":.5,"icon-rotate":90},paint:{"icon-color":["case",["boolean",e.anchorMode,!1],"#B5E0D6","#7EBAAC"]}}}}),e._v(" "),t("MglGeojsonLayer",e._g({attrs:{"source-id":"editorNodes",source:{type:"geojson",data:e.$store.getters.editorNodes,buffer:0,promoteId:"index"},"layer-id":"editorNodes",layer:{interactive:!0,type:"circle",minzoom:2,paint:{"circle-color":"#2C3E4E","circle-radius":["case",["boolean",["feature-state","hover"],!1],16,8],"circle-blur":["case",["boolean",["feature-state","hover"],!1],.3,0]}}},on:{mouseover:e.onCursor,mouseleave:e.offCursor,mousedown:e.moveNode}},e.anchorMode?{}:{click:e.selectClick,contextmenu:e.contextMenuNode})),e._v(" "),t("MglGeojsonLayer",{attrs:{"source-id":"anchorNodes",source:{type:"geojson",data:e.anchorNodes,buffer:0,promoteId:"index"},"layer-id":"anchorNodes",layer:{interactive:!0,type:"circle",minzoom:2,paint:{"circle-color":"#ffffff","circle-opacity":.5,"circle-radius":["case",["boolean",["feature-state","hover"],!1],10,5],"circle-blur":["case",["boolean",["feature-state","hover"],!1],.3,0],"circle-stroke-color":"#2C3E4E","circle-stroke-width":2}}},on:{click:e.selectClick,mouseover:e.onCursor,mouseleave:e.offCursor,mousedown:e.moveNode,contextmenu:e.contextMenuNode}}),e._v(" "),t("MglPopup",{attrs:{"close-button":!1,showed:e.popupEditor.showed,coordinates:e.popupEditor.coordinates},on:{close:function(t){e.popupEditor.showed=!1}}},[t("span",[t("h3",[e._v(e._s(e.popupEditor.content))]),e._v(" "),t("hr"),e._v("\n      "+e._s("editorLinks"==e.hoveredStateId?.layerId?e.$gettext("Left click to add a stop"):e.$gettext("Hold left click to drag"))+"\n      "),t("hr"),e._v("\n      "+e._s("editorLinks"==e.hoveredStateId?.layerId?e.$gettext("Right click to edit properties"):e.$gettext("Right click for context menu"))+"\n    ")])]),e._v(" "),t("MglPopup",{attrs:{"close-button":!1,showed:e.contextMenu.showed,coordinates:e.contextMenu.coordinates},on:{close:function(t){e.contextMenu.showed=!1}}},[t("span",{on:{mouseleave:function(t){e.contextMenu.showed=!1}}},[t("v-list",{attrs:{dense:"",flat:""}},[t("v-list-item-group",e._l(e.contextMenu.actions,(function(o){return t("v-list-item",{key:o.id},[t("v-list-item-content",[t("v-btn",{attrs:{outlined:"",small:""},on:{click:function(t){return e.actionClick({action:o,feature:e.contextMenu.feature,coordinates:e.contextMenu.coordinates})}}},[e._v("\n                "+e._s(e.$gettext(o))+"\n              ")])],1)],1)})),1)],1)],1)])],1)};r._withStripped=!0;var s=o(1963);const i={name:"EditorLinks",components:{MglPopup:s.eO,MglImageLayer:s.vV,MglGeojsonLayer:s.tf},props:["map","anchorMode"],events:["clickFeature","onHover","offHover"],data:()=>({selectedFeature:null,hoveredStateId:null,disablePopup:!1,keepHovering:!1,dragNode:!1,popupEditor:{coordinates:[0,0],showed:!1,content:null},contextMenu:{coordinates:[0,0],showed:!1,actions:[],feature:null,type:null}}),computed:{anchorNodes(){return this.anchorMode?this.$store.getters.anchorNodes:this.$store.getters.nodesHeader}},watch:{},created(){},methods:{selectClick(e){if(null!==this.hoveredStateId){const t=this.map.querySourceFeatures(this.hoveredStateId.layerId);if(this.selectedFeature=t.filter((e=>e.id===this.hoveredStateId.id))[0],null!==this.selectedFeature&&"editorLinks"===this.hoveredStateId.layerId){const t=this.anchorMode?"Add Anchor Inline":"Add Stop Inline",o={selectedFeature:this.selectedFeature,action:t,lngLat:e.mapboxEvent.lngLat};this.$emit("clickFeature",o)}}},onCursor(e){null!==this.hoveredStateId&&"editorLinks"!==this.hoveredStateId.layerId||(this.map.getCanvas().style.cursor="pointer",null!==this.hoveredStateId&&this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id},{hover:!1}),this.hoveredStateId={layerId:e.layerId,id:e.mapboxEvent.features[0].id},this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id},{hover:!0}),!this.disablePopup&!this.anchorMode&&(this.popupEditor.coordinates=[e.mapboxEvent.lngLat.lng,e.mapboxEvent.lngLat.lat],this.popupEditor.content=this.hoveredStateId.id,this.popupEditor.showed=!0)),this.$emit("onHover",{selectedId:this.hoveredStateId.id})},offCursor(e){null!==this.hoveredStateId&&(["editorNodes","anchorNodes"].includes(this.hoveredStateId.layerId)&&"editorLinks"===e?.layerId||(this.keepHovering?(this.dragNode=!0,this.contextMenu.showed=!1):(this.map.getCanvas().style.cursor="",this.popupEditor.showed=!1,this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id},{hover:!1}),this.hoveredStateId=null,this.$emit("offHover",e))))},contextMenuNode(e){if(this.popupEditor.showed&&"editorNodes"===this.hoveredStateId?.layerId){this.contextMenu.coordinates=[e.mapboxEvent.lngLat.lng,e.mapboxEvent.lngLat.lat],this.contextMenu.showed=!0,this.contextMenu.type="node";const t=this.map.querySourceFeatures(this.hoveredStateId.layerId);this.contextMenu.feature=t.filter((e=>e.id===this.hoveredStateId.id))[0];const o=this.contextMenu.feature.properties.index;o===this.$store.getters.firstNodeId||o===this.$store.getters.lastNodeId?this.contextMenu.actions=["Edit Node Info","Delete Stop"]:this.contextMenu.actions=["Edit Node Info","Cut Before Node","Cut After Node","Delete Stop"]}else if("anchorNodes"===this.hoveredStateId?.layerId){const e=this.map.querySourceFeatures(this.hoveredStateId.layerId);this.selectedFeature=e.filter((e=>e.id===this.hoveredStateId.id));const t={selectedFeature:this.selectedFeature[0],action:"Delete Anchor",lngLat:null};this.$emit("clickFeature",t)}},linkRightClick(e){if("editorLinks"===this.hoveredStateId.layerId){const t=this.map.querySourceFeatures(this.hoveredStateId.layerId);this.selectedFeature=t.filter((e=>e.id===this.hoveredStateId.id))[0];const o={selectedFeature:this.selectedFeature,action:"Edit Link Info",lngLat:e.mapboxEvent.lngLat,lingering:!0};this.$emit("clickFeature",o)}},actionClick(e){const t={selectedFeature:e.feature,action:e.action,lngLat:e.coordinates};this.$emit("clickFeature",t),this.contextMenu.showed=!1,this.contextMenu.type=null},moveNode(e){if(0===e.mapboxEvent.originalEvent.button&["editorNodes","anchorNodes"].includes(this.hoveredStateId.layerId)){e.mapboxEvent.preventDefault(),this.map.getCanvas().style.cursor="grab",this.keepHovering=!0;const t=this.map.querySourceFeatures(this.hoveredStateId.layerId);this.selectedFeature=t.filter((e=>e.id===this.hoveredStateId.id))[0],this.disablePopup=!0,this.popupEditor.showed=!1,this.map.on("mousemove",this.onMove),this.map.on("mouseup",this.stopMovingNode)}},onMove(e){if(this.map.loaded()&&this.dragNode&&this.selectedFeature){const t={selectedFeature:this.selectedFeature,action:null,lngLat:Object.values(e.lngLat)};"anchorNodes"===this.hoveredStateId.layerId?(t.action="Move Anchor",this.$emit("clickFeature",t)):(t.action="Move Node",this.$emit("clickFeature",t))}},stopMovingNode(e){this.map.getCanvas().style.cursor="pointer",this.map.off("mousemove",this.onMove),this.keepHovering=!1,this.dragNode=!1,this.disablePopup=!1,this.offCursor(),this.map.off("mouseup",this.stopMovingNode)}}},a=(0,o(1900).Z)(i,r,[],!1,null,"58974184",null).exports}}]);
//# sourceMappingURL=681.build.js.map