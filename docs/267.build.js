"use strict";(self.webpackChunkquetzal_network_editor=self.webpackChunkquetzal_network_editor||[]).push([[267],{48735:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(87537),a=r.n(n),s=r(23645),i=r.n(s)()(a());i.push([e.id,".card[data-v-1c21ddff]{height:95%;overflow-y:auto;padding:2.5rem}.card2[data-v-1c21ddff]{height:95%;overflow-y:auto;padding:2.5rem;margin-right:3rem}.row[data-v-1c21ddff]{height:100%}.col[data-v-1c21ddff]{max-height:100%}.title[data-v-1c21ddff]{display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:3.5em;color:#b5e0d6 !important;font-weight:bold}.subtitle[data-v-1c21ddff]{font-size:2em;color:var(--v-secondary-dark);font-weight:bold;margin:10px;margin-left:0px}.card button[data-v-1c21ddff]{margin-top:0px}.background[data-v-1c21ddff]{background-color:var(--v-background-base)}div.gallery[data-v-1c21ddff]{margin:5px;background-color:var(--v-white-base);border:1px solid var(--v-lightgrey-base);float:left;width:50rem}div.gallery[data-v-1c21ddff]:hover{border:1px solid var(--v-darkgrey-base)}div.gallery img[data-v-1c21ddff]{width:100%;height:auto}","",{version:3,sources:["webpack://./src/components/microservices/MatrixRoadCaster.vue"],names:[],mappings:"AAGA,uBACE,UAAA,CACA,eAAA,CACA,cAAA,CAEF,wBACE,UAAA,CACA,eAAA,CACA,cAAA,CACA,iBAAA,CAEF,sBACE,WAAA,CAEF,sBACE,eAAA,CAEF,wBACE,YAAA,CACA,qBAAA,CACA,kBAAA,CACA,sBAAA,CACA,eAAA,CACA,wBAAA,CACA,gBAAA,CAEF,2BACE,aAAA,CACA,6BAAA,CACA,gBAAA,CACA,WAAA,CACA,eAAA,CAEF,8BACE,cAAA,CAEF,6BACE,yCAAA,CAGF,6BACE,UAAA,CACA,oCAAA,CACA,wCAAA,CACA,UAAA,CACA,WAAA,CAGF,mCACE,uCAAA,CAGF,iCACE,UAAA,CACA,WAAA",sourcesContent:['@import "@scss/variables.scss";\n\n\n.card {\n  height: 95%;\n  overflow-y: auto;\n  padding: 2.5rem;\n}\n.card2 {\n  height: 95%;\n  overflow-y: auto;\n  padding: 2.5rem;\n  margin-right: 3rem;\n}\n.row {\n  height: 100%\n}\n.col {\n  max-height: 100%;\n}\n.title {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  font-size: 3.5em;\n  color: $primary !important;\n  font-weight: bold;\n}\n.subtitle {\n  font-size: 2em;\n  color:var(--v-secondary-dark);\n  font-weight: bold;\n  margin: 10px;\n  margin-left: 0px;\n}\n.card button {\n  margin-top: 0px;\n}\n.background {\n  background-color:var(--v-background-base);\n}\n\ndiv.gallery {\n  margin: 5px;\n  background-color: var(--v-white-base);\n  border: 1px solid var(--v-lightgrey-base);\n  float: left;\n  width: 50rem;\n}\n\ndiv.gallery:hover {\n  border: 1px solid var(--v-darkgrey-base);\n}\n\ndiv.gallery img {\n  width: 100%;\n  height: auto;\n}\n\n'],sourceRoot:""}]);const o=i},22267:(e,t,r)=>{r.r(t),r.d(t,{default:()=>b});var n=function(){var e=this,t=e._self._c;return t("v-row",{staticClass:"ma-0 pa-2 background"},[t("v-col",[t("v-card",{staticClass:"card"},[t("v-card-title",{staticClass:"subtitle"},[e._v("\n        "+e._s(e.$gettext("ML Matrix Road Caster"))+"\n      ")]),e._v(" "),t("p",[e._v(" "+e._s(e.$gettext("1) Find n zones centroids using a Kmean clustering on the nodes")))]),e._v(" "),t("p",[e._v(" "+e._s(e.$gettext("2) Call the Here Matrix API on random OD ( around 1% is sufficient )")))]),e._v(" "),t("p",[e._v(" "+e._s(e.$gettext("3) Interpolate every other OD time with an hybrid Machine learning model")))]),e._v(" "),t("p",[e._v(" "+e._s(e.$gettext("4) ajust the speed on the road network to match the routing time with the OD time using an iterative algorithm")))]),e._v(" "),t("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:e.validForm,callback:function(t){e.validForm=t},expression:"validForm"}},e._l(e.parameters,(function(r,n){return t("div",{key:n},[void 0===r.items?t("v-text-field",{attrs:{type:r.type,label:e.$gettext(r.text),suffix:r.units,hint:e.showHint?e.$gettext(r.hint):"","persistent-hint":e.showHint,rules:r.rules.map((t=>e.rules[t])),required:""},on:{wheel:()=>{}},model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"item.value"}}):t("v-select",{attrs:{type:r.type,items:r.items,label:e.$gettext(r.text),suffix:r.units,hint:e.showHint?e.$gettext(r.hint):"","persistent-hint":e.showHint,rules:r.rules.map((t=>e.rules[t])),required:""},on:{wheel:()=>{}},model:{value:r.value,callback:function(t){e.$set(r,"value",t)},expression:"item.value"}})],1)})),0),e._v(" "),t("v-card-actions",[t("v-btn",{attrs:{color:"success",loading:e.running||"RUNNING"===e.importStatus,disabled:e.running||"RUNNING"===e.importStatus||!e.validForm},on:{click:function(t){return e.run()}}},[t("v-icon",{staticStyle:{"margin-right":"10px"},attrs:{small:""}},[e._v("\n            fa-solid fa-play\n          ")]),e._v("\n          "+e._s(e.$gettext("Run"))+"\n        ")],1),e._v(" "),t("v-btn",{directives:[{name:"show",rawName:"v-show",value:"RUNNING"==e.importStatus,expression:"importStatus == 'RUNNING'"}],attrs:{color:"grey",text:""},on:{click:function(t){return e.stopRun()}}},[e._v("\n          "+e._s(e.$gettext("Abort"))+"\n        ")]),e._v(" "),t("v-card-text",{directives:[{name:"show",rawName:"v-show",value:"RUNNING"==e.importStatus,expression:"importStatus == 'RUNNING'"}]},[e._v("\n          ~ "+e._s(e.timer>0?Math.ceil(e.timer/60):e.$gettext("less than 1"))+e._s(e.$gettext(" minutes remaining"))+"\n        ")]),e._v(" "),t("v-spacer"),e._v(" "),t("v-btn",{attrs:{icon:"",small:""},on:{click:function(t){e.showHint=!e.showHint}}},[t("v-icon",[e._v("far fa-question-circle small")])],1)],1)],1)],1),e._v(" "),t("v-col",[t("v-card",{staticClass:"card2"},[t("v-card-title",{staticClass:"subtitle"},[e._v("\n        "+e._s(e.$gettext("Calibration Results"))+"\n      ")]),e._v(" "),t("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.imgs.length>0,expression:"imgs.length>0"}],attrs:{loading:e.applying,disabled:e.applying},on:{click:e.ApplyResults}},[t("v-icon",{staticStyle:{"margin-right":"10px"},attrs:{small:""}},[e._v("\n          fa-solid fa-upload\n        ")]),e._v("\n        "+e._s(e.$gettext("Apply Road links to project"))+"\n      ")],1),e._v(" "),t("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.imgs.length>0,expression:"imgs.length>0"}],attrs:{loading:e.exporting,disabled:e.exporting},on:{click:e.download}},[t("v-icon",{staticStyle:{"margin-right":"10px"},attrs:{small:""}},[e._v("\n          fa-solid fa-download\n        ")]),e._v("\n        "+e._s(e.$gettext("Download"))+"\n      ")],1),e._v(" "),e.error?t("v-alert",{attrs:{dense:"",outlined:"",text:"",type:"error"}},[e._v("\n        "+e._s(e.$gettext("Service ended with an execution error or have been aborted.           Please retry. If the problem persist, contact us."))+"\n        "),e._l(Object.keys(e.errorMessage),(function(r){return t("p",{key:r},[t("b",[e._v(e._s(r)+": ")]),e._v(e._s(e.errorMessage[r])+"\n        ")])}))],2):e._e(),e._v(" "),e._l(e.imgs,(function(e,r){return t("div",{key:r,staticClass:"gallery"},[t("v-img",{attrs:{src:e,alt:"image",contain:""}})],1)}))],2)],1)],1)};n._withStripped=!0;var a=r(60887);const s={name:"MatrixRoadCaster",components:{},data(){return{imgs:[],exporting:!1,applying:!1,validForm:!0,parameters:[{name:"num_zones",text:"number of zones",value:null,type:"Number",units:"",hint:"number of zones. road nodes will be aggregate to form centroids",rules:["required","largerThanZero"]},{name:"train_size",text:"number of OD (api call)",value:null,type:"Number",units:"",hint:"number of OD to get from the API, the rest will be interpolated with ML",rules:["required","largerThanZero"]},{name:"date_time",text:"date Time",value:null,type:"String",units:"",hint:"DateTime in the past. (YYYY-MM-DDTHH:MM:SS(UTC-timezone) (-04:00 for montreal))",rules:["required","dateTimeRule"]},{name:"ff_time_col",text:"freeflow time on roads",value:null,items:this.$store.getters.rlineAttributes,type:"String",units:"",hint:"road links time (link length / speed) to use as a first approximation. this is the freeflow speed, or speed limit",rules:["required"]},{name:"max_speed",text:"max speed on road",value:null,type:"Number",units:"",hint:"Maximum allowed speed on a road. applying an OD matrix on the road network could result il unrealistic speed if not used.",rules:["required","largerThanZero"]},{name:"num_random_od",text:"number of OD to plot",value:null,type:"Number",units:"",hint:"number of OD calibration plot to produce. those are random OD.",rules:["required","largerThanZero"]},{name:"hereApiKey",text:"HERE api key",value:null,type:"String",units:"",hint:"HERE api key to download a set of OD",rules:["required"]}],showHint:!1,re:/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,rules:{required:e=>!!e||"Required",largerThanZero:e=>e>0||"should be larger than 0",nonNegative:e=>e>=0||"should be larger or equal to 0",dateTimeRule:e=>this.re.test(e)||"invalid date time"}}},computed:{bucket(){return this.$store.getters["runMRC/bucket"]},callID(){return this.$store.getters["runMRC/callID"]},timer(){return this.$store.getters["runMRC/timer"]},importStatus(){return this.$store.getters["runMRC/status"]},running(){return this.$store.getters["runMRC/running"]},error(){return this.$store.getters["runMRC/error"]},errorMessage(){return this.$store.getters["runMRC/errorMessage"]}},watch:{importStatus(e){"SUCCEEDED"===e&&this.getImagesURL()}},created(){const e=this.$store.getters["runMRC/parameters"];this.parameters.forEach((t=>t.value=e[t.name])),this.callID&&this.getImagesURL()},methods:{run(){if(!this.$refs.form.validate())return;this.$store.commit("runMRC/setCallID");const e={callID:this.callID};this.parameters.forEach((t=>{e[t.name]=t.value})),this.$store.dispatch("runMRC/startExecution",{rlinks:this.$store.getters.rlinks,rnodes:this.$store.getters.rnodes,parameters:e})},stopRun(){this.$store.dispatch("runMRC/stopExecution")},async ApplyResults(){this.applying=!0;const e=await a.Z.readJson(this.bucket,this.callID.concat("/road_links.geojson"));this.$store.commit("loadrLinks",e);const t=await a.Z.readJson(this.bucket,this.callID.concat("/road_nodes.geojson"));this.$store.commit("loadrNodes",t),this.applying=!1,this.$store.commit("changeNotification",{text:"Road links applied!",autoClose:!0,color:"success"})},async getImagesURL(){const e=(await a.Z.listFiles(this.bucket,this.callID+"/")).filter((e=>e.endsWith(".png")));for(const t of e){const e=await a.Z.getImagesURL(this.bucket,t);this.imgs.push(e)}},async download(){this.exporting=!0,await a.Z.downloadFolder(this.bucket,this.callID.concat("/")),this.exporting=!1}}};var i=r(93379),o=r.n(i),l=r(7795),d=r.n(l),u=r(90569),c=r.n(u),m=r(3565),A=r.n(m),g=r(19216),h=r.n(g),v=r(44589),p=r.n(v),f=r(48735),C={};C.styleTagTransform=p(),C.setAttributes=A(),C.insert=c().bind(null,"head"),C.domAPI=d(),C.insertStyleElement=h(),o()(f.Z,C),f.Z&&f.Z.locals&&f.Z.locals;const b=(0,r(51900).Z)(s,n,[],!1,null,"1c21ddff",null).exports}}]);
//# sourceMappingURL=267.build.js.map