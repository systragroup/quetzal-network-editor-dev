"use strict";(self.webpackChunkquetzal_network_editor=self.webpackChunkquetzal_network_editor||[]).push([[643],{21852:(e,t,o)=>{o.d(t,{Z:()=>n});var s=o(87537),r=o.n(s),a=o(23645),i=o.n(a)()(r());i.push([e.id,".map[data-v-36ea0e40]{max-width:100rem;min-width:50rem;height:45rem}.freeform-button[data-v-36ea0e40]{position:absolute;top:5px;right:5px}","",{version:3,sources:["webpack://./src/components/microservices/MapSelector.vue"],names:[],mappings:"AAGA,sBACE,gBAAA,CACA,eAAA,CACA,YAAA,CAEF,kCACE,iBAAA,CACA,OAAA,CACA,SAAA",sourcesContent:['@import "@scss/variables.scss";\n\n\n.map {\n  max-width: 100rem;\n  min-width:50rem;\n  height: 45rem;\n}\n.freeform-button {\n  position: absolute;\n  top: 5px;\n  right: 5px;\n}\n\n'],sourceRoot:""}]);const n=i},22326:(e,t,o)=>{o.d(t,{Z:()=>n});var s=o(87537),r=o.n(s),a=o(23645),i=o.n(a)()(r());i.push([e.id,".card[data-v-49dba066]{height:100%;overflow-y:auto;padding:2.5rem}.map[data-v-49dba066]{max-width:100rem;width:50rem;height:35rem}.v-card__text[data-v-49dba066]{padding:0px 24px 0px}.freeform-button[data-v-49dba066]{position:absolute;top:5px;right:5px}","",{version:3,sources:["webpack://./src/components/microservices/OSMImporter.vue"],names:[],mappings:"AAGA,uBACE,WAAA,CACA,eAAA,CACA,cAAA,CAEF,sBACE,gBAAA,CACA,WAAA,CACA,YAAA,CAEF,+BACI,oBAAA,CAEJ,kCACE,iBAAA,CACA,OAAA,CACA,SAAA",sourcesContent:['@import "@scss/variables.scss";\n\n\n.card {\n  height: 100%;\n  overflow-y: auto;\n  padding: 2.5rem;\n}\n.map {\n  max-width: 100rem;\n  width:50rem;\n  height: 35rem;\n}\n.v-card__text {\n    padding: 0px 24px 0px;\n}\n.freeform-button {\n  position: absolute;\n  top: 5px;\n  right: 5px;\n}\n'],sourceRoot:""}]);const n=i},94209:(e,t,o)=>{o.d(t,{Z:()=>n});var s=o(87537),r=o.n(s),a=o(23645),i=o.n(a)()(r());i.push([e.id,".layout[data-v-3e11cc5a]{position:absolute;width:100%;height:calc(100% - 50px);display:flex;flex-flow:row;justify-content:center;align-items:center}.layout-overlay[data-v-3e11cc5a]{height:100%;width:100%;background-color:var(--v-background-base);position:absolute}.subtabs[data-v-3e11cc5a]{border-top:1px solid var(--v-background-lighten3)}","",{version:3,sources:["webpack://./src/pages/Microservices.vue"],names:[],mappings:"AAEA,yBACE,iBAAA,CACA,UAAA,CACA,wBAAA,CACA,YAAA,CACA,aAAA,CACA,sBAAA,CACA,kBAAA,CAEF,iCACE,WAAA,CACA,UAAA,CACA,yCAAA,CAEA,iBAAA,CAEF,0BACE,iDAAA",sourcesContent:['@import "@scss/variables.scss";\n\n.layout {\n  position: absolute;\n  width: calc(100%);\n  height: calc(100% - 50px);\n  display: flex;\n  flex-flow: row;\n  justify-content: center;\n  align-items: center;\n}\n.layout-overlay {\n  height: 100%;\n  width: 100%;\n  background-color:var(--v-background-base);\n\n  position: absolute;\n}\n.subtabs{\n  border-top: 1px solid var(--v-background-lighten3)\n\n}\n'],sourceRoot:""}]);const n=i},39492:(e,t,o)=>{o.d(t,{Z:()=>E});var s=function(){var e=this,t=e._self._c;return t("MglMap",{key:e.mapStyle,staticClass:"map",attrs:{center:e.$store.getters.mapCenter,zoom:e.$store.getters.mapZoom,"min-zoom":3,"access-token":e.mapboxPublicKey,"map-style":e.mapStyle},on:{load:e.onMapLoaded,click:e.addNode}},[t("MglScaleControl",{attrs:{position:"bottom-right"}}),e._v(" "),t("MglNavigationControl",{attrs:{position:"bottom-right"}}),e._v(" "),[t("v-btn",{staticClass:"freeform-button",attrs:{fab:"",small:""},on:{click:e.toggleFreeForm}},[t("v-icon",{attrs:{color:"regular"}},[e._v("\n        "+e._s(e.freeForm?"far fa-square":"fas fa-vector-square")+"\n      ")])],1)],e._v(" "),t("MglGeojsonLayer",{attrs:{"source-id":"polygon",source:{type:"geojson",data:e.poly,promoteId:"index"},"layer-id":"poly",layer:{interactive:!0,type:"fill",paint:{"fill-color":e.$vuetify.theme.currentTheme.linksprimary,"fill-opacity":.3}}},on:{mouseover:e.onHover,mouseleave:e.offHover}}),e._v(" "),t("MglGeojsonLayer",{attrs:{"source-id":"polygon",type:"line",source:"polygon","layer-id":"stroke",layer:{type:"line",paint:{"line-color":e.$vuetify.theme.currentTheme.linksprimary,"line-width":3}}}}),e._v(" "),e.mapIsLoaded?t("NodesLayer",{attrs:{map:e.map,nodes:e.freeForm?e.nodes:e.nodesHeader,active:e.freeForm},on:{move:e.moveNode,rightClick:e.removeNode}}):e._e()],2)};s._withStripped=!0;var r=o(1963),a=function(){var e=this;return(0,e._self._c)("MglGeojsonLayer",{attrs:{"source-id":"nodes",source:{type:"geojson",data:e.nodes,buffer:0,promoteId:"index"},"layer-id":"nodes",layer:{interactive:!0,type:"circle",paint:{"circle-color":"#ffffff","circle-opacity":.5,"circle-radius":["case",["boolean",["feature-state","hover"],!1],10,5],"circle-blur":["case",["boolean",["feature-state","hover"],!1],.3,0],"circle-stroke-color":e.$vuetify.theme.currentTheme.darkgrey,"circle-stroke-width":2}}},on:{mouseover:e.onCursor,mouseleave:e.offCursor,mousedown:e.moveNode,contextmenu:e.rightClick}})};a._withStripped=!0;const i={name:"NodesLayer",components:{MglGeojsonLayer:r.tf},props:["map","nodes","active"],event:["move","rightClick"],data:()=>({hoveredStateId:null,keepHovering:!1,dragNode:!1}),computed:{},watch:{},created(){},methods:{onCursor(e){if(this.active&&null===this.hoveredStateId){this.map.getCanvas().style.cursor="pointer";const t=[...new Set(e.mapboxEvent.features.map((e=>e.id)))];this.hoveredStateId={layerId:e.layerId,id:t},this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id[0]},{hover:!0})}},offCursor(e){this.active&&null!==this.hoveredStateId&&(this.keepHovering?this.dragNode=!0:(this.map.getCanvas().style.cursor="",this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id[0]},{hover:!1}),this.hoveredStateId=null))},rightClick(e){if(!this.dragNode&&"nodes"===this.hoveredStateId?.layerId){const e=this.map.querySourceFeatures(this.hoveredStateId.layerId).filter((e=>e.id===this.hoveredStateId.id[0]))[0],t={selectedFeature:e};e&&this.$emit("rightClick",t)}},moveNode(e){if(this.active&&"nodes"===this.hoveredStateId?.layerId&&0===e.mapboxEvent.originalEvent.button){e.mapboxEvent.preventDefault(),this.map.getCanvas().style.cursor="grab",this.keepHovering=!0;const t=this.map.querySourceFeatures(this.hoveredStateId.layerId);this.selectedFeature=t.filter((e=>e.id===this.hoveredStateId.id[0]))[0],this.selectedFeature?.properties&&(this.map.on("mousemove",this.onMove),this.map.on("mouseup",this.stopMovingNode))}},onMove(e){if(this.dragNode&&this.selectedFeature){const t={selectedFeature:this.selectedFeature,lngLat:Object.values(e.lngLat)};this.$emit("move",t)}},stopMovingNode(e){this.active&&0===e.originalEvent.button&&(this.map.getCanvas().style.cursor="pointer",this.map.off("mousemove",this.onMove),this.keepHovering=!1,this.dragNode=!1,this.map.getCanvas().style.cursor="",this.hoveredStateId&&this.map.setFeatureState({source:this.hoveredStateId.layerId,id:this.hoveredStateId.id[0]},{hover:!1}),this.hoveredStateId=null,this.map.off("mouseup",this.stopMovingNode))}}};var n=o(51900);const l=(0,n.Z)(i,a,[],!1,null,"512658b6",null).exports;var d=o(95637),c=o(95),h=o(23384),p=o.n(h),m=o(59903),u=o.n(m),v=o(50253);const g=o(7597),y={name:"MapSelector",events:["change"],components:{MglMap:r.Q3,MglNavigationControl:r.RV,MglScaleControl:r.RQ,MglGeojsonLayer:r.tf,NodesLayer:l},data:()=>({mapIsLoaded:!1,mapboxPublicKey:"pk.eyJ1Ijoic2JvaXZpbiIsImEiOiJja3BlMm41cm4xa2QyMnZwZTBqdGx4bHI0In0.11oH2-B2g9J6LarDnoqQfQ",poly:null,nodes:{},freeForm:!1}),computed:{mapStyle(){return this.$store.getters.mapStyle},rlinksIsEmpty(){return this.$store.getters.rlinksIsEmpty},nodesHeader(){return this.$store.getters.nodesHeader}},watch:{mapStyle(){try{this.map.removeLayer("stroke")}catch(e){}}},beforeDestroy(){const e=this.map?.getCenter();e&&this.$store.commit("saveMapPosition",{mapCenter:[e.lng,e.lat],mapZoom:this.map.getZoom()}),this.$store.commit("saveImportPoly",{freeForm:this.freeForm,poly:this.poly});try{this.map.removeLayer("stroke")}catch(e){}},async created(){},methods:{onMapLoaded(e){e.map.dragRotate.disable(),this.map=e.map,this.map.on("dragend",this.getBounds),this.map.on("zoomend",this.getBounds),this.freeForm=!1,this.$store.getters.importPoly?.freeForm?(this.poly=this.$store.getters.importPoly.poly,this.toggleFreeForm()):this.getBounds(),this.mapIsLoaded=!0},getBounds(){const e=this.map.getBounds(),t=(0,c.Z)([e._sw.lng,e._sw.lat,e._ne.lng,e._ne.lat]);this.poly=(0,d.Z)(t,-.1*(e._ne.lat-e._sw.lat),{units:"degrees"}),this.poly.geometry.coordinates[0]=this.poly.geometry.coordinates[0].reverse();const o=[e._sw.lat,e._sw.lng,e._ne.lat,e._ne.lng];this.$emit("change",{style:"bbox",geometry:o})},toggleFreeForm(e){this.freeForm=!this.freeForm,this.freeForm?(this.map.off("dragend",this.getBounds),this.map.off("zoomend",this.getBounds),this.getNodes(),this.$store.commit("changeNotification",{text:"Click to add points. Right click de remove",autoClose:!1})):(this.map.on("dragend",this.getBounds),this.map.on("zoomend",this.getBounds),this.getBounds(),this.$store.commit("changeNotification",{text:"",autoClose:!0}))},onHover(){this.freeForm&&(this.map.getCanvas().style.cursor="pointer")},offHover(){this.freeForm&&(this.map.getCanvas().style.cursor="")},getNodes(){const e=structuredClone(this.nodesHeader),t=this.poly.geometry.coordinates[0];t.slice(0,t.length-1).forEach(((t,o)=>e.features.push(p()(t,{index:g.generate(),coordinatesIndex:o})))),this.nodes=e,this.$emit("change",{style:"poly",geometry:this.poly.geometry.coordinates[0]})},moveNode(e){const t=e.selectedFeature.properties.coordinatesIndex,o=this.poly.geometry.coordinates[0];o[t]=e.lngLat,0===t&&(o[o.length-1]=e.lngLat),this.getNodes()},removeNode(e){const t=e.selectedFeature.properties.coordinatesIndex,o=this.poly.geometry.coordinates[0];o.length<=4?this.$store.commit("changeNotification",{text:"Cannot delete anymore",autoClose:!0}):0===t?this.$store.commit("changeNotification",{text:"cannot delete first point of polygon",autoClose:!0}):(this.poly.geometry.coordinates[0]=[...o.slice(0,t),...o.slice(t+1)],this.getNodes())},addNode(e){if(this.freeForm){const t=this.poly.geometry.coordinates[0],o=e.mapboxEvent.lngLat,s=u()(t),r=p()(Object.values(o)),a=(0,v.Z)(s,r,{units:"kilometers"}).properties.index+1;t.splice(a,0,Object.values(o)),this.getNodes()}}}};var A=o(93379),b=o.n(A),f=o(7795),C=o.n(f),_=o(90569),w=o.n(_),x=o(3565),k=o.n(x),S=o(19216),I=o.n(S),M=o(44589),F=o.n(M),O=o(21852),$={};$.styleTagTransform=F(),$.setAttributes=k(),$.insert=w().bind(null,"head"),$.domAPI=C(),$.insertStyleElement=I(),b()(O.Z,$),O.Z&&O.Z.locals&&O.Z.locals;const E=(0,n.Z)(y,s,[],!1,null,"36ea0e40",null).exports},36643:(e,t,o)=>{o.r(t),o.d(t,{default:()=>I});var s=function(){var e=this,t=e._self._c;return t("section",[t("v-tabs",{attrs:{centered:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[t("v-tab",[e._v("OSM importer")]),e._v(" "),t("v-tab",[e._v("GTFS importer")]),e._v(" "),t("v-tab",[e._v("Matrix Road Caster")])],1),e._v(" "),1===e.tab?t("v-tabs",{staticClass:"subtabs",attrs:{centered:""},model:{value:e.subtab,callback:function(t){e.subtab=t},expression:"subtab"}},[t("v-tab",[e._v("Zip importer")]),e._v(" "),t("v-tab",[e._v("Web importer")])],1):e._e(),e._v(" "),t("div",{staticClass:"layout"},[t("div",{staticClass:"layout-overlay"}),e._v(" "),0===e.tab?t("OSMImporter"):1===e.tab&&0===e.subtab?t("GTFSZipImporter"):1===e.tab&&1===e.subtab?t("GTFSWebImporter"):2===e.tab?t("MatrixRoadCaster"):e._e()],1)],1)};s._withStripped=!0;var r=function(){var e=this,t=e._self._c;return t("section",[t("v-card",{staticClass:"card"},[t("v-card-title",[e._v("\n      "+e._s(e.$gettext("Import OSM network in bounding box"))+"\n    ")]),e._v(" "),t("v-spacer"),e._v(" "),t("v-card-subtitle",[e.error?t("v-alert",{attrs:{dense:"",width:"50rem",outlined:"",text:"",type:"error"}},[e._v("\n        "+e._s(e.$gettext("There as been an error while importing OSM network.           Please try again. If the problem persist, contact us."))+"\n        "),e._l(Object.keys(e.errorMessage),(function(o){return t("p",{key:o},[t("b",[e._v(e._s(o)+": ")]),e._v(e._s(e.errorMessage[o])+"\n        ")])}))],2):e._e()],1),e._v(" "),t("v-card-actions",[t("MapSelector",{on:{change:e.getBBOX}})],1),e._v(" "),t("v-divider"),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),t("v-select",{attrs:{items:e.highwayList,attach:"",chips:"","menu-props":{top:!0,offsetY:!0},label:"Highways to import",multiple:""},scopedSlots:e._u([{key:"selection",fn:function({item:o,index:s}){return[s<=0?t("v-chip",[t("span",[e._v(e._s(o))])]):e._e(),e._v(" "),1===s?t("span",{staticClass:"grey--text text-caption"},[e._v("\n            (+"+e._s(e.selectedHighway.length-1+" "+e.$gettext("more"))+" )\n          ")]):e._e()]}}]),model:{value:e.selectedHighway,callback:function(t){e.selectedHighway=t},expression:"selectedHighway"}}),e._v(" "),t("v-spacer"),e._v(" "),t("v-btn",{attrs:{text:"",outlined:"",color:"success",loading:e.running,disabled:e.running},on:{click:e.importOSM}},[e._v("\n        "+e._s(e.$gettext("Download"))+"\n      ")])],1)],1),e._v(" "),t("v-dialog",{attrs:{persistent:"","max-width":"500"},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.applyOverwriteDialog.apply(null,arguments)},function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"]))return null;e.showOverwriteDialog=!1}]},model:{value:e.showOverwriteDialog,callback:function(t){e.showOverwriteDialog=t},expression:"showOverwriteDialog"}},[t("v-card",[t("v-card-title",{staticClass:"text-h5"},[e._v("\n        "+e._s(e.$gettext("Overwrite current road network ?"))+"\n      ")]),e._v(" "),t("v-card-actions",[t("v-spacer"),e._v(" "),t("v-btn",{attrs:{color:"regular"},on:{click:function(t){e.showOverwriteDialog=!e.showOverwriteDialog}}},[e._v("\n          "+e._s(e.$gettext("No"))+"\n        ")]),e._v(" "),t("v-btn",{attrs:{color:"primary"},on:{click:e.applyOverwriteDialog}},[e._v("\n          "+e._s(e.$gettext("Yes"))+"\n        ")])],1)],1)],1)],1)};r._withStripped=!0;var a=o(36463),i=o(75997),n=o(34221);const l={name:"OSMImporter",components:{MapSelector:o(39492).Z},data:()=>({showOverwriteDialog:!1,poly:null,nodes:{},selectedHighway:null,highwayList:a.$z}),computed:{rlinksIsEmpty(){return this.$store.getters.rlinksIsEmpty},highway(){return this.$store.getters["runOSM/highway"]},callID(){return this.$store.getters["runOSM/callID"]},running(){return this.$store.getters["runOSM/running"]},error(){return this.$store.getters["runOSM/error"]},errorMessage(){return this.$store.getters["runOSM/errorMessage"]}},watch:{selectedHighway(e){this.$store.commit("runOSM/changeHighway",e)}},created(){this.selectedHighway=this.highway},methods:{getBBOX(e){this.poly=e},importOSM(){this.rlinksIsEmpty?(this.$store.commit("runOSM/setCallID"),this.$store.dispatch("runOSM/startExecution",{coords:this.poly.geometry,method:this.poly.style})):this.showOverwriteDialog=!0},applyOverwriteDialog(){this.$store.commit("loadrLinks",i.Z),this.$store.commit("loadrNodes",n.Z),this.showOverwriteDialog=!1,this.importOSM()}}};var d=o(93379),c=o.n(d),h=o(7795),p=o.n(h),m=o(90569),u=o.n(m),v=o(3565),g=o.n(v),y=o(19216),A=o.n(y),b=o(44589),f=o.n(b),C=o(22326),_={};_.styleTagTransform=f(),_.setAttributes=g(),_.insert=u().bind(null,"head"),_.domAPI=p(),_.insertStyleElement=A(),c()(C.Z,_),C.Z&&C.Z.locals&&C.Z.locals;var w=o(51900);const x={name:"Microservices",components:{MatrixRoadCaster:()=>o.e(267).then(o.bind(o,22267)),OSMImporter:(0,w.Z)(l,r,[],!1,null,"49dba066",null).exports,GTFSWebImporter:()=>o.e(170).then(o.bind(o,36170)),GTFSZipImporter:()=>o.e(301).then(o.bind(o,64301))},props:{value:{type:Array,default:()=>[]}},data:()=>({tab:0,subtab:0})};var k=o(94209),S={};S.styleTagTransform=f(),S.setAttributes=g(),S.insert=u().bind(null,"head"),S.domAPI=p(),S.insertStyleElement=A(),c()(k.Z,S),k.Z&&k.Z.locals&&k.Z.locals;const I=(0,w.Z)(x,s,[],!1,null,"3e11cc5a",null).exports}}]);
//# sourceMappingURL=643.build.js.map