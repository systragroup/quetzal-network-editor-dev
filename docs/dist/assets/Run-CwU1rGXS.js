import{_ as H,ae as ee,af as K,ag as j,e as g,p as ae,r as A,ah as se,w as O,f as oe,g as o,h as V,i as a,j as s,ab as te,x as f,y as r,ai as v,q as m,l as T,v as E,U as ue,aj as re,F as P,E as N,ak as ie,al as de,am as ce,a1 as le,Z as pe,N as ve,an as fe,z as Y,a4 as me,ao as ge,a2 as ye,G as q,a3 as Ve,V as G,L as Z,ap as _e,t as he,C as be,A as ne,D as xe,J as X,B as Se,a9 as ke,u as we,Y as Le,X as Q,aq as Ce,ar as $e,as as Ue,at as M,au as W}from"./index-D0Ou50ha.js";const Ee={key:0,class:"info-div"},Fe={class:"expansion"},Re={key:0,class:"custom-hint"},Te=["onDblclick"],Ae=["onUpdate:modelValue"],Pe={__name:"ParamForm",setup(z){const{$gettext:u}=ee(),_=K(),n=j();function C(e,l){return Array.isArray(e)?e.includes(l):e===l}const I=g(()=>_.selectedStepFunction),p=g(()=>_.parameters.filter(e=>Object.keys(e).includes("category")&&C(e.model,I.value))),w=g(()=>{var l;let e=_.parameters.filter(S=>S==null?void 0:S.info);return e=e.filter(S=>C(S.model,I.value)),(l=e[0])==null?void 0:l.info}),L=g(()=>n.scenariosList),h=g(()=>n.scenario);function b(){for(const e of p.value)for(const l of e.params)if(l.items==="$scenarios"){const S=L.value.map(k=>k.scenario);Array.isArray(l.value)?l.value=l.value.filter(k=>S.includes(k)):l.value=S.includes(l.value)?l.value:""}}ae(()=>{b()});function x(e){return e.items==="$scenarios"?L.value.map(l=>l.scenario).filter(l=>l!==h.value):e.items}function B(){_.getParameters()}const $=A([...Array(p.value.length).keys()].map((e,l)=>l));function U(){$.value.length<p.value.length?$.value=[...Array(p.value.length).keys()].map((e,l)=>l):$.value=[]}const F={required:e=>e!=null||u("Required"),largerThanZero:e=>e>0||u("should be larger than 0"),nonNegative:e=>e>=0||u("should be larger or equal to 0")},R=A(!1),y=A(!1),c=se("editRef");function i(e,l){y.value=!0;const k=p.value.slice(0,e).map(D=>D.params.length).reduce((D,t)=>D+t,0)+l;_e(()=>c.value[k].focus())}return O(R,e=>{e||(y.value=!1)}),(e,l)=>{const S=oe("v-number-input");return o(),V(Z,{class:"card"},{default:a(()=>[s(te,{class:"subtitle"},{default:a(()=>[f(r(v(u)("Scenario Settings")),1)]),_:1}),w.value?(o(),m("div",Ee,r(w.value),1)):T("",!0),E("div",Fe,[s(ue,{ref:"form","lazy-validation":""},{default:a(()=>[s(re,{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=k=>$.value=k),multiple:""},{default:a(()=>[(o(!0),m(P,null,N(p.value,(k,D)=>(o(),V(ie,{key:D},{default:a(()=>[s(de,{class:"categorie"},{default:a(()=>[f(r(k.category),1)]),_:2},1024),s(ce,{style:{"background-color":"rgb(var(--v-theme-lightgrey))"}},{default:a(()=>[(o(!0),m(P,null,N(k.params,(t,J)=>(o(),m("li",{key:J,class:"param-list"},[typeof t.items>"u"&&typeof t.value=="boolean"?(o(),V(le,{key:0,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,color:"primary",density:"compact",class:"pl-2","hide-details":"",label:v(u)(t.text),"persistent-hint":R.value},null,8,["modelValue","onUpdate:modelValue","label","persistent-hint"])):t.type=="Number"?(o(),V(S,{key:1,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,variant:"outlined","control-variant":"stacked",type:t.type,label:v(u)(t.text),suffix:t.units,"hide-details":"",rules:t.rules.map(d=>F[d]),onKeydown:l[0]||(l[0]=d=>console.log(d))},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):typeof t.items>"u"?(o(),V(pe,{key:2,modelValue:t.value,"onUpdate:modelValue":d=>t.value=d,variant:"outlined","hide-details":"",type:t.type,label:v(u)(t.text),suffix:t.units,rules:t.rules.map(d=>F[d])},null,8,["modelValue","onUpdate:modelValue","type","label","suffix","rules"])):(o(),V(ve,{key:3,modelValue:t.value,"onUpdate:modelValue":[d=>t.value=d,d=>b(t)],variant:"outlined","hide-details":"",type:t.type,multiple:t==null?void 0:t.multiple,items:x(t),label:v(u)(t.text),suffix:t.units,rules:t.rules.map(d=>F[d])},null,8,["modelValue","onUpdate:modelValue","type","multiple","items","label","suffix","rules"])),s(fe,null,{default:a(()=>[R.value?(o(),m("div",Re,[y.value?Y((o(),m("textarea",{key:1,ref_for:!0,ref:"editRef","onUpdate:modelValue":d=>t.hint=d,rows:"1",class:"edition",onKeydown:l[1]||(l[1]=me(d=>y.value=!1,["enter"]))},null,40,Ae)),[[ge,t.hint]]):(o(),m("div",{key:0,onDblclick:d=>i(D,J)},r(t.hint),41,Te))])):T("",!0)]),_:2},1024)]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1},512)]),s(ye,null,{default:a(()=>[s(q,{color:"grey",variant:"text",onClick:B},{default:a(()=>[f(r(v(u)("back to default")),1)]),_:1}),s(Ve),s(q,{variant:"text",onClick:U},{default:a(()=>[f(r($.value.length!=p.value.length?v(u)("Expand all"):v(u)("Collapse all")),1)]),_:1}),s(q,{icon:"",size:"small",onClick:l[3]||(l[3]=k=>R.value=!R.value)},{default:a(()=>[s(G,null,{default:a(()=>l[4]||(l[4]=[f("far fa-question-circle small")])),_:1})]),_:1})]),_:1})]),_:1})}}},Ie=H(Pe,[["__scopeId","data-v-cee6087a"]]),De={style:{"white-space":"pre-line"}},Ne={__name:"Logs",props:{disabled:{type:Boolean,default:!1}},setup(z){const u=z,{disabled:_}=he(u),n=K(),C=A(!1),I=g(()=>n.hasLogs),p=A([]);async function w(){await n.getLogs(),p.value=n.logs,p.value.sort((h,b)=>String(h.time).localeCompare(String(b.time),void 0,{sensitivity:"base"})),C.value=!0}async function L(){await n.downloadLogs()}return(h,b)=>(o(),m(P,null,[s(Se,{"close-delay":"100",transition:"slide-y-transition"},{activator:a(({props:x})=>[Y(s(q,be({disabled:v(_),class:"log-button",color:"regular",variant:"outlined","prepend-icon":"fas fa-file-lines","append-icon":"fas fa-caret-down"},x),{default:a(()=>b[1]||(b[1]=[f(" logs ")])),_:2},1040,["disabled"]),[[ne,I.value]])]),default:a(()=>[s(xe,null,{default:a(()=>[s(X,{onClick:w},{prepend:a(()=>[s(G,{icon:"fas fa-eye"})]),default:a(()=>[f(r(h.$gettext("show"))+" ",1)]),_:1}),s(X,{onClick:L},{prepend:a(()=>[s(G,{icon:"fas fa-download"})]),default:a(()=>[f(r(h.$gettext("download"))+" ",1)]),_:1})]),_:1})]),_:1}),s(ke,{modelValue:C.value,"onUpdate:modelValue":b[0]||(b[0]=x=>C.value=x),width:"90%"},{default:a(()=>[s(Z,{style:{"overflow-y":"auto"}},{default:a(()=>[(o(!0),m(P,null,N(p.value,(x,B)=>(o(),m("div",{key:B,class:"log-container"},[E("h1",null,r(x.name),1),E("h3",null,[E("b",null,r(x.time),1)]),E("span",De,r(x.text),1)]))),128))]),_:1})]),_:1},8,["modelValue"])],64))}},qe=H(Ne,[["__scopeId","data-v-c531ebb9"]]),Be={class:"title-container"},Oe={class:"buttons-row ma-2"},ze={key:4},Me={__name:"Run",setup(z){const{$gettext:u}=ee(),_=we(),n=K(),C=j(),I=g(()=>n.steps),p=g(()=>{const y=n.availableModels;return n.avalaibleStepFunctions.filter(c=>y.has(c))}),w=A(n.selectedStepFunction),L=g(()=>n.running),h=g(()=>n.currentStep),b=g(()=>n.error),x=g(()=>n.errorMessage),B=g(()=>n.synchronized),$=g(()=>C.protected),U=g(()=>C.model!==null),F=A(n.endSignal);O(F,()=>n.changeEndSignal(F.value)),ae(async()=>{U.value&&(await n.getSteps(),await n.GetRunningExecution())}),O(p,y=>{U.value&&(y.includes(w.value)||(n.setSelectedStepFunction(y[0]),n.getSteps()))},{once:!0}),O(w,async y=>{U.value&&(p.value.includes(y)?(n.setSelectedStepFunction(y),n.getSteps()):(w.value=p.value[0],n.setSelectedStepFunction(p.value[0]),n.getSteps()))});async function R(){if(await n.GetRunningExecution()){_.changeNotification({text:u("could not start and save. This scenario was already launch by another user."),autoClose:!1,color:"warning"});return}try{const c=j();n.initExecution(),await _.exportToS3("inputs"),await _.deleteOutputsOnS3(),await _.deleteLogsOnS3(),_.deleteOutputs(),n.startExecution({scenario:c.scenario})}catch(c){n.terminateExecution(),console.log(c),_.changeAlert(c)}}return(y,c)=>(o(),V(Le,{class:"background"},{default:a(()=>[s(Q,{order:"1"},{default:a(()=>[s(Ie)]),_:1}),s(Q,{order:"2"},{default:a(()=>[s(Z,{class:"card"},{default:a(()=>[E("div",Be,[s(te,{class:"subtitle"},{default:a(()=>[f(r(v(u)("Scenario Simulation")),1)]),_:1}),s(qe,{disabled:L.value||!U.value},null,8,["disabled"])]),s(Ce,{modelValue:h.value,"onUpdate:modelValue":c[4]||(c[4]=i=>h.value=i),class:"stepper"},{default:a(()=>[p.value.length>1?(o(),V($e,{key:0,modelValue:w.value,"onUpdate:modelValue":c[0]||(c[0]=i=>w.value=i),"show-arrows":"","bg-color":"lightgrey",color:"success","fixed-tabs":""},{default:a(()=>[(o(!0),m(P,null,N(p.value,i=>(o(),V(Ue,{key:i,value:i,disabled:L.value||!U.value},{default:a(()=>[f(r(i),1)]),_:2},1032,["value","disabled"]))),128))]),_:1},8,["modelValue"])):T("",!0),B.value?T("",!0):(o(),V(M,{key:1,density:"compact",variant:"outlined",text:"",type:"warning"},{default:a(()=>[f(r(v(u)("Results are not synchronized with latest modifications.             Please relauch simulation to update results.")),1)]),_:1})),b.value?(o(),V(M,{key:2,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[f(r(v(u)("Simulation ended with an execution error or have been aborted.             Please relauch simulation. If the problem persist, contact us."))+" ",1),(o(!0),m(P,null,N(Object.keys(x.value),i=>(o(),m("p",{key:i},[E("b",null,r(i)+": ",1),f(r(x.value[i]),1)]))),128))]),_:1})):T("",!0),$.value?(o(),V(M,{key:3,density:"compact",variant:"outlined",text:"",type:"error"},{default:a(()=>[f(r(v(u)("This scenario is protected. You can not run simulation.")),1)]),_:1})):T("",!0),E("div",Oe,[s(q,{loading:L.value,disabled:L.value||$.value||!U.value,color:"success","prepend-icon":"fa-solid fa-play",onClick:c[1]||(c[1]=i=>R())},{default:a(()=>[f(r(v(u)("Run Simulation")),1)]),_:1},8,["loading","disabled"]),Y(s(q,{color:"grey",variant:"text",onClick:c[2]||(c[2]=i=>v(n).stopExecution())},{default:a(()=>[f(r(v(u)("Abort")),1)]),_:1},512),[[ne,L.value&&h.value!==1]]),s(le,{modelValue:F.value,"onUpdate:modelValue":c[3]||(c[3]=i=>F.value=i),class:"switch",density:"compact","false-icon":"fas fa-volume-xmark","true-icon":"fas fa-volume-high",inset:"",color:"success","hide-details":""},{prepend:a(()=>[E("span",null,r(v(u)("End signal")),1)]),_:1},8,["modelValue"])]),U.value?(o(),m("div",ze,[(o(!0),m(P,null,N(I.value,(i,e)=>(o(),m("div",{key:e+1},[b.value?(o(),V(W,{key:1,complete:h.value>e+1,title:i.name,value:e+1,step:e+1},null,8,["complete","title","value","step"])):(o(),V(W,{key:0,complete:h.value>e+1,color:h.value>=e+1?"primary":"regular",title:i.name,value:e+1,compact:"",step:e+1},null,8,["complete","color","title","value","step"]))]))),128))])):T("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}},Ge=H(Me,[["__scopeId","data-v-bdf210d1"]]);export{Ge as default};
